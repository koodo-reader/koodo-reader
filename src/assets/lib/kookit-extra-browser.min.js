import e from"axios";import{Storage as t}from"megajs";import{Buffer as r}from"buffer";import{createClient as n,AuthType as i}from"webdav/dist/web/index.js";import{SSE as o}from"sse.js";import{isElectron as s}from"react-device-detect";function a(e,t,r,n){return new(r||(r=Promise))((function(i,o){function s(e){try{c(n.next(e))}catch(e){o(e)}}function a(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}c((n=n.apply(e,t||[])).next())}))}const c=e=>"json"===e?"application/json":["jpg","jpeg","png","gif","bmp"].includes(e)?"image/"+e:"zip"===e?"application/zip":"epub"===e?"application/epub+zip":"txt"===e?"text/plain":"pdf"===e?"application/pdf":"mobi"===e?"application/x-mobipocket-ebook":"azw3"===e||"azw"===e?"application/vnd.amazon.ebook":"cbz"===e?"application/x-cbz":"cbr"===e?"application/x-cbr":"cbt"===e?"application/x-cbt":"cb7"===e?"application/x-cb7":"fb2"===e?"application/x-fictionbook+xml":"html"===e?"text/html":"css"===e?"text/css":"js"===e?"application/javascript":"xml"===e?"application/xml":"xhtml"===e?"application/xhtml+xml":"opf"===e?"application/oebps-package+xml":"ncx"===e?"application/x-dtbncx+xml":"mp3"===e?"audio/mpeg":"wav"===e?"audio/wav":"ogg"===e?"audio/ogg":"mp4"===e?"video/mp4":"webm"===e?"video/webm":"avi"===e?"video/x-msvideo":"wmv"===e?"video/x-ms-wmv":"flv"===e?"video/x-flv":"m3u8"===e?"application/x-mpegURL":"ts"===e?"video/MP2T":"3gp"===e?"video/3gpp":"3g2"===e?"video/3gpp2":"db"===e?"application/x-sqlite3":void 0,u=["books","notes","bookmarks","plugins","words"],d=e=>{const t=atob(e),r=t.length,n=new Uint8Array(r);for(let e=0;e<r;e++)n[e]=t.charCodeAt(e);return n.buffer},l=e=>{let t="";const r=new Uint8Array(e),n=r.byteLength;for(let e=0;e<n;e++)t+=String.fromCharCode(r[e]);return btoa(t)};function h(e){const t=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],r=(e,t)=>e>>>t|e<<32-t,n=(e,t,r)=>e&t^~e&r,i=(e,t,r)=>e&t^e&r^t&r,o=e=>r(e,2)^r(e,13)^r(e,22),s=e=>r(e,6)^r(e,11)^r(e,25),a=e=>r(e,7)^r(e,18)^e>>>3,c=e=>r(e,17)^r(e,19)^e>>>10,u=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],d=8*e.length,l=(960-(8*e.length+1)%512)%512,h=e.length+Math.ceil((l+1)/8)+8,f=new Uint8Array(h);f.set(e),f[e.length]=128;new DataView(f.buffer,f.byteLength-8).setBigUint64(0,BigInt(d),!1);for(let e=0;e<f.length;e+=64){const r=f.subarray(e,e+64),d=new Uint32Array(64);for(let e=0;e<16;e++)d[e]=r[4*e]<<24|r[4*e+1]<<16|r[4*e+2]<<8|r[4*e+3];for(let e=16;e<64;e++)d[e]=c(d[e-2])+d[e-7]+a(d[e-15])+d[e-16]>>>0;let[l,h,p,g,m,y,v,b]=u;for(let e=0;e<64;e++){const r=b+s(m)+n(m,y,v)+t[e]+d[e]>>>0,a=o(l)+i(l,h,p)>>>0;b=v,v=y,y=m,m=g+r>>>0,g=p,p=h,h=l,l=r+a>>>0}u[0]=u[0]+l>>>0,u[1]=u[1]+h>>>0,u[2]=u[2]+p>>>0,u[3]=u[3]+g>>>0,u[4]=u[4]+m>>>0,u[5]=u[5]+y>>>0,u[6]=u[6]+v>>>0,u[7]=u[7]+b>>>0}const p=new ArrayBuffer(32),g=new DataView(p);return u.forEach(((e,t)=>{g.setUint32(4*t,e,!1)})),p}class f{constructor(e){this.queue=[],this.runningTasks=0,this.totalTasks=0,this.completedTasks=0,this.hasFailedTasks=!1,this.maxConcurrency=e}addTask(e){return a(this,void 0,void 0,(function*(){return this.totalTasks++,new Promise(((t,r)=>{const n=()=>a(this,void 0,void 0,(function*(){try{this.runningTasks++;const r=yield e();return this.completedTasks++,t(r),r}catch(e){throw this.completedTasks++,r(e),e}finally{this.runningTasks--,this.runNext()}}));this.runningTasks<this.maxConcurrency?n():this.queue.push(n)}))}))}runNext(){if(this.queue.length>0&&this.runningTasks<this.maxConcurrency){const e=this.queue.shift();e&&e()}}clearQueue(){this.queue=[]}getStats(){return{total:this.totalTasks,completed:this.completedTasks,pending:this.queue.length,running:this.runningTasks,hasFailedTasks:this.hasFailedTasks}}resetCounters(){this.totalTasks=0,this.completedTasks=0,this.hasFailedTasks=!1}}var p={getMimeType:c,getExtension:e=>"application/json"===e?"json":e.startsWith("image/")?e.split("/")[1]:"application/zip"===e?"zip":"application/epub+zip"===e?"epub":"text/plain"===e?"txt":"application/pdf"===e?"pdf":"application/x-mobipocket-ebook"===e?"mobi":"application/vnd.amazon.ebook"===e?"azw3":"application/x-cbz"===e?"cbz":"application/x-cbr"===e?"cbr":"application/x-cbt"===e?"cbt":"application/x-cb7"===e?"cb7":"application/x-fictionbook+xml"===e?"fb2":"text/html"===e?"html":"text/css"===e?"css":"application/javascript"===e?"js":"application/xml"===e?"xml":"application/xhtml+xml"===e?"xhtml":"application/oebps-package+xml"===e?"opf":"application/x-dtbncx+xml"===e?"ncx":"audio/mpeg"===e?"mp3":"audio/wav"===e?"wav":"audio/ogg"===e?"ogg":"video/mp4"===e?"mp4":"video/webm"===e?"webm":"video/x-msvideo"===e?"avi":"video/x-ms-wmv"===e?"wmv":"video/x-flv"===e?"flv":"application/x-mpegURL"===e?"m3u8":"video/MP2T"===e?"ts":"video/3gpp"===e?"3gp":"video/3gpp2"===e?"3g2":"application/x-sqlite3"===e?"db":"",databaseList:u,configList:["themeColors","readingTime","cloudSyncTime","recentBooks","recentAdd","deletedBooks","favoriteBooks","shelfList","txtParsers","noteTags","recordLocation","sortedShelfList","kindleDeviceList"],copyArrayBuffer:e=>{var t=new ArrayBuffer(e.byteLength);return new Uint8Array(t).set(new Uint8Array(e)),t},base64ToArrayBuffer:d,arrayBufferToBase64:l,generateSHA256Hash:function(e){return a(this,void 0,void 0,(function*(){const t=(new TextEncoder).encode(e),r="undefined"!=typeof crypto&&crypto.subtle?yield crypto.subtle.digest("SHA-256",t):h(t),n=Array.from(new Uint8Array(r)).map((e=>e.toString(16).padStart(2,"0"))).join("");return n}))},EmailProviders:["gmail.com","qq.com","163.com","yahoo.com","sina.com","126.com","outlook.com","yeah.net","foxmail.com","hotmail.com","protonmail.com","proton.me","icloud.com","mail.com","live.com","aliyun.com"]};const g={publicUrl:"https://api.960960.xyz",cloudUrl:"https://cloud.960960.xyz",cloudCNUrl:"https://cloud.koodoreader.cn",devUrl:"http://192.168.28.159:8000"},m={callbackUrl:"https://web.koodoreader.com/",dropboxClientId:"vnc67byrssocvy1",pcloudClientId:"pg8ten0B3vH",boxClientId:"ltimecqanmpxoaicn9qw3es6l3sdl1ya",microsoftClientId:"506df58a-29ab-4020-afc5-6f423dc80f35",googleClientId:"1051055003225-ph1f5fvh328dhv7bco5jitlnfhg6ks2t.apps.googleusercontent.com",facebookClientId:"2845583825559500",githubClientId:"Ov23liJVzfvJMMEEZ8v2",adriveClientId:"a128ae7b9c094545af623de61dc0a1ef"},y={google:{clientId:m.googleClientId,scopes:["openid email profile"],usePKCE:!1,responseType:"code",redirectUri:m.callbackUrl,extraParams:{prompt:"consent",scope:"openid email profile"}},microsoft:{clientId:m.microsoftClientId,scopes:["openid","profile","User.Read","offline_access"],usePKCE:!1,responseType:"code",redirectUri:m.callbackUrl,extraParams:{scope:"openid profile User.Read offline_access"}},facebook:{clientId:m.facebookClientId,scopes:[],usePKCE:!1,responseType:"code",redirectUri:m.callbackUrl,extraParams:{scope:""}},github:{clientId:m.githubClientId,scopes:["user:email"],usePKCE:!1,responseType:"code",redirectUri:m.callbackUrl,extraParams:{scope:"user:email"}},email:{clientId:"",scopes:[],usePKCE:!1,responseType:"code",redirectUri:m.callbackUrl,extraParams:{scope:""}}};var v={CloudConfig:g,ThirdpartyConfig:m,LoginAuthRequest:y,LoginDiscovery:{microsoft:{authorizationEndpoint:"https://login.microsoftonline.com/common/oauth2/v2.0/authorize",tokenEndpoint:"https://login.microsoftonline.com/common/oauth2/v2.0/token"},google:{authorizationEndpoint:"https://accounts.google.com/o/oauth2/v2/auth",tokenEndpoint:"https://oauth2.googleapis.com/token"},facebook:{authorizationEndpoint:"https://www.facebook.com/v12.0/dialog/oauth",tokenEndpoint:"https://graph.facebook.com/v12.0/oauth/access_token"},github:{authorizationEndpoint:"https://github.com/login/oauth/authorize",tokenEndpoint:"https://github.com/login/oauth/access_token"},email:{authorizationEndpoint:"",tokenEndpoint:""}},DriveAuthRequest:{dropbox:{clientId:m.dropboxClientId,scopes:[],usePKCE:!1,responseType:"code",redirectUri:m.callbackUrl,extraParams:{token_access_type:"offline"}},boxnet:{clientId:m.boxClientId,scopes:[],usePKCE:!1,responseType:"code",redirectUri:m.callbackUrl,extraParams:{grant_type:"authorization_code",box_subject_type:"enterprise",scope:"root_readwrite"}},pcloud:{clientId:m.pcloudClientId,scopes:[],usePKCE:!1,responseType:"code",redirectUri:m.callbackUrl,extraParams:{grant_type:"authorization_code"}},adrive:{clientId:m.adriveClientId,scopes:[],usePKCE:!1,responseType:"code",redirectUri:m.callbackUrl,extraParams:{grant_type:"authorization_code",scope:"user:base,file:all:write,file:all:read"}},microsoft:{clientId:m.microsoftClientId,scopes:[],usePKCE:!1,responseType:"code",redirectUri:m.callbackUrl,extraParams:{scope:"files.readwrite.appfolder offline_access"}},google:{clientId:m.googleClientId,scopes:[],usePKCE:!1,responseType:"code",redirectUri:m.callbackUrl,extraParams:{prompt:"consent",scope:"https://www.googleapis.com/auth/drive.file",access_type:"offline"}},microsoft_exp:{clientId:m.microsoftClientId,scopes:[],usePKCE:!1,responseType:"code",redirectUri:m.callbackUrl,extraParams:{scope:"files.readwrite.all offline_access"}},google_exp:{clientId:m.googleClientId,scopes:[],usePKCE:!1,responseType:"code",redirectUri:m.callbackUrl,extraParams:{prompt:"consent",scope:"https://www.googleapis.com/auth/drive",access_type:"offline"}}},DriveDiscovery:{dropbox:{authorizationEndpoint:"https://www.dropbox.com/oauth2/authorize",tokenEndpoint:"https://www.dropbox.com/oauth2/token"},boxnet:{authorizationEndpoint:"https://account.box.com/api/oauth2/authorize",tokenEndpoint:"https://api.box.com/oauth2/token"},pcloud:{authorizationEndpoint:"https://my.pcloud.com/oauth2/authorize",tokenEndpoint:"https://api.pcloud.com/oauth2_token"},adrive:{authorizationEndpoint:"https://openapi.alipan.com/oauth/authorize",tokenEndpoint:"https://openapi.alipan.com/oauth/token"},microsoft:{authorizationEndpoint:"https://login.microsoftonline.com/common/oauth2/v2.0/authorize",tokenEndpoint:"https://login.microsoftonline.com/common/oauth2/v2.0/token"},google:{authorizationEndpoint:"https://accounts.google.com/o/oauth2/v2/auth",tokenEndpoint:"https://oauth2.googleapis.com/token"},microsoft_exp:{authorizationEndpoint:"https://login.microsoftonline.com/common/oauth2/v2.0/authorize",tokenEndpoint:"https://login.microsoftonline.com/common/oauth2/v2.0/token"},google_exp:{authorizationEndpoint:"https://accounts.google.com/o/oauth2/v2/auth",tokenEndpoint:"https://oauth2.googleapis.com/token"}}};class b{constructor(e,t){this.config=e,this.thirdpartyRequest=t,this.driveId="",this.refreshTokenPromise=null,this.taskQueue=new f(1),void 0===this.config.baseFolder?this.baseFolder="/KoodoReader":this.baseFolder=this.config.baseFolder}retryOperation(e,t=5){return a(this,void 0,void 0,(function*(){let r=0;for(;;){const n=yield e();if(n)return n;if(r>=t)return this.taskQueue.hasFailedTasks=!0,this.taskQueue.clearQueue(),n;r++;const i=1e3*Math.pow(2,r);console.info(`Retry attempt ${r} after ${i}ms`),yield new Promise((e=>setTimeout(e,i)))}}))}getDriveId(){return a(this,void 0,void 0,(function*(){if(this.driveId)return this.driveId;const t=yield this.refreshToken(),r=yield e.post("https://openapi.alipan.com/adrive/v1.0/user/getDriveInfo",{},{headers:{Authorization:`Bearer ${t}`}});return this.driveId=r.data.default_drive_id,this.driveId}))}getFolderIdByPath(t){return a(this,void 0,void 0,(function*(){const r=yield this.refreshToken(),n=yield this.getDriveId();try{try{const i=yield e.post("https://openapi.alipan.com/adrive/v1.0/openFile/get_by_path",{drive_id:n,file_path:t},{headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"}});if(i.data)return i.data.file_id}catch(i){const o=t.split("/").filter((e=>e));let s="",a="root";for(const t of o){s+="/"+t;try{a=(yield e.post("https://openapi.alipan.com/adrive/v1.0/openFile/get_by_path",{drive_id:n,file_path:s},{headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"}})).data.file_id}catch(i){a=(yield e.post("https://openapi.alipan.com/adrive/v1.0/openFile/create",{drive_id:n,parent_file_id:a,name:t,type:"folder",check_name_mode:"refuse"},{headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"}})).data.file_id}}return a}}catch(e){return console.error("Error getting/creating folder by path:",e),""}}))}listFiles(t){return a(this,void 0,void 0,(function*(){try{const r=yield this.refreshToken(),n=yield this.getDriveId(),i=yield this.getFolderIdByPath(this.baseFolder+"/"+t);let o=[],s="",a=!0;for(;a;){const t=yield e.post("https://openapi.alipan.com/adrive/v1.0/openFile/list",{drive_id:n,parent_file_id:i,marker:s||void 0},{headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"}}),c=t.data.items||[];o=o.concat(c),s=t.data.next_marker,a=!!s&&100===c.length}return[...new Set(o.map((e=>e.name)))]}catch(e){return console.error("Error listing files:",e),[]}}))}deleteFile(e){return a(this,void 0,void 0,(function*(){return this.taskQueue.addTask((()=>this.retryOperation((()=>a(this,void 0,void 0,(function*(){return yield this.deleteFileWithoutQueue(e)}))))))}))}deleteFileWithoutQueue(t){return a(this,void 0,void 0,(function*(){try{const r=yield this.refreshToken(),n=yield this.getDriveId(),i=yield this.getFolderIdByPath(this.baseFolder+"/"+t);return!i||(yield e.post("https://openapi.alipan.com/adrive/v1.0/openFile/delete",{drive_id:n,file_id:i},{headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"}}),!0)}catch(e){return console.error("Error deleting file:",e),!1}}))}checkExists(t){var r;return a(this,void 0,void 0,(function*(){try{const n=yield this.refreshToken(),i=yield this.getDriveId(),o=yield e.post("https://openapi.alipan.com/adrive/v1.0/openFile/get_by_path",{drive_id:i,file_path:t},{headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"}});(null===(r=o.data)||void 0===r?void 0:r.file_id)&&(yield e.post("https://openapi.alipan.com/adrive/v1.0/openFile/recyclebin/trash",{drive_id:i,file_id:o.data.file_id},{headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"}}))}catch(e){}}))}refreshToken(){return a(this,void 0,void 0,(function*(){return this.config.access_token&&this.config.expires_at>(new Date).getTime()?this.config.access_token:(this.refreshTokenPromise||(this.refreshTokenPromise=(()=>a(this,void 0,void 0,(function*(){try{let e=this.config.refresh_token,t=yield this.thirdpartyRequest.refreshThirdToken({provider:"adrive",refresh_token:e});this.config.access_token=t.data.access_token,this.config.expires_at=(new Date).getTime()+1e3*t.data.expires_in,this.config.refresh_token=t.data.refresh_token;let r=yield this.thirdpartyRequest.encryptToken({token:JSON.stringify({refresh_token:t.data.refresh_token})});return 200===r.code&&(yield this.thirdpartyRequest.TokenService.setToken("adrive_token",r.data.encrypted_token)),t.data.access_token}finally{this.refreshTokenPromise=null}})))()),this.refreshTokenPromise)}))}authToken(e){return a(this,void 0,void 0,(function*(){return(yield this.thirdpartyRequest.authThirdToken({provider:"adrive",redirect_uri:m.callbackUrl,code:e})).data.refresh_token}))}getAuthUrl(){return`https://openapi.alipan.com/oauth/authorize?${new URLSearchParams({response_type:"code",client_id:m.adriveClientId,redirect_uri:m.callbackUrl,grant_type:"authorization_code",scope:"user:base,file:all:write,file:all:read"}).toString()}`}}class w extends b{constructor(e,t){super(e,t)}uploadFile(t,r){return a(this,void 0,void 0,(function*(){return new Promise(((n,i)=>a(this,void 0,void 0,(function*(){try{const i=yield this.refreshToken(),o=yield this.getDriveId(),s=r.substring(0,r.lastIndexOf("/")),a=r.substring(r.lastIndexOf("/")+1),c=yield this.getFolderIdByPath(this.baseFolder+"/"+s),u=yield e.post("https://openapi.alipan.com/adrive/v1.0/openFile/create",{drive_id:o,parent_file_id:c,name:a,type:"file",check_name_mode:"ignore"},{headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"}}),{file_id:d,upload_id:l,part_info_list:h}=u.data;yield e.put(h[0].upload_url,t,{headers:{"Content-Type":"application/octet-stream"}}),yield e.post("https://openapi.alipan.com/adrive/v1.0/openFile/complete",{drive_id:o,file_id:d,upload_id:l},{headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"}}),n(!0)}catch(e){console.error("Error uploading file:",e),n(!1)}}))))}))}downloadFile(t){return new Promise(((r,n)=>a(this,void 0,void 0,(function*(){try{const n=yield this.refreshToken(),i=yield this.getDriveId(),o=(yield e.post("https://openapi.alipan.com/adrive/v1.0/openFile/get_by_path",{drive_id:i,file_path:this.baseFolder+"/"+t},{headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"}})).data.file_id,s=yield e.post("https://openapi.alipan.com/adrive/v1.0/openFile/getDownloadUrl",{drive_id:i,file_id:o},{headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"}}),a=yield e.get(s.data.url,{responseType:"arraybuffer"});r(a.data)}catch(e){console.error("Error downloading file:",e),r(!1)}}))))}}class k{constructor(e,t){this.config=e,this.thirdpartyRequest=t,this.refreshTokenPromise=null,this.taskQueue=new f(3),void 0===this.config.baseFolder?this.baseFolder="KoodoReader":this.baseFolder=this.config.baseFolder}retryOperation(e,t=3){return a(this,void 0,void 0,(function*(){let r=0;for(;;){const n=yield e();if(n)return n;if(r>=t)return this.taskQueue.hasFailedTasks=!0,this.taskQueue.clearQueue(),n;r++;const i=1e3*Math.pow(2,r);console.info(`Retry attempt ${r} after ${i}ms`),yield new Promise((e=>setTimeout(e,i)))}}))}getFolderIdByPath(t){return a(this,void 0,void 0,(function*(){if(""==t)return"0";const r=yield this.refreshToken(),n=t.split("/");let i="0";for(const t of n){const n=`https://api.box.com/2.0/folders/${i}/items?fields=id,name&type=folder&limit=1000`;try{const o=(yield e.get(n,{headers:{Authorization:`Bearer ${r}`}})).data.entries.find((e=>e.name===t&&"folder"===e.type));if(o)i=o.id;else{const n={name:t,parent:{id:i},type:"folder"};i=(yield e.post("https://api.box.com/2.0/folders",n,{headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"}})).data.id}}catch(e){return console.error("Error occurred during folder creation:",e),""}}return i}))}listFiles(t){return a(this,void 0,void 0,(function*(){try{const r=yield this.refreshToken();let n=this.baseFolder+"/"+t;for(;n.startsWith("/");)n=n.substring(1);let i=yield this.getFolderIdByPath(n),o=[],s=0,a=!0;const c=1e3;for(;a;){const t=yield e.get(`https://api.box.com/2.0/folders/${i}/items`,{params:{limit:c,offset:s},headers:{Authorization:`Bearer ${r}`}}),n=t.data.entries||[];o=o.concat(n),s+=n.length,a=n.length===c&&t.data.total_count>s}return[...new Set(o.map((e=>e.name)))]}catch(e){return console.error("Error listing files:",e),[]}}))}deleteFile(e){return a(this,void 0,void 0,(function*(){return this.taskQueue.addTask((()=>this.retryOperation((()=>a(this,void 0,void 0,(function*(){return yield this.deleteFileWithoutQueue(e)}))))))}))}deleteFileWithoutQueue(t){return a(this,void 0,void 0,(function*(){try{const r=yield this.refreshToken(),n=t.substring(0,t.lastIndexOf("/")),i=t.substring(t.lastIndexOf("/")+1);let o=this.baseFolder+"/"+n;for(;o.startsWith("/");)o=o.substring(1);const s=yield this.getFolderIdByPath(o);if(!s)return!0;const a=`https://api.box.com/2.0/folders/${s}/items?fields=id,name&type=file&limit=1000`,c=(yield e.get(a,{headers:{Authorization:`Bearer ${r}`}})).data.entries.find((e=>e.name===i&&"file"===e.type));return!c||(yield e.delete(`https://api.box.com/2.0/files/${c.id}`,{headers:{Authorization:`Bearer ${r}`}}),!0)}catch(e){return console.error("Error deleting file:",e),!1}}))}refreshToken(){return a(this,void 0,void 0,(function*(){return this.config.access_token&&this.config.expires_at>(new Date).getTime()?this.config.access_token:(this.refreshTokenPromise||(this.refreshTokenPromise=(()=>a(this,void 0,void 0,(function*(){try{let e=this.config.refresh_token,t=yield this.thirdpartyRequest.refreshThirdToken({provider:"boxnet",refresh_token:e});this.config.access_token=t.data.access_token,this.config.expires_at=(new Date).getTime()+1e3*t.data.expires_in,this.config.refresh_token=t.data.refresh_token;let r=yield this.thirdpartyRequest.encryptToken({token:JSON.stringify({refresh_token:t.data.refresh_token})});return 200===r.code&&(yield this.thirdpartyRequest.TokenService.setToken("boxnet_token",r.data.encrypted_token)),t.data.access_token}finally{this.refreshTokenPromise=null}})))()),this.refreshTokenPromise)}))}authToken(e){return a(this,void 0,void 0,(function*(){return(yield this.thirdpartyRequest.authThirdToken({provider:"boxnet",redirect_uri:m.callbackUrl,code:e})).data.refresh_token}))}getAuthUrl(){return`https://account.box.com/api/oauth2/authorize?${new URLSearchParams({response_type:"code",client_id:m.boxClientId,redirect_uri:m.callbackUrl,grant_type:"authorization_code",box_subject_type:"enterprise",scope:"root_readwrite"}).toString()}`}}class S extends k{constructor(e,t){super(e,t)}uploadFile(t,r){return a(this,void 0,void 0,(function*(){return this.taskQueue.addTask((()=>this.retryOperation((()=>a(this,void 0,void 0,(function*(){try{const n=yield this.refreshToken(),i=r.substring(0,r.lastIndexOf("/")),o=r.substring(r.lastIndexOf("/")+1);let s=this.baseFolder+"/"+i;for(;s.startsWith("/");)s=s.substring(1);const a=yield this.getFolderIdByPath(s);if(!a)throw new Error("Folder not found");const c=(yield this.listFiles(i)).find((e=>e===o));c&&(yield this.deleteFileWithoutQueue(i+"/"+o));let u=new File([t],o,{lastModified:(new Date).getTime(),type:t.type});const d=new FormData;d.append("file",u),d.append("parent_id",a);const l=yield e.post("https://upload.box.com/api/2.0/files/content",d,{headers:{Authorization:`Bearer ${n}`,"Content-Type":"multipart/form-data"},params:{if_match:"false",fields:"name,id"},maxContentLength:1/0,maxBodyLength:1/0});return!(l.status>=300)||(console.error("Error occurred during file upload:",l),!1)}catch(e){return console.error("Error uploading file:",e),!1}}))))))}))}downloadFile(t){return a(this,void 0,void 0,(function*(){return this.taskQueue.addTask((()=>this.retryOperation((()=>a(this,void 0,void 0,(function*(){try{const r=yield this.refreshToken(),n=t.substring(0,t.lastIndexOf("/")),i=t.substring(t.lastIndexOf("/")+1);let o=this.baseFolder+"/"+n;for(;o.startsWith("/");)o=o.substring(1);const s=yield this.getFolderIdByPath(o);if(!s)return console.error("Folder not found"),!0;const a=`https://api.box.com/2.0/folders/${s}/items?fields=id,name&type=file&limit=1000`,c=(yield e.get(a,{headers:{Authorization:`Bearer ${r}`}})).data.entries.find((e=>e.name===i&&"file"===e.type));if(!c)return console.error("File not found:",i),!0;const u=yield e({url:`https://api.box.com/2.0/files/${c.id}/content`,method:"get",headers:{Authorization:`Bearer ${r}`},responseType:"arraybuffer"});return u.status>=300?(console.error("Error occurred during file download:",u),!1):u.data}catch(e){return console.error("Error occurred during file download:",e),!1}}))))))}))}}class E{constructor(e,t){this.config=e,this.thirdpartyRequest=t,this.refreshTokenPromise=null,this.taskQueue=new f(3)}retryOperation(e,t=3){return a(this,void 0,void 0,(function*(){let r=0;for(;;){const n=yield e();if(n)return n;if(r>=t)return this.taskQueue.hasFailedTasks=!0,this.taskQueue.clearQueue(),n;r++;const i=1e3*Math.pow(2,r);console.info(`Retry attempt ${r} after ${i}ms`),yield new Promise((e=>setTimeout(e,i)))}}))}listFiles(t){return a(this,void 0,void 0,(function*(){try{const r=yield this.refreshToken();let n=[],i=!0,o=null;for(;i;){let s;s=o?yield e.post("https://api.dropboxapi.com/2/files/list_folder/continue",{cursor:o},{headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"}}):yield e.post("https://api.dropboxapi.com/2/files/list_folder",{path:"/"+t,limit:2e3},{headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"}});const a=s.data.entries||[];n=n.concat(a),i=s.data.has_more,o=s.data.cursor}return[...new Set(n.map((e=>e.name)))]}catch(e){return console.error("Error listing files:",e),[]}}))}deleteFile(e){return a(this,void 0,void 0,(function*(){return this.taskQueue.addTask((()=>this.retryOperation((()=>a(this,void 0,void 0,(function*(){return yield this.deleteFileWithoutQueue(e)}))))))}))}deleteFileWithoutQueue(t){return a(this,void 0,void 0,(function*(){try{const r=yield this.refreshToken();yield e.post("https://api.dropboxapi.com/2/files/delete_v2",{path:"/"+t},{headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"}});return!0}catch(e){return console.error("Error deleting file:",e),!1}}))}refreshToken(){return a(this,void 0,void 0,(function*(){return this.config.access_token&&this.config.expires_at>(new Date).getTime()?this.config.access_token:(this.refreshTokenPromise||(this.refreshTokenPromise=(()=>a(this,void 0,void 0,(function*(){try{let e=this.config.refresh_token,t=yield this.thirdpartyRequest.refreshThirdToken({provider:"dropbox",refresh_token:e});return this.config.access_token=t.data.access_token,this.config.expires_at=(new Date).getTime()+1e3*t.data.expires_in,t.data.access_token}finally{this.refreshTokenPromise=null}})))()),this.refreshTokenPromise)}))}authToken(e){return a(this,void 0,void 0,(function*(){return(yield this.thirdpartyRequest.authThirdToken({provider:"dropbox",redirect_uri:m.callbackUrl,code:e})).data.refresh_token}))}getAuthUrl(){return`https://www.dropbox.com/oauth2/authorize?response_type=code&token_access_type=offline&client_id=${m.dropboxClientId}&redirect_uri=${m.callbackUrl}`}}class x extends E{constructor(e,t){super(e,t)}uploadFile(t,r){return a(this,void 0,void 0,(function*(){return this.taskQueue.addTask((()=>this.retryOperation((()=>a(this,void 0,void 0,(function*(){try{const n=yield this.refreshToken();let i=r.split("/").pop()||"",o=new File([t],i,{lastModified:(new Date).getTime(),type:t.type});const s=yield e.post("https://content.dropboxapi.com/2/files/upload",o,{headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/octet-stream","Dropbox-API-Arg":JSON.stringify({path:"/"+r,mode:"overwrite",autorename:!0,mute:!1})},maxContentLength:1/0,maxBodyLength:1/0});return!(s.status>=300)||(console.error("Error occurred during file upload:",s),!1)}catch(e){return console.error("Error uploading file:",e),!1}}))))))}))}downloadFile(t){return a(this,void 0,void 0,(function*(){return this.taskQueue.addTask((()=>this.retryOperation((()=>a(this,void 0,void 0,(function*(){try{const r=yield this.refreshToken(),n=yield e({url:"https://content.dropboxapi.com/2/files/download",method:"post",headers:{Authorization:`Bearer ${r}`,"Dropbox-API-Arg":JSON.stringify({path:"/"+t})},maxContentLength:1/0,maxBodyLength:1/0,responseType:"arraybuffer"});return n.status>=300?(console.error("Error occurred during file download:",n),!1):n.data}catch(e){return console.error("Error occurred during file download:",e),!1}}))))))}))}}class A{constructor(e,t){this.isExp=!1,this.config=e,this.thirdpartyRequest=t,this.refreshTokenPromise=null,this.taskQueue=new f(3),this.isExp=this.config.isExp||!1,void 0===this.config.baseFolder?this.baseFolder="KoodoReader":this.baseFolder=this.config.baseFolder}retryOperation(e,t=3){return a(this,void 0,void 0,(function*(){let r=0;for(;;){const n=yield e();if(n)return n;if(r>=t)return this.taskQueue.hasFailedTasks=!0,this.taskQueue.clearQueue(),n;r++;const i=1e3*Math.pow(2,r);console.info(`Retry attempt ${r} after ${i}ms`),yield new Promise((e=>setTimeout(e,i)))}}))}getFileId(t,r){return a(this,void 0,void 0,(function*(){const n=yield this.refreshToken(),i=`https://www.googleapis.com/drive/v3/files?q=name='${t}'+and+'${r}'+in+parents&fields=files(id,name)`;try{const t=yield e.get(i,{headers:{Authorization:"Bearer "+n}});if(0===t.data.files.length)return"";const r=t.data.files;return r.length>0?r[0].id:null}catch(e){return console.error("Error occurred during file list retrieval:",e),""}}))}checkFolder(t){return a(this,void 0,void 0,(function*(){t=this.baseFolder+"/"+t;const r=yield this.refreshToken();if(""===t)return"root";const n=t.split("/").filter((e=>""!==e.trim()));let i="root";for(const t of n){let n=yield this.getFolderId(t,i);if(!n){const o={name:t,mimeType:"application/vnd.google-apps.folder",parents:[i]};try{n=(yield e.post("https://www.googleapis.com/drive/v3/files",o,{headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"}})).data.id}catch(e){throw console.error(`Error occurred during folder creation for ${t}:`,e),e}}i=n}return i}))}getFolderId(t,r){return a(this,void 0,void 0,(function*(){const n=yield this.refreshToken(),i=`https://www.googleapis.com/drive/v3/files?q=name='${t=encodeURIComponent(t)}'+and+mimeType='application/vnd.google-apps.folder'+and+'${r}'+in+parents&fields=files(id,name)`;try{const t=(yield e.get(i,{headers:{Authorization:`Bearer ${n}`}})).data.files;return t.length>0?t[0].id:null}catch(e){throw console.error("Error occurred during fetching folder ID:",e),e}}))}listFiles(t){return a(this,void 0,void 0,(function*(){try{const r=yield this.refreshToken();let n=yield this.checkFolder(t),i=[],o="",s=!0;for(;s;){let t=`https://www.googleapis.com/drive/v3/files?q='${n}'+in+parents&fields=nextPageToken,files(id,name)&pageSize=1000`;o&&(t+=`&pageToken=${o}`);const a=yield e.get(t,{headers:{Authorization:`Bearer ${r}`}}),c=a.data.files||[];i=i.concat(c),o=a.data.nextPageToken,s=!!o}return[...new Set(i.map((e=>e.name)))]}catch(e){return console.error("Error listing files:",e),[]}}))}deleteFile(e){return a(this,void 0,void 0,(function*(){return this.taskQueue.addTask((()=>this.retryOperation((()=>a(this,void 0,void 0,(function*(){return yield this.deleteFileWithoutQue(e)}))))))}))}deleteFileWithoutQue(t){return a(this,void 0,void 0,(function*(){const r=t.split("/")[1],n=yield this.checkFolder(t),i=yield this.refreshToken(),o=yield this.getFileId(r,n);if(""===o)return console.error("File not found:",r),!0;try{const t=yield e.delete(`https://www.googleapis.com/drive/v3/files/${o}`,{headers:{Authorization:`Bearer ${i}`}});return console.error("File deleted:",t),!0}catch(e){return console.error("Error deleting file:",e),!1}}))}refreshToken(){return a(this,void 0,void 0,(function*(){return this.config.access_token&&this.config.expires_at>(new Date).getTime()?this.config.access_token:(this.refreshTokenPromise||(this.refreshTokenPromise=(()=>a(this,void 0,void 0,(function*(){try{let e=this.config.refresh_token,t=yield this.thirdpartyRequest.refreshThirdToken({provider:"google",refresh_token:e});return this.config.access_token=t.data.access_token,this.config.expires_at=(new Date).getTime()+1e3*t.data.expires_in,t.data.access_token}finally{this.refreshTokenPromise=null}})))()),this.refreshTokenPromise)}))}authToken(e){return a(this,void 0,void 0,(function*(){return(yield this.thirdpartyRequest.authThirdToken({provider:"google",redirect_uri:m.callbackUrl,code:e})).data.refresh_token}))}getAuthUrl(){return`https://accounts.google.com/o/oauth2/v2/auth?redirect_uri=${m.callbackUrl}&prompt=consent&response_type=code&client_id=${m.googleClientId}&scope=https://www.googleapis.com/auth/${this.isExp?"drive":"drive.file"}&access_type=offline`}}class T extends A{constructor(e,t){super(e,t)}uploadFile(t,r){return a(this,void 0,void 0,(function*(){return this.taskQueue.addTask((()=>this.retryOperation((()=>a(this,void 0,void 0,(function*(){try{const n=yield this.refreshToken();let i=r.split("/").pop()||"",o=new File([t],i,{lastModified:(new Date).getTime(),type:t.type}),s=r.split(".").pop(),a=c(s||""),u=r.split("/")[0],d=yield this.checkFolder(u),l=yield this.getFileId(i||"",d);const h={mimeType:a,name:i,parents:[d]},f=l?`https://www.googleapis.com/upload/drive/v3/files/${l}?uploadType=resumable`:"https://www.googleapis.com/upload/drive/v3/files?uploadType=resumable",p=(yield e({method:l?"PATCH":"POST",url:f,data:l?null:JSON.stringify(h),headers:{Authorization:"Bearer "+n,"Content-Type":"application/json; charset=UTF-8"},maxContentLength:1/0,maxBodyLength:1/0})).headers.location,g=yield this.getData(o);if(0===Object.keys(g).length)return!1;const m=yield e.put(p,g.data,{headers:{Authorization:"Bearer "+n,"Content-Type":"application/zip","Content-Range":`bytes 0-${g.fileSize-1}/${g.fileSize}`},maxContentLength:1/0,maxBodyLength:1/0});return!(m.status>=300)||(console.error("Error occurred during file download:",m),!1)}catch(e){return console.error("Error uploading file:",e),!1}}))))))}))}downloadFile(t){return a(this,void 0,void 0,(function*(){return this.taskQueue.addTask((()=>this.retryOperation((()=>a(this,void 0,void 0,(function*(){try{const r=yield this.refreshToken();let n=t.split("/").pop(),i=t.split("/")[0],o=yield this.checkFolder(i),s=yield this.getFileId(n||"",o);if(!s)return console.error("File not found:",n),!0;const a=`https://www.googleapis.com/drive/v3/files/${s}?alt=media`,c=yield e.get(a,{headers:{Authorization:"Bearer "+r},maxContentLength:1/0,maxBodyLength:1/0,responseType:"arraybuffer"});return c.status>=300?(console.error("Error occurred during file download:",c),!1):c.data}catch(e){return console.error("Error occurred during file download:",e),!1}}))))))}))}getData(e){return a(this,void 0,void 0,(function*(){return e?new Promise(((t,r)=>{const n=new FileReader;n.onload=r=>t({fileName:e.name,mimeType:e.type,fileSize:e.size,data:r.target.result}),n.onerror=e=>r(e),n.readAsArrayBuffer(e)})):{}}))}}class C{constructor(e){this.folderCreationLocks=new Map,this.config=e,this.taskQueue=new f(3),void 0===this.config.baseFolder?this.baseFolder="KoodoReader":this.baseFolder=this.config.baseFolder}retryOperation(e,t=3){return a(this,void 0,void 0,(function*(){let r=0;for(;;){const n=yield e();if(n)return n;if(r>=t)return this.taskQueue.hasFailedTasks=!0,this.taskQueue.clearQueue(),n;r++;const i=1e3*Math.pow(2,r);console.info(`Retry attempt ${r} after ${i}ms`),yield new Promise((e=>setTimeout(e,i)))}}))}getStorage(){return a(this,void 0,void 0,(function*(){if(this.storage)return this.storage;let{email:e,password:r}=this.config;return this.storage=yield new t({email:e,password:r}).ready,this.storage}))}getRoot(){return a(this,void 0,void 0,(function*(){if(this.root)return this.root;const e=(yield this.getStorage()).root;if(""===this.baseFolder)return this.root=e,this.root;let t=e.children.find((e=>e.name===this.baseFolder&&e.directory));return t||(t=yield e.mkdir(this.baseFolder)),this.root=t,this.root}))}createFolder(e,t){return a(this,void 0,void 0,(function*(){const r=`${e.nodeId}_${t}`;if(this.folderCreationLocks.has(r))return yield this.folderCreationLocks.get(r);const n=(()=>a(this,void 0,void 0,(function*(){try{let r=e.children.find((e=>e.name===t&&e.directory));return r||(r=yield e.mkdir(t),r)}finally{this.folderCreationLocks.delete(r)}})))();return this.folderCreationLocks.set(r,n),yield n}))}listFiles(e){return a(this,void 0,void 0,(function*(){try{let t=yield this.getRoot();if(e){const r=e.split("/").filter((e=>e));for(const e of r){const r=t.children.find((t=>t.name===e&&t.directory));if(!r)return[];t=r}}const r=t.children.map((e=>e.name));return r}catch(e){return console.error("Error listing MEGA files:",e),[]}}))}deleteFile(e){return a(this,void 0,void 0,(function*(){return this.taskQueue.addTask((()=>this.retryOperation((()=>a(this,void 0,void 0,(function*(){return yield this.deleteFileWithoutQueue(e)}))))))}))}deleteFileWithoutQueue(e){return a(this,void 0,void 0,(function*(){try{let t=yield this.getRoot();const r=e.split("/"),n=r.pop();for(const e of r){if(!e)continue;const r=t.children.find((t=>t.name===e&&t.directory));if(!r)return!0;t=r}const i=t.children.find((e=>e.name===n&&!e.directory));return!i||(yield i.delete(),!0)}catch(e){return console.error("Error deleting MEGA file:",e),!1}}))}}class R extends C{constructor(e){super(e)}uploadFile(e,t){return a(this,void 0,void 0,(function*(){return this.taskQueue.addTask((()=>this.retryOperation((()=>a(this,void 0,void 0,(function*(){try{let n=yield this.getRoot();const i=t.split("/"),o=i.pop()||"";for(const e of i){if(!e)continue;let t=n.children.find((t=>t.name===e&&t.directory));t||(t=yield this.createFolder(n,e)),n=t}const s=new File([e],o,{lastModified:(new Date).getTime(),type:e.type}),a=yield e.arrayBuffer(),c=new Uint8Array(a),u=r.from(c),d=n.children.find((e=>e.name===o&&!e.directory));return d&&(yield d.delete()),yield n.upload({name:o,size:s.size},u).complete,!0}catch(e){return console.error("Error occurred during MEGA file upload:",e),!1}}))))))}))}downloadFile(e){return a(this,void 0,void 0,(function*(){return this.taskQueue.addTask((()=>this.retryOperation((()=>a(this,void 0,void 0,(function*(){try{let t=yield this.getRoot();const r=e.split("/"),n=r.pop()||"";for(const e of r){if(!e)continue;const r=t.children.find((t=>t.name===e&&t.directory));if(!r)return!0;t=r}const i=t.children.find((e=>e.name===n&&!e.directory));if(!i)return!0;return(yield i.downloadBuffer()).buffer}catch(e){return console.error("Error occurred during MEGA file download:",e),!1}}))))))}))}}class O{constructor(e,t){this.isExp=!1,this.baseUrl="https://graph.microsoft.com/v1.0/me/drive/special/approot",this.config=e,this.thirdpartyRequest=t,this.refreshTokenPromise=null,this.taskQueue=new f(3),this.isExp=this.config.isExp||!1,this.baseUrl=this.isExp?"https://graph.microsoft.com/v1.0/me/drive/root":"https://graph.microsoft.com/v1.0/me/drive/special/approot",void 0===this.config.baseFolder?this.baseFolder=this.isExp?"KoodoReader":"":this.baseFolder=this.config.baseFolder}retryOperation(e,t=3){return a(this,void 0,void 0,(function*(){let r=0;for(;;){const n=yield e();if(n)return n;if(r>=t)return this.taskQueue.hasFailedTasks=!0,this.taskQueue.clearQueue(),n;r++;const i=1e3*Math.pow(2,r);console.info(`Retry attempt ${r} after ${i}ms`),yield new Promise((e=>setTimeout(e,i)))}}))}listFiles(t){return a(this,void 0,void 0,(function*(){try{const r=yield this.refreshToken();for(t=this.baseFolder+"/"+t;t.startsWith("/");)t=t.substring(1);let n,i=[];if(""===t)n=`${this.baseUrl}/children`;else{const e=encodeURIComponent(t);n=`${this.baseUrl}:/${e}:/children`}for(console.log("Listing files at path:",n);n;){const t=yield e.get(n,{headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"}});if(console.log(n,t.data),t.status>=300)break;const o=t.data.value||[];i=i.concat(o),n=t.data["@odata.nextLink"]||""}return[...new Set(i.map((e=>e.name)))]}catch(e){return console.error("Error occurred during file list:",e),[]}}))}deleteFile(e){return a(this,void 0,void 0,(function*(){return this.taskQueue.addTask((()=>this.retryOperation((()=>a(this,void 0,void 0,(function*(){return yield this.deleteFileWithoutQueue(e)}))))))}))}deleteFileWithoutQueue(t){return a(this,void 0,void 0,(function*(){try{const r=yield this.refreshToken();for(t=this.baseFolder+"/"+t;t.startsWith("/");)t=t.substring(1);const n=yield e.delete(`${this.baseUrl}:/${t}`,{headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"}});return!(n.status>=300)||(console.error("Error deleting file:",n),!0)}catch(e){return console.error("Error occurred during file delete:",e),!1}}))}refreshToken(){return a(this,void 0,void 0,(function*(){return this.config.access_token&&this.config.expires_at>(new Date).getTime()?this.config.access_token:(this.refreshTokenPromise||(this.refreshTokenPromise=(()=>a(this,void 0,void 0,(function*(){try{let e=this.config.refresh_token,t=yield this.thirdpartyRequest.refreshThirdToken({provider:"microsoft",refresh_token:e});return this.config.access_token=t.data.access_token,this.config.expires_at=(new Date).getTime()+1e3*t.data.expires_in,t.data.access_token}finally{this.refreshTokenPromise=null}})))()),this.refreshTokenPromise)}))}authToken(e){return a(this,void 0,void 0,(function*(){return(yield this.thirdpartyRequest.authThirdToken({provider:"microsoft",redirect_uri:m.callbackUrl,code:e})).data.refresh_token}))}getAuthUrl(){return`https://login.microsoftonline.com/common/oauth2/v2.0/authorize?client_id=${m.microsoftClientId}&scope=${this.isExp?"files.readwrite.all":"files.readwrite.appfolder"} offline_access&response_type=code&redirect_uri=${m.callbackUrl}`}}class P extends O{constructor(e,t){super(e,t)}uploadFile(t,r){return a(this,void 0,void 0,(function*(){return this.taskQueue.addTask((()=>this.retryOperation((()=>a(this,void 0,void 0,(function*(){try{const n=yield this.refreshToken();let i=r.split("/").pop()||"",o=new File([t],i,{lastModified:(new Date).getTime(),type:t.type});for(r=this.baseFolder+"/"+r;r.startsWith("/");)r=r.substring(1);const s=this.baseUrl+":/"+r+":/createUploadSession",a=yield e.post(s,null,{headers:{Authorization:"Bearer "+n,"Content-Type":"application/json"},maxContentLength:1/0,maxBodyLength:1/0});let c=o.size;const u=o.type,d=a.data.uploadUrl,l=yield e.put(d,o,{headers:{"Content-Type":u,"Content-Range":`bytes 0-${c-1}/${c}`},maxContentLength:1/0,maxBodyLength:1/0});return!(l.status>=300)||(console.error("Error occurred during file download:",l),!1)}catch(e){return console.error("Error uploading file:",e),!1}}))))))}))}downloadFile(t){return a(this,void 0,void 0,(function*(){return this.taskQueue.addTask((()=>this.retryOperation((()=>a(this,void 0,void 0,(function*(){try{const r=yield this.refreshToken();for(t=this.baseFolder+"/"+t;t.startsWith("/");)t=t.substring(1);const n=`${this.baseUrl}:/${t}:/content`,i=yield e.get(n,{responseType:"arraybuffer",headers:{Authorization:"Bearer "+r},maxContentLength:1/0,maxBodyLength:1/0});return i.status>=300?(console.error("Error occurred during file download:",i),!1):i.data}catch(e){return console.error("Error occurred during file download:",e),!1}}))))))}))}}class _{downloadFile(e,t){return a(this,void 0,void 0,(function*(){return new Promise((e=>{e(!0)}))}))}uploadFile(e,t){return a(this,void 0,void 0,(function*(){return new Promise((e=>{e(!0)}))}))}listFiles(e){return a(this,void 0,void 0,(function*(){return new Promise((e=>{e([])}))}))}authToken(e){return a(this,void 0,void 0,(function*(){return new Promise((e=>{e("")}))}))}getAuthUrl(){return""}}class I{constructor(e,t){this.config=e,this.thirdpartyRequest=t,this.taskQueue=new f(3)}retryOperation(e,t=5){return a(this,void 0,void 0,(function*(){let r=0;for(;;){const n=yield e();if(n)return n;if(r>=t)return this.taskQueue.hasFailedTasks=!0,this.taskQueue.clearQueue(),n;r++;const i=1e3*Math.pow(2,r);console.info(`Retry attempt ${r} after ${i}ms`),yield new Promise((e=>setTimeout(e,i)))}}))}checkFolderExists(t,r){return a(this,void 0,void 0,(function*(){try{return 0===(yield e.get("https://api.pcloud.com/listfolder",{params:{access_token:r,path:`/${t}`}})).data.result}catch(e){return console.error("Error checking folder:",e),!1}}))}createFolder(t,r){return a(this,void 0,void 0,(function*(){try{return 0===(yield e.get("https://api.pcloud.com/createfolderifnotexists",{params:{access_token:r,path:`/${t}`}})).data.result}catch(e){return console.error("Error creating folder:",e),!1}}))}listFiles(t){return a(this,void 0,void 0,(function*(){try{const r=yield this.refreshToken(),n=yield e.get("https://api.pcloud.com/listfolder",{params:{access_token:r,path:"/"+t,recursive:0}});return 0!==n.data.result?[]:n.data.metadata.contents.map((e=>e.name))}catch(e){return console.error("Error occurred during file list:",e),[]}}))}deleteFile(e){return a(this,void 0,void 0,(function*(){return this.taskQueue.addTask((()=>this.retryOperation((()=>a(this,void 0,void 0,(function*(){return yield this.deleteFileWithoutQueue(e)}))))))}))}deleteFileWithoutQueue(t){return a(this,void 0,void 0,(function*(){try{const r=yield this.refreshToken(),n=yield e.get("https://api.pcloud.com/deletefile",{params:{access_token:r,path:"/"+t}});return 0===n.data.result||(console.error("Error deleting file:",n.data),!0)}catch(e){return console.error("Error occurred during file delete:",e),!1}}))}refreshToken(){return a(this,void 0,void 0,(function*(){return this.config.refresh_token}))}authToken(e){return a(this,void 0,void 0,(function*(){return(yield this.thirdpartyRequest.authThirdToken({provider:"pcloud",redirect_uri:m.callbackUrl,code:e})).data.access_token}))}getAuthUrl(){return`https://my.pcloud.com/oauth2/authorize?client_id=${m.pcloudClientId}&response_type=code&redirect_uri=${m.callbackUrl}`}}class M extends I{constructor(e,t){super(e,t)}uploadFile(t,r){return a(this,void 0,void 0,(function*(){return this.taskQueue.addTask((()=>this.retryOperation((()=>a(this,void 0,void 0,(function*(){try{const n=yield this.refreshToken(),i=r.split("/").slice(0,-1).join("/");if(!(yield this.checkFolderExists(i,n))){if(!(yield this.createFolder(i,n)))return!1}let o=r.split("/").pop()||"",s=new File([t],o,{lastModified:(new Date).getTime(),type:t.type});const a=new FormData;a.append("file",s);const c=yield e.post("https://api.pcloud.com/uploadfile",a,{params:{access_token:n,path:`/${i}`,renew:1},maxContentLength:1/0,maxBodyLength:1/0});return 0===c.data.result||(console.error("Error uploading file:",c.data),!1)}catch(e){return console.error("Error uploading file:",e),!1}}))))))}))}downloadFile(t){return a(this,void 0,void 0,(function*(){return this.taskQueue.addTask((()=>this.retryOperation((()=>a(this,void 0,void 0,(function*(){try{const r=yield this.refreshToken(),n=yield e.get("https://api.pcloud.com/getfilelink",{params:{access_token:r,path:`/${t}`}});if(0!==n.data.result)return console.error("Error getting file link:",n.data),!0;const i=`https://${n.data.hosts[0]}${n.data.path}`,o=yield e.get(i,{responseType:"arraybuffer",maxContentLength:1/0,maxBodyLength:1/0});return o.status>=300?(console.error("Error downloading file:",o),!1):o.data}catch(e){return console.error("Error occurred during file download:",e),!1}}))))))}))}}const N=e=>{let t=e.httpHandler;return{setHttpHandler(e){t=e},httpHandler:()=>t,updateHttpClientConfig(e,r){t.updateHttpClientConfig(e,r)},httpHandlerConfigs:()=>t.httpHandlerConfigs()}};var F,$,U,L,B;!function(e){e.HEADER="header",e.QUERY="query"}(F||(F={})),function(e){e.HEADER="header",e.QUERY="query"}($||($={})),function(e){e.HTTP="http",e.HTTPS="https"}(U||(U={})),function(e){e.MD5="md5",e.CRC32="crc32",e.CRC32C="crc32c",e.SHA1="sha1",e.SHA256="sha256"}(L||(L={})),function(e){e[e.HEADER=0]="HEADER",e[e.TRAILER=1]="TRAILER"}(B||(B={}));const D="__smithy_context";var j,z;!function(e){e.PROFILE="profile",e.SSO_SESSION="sso-session",e.SERVICES="services"}(j||(j={})),function(e){e.HTTP_0_9="http/0.9",e.HTTP_1_0="http/1.0",e.TDS_8_0="tds/8.0"}(z||(z={}));class q{constructor(e){this.method=e.method||"GET",this.hostname=e.hostname||"localhost",this.port=e.port,this.query=e.query||{},this.headers=e.headers||{},this.body=e.body,this.protocol=e.protocol?":"!==e.protocol.slice(-1)?`${e.protocol}:`:e.protocol:"https:",this.path=e.path?"/"!==e.path.charAt(0)?`/${e.path}`:e.path:"/",this.username=e.username,this.password=e.password,this.fragment=e.fragment}static clone(e){const t=new q({...e,headers:{...e.headers}});var r;return t.query&&(t.query=(r=t.query,Object.keys(r).reduce(((e,t)=>{const n=r[t];return{...e,[t]:Array.isArray(n)?[...n]:n}}),{}))),t}static isInstance(e){if(!e)return!1;const t=e;return"method"in t&&"protocol"in t&&"hostname"in t&&"path"in t&&"object"==typeof t.query&&"object"==typeof t.headers}clone(){return q.clone(this)}}class H{constructor(e){this.statusCode=e.statusCode,this.reason=e.reason,this.headers=e.headers||{},this.body=e.body}static isInstance(e){if(!e)return!1;const t=e;return"number"==typeof t.statusCode&&"object"==typeof t.headers}}const W={step:"build",tags:["SET_EXPECT_HEADER","EXPECT_HEADER"],name:"addExpectContinueMiddleware",override:!0},K=e=>({applyToStack:t=>{t.add(function(e){return t=>async r=>{const{request:n}=r;return q.isInstance(n)&&n.body&&"node"===e.runtime&&"FetchHttpHandler"!==e.requestHandler?.constructor?.name&&(n.headers={...n.headers,Expect:"100-continue"}),t({...r,request:n})}}(e),W)}}),V="WHEN_SUPPORTED",Q=V,G=V;var J,X;!function(e){e.MD5="MD5",e.CRC32="CRC32",e.CRC32C="CRC32C",e.SHA1="SHA1",e.SHA256="SHA256"}(J||(J={})),function(e){e.HEADER="header",e.TRAILER="trailer"}(X||(X={}));const Z=J.MD5,Y=J.CRC32;var ee;function te(e,t,r){e.__aws_sdk_context?e.__aws_sdk_context.features||(e.__aws_sdk_context.features={}):e.__aws_sdk_context={features:{}},e.__aws_sdk_context.features[t]=r}!function(e){e.ENV="env",e.CONFIG="shared config entry"}(ee||(ee={}));const re=e=>H.isInstance(e)?e.headers?.date??e.headers?.Date:void 0,ne=e=>new Date(Date.now()+e),ie=(e,t)=>{const r=Date.parse(e);return((e,t)=>Math.abs(ne(t).getTime()-e)>=3e5)(r,t)?r-Date.now():t},oe=(e,t)=>{if(!t)throw new Error(`Property \`${e}\` is not resolved for AWS SDK SigV4Auth`);return t},se=async e=>{const t=oe("context",e.context),r=oe("config",e.config),n=t.endpointV2?.properties?.authSchemes?.[0],i=oe("signer",r.signer),o=await i(n),s=e?.signingRegion,a=e?.signingRegionSet,c=e?.signingName;return{config:r,signer:o,signingRegion:s,signingRegionSet:a,signingName:c}};class ae{async sign(e,t,r){if(!q.isInstance(e))throw new Error("The request is not an instance of `HttpRequest` and cannot be signed");const n=await se(r),{config:i,signer:o}=n;let{signingRegion:s,signingName:a}=n;const c=r.context;if(c?.authSchemes?.length){const[e,t]=c.authSchemes;"sigv4a"===e?.name&&"sigv4"===t?.name&&(s=t?.signingRegion??s,a=t?.signingName??a)}return await o.sign(e,{signingDate:ne(i.systemClockOffset),signingRegion:s,signingService:a})}errorHandler(e){return t=>{const r=t.ServerTime??re(t.$response);if(r){const n=oe("config",e.config),i=n.systemClockOffset;n.systemClockOffset=ie(r,n.systemClockOffset);n.systemClockOffset!==i&&t.$metadata&&(t.$metadata.clockSkewCorrected=!0)}throw t}}successHandler(e,t){const r=re(e);if(r){const e=oe("config",t.config);e.systemClockOffset=ie(r,e.systemClockOffset)}}}class ce extends ae{async sign(e,t,r){if(!q.isInstance(e))throw new Error("The request is not an instance of `HttpRequest` and cannot be signed");const{config:n,signer:i,signingRegion:o,signingRegionSet:s,signingName:a}=await se(r),c=(await(n.sigv4aSigningRegionSet?.())??s??[o]).join(",");return await i.sign(e,{signingDate:ne(n.systemClockOffset),signingRegion:c,signingService:a})}}const ue=e=>e[D]||(e[D]={}),de=e=>{if("function"==typeof e)return e;const t=Promise.resolve(e);return()=>t};const le=(e,t)=>(r,n)=>async i=>{const o=e.httpAuthSchemeProvider(await t.httpAuthSchemeParametersProvider(e,n,i.input)),s=function(e){const t=new Map;for(const r of e)t.set(r.schemeId,r);return t}(e.httpAuthSchemes),a=ue(n),c=[];for(const r of o){const i=s.get(r.schemeId);if(!i){c.push(`HttpAuthScheme \`${r.schemeId}\` was not enabled for this service.`);continue}const o=i.identityProvider(await t.identityProviderConfigProvider(e));if(!o){c.push(`HttpAuthScheme \`${r.schemeId}\` did not have an IdentityProvider configured.`);continue}const{identityProperties:u={},signingProperties:d={}}=r.propertiesExtractor?.(e,n)||{};r.identityProperties=Object.assign(r.identityProperties||{},u),r.signingProperties=Object.assign(r.signingProperties||{},d),a.selectedHttpAuthScheme={httpAuthOption:r,identity:await o(r.identityProperties),signer:i.signer};break}if(!a.selectedHttpAuthScheme)throw new Error(c.join("\n"));return r(i)},he={step:"serialize",tags:["HTTP_AUTH_SCHEME"],name:"httpAuthSchemeMiddleware",override:!0,relation:"before",toMiddleware:"endpointV2Middleware"},fe={name:"deserializerMiddleware",step:"deserialize",tags:["DESERIALIZER"],override:!0},pe={name:"serializerMiddleware",step:"serialize",tags:["SERIALIZER"],override:!0};function ge(e,t,r){return{applyToStack:n=>{n.add(((e,t)=>r=>async n=>{const{response:i}=await r(n);try{return{response:i,output:await t(i,e)}}catch(e){if(Object.defineProperty(e,"$response",{value:i}),!("$metadata"in e)){const t="Deserialization error: to see the raw response, inspect the hidden field {error}.$response on this object.";e.message+="\n  "+t,void 0!==e.$responseBodyText&&e.$response&&(e.$response.body=e.$responseBodyText)}throw e}})(e,r),fe),n.add(((e,t)=>(r,n)=>async i=>{const o=n.endpointV2?.url&&e.urlParser?async()=>e.urlParser(n.endpointV2.url):e.endpoint;if(!o)throw new Error("No valid endpoint provider available.");const s=await t(i.input,{...e,endpoint:o});return r({...i,request:s})})(e,t),pe)}}}const me=e=>e=>{throw e},ye=(e,t)=>{},ve={step:"finalizeRequest",tags:["HTTP_SIGNING"],name:"httpSigningMiddleware",aliases:["apiKeyMiddleware","tokenMiddleware","awsAuthMiddleware"],override:!0,relation:"after",toMiddleware:"retryMiddleware"},be=e=>({applyToStack:e=>{e.addRelativeTo(((e,t)=>async r=>{if(!q.isInstance(r.request))return e(r);const n=ue(t).selectedHttpAuthScheme;if(!n)throw new Error("No HttpAuthScheme was selected: unable to sign request");const{httpAuthOption:{signingProperties:i={}},identity:o,signer:s}=n,a=await e({...r,request:await s.sign(r.request,o,i)}).catch((s.errorHandler||me)(i));return(s.successHandler||ye)(a.response,i),a}),ve)}}),we=e=>{if("function"==typeof e)return e;const t=Promise.resolve(e);return()=>t},ke={},Se=new Array(64);for(let e=0,t="A".charCodeAt(0),r="Z".charCodeAt(0);e+t<=r;e++){const r=String.fromCharCode(e+t);ke[r]=e,Se[e]=r}for(let e=0,t="a".charCodeAt(0),r="z".charCodeAt(0);e+t<=r;e++){const r=String.fromCharCode(e+t),n=e+26;ke[r]=n,Se[n]=r}for(let e=0;e<10;e++){ke[e.toString(10)]=e+52;const t=e.toString(10),r=e+52;ke[t]=r,Se[r]=t}ke["+"]=62,Se[62]="+",ke["/"]=63,Se[63]="/";const Ee=e=>{let t=e.length/4*3;"=="===e.slice(-2)?t-=2:"="===e.slice(-1)&&t--;const r=new ArrayBuffer(t),n=new DataView(r);for(let t=0;t<e.length;t+=4){let r=0,i=0;for(let n=t,o=t+3;n<=o;n++)if("="!==e[n]){if(!(e[n]in ke))throw new TypeError(`Invalid character ${e[n]} in base64 string.`);r|=ke[e[n]]<<6*(o-n),i+=6}else r>>=6;const o=t/4*3;r>>=i%8;const s=Math.floor(i/8);for(let e=0;e<s;e++){const t=8*(s-e-1);n.setUint8(o+e,(r&255<<t)>>t)}}return new Uint8Array(r)},xe=e=>(new TextEncoder).encode(e),Ae=e=>"string"==typeof e?xe(e):ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength/Uint8Array.BYTES_PER_ELEMENT):new Uint8Array(e),Te=e=>{if("string"==typeof e)return e;if("object"!=typeof e||"number"!=typeof e.byteOffset||"number"!=typeof e.byteLength)throw new Error("@smithy/util-utf8: toUtf8 encoder function only accepts string | Uint8Array.");return new TextDecoder("utf-8").decode(e)};function Ce(e){let t;t="string"==typeof e?xe(e):e;const r="object"==typeof t&&"number"==typeof t.length,n="object"==typeof t&&"number"==typeof t.byteOffset&&"number"==typeof t.byteLength;if(!r&&!n)throw new Error("@smithy/util-base64: toBase64 encoder function only accepts string | Uint8Array.");let i="";for(let e=0;e<t.length;e+=3){let r=0,n=0;for(let i=e,o=Math.min(e+3,t.length);i<o;i++)r|=t[i]<<8*(o-i-1),n+=8;const o=Math.ceil(n/6);r<<=6*o-n;for(let e=1;e<=o;e++){const t=6*(o-e);i+=Se[(r&63<<t)>>t]}i+="==".slice(0,4-o)}return i}class Re extends Uint8Array{static fromString(e,t="utf-8"){if("string"==typeof e)return function(e,t){return"base64"===t?Re.mutate(Ee(e)):Re.mutate(xe(e))}(e,t);throw new Error(`Unsupported conversion from ${typeof e} to Uint8ArrayBlobAdapter.`)}static mutate(e){return Object.setPrototypeOf(e,Re.prototype),e}transformToString(e="utf-8"){return function(e,t="utf-8"){return"base64"===t?Ce(e):Te(e)}(this,e)}}const Oe=(e,t)=>{const{base64Encoder:r,bodyLengthChecker:n,checksumAlgorithmFn:i,checksumLocationName:o,streamHasher:s}=t,a=void 0!==r&&void 0!==n&&void 0!==i&&void 0!==o&&void 0!==s,c=a?s(i,e):void 0,u=e.getReader();return new ReadableStream({async pull(e){const{value:t,done:i}=await u.read();if(i){if(e.enqueue("0\r\n"),a){const t=r(await c);e.enqueue(`${o}:${t}\r\n`),e.enqueue("\r\n")}e.close()}else e.enqueue(`${(n(t)||0).toString(16)}\r\n${t}\r\n`)}})},Pe=e=>encodeURIComponent(e).replace(/[!'()*]/g,_e),_e=e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`;function Ie(e,t){return new Request(e,t)}function Me(e=0){return new Promise(((t,r)=>{e&&setTimeout((()=>{const t=new Error(`Request did not complete within ${e} ms`);t.name="TimeoutError",r(t)}),e)}))}const Ne={supported:void 0};class Fe{static create(e){return"function"==typeof e?.handle?e:new Fe(e)}constructor(e){"function"==typeof e?this.configProvider=e().then((e=>e||{})):(this.config=e??{},this.configProvider=Promise.resolve(this.config)),void 0===Ne.supported&&(Ne.supported=Boolean("undefined"!=typeof Request&&"keepalive"in Ie("https://[::1]")))}destroy(){}async handle(e,{abortSignal:t}={}){this.config||(this.config=await this.configProvider);const r=this.config.requestTimeout,n=!0===this.config.keepAlive,i=this.config.credentials;if(t?.aborted){const e=new Error("Request aborted");return e.name="AbortError",Promise.reject(e)}let o=e.path;const s=function(e){const t=[];for(let r of Object.keys(e).sort()){const n=e[r];if(r=Pe(r),Array.isArray(n))for(let e=0,i=n.length;e<i;e++)t.push(`${r}=${Pe(n[e])}`);else{let e=r;(n||"string"==typeof n)&&(e+=`=${Pe(n)}`),t.push(e)}}return t.join("&")}(e.query||{});s&&(o+=`?${s}`),e.fragment&&(o+=`#${e.fragment}`);let a="";if(null!=e.username||null!=e.password){a=`${e.username??""}:${e.password??""}@`}const{port:c,method:u}=e,d=`${e.protocol}//${a}${e.hostname}${c?`:${c}`:""}${o}`,l="GET"===u||"HEAD"===u?void 0:e.body,h={body:l,headers:new Headers(e.headers),method:u,credentials:i};this.config?.cache&&(h.cache=this.config.cache),l&&(h.duplex="half"),"undefined"!=typeof AbortController&&(h.signal=t),Ne.supported&&(h.keepalive=n),"function"==typeof this.config.requestInit&&Object.assign(h,this.config.requestInit(e));let f=()=>{};const p=Ie(d,h),g=[fetch(p).then((e=>{const t=e.headers,r={};for(const e of t.entries())r[e[0]]=e[1];return null!=e.body?{response:new H({headers:r,reason:e.statusText,statusCode:e.status,body:e.body})}:e.blob().then((t=>({response:new H({headers:r,reason:e.statusText,statusCode:e.status,body:t})})))})),Me(r)];return t&&g.push(new Promise(((e,r)=>{const n=()=>{const e=new Error("Request aborted");e.name="AbortError",r(e)};if("function"==typeof t.addEventListener){const e=t;e.addEventListener("abort",n,{once:!0}),f=()=>e.removeEventListener("abort",n)}else t.onabort=n}))),Promise.race(g).finally(f)}updateHttpClientConfig(e,t){this.config=void 0,this.configProvider=this.configProvider.then((r=>(r[e]=t,r)))}httpHandlerConfigs(){return this.config??{}}}const $e=async e=>"function"==typeof Blob&&e instanceof Blob||"Blob"===e.constructor?.name?new Uint8Array(await e.arrayBuffer()):async function(e){const t=[],r=e.getReader();let n=!1,i=0;for(;!n;){const{done:e,value:o}=await r.read();o&&(t.push(o),i+=o.length),n=e}const o=new Uint8Array(i);let s=0;for(const e of t)o.set(e,s),s+=e.length;return o}(e);const Ue={},Le={};for(let e=0;e<256;e++){let t=e.toString(16).toLowerCase();1===t.length&&(t=`0${t}`),Ue[e]=t,Le[t]=e}function Be(e){if(e.length%2!=0)throw new Error("Hex encoded strings must have an even number length");const t=new Uint8Array(e.length/2);for(let r=0;r<e.length;r+=2){const n=e.slice(r,r+2).toLowerCase();if(!(n in Le))throw new Error(`Cannot decode unrecognized sequence ${n} as hexadecimal`);t[r/2]=Le[n]}return t}function De(e){let t="";for(let r=0;r<e.byteLength;r++)t+=Ue[e[r]];return t}const je=e=>"function"==typeof ReadableStream&&(e?.constructor?.name===ReadableStream.name||e instanceof ReadableStream),ze="The stream has already been transformed.",qe=e=>{if(!He(e)&&!je(e)){throw new Error(`Unexpected stream implementation, expect Blob or ReadableStream, got ${e?.__proto__?.constructor?.name||e}`)}let t=!1;const r=async()=>{if(t)throw new Error(ze);return t=!0,await $e(e)};return Object.assign(e,{transformToByteArray:r,transformToString:async e=>{const t=await r();if("base64"===e)return Ce(t);if("hex"===e)return De(t);if(void 0===e||"utf8"===e||"utf-8"===e)return Te(t);if("function"==typeof TextDecoder)return new TextDecoder(e).decode(t);throw new Error("TextDecoder is not available, please make sure polyfill is provided.")},transformToWebStream:()=>{if(t)throw new Error(ze);if(t=!0,He(e))return(e=>{if("function"!=typeof e.stream)throw new Error("Cannot transform payload Blob to web stream. Please make sure the Blob.stream() is polyfilled.\nIf you are using React Native, this API is not yet supported, see: https://react-native.canny.io/feature-requests/p/fetch-streaming-body");return e.stream()})(e);if(je(e))return e;throw new Error(`Cannot transform payload to web stream, got ${e}`)}})},He=e=>"function"==typeof Blob&&e instanceof Blob;const We="function"==typeof ReadableStream?ReadableStream:function(){};class Ke extends We{}const Ve=({expectedChecksum:e,checksum:t,source:r,checksumSourceLocation:n,base64Encoder:i})=>{if(!je(r))throw new Error(`@smithy/util-stream: unsupported source type ${r?.constructor?.name??r} in ChecksumStream.`);const o=i??Ce;if("function"!=typeof TransformStream)throw new Error("@smithy/util-stream: unable to instantiate ChecksumStream because API unavailable: ReadableStream/TransformStream.");const s=new TransformStream({start(){},async transform(e,r){t.update(e),r.enqueue(e)},async flush(r){const i=await t.digest(),s=o(i);if(e!==s){const t=new Error(`Checksum mismatch: expected "${e}" but received "${s}" in response header "${n}".`);r.error(t)}else r.terminate()}});r.pipeThrough(s);const a=s.readable;return Object.setPrototypeOf(a,Ke.prototype),a},Qe=async(e=new Uint8Array,t)=>{if(e instanceof Uint8Array)return Re.mutate(e);if(!e)return Re.mutate(new Uint8Array);const r=t.streamCollector(e);return Re.mutate(await r)};function Ge(e){return encodeURIComponent(e).replace(/[!'()*]/g,(function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()}))}function Je(e,t){return new Xe(e,t)}class Xe{constructor(e,t){this.input=e,this.context=t,this.query={},this.method="",this.headers={},this.path="",this.body=null,this.hostname="",this.resolvePathStack=[]}async build(){const{hostname:e,protocol:t="https",port:r,path:n}=await this.context.endpoint();this.path=n;for(const e of this.resolvePathStack)e(this.path);return new q({protocol:t,hostname:this.hostname||e,port:r,method:this.method,path:this.path,query:this.query,body:this.body,headers:this.headers})}hn(e){return this.hostname=e,this}bp(e){return this.resolvePathStack.push((t=>{this.path=`${t?.endsWith("/")?t.slice(0,-1):t||""}`+e})),this}p(e,t,r,n){return this.resolvePathStack.push((i=>{this.path=((e,t,r,n,i,o)=>{if(null==t||void 0===t[r])throw new Error("No value provided for input HTTP label: "+r+".");{const t=n();if(t.length<=0)throw new Error("Empty value provided for input HTTP label: "+r+".");e=e.replace(i,o?t.split("/").map((e=>Ge(e))).join("/"):Ge(t))}return e})(i,this.input,e,t,r,n)})),this}h(e){return this.headers=e,this}q(e){return this.query=e,this}b(e){return this.body=e,this}m(e){return this.method=e,this}}class Ze{constructor(e){this.authSchemes=new Map;for(const[t,r]of Object.entries(e))void 0!==r&&this.authSchemes.set(t,r)}getIdentityProvider(e){return this.authSchemes.get(e)}}const Ye=(et=3e5,e=>tt(e)&&e.expiration.getTime()-Date.now()<et);var et;const tt=e=>void 0!==e.expiration,rt="X-Amz-Date",nt="X-Amz-Signature",it="X-Amz-Security-Token",ot="authorization",st=rt.toLowerCase(),at=[ot,st,"date"],ct=nt.toLowerCase(),ut="x-amz-content-sha256",dt=it.toLowerCase(),lt={authorization:!0,"cache-control":!0,connection:!0,expect:!0,from:!0,"keep-alive":!0,"max-forwards":!0,pragma:!0,referer:!0,te:!0,trailer:!0,"transfer-encoding":!0,upgrade:!0,"user-agent":!0,"x-amzn-trace-id":!0},ht=/^proxy-/,ft=/^sec-/,pt="AWS4-HMAC-SHA256",gt="AWS4-HMAC-SHA256-PAYLOAD",mt="aws4_request",yt={},vt=[],bt=(e,t,r)=>`${e}/${t}/${r}/${mt}`,wt=(e,t,r)=>{const n=new e(t);return n.update(Ae(r)),n.digest()},kt=({headers:e},t,r)=>{const n={};for(const i of Object.keys(e).sort()){if(null==e[i])continue;const o=i.toLowerCase();(o in lt||t?.has(o)||ht.test(o)||ft.test(o))&&(!r||r&&!r.has(o))||(n[o]=e[i].trim().replace(/\s+/g," "))}return n},St=e=>"function"==typeof ArrayBuffer&&e instanceof ArrayBuffer||"[object ArrayBuffer]"===Object.prototype.toString.call(e),Et=async({headers:e,body:t},r)=>{for(const t of Object.keys(e))if(t.toLowerCase()===ut)return e[t];if(null==t)return"e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855";if("string"==typeof t||ArrayBuffer.isView(t)||St(t)){const e=new r;return e.update(Ae(t)),De(await e.digest())}return"UNSIGNED-PAYLOAD"};class xt{format(e){const t=[];for(const r of Object.keys(e)){const n=xe(r);t.push(Uint8Array.from([n.byteLength]),n,this.formatHeaderValue(e[r]))}const r=new Uint8Array(t.reduce(((e,t)=>e+t.byteLength),0));let n=0;for(const e of t)r.set(e,n),n+=e.byteLength;return r}formatHeaderValue(e){switch(e.type){case"boolean":return Uint8Array.from([e.value?0:1]);case"byte":return Uint8Array.from([2,e.value]);case"short":const t=new DataView(new ArrayBuffer(3));return t.setUint8(0,3),t.setInt16(1,e.value,!1),new Uint8Array(t.buffer);case"integer":const r=new DataView(new ArrayBuffer(5));return r.setUint8(0,4),r.setInt32(1,e.value,!1),new Uint8Array(r.buffer);case"long":const n=new Uint8Array(9);return n[0]=5,n.set(e.value.bytes,1),n;case"binary":const i=new DataView(new ArrayBuffer(3+e.value.byteLength));i.setUint8(0,6),i.setUint16(1,e.value.byteLength,!1);const o=new Uint8Array(i.buffer);return o.set(e.value,3),o;case"string":const s=xe(e.value),a=new DataView(new ArrayBuffer(3+s.byteLength));a.setUint8(0,7),a.setUint16(1,s.byteLength,!1);const c=new Uint8Array(a.buffer);return c.set(s,3),c;case"timestamp":const u=new Uint8Array(9);return u[0]=8,u.set(Ct.fromNumber(e.value.valueOf()).bytes,1),u;case"uuid":if(!Tt.test(e.value))throw new Error(`Invalid UUID received: ${e.value}`);const d=new Uint8Array(17);return d[0]=9,d.set(Be(e.value.replace(/\-/g,"")),1),d}}}var At;!function(e){e[e.boolTrue=0]="boolTrue",e[e.boolFalse=1]="boolFalse",e[e.byte=2]="byte",e[e.short=3]="short",e[e.integer=4]="integer",e[e.long=5]="long",e[e.byteArray=6]="byteArray",e[e.string=7]="string",e[e.timestamp=8]="timestamp",e[e.uuid=9]="uuid"}(At||(At={}));const Tt=/^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$/;class Ct{constructor(e){if(this.bytes=e,8!==e.byteLength)throw new Error("Int64 buffers must be exactly 8 bytes")}static fromNumber(e){if(e>0x8000000000000000||e<-0x8000000000000000)throw new Error(`${e} is too large (or, if negative, too small) to represent as an Int64`);const t=new Uint8Array(8);for(let r=7,n=Math.abs(Math.round(e));r>-1&&n>0;r--,n/=256)t[r]=n;return e<0&&Rt(t),new Ct(t)}valueOf(){const e=this.bytes.slice(0),t=128&e[0];return t&&Rt(e),parseInt(De(e),16)*(t?-1:1)}toString(){return String(this.valueOf())}}function Rt(e){for(let t=0;t<8;t++)e[t]^=255;for(let t=7;t>-1&&(e[t]++,0===e[t]);t--);}const Ot=e=>{e=q.clone(e);for(const t of Object.keys(e.headers))at.indexOf(t.toLowerCase())>-1&&delete e.headers[t];return e},Pt=e=>"number"==typeof e?new Date(1e3*e):"string"==typeof e?Number(e)?new Date(1e3*Number(e)):new Date(e):e;class _t{constructor({applyChecksum:e,credentials:t,region:r,service:n,sha256:i,uriEscapePath:o=!0}){this.headerFormatter=new xt,this.service=n,this.sha256=i,this.uriEscapePath=o,this.applyChecksum="boolean"!=typeof e||e,this.regionProvider=de(r),this.credentialProvider=de(t)}async presign(e,t={}){const{signingDate:r=new Date,expiresIn:n=3600,unsignableHeaders:i,unhoistableHeaders:o,signableHeaders:s,hoistableHeaders:a,signingRegion:c,signingService:u}=t,d=await this.credentialProvider();this.validateResolvedCredentials(d);const l=c??await this.regionProvider(),{longDate:h,shortDate:f}=It(r);if(n>604800)return Promise.reject("Signature version 4 presigned URLs must have an expiration date less than one week in the future");const p=bt(f,l,u??this.service),g=((e,t={})=>{const{headers:r,query:n={}}=q.clone(e);for(const e of Object.keys(r)){const i=e.toLowerCase();("x-amz-"===i.slice(0,6)&&!t.unhoistableHeaders?.has(i)||t.hoistableHeaders?.has(i))&&(n[e]=r[e],delete r[e])}return{...e,headers:r,query:n}})(Ot(e),{unhoistableHeaders:o,hoistableHeaders:a});d.sessionToken&&(g.query[it]=d.sessionToken),g.query["X-Amz-Algorithm"]=pt,g.query["X-Amz-Credential"]=`${d.accessKeyId}/${p}`,g.query[rt]=h,g.query["X-Amz-Expires"]=n.toString(10);const m=kt(g,i,s);return g.query["X-Amz-SignedHeaders"]=Mt(m),g.query[nt]=await this.getSignature(h,p,this.getSigningKey(d,l,f,u),this.createCanonicalRequest(g,m,await Et(e,this.sha256))),g}async sign(e,t){return"string"==typeof e?this.signString(e,t):e.headers&&e.payload?this.signEvent(e,t):e.message?this.signMessage(e,t):this.signRequest(e,t)}async signEvent({headers:e,payload:t},{signingDate:r=new Date,priorSignature:n,signingRegion:i,signingService:o}){const s=i??await this.regionProvider(),{shortDate:a,longDate:c}=It(r),u=bt(a,s,o??this.service),d=await Et({headers:{},body:t},this.sha256),l=new this.sha256;l.update(e);const h=De(await l.digest()),f=[gt,c,u,n,h,d].join("\n");return this.signString(f,{signingDate:r,signingRegion:s,signingService:o})}async signMessage(e,{signingDate:t=new Date,signingRegion:r,signingService:n}){return this.signEvent({headers:this.headerFormatter.format(e.message.headers),payload:e.message.body},{signingDate:t,signingRegion:r,signingService:n,priorSignature:e.priorSignature}).then((t=>({message:e.message,signature:t})))}async signString(e,{signingDate:t=new Date,signingRegion:r,signingService:n}={}){const i=await this.credentialProvider();this.validateResolvedCredentials(i);const o=r??await this.regionProvider(),{shortDate:s}=It(t),a=new this.sha256(await this.getSigningKey(i,o,s,n));return a.update(Ae(e)),De(await a.digest())}async signRequest(e,{signingDate:t=new Date,signableHeaders:r,unsignableHeaders:n,signingRegion:i,signingService:o}={}){const s=await this.credentialProvider();this.validateResolvedCredentials(s);const a=i??await this.regionProvider(),c=Ot(e),{longDate:u,shortDate:d}=It(t),l=bt(d,a,o??this.service);c.headers[st]=u,s.sessionToken&&(c.headers[dt]=s.sessionToken);const h=await Et(c,this.sha256);!((e,t)=>{e=e.toLowerCase();for(const r of Object.keys(t))if(e===r.toLowerCase())return!0;return!1})(ut,c.headers)&&this.applyChecksum&&(c.headers[ut]=h);const f=kt(c,n,r),p=await this.getSignature(u,l,this.getSigningKey(s,a,d,o),this.createCanonicalRequest(c,f,h));return c.headers[ot]=`${pt} Credential=${s.accessKeyId}/${l}, SignedHeaders=${Mt(f)}, Signature=${p}`,c}createCanonicalRequest(e,t,r){const n=Object.keys(t).sort();return`${e.method}\n${this.getCanonicalPath(e)}\n${(({query:e={}})=>{const t=[],r={};for(const n of Object.keys(e)){if(n.toLowerCase()===ct)continue;const i=Pe(n);t.push(i);const o=e[n];"string"==typeof o?r[i]=`${i}=${Pe(o)}`:Array.isArray(o)&&(r[i]=o.slice(0).reduce(((e,t)=>e.concat([`${i}=${Pe(t)}`])),[]).sort().join("&"))}return t.sort().map((e=>r[e])).filter((e=>e)).join("&")})(e)}\n${n.map((e=>`${e}:${t[e]}`)).join("\n")}\n\n${n.join(";")}\n${r}`}async createStringToSign(e,t,r){const n=new this.sha256;n.update(Ae(r));const i=await n.digest();return`${pt}\n${e}\n${t}\n${De(i)}`}getCanonicalPath({path:e}){if(this.uriEscapePath){const t=[];for(const r of e.split("/"))0!==r?.length&&"."!==r&&(".."===r?t.pop():t.push(r));const r=`${e?.startsWith("/")?"/":""}${t.join("/")}${t.length>0&&e?.endsWith("/")?"/":""}`;return Pe(r).replace(/%2F/g,"/")}return e}async getSignature(e,t,r,n){const i=await this.createStringToSign(e,t,n),o=new this.sha256(await r);return o.update(Ae(i)),De(await o.digest())}getSigningKey(e,t,r,n){return(async(e,t,r,n,i)=>{const o=`${r}:${n}:${i}:${De(await wt(e,t.secretAccessKey,t.accessKeyId))}:${t.sessionToken}`;if(o in yt)return yt[o];for(vt.push(o);vt.length>50;)delete yt[vt.shift()];let s=`AWS4${t.secretAccessKey}`;for(const t of[r,n,i,mt])s=await wt(e,s,t);return yt[o]=s})(this.sha256,e,r,t,n||this.service)}validateResolvedCredentials(e){if("object"!=typeof e||"string"!=typeof e.accessKeyId||"string"!=typeof e.secretAccessKey)throw new Error("Resolved credential object is not valid")}}const It=e=>{const t=(r=e,Pt(r).toISOString().replace(/\.\d{3}Z$/,"Z")).replace(/[\-:]/g,"");var r;return{longDate:t,shortDate:t.slice(0,8)}},Mt=e=>Object.keys(e).sort().join(";"),Nt=e=>{let t,r=!1;e.credentials&&(r=!0,t=((e,t,r)=>{if(void 0===e)return;const n="function"!=typeof e?async()=>Promise.resolve(e):e;let i,o,s,a=!1;const c=async e=>{o||(o=n(e));try{i=await o,s=!0,a=!1}finally{o=void 0}return i};return void 0===t?async e=>(s&&!e?.forceRefresh||(i=await c(e)),i):async e=>(s&&!e?.forceRefresh||(i=await c(e)),a?i:r(i)?t(i)?(await c(e),i):i:(a=!0,i))})(e.credentials,Ye,tt)),t||(t=e.credentialDefaultProvider?we(e.credentialDefaultProvider(Object.assign({},e,{parentClientConfig:e}))):async()=>{throw new Error("`credentials` is missing")});const{signingEscapePath:n=!0,systemClockOffset:i=e.systemClockOffset||0,sha256:o}=e;let s;return s=e.signer?we(e.signer):e.regionInfoProvider?()=>we(e.region)().then((async t=>[await e.regionInfoProvider(t,{useFipsEndpoint:await e.useFipsEndpoint(),useDualstackEndpoint:await e.useDualstackEndpoint()})||{},t])).then((([r,i])=>{const{signingRegion:s,signingService:a}=r;e.signingRegion=e.signingRegion||s||i,e.signingName=e.signingName||a||e.serviceId;const c={...e,credentials:t,region:e.signingRegion,service:e.signingName,sha256:o,uriEscapePath:n};return new(e.signerConstructor||_t)(c)})):async r=>{const i=(r=Object.assign({},{name:"sigv4",signingName:e.signingName||e.defaultSigningName,signingRegion:await we(e.region)(),properties:{}},r)).signingRegion,s=r.signingName;e.signingRegion=e.signingRegion||i,e.signingName=e.signingName||s||e.serviceId;const a={...e,credentials:t,region:e.signingRegion,service:e.signingName,sha256:o,uriEscapePath:n};return new(e.signerConstructor||_t)(a)},{...e,systemClockOffset:i,signingEscapePath:n,credentials:r?async()=>t().then((e=>{return r="CREDENTIALS_CODE",n="e",(t=e).$source||(t.$source={}),t.$source[r]=n,t;var t,r,n})):t,signer:s}},Ft=(e,t)=>{const r=[];if(e&&r.push(e),t)for(const e of t)r.push(e);return r},$t=(e,t)=>`${e||"anonymous"}${t&&t.length>0?` (a.k.a. ${t.join(",")})`:""}`,Ut=()=>{let e=[],t=[],r=!1;const n=new Set,i=r=>(e.forEach((e=>{r.add(e.middleware,{...e})})),t.forEach((e=>{r.addRelativeTo(e.middleware,{...e})})),r.identifyOnResolve?.(a.identifyOnResolve()),r),o=e=>{const t=[];return e.before.forEach((e=>{0===e.before.length&&0===e.after.length?t.push(e):t.push(...o(e))})),t.push(e),e.after.reverse().forEach((e=>{0===e.before.length&&0===e.after.length?t.push(e):t.push(...o(e))})),t},s=(r=!1)=>{const n=[],i=[],s={};e.forEach((e=>{const t={...e,before:[],after:[]};for(const e of Ft(t.name,t.aliases))s[e]=t;n.push(t)})),t.forEach((e=>{const t={...e,before:[],after:[]};for(const e of Ft(t.name,t.aliases))s[e]=t;i.push(t)})),i.forEach((e=>{if(e.toMiddleware){const t=s[e.toMiddleware];if(void 0===t){if(r)return;throw new Error(`${e.toMiddleware} is not found when adding ${$t(e.name,e.aliases)} middleware ${e.relation} ${e.toMiddleware}`)}"after"===e.relation&&t.after.push(e),"before"===e.relation&&t.before.push(e)}}));const a=(c=n,c.sort(((e,t)=>Lt[t.step]-Lt[e.step]||Bt[t.priority||"normal"]-Bt[e.priority||"normal"]))).map(o).reduce(((e,t)=>(e.push(...t),e)),[]);var c;return a},a={add:(t,r={})=>{const{name:i,override:o,aliases:s}=r,a={step:"initialize",priority:"normal",middleware:t,...r},c=Ft(i,s);if(c.length>0){if(c.some((e=>n.has(e)))){if(!o)throw new Error(`Duplicate middleware name '${$t(i,s)}'`);for(const t of c){const r=e.findIndex((e=>e.name===t||e.aliases?.some((e=>e===t))));if(-1===r)continue;const n=e[r];if(n.step!==a.step||a.priority!==n.priority)throw new Error(`"${$t(n.name,n.aliases)}" middleware with ${n.priority} priority in ${n.step} step cannot be overridden by "${$t(i,s)}" middleware with ${a.priority} priority in ${a.step} step.`);e.splice(r,1)}}for(const e of c)n.add(e)}e.push(a)},addRelativeTo:(e,r)=>{const{name:i,override:o,aliases:s}=r,a={middleware:e,...r},c=Ft(i,s);if(c.length>0){if(c.some((e=>n.has(e)))){if(!o)throw new Error(`Duplicate middleware name '${$t(i,s)}'`);for(const e of c){const r=t.findIndex((t=>t.name===e||t.aliases?.some((t=>t===e))));if(-1===r)continue;const n=t[r];if(n.toMiddleware!==a.toMiddleware||n.relation!==a.relation)throw new Error(`"${$t(n.name,n.aliases)}" middleware ${n.relation} "${n.toMiddleware}" middleware cannot be overridden by "${$t(i,s)}" middleware ${a.relation} "${a.toMiddleware}" middleware.`);t.splice(r,1)}}for(const e of c)n.add(e)}t.push(a)},clone:()=>i(Ut()),use:e=>{e.applyToStack(a)},remove:r=>"string"==typeof r?(r=>{let i=!1;const o=e=>{const t=Ft(e.name,e.aliases);if(t.includes(r)){i=!0;for(const e of t)n.delete(e);return!1}return!0};return e=e.filter(o),t=t.filter(o),i})(r):(r=>{let i=!1;const o=e=>{if(e.middleware===r){i=!0;for(const t of Ft(e.name,e.aliases))n.delete(t);return!1}return!0};return e=e.filter(o),t=t.filter(o),i})(r),removeByTag:r=>{let i=!1;const o=e=>{const{tags:t,name:o,aliases:s}=e;if(t&&t.includes(r)){const e=Ft(o,s);for(const t of e)n.delete(t);return i=!0,!1}return!0};return e=e.filter(o),t=t.filter(o),i},concat:e=>{const t=i(Ut());return t.use(e),t.identifyOnResolve(r||t.identifyOnResolve()||(e.identifyOnResolve?.()??!1)),t},applyToStack:i,identify:()=>s(!0).map((e=>{const t=e.step??e.relation+" "+e.toMiddleware;return $t(e.name,e.aliases)+" - "+t})),identifyOnResolve:e=>("boolean"==typeof e&&(r=e),r),resolve:(e,t)=>{for(const r of s().map((e=>e.middleware)).reverse())e=r(e,t);return r&&console.log(a.identify()),e}};return a},Lt={initialize:5,serialize:4,build:3,finalizeRequest:2,deserialize:1},Bt={high:3,normal:2,low:1};class Dt{constructor(e){this.config=e,this.middlewareStack=Ut()}send(e,t,r){const n="function"!=typeof t?t:void 0,i="function"==typeof t?t:r;let o;if(void 0===n&&!0===this.config.cacheMiddleware){this.handlers||(this.handlers=new WeakMap);const t=this.handlers;t.has(e.constructor)?o=t.get(e.constructor):(o=e.resolveMiddleware(this.middlewareStack,this.config,n),t.set(e.constructor,o))}else delete this.handlers,o=e.resolveMiddleware(this.middlewareStack,this.config,n);if(!i)return o(e).then((e=>e.output));o(e).then((e=>i(null,e.output)),(e=>i(e))).catch((()=>{}))}destroy(){this.config?.requestHandler?.destroy?.(),delete this.handlers}}class jt{constructor(){this.middlewareStack=Ut()}static classBuilder(){return new zt}resolveMiddlewareWithContext(e,t,r,{middlewareFn:n,clientName:i,commandName:o,inputFilterSensitiveLog:s,outputFilterSensitiveLog:a,smithyContext:c,additionalContext:u,CommandCtor:d}){for(const i of n.bind(this)(d,e,t,r))this.middlewareStack.use(i);const l=e.concat(this.middlewareStack),{logger:h}=t,f={logger:h,clientName:i,commandName:o,inputFilterSensitiveLog:s,outputFilterSensitiveLog:a,[D]:{commandInstance:this,...c},...u},{requestHandler:p}=t;return l.resolve((e=>p.handle(e.request,r||{})),f)}}class zt{constructor(){this._init=()=>{},this._ep={},this._middlewareFn=()=>[],this._commandName="",this._clientName="",this._additionalContext={},this._smithyContext={},this._inputFilterSensitiveLog=e=>e,this._outputFilterSensitiveLog=e=>e,this._serializer=null,this._deserializer=null}init(e){this._init=e}ep(e){return this._ep=e,this}m(e){return this._middlewareFn=e,this}s(e,t,r={}){return this._smithyContext={service:e,operation:t,...r},this}c(e={}){return this._additionalContext=e,this}n(e,t){return this._clientName=e,this._commandName=t,this}f(e=e=>e,t=e=>e){return this._inputFilterSensitiveLog=e,this._outputFilterSensitiveLog=t,this}ser(e){return this._serializer=e,this}de(e){return this._deserializer=e,this}build(){const e=this;let t;return t=class extends jt{static getEndpointParameterInstructions(){return e._ep}constructor(...[t]){super(),this.serialize=e._serializer,this.deserialize=e._deserializer,this.input=t??{},e._init(this)}resolveMiddleware(r,n,i){return this.resolveMiddlewareWithContext(r,n,i,{CommandCtor:t,middlewareFn:e._middlewareFn,clientName:e._clientName,commandName:e._commandName,inputFilterSensitiveLog:e._inputFilterSensitiveLog,outputFilterSensitiveLog:e._outputFilterSensitiveLog,smithyContext:e._smithyContext,additionalContext:e._additionalContext})}}}}const qt="***SensitiveInformation***",Ht=e=>{switch(e){case"true":return!0;case"false":return!1;default:throw new Error(`Unable to parse boolean value "${e}"`)}},Wt=Math.ceil(2**127*(2-2**-23)),Kt=e=>{const t=(e=>{if(null!=e){if("string"==typeof e){const t=parseFloat(e);if(!Number.isNaN(t))return String(t)!==String(e)&&cr.warn(ar(`Expected number but observed string: ${e}`)),t}if("number"==typeof e)return e;throw new TypeError(`Expected number, got ${typeof e}: ${e}`)}})(e);if(void 0!==t&&!Number.isNaN(t)&&t!==1/0&&t!==-1/0&&Math.abs(t)>Wt)throw new TypeError(`Expected 32-bit float, got ${e}`);return t},Vt=e=>{if(null!=e){if(Number.isInteger(e)&&!Number.isNaN(e))return e;throw new TypeError(`Expected integer, got ${typeof e}: ${e}`)}},Qt=e=>Xt(e,32),Gt=e=>Xt(e,16),Jt=e=>Xt(e,8),Xt=(e,t)=>{const r=Vt(e);if(void 0!==r&&Zt(r,t)!==r)throw new TypeError(`Expected ${t}-bit integer, got ${e}`);return r},Zt=(e,t)=>{switch(t){case 32:return Int32Array.of(e)[0];case 16:return Int16Array.of(e)[0];case 8:return Int8Array.of(e)[0]}},Yt=(e,t)=>{if(null==e){if(t)throw new TypeError(`Expected a non-null value for ${t}`);throw new TypeError("Expected a non-null value")}return e},er=e=>{if(null==e)return;if("object"==typeof e&&!Array.isArray(e))return e;const t=Array.isArray(e)?"array":typeof e;throw new TypeError(`Expected object, got ${t}: ${e}`)},tr=e=>{if(null!=e){if("string"==typeof e)return e;if(["boolean","number","bigint"].includes(typeof e))return cr.warn(ar(`Expected string, got ${typeof e}: ${e}`)),String(e);throw new TypeError(`Expected string, got ${typeof e}: ${e}`)}},rr=/(-?(?:0|[1-9]\d*)(?:\.\d+)?(?:[eE][+-]?\d+)?)|(-?Infinity)|(NaN)/g,nr=e=>{const t=e.match(rr);if(null===t||t[0].length!==e.length)throw new TypeError("Expected real number, got implicit NaN");return parseFloat(e)},ir=e=>Vt("string"==typeof e?nr(e):e),or=e=>Qt("string"==typeof e?nr(e):e),sr=e=>Gt("string"==typeof e?nr(e):e),ar=e=>String(new TypeError(e).stack||e).split("\n").slice(0,5).filter((e=>!e.includes("stackTraceWarning"))).join("\n"),cr={warn:console.warn},ur=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dr=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function lr(e){const t=e.getUTCFullYear(),r=e.getUTCMonth(),n=e.getUTCDay(),i=e.getUTCDate(),o=e.getUTCHours(),s=e.getUTCMinutes(),a=e.getUTCSeconds(),c=o<10?`0${o}`:`${o}`,u=s<10?`0${s}`:`${s}`,d=a<10?`0${a}`:`${a}`;return`${ur[n]}, ${i<10?`0${i}`:`${i}`} ${dr[r]} ${t} ${c}:${u}:${d} GMT`}const hr=new RegExp(/^(\d{4})-(\d{2})-(\d{2})[tT](\d{2}):(\d{2}):(\d{2})(?:\.(\d+))?(([-+]\d{2}\:\d{2})|[zZ])$/),fr=e=>{if(null==e)return;if("string"!=typeof e)throw new TypeError("RFC-3339 date-times must be expressed as strings");const t=hr.exec(e);if(!t)throw new TypeError("Invalid RFC-3339 date-time value");const[r,n,i,o,s,a,c,u,d]=t,l=sr(Rr(n)),h=Ar(i,"month",1,12),f=Ar(o,"day",1,31),p=vr(l,h,f,{hours:s,minutes:a,seconds:c,fractionalMilliseconds:u});return"Z"!=d.toUpperCase()&&p.setTime(p.getTime()-Cr(d)),p},pr=new RegExp(/^(?:Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d{2}) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d{1,2}):(\d{2}):(\d{2})(?:\.(\d+))? GMT$/),gr=new RegExp(/^(?:Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday), (\d{2})-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d{2}) (\d{1,2}):(\d{2}):(\d{2})(?:\.(\d+))? GMT$/),mr=new RegExp(/^(?:Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( [1-9]|\d{2}) (\d{1,2}):(\d{2}):(\d{2})(?:\.(\d+))? (\d{4})$/),yr=e=>{if(null==e)return;if("string"!=typeof e)throw new TypeError("RFC-7231 date-times must be expressed as strings");let t=pr.exec(e);if(t){const[e,r,n,i,o,s,a,c]=t;return vr(sr(Rr(i)),kr(n),Ar(r,"day",1,31),{hours:o,minutes:s,seconds:a,fractionalMilliseconds:c})}if(t=gr.exec(e),t){const[e,r,n,i,o,s,a,c]=t;return wr(vr(br(i),kr(n),Ar(r,"day",1,31),{hours:o,minutes:s,seconds:a,fractionalMilliseconds:c}))}if(t=mr.exec(e),t){const[e,r,n,i,o,s,a,c]=t;return vr(sr(Rr(c)),kr(r),Ar(n.trimLeft(),"day",1,31),{hours:i,minutes:o,seconds:s,fractionalMilliseconds:a})}throw new TypeError("Invalid RFC-7231 date-time value")},vr=(e,t,r,n)=>{const i=t-1;return Er(e,i,r),new Date(Date.UTC(e,i,r,Ar(n.hours,"hour",0,23),Ar(n.minutes,"minute",0,59),Ar(n.seconds,"seconds",0,60),Tr(n.fractionalMilliseconds)))},br=e=>{const t=(new Date).getUTCFullYear(),r=100*Math.floor(t/100)+sr(Rr(e));return r<t?r+100:r},wr=e=>e.getTime()-(new Date).getTime()>15768e8?new Date(Date.UTC(e.getUTCFullYear()-100,e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds())):e,kr=e=>{const t=dr.indexOf(e);if(t<0)throw new TypeError(`Invalid month: ${e}`);return t+1},Sr=[31,28,31,30,31,30,31,31,30,31,30,31],Er=(e,t,r)=>{let n=Sr[t];if(1===t&&xr(e)&&(n=29),r>n)throw new TypeError(`Invalid day for ${dr[t]} in ${e}: ${r}`)},xr=e=>e%4==0&&(e%100!=0||e%400==0),Ar=(e,t,r,n)=>{const i=(e=>Jt("string"==typeof e?nr(e):e))(Rr(e));if(i<r||i>n)throw new TypeError(`${t} must be between ${r} and ${n}, inclusive`);return i},Tr=e=>null==e?0:1e3*(e=>Kt("string"==typeof e?nr(e):e))("0."+e),Cr=e=>{const t=e[0];let r=1;if("+"==t)r=1;else{if("-"!=t)throw new TypeError(`Offset direction, ${t}, must be "+" or "-"`);r=-1}return r*(60*Number(e.substring(1,3))+Number(e.substring(4,6)))*60*1e3},Rr=e=>{let t=0;for(;t<e.length-1&&"0"===e.charAt(t);)t++;return 0===t?e:e.slice(t)};class Or extends Error{constructor(e){super(e.message),Object.setPrototypeOf(this,Or.prototype),this.name=e.name,this.$fault=e.$fault,this.$metadata=e.$metadata}}const Pr=(e,t={})=>{Object.entries(t).filter((([,e])=>void 0!==e)).forEach((([t,r])=>{null!=e[t]&&""!==e[t]||(e[t]=r)}));const r=e.message||e.Message||"UnknownError";return e.message=r,delete e.Message,e},_r=e=>({httpStatusCode:e.statusCode,requestId:e.headers["x-amzn-requestid"]??e.headers["x-amzn-request-id"]??e.headers["x-amz-request-id"],extendedRequestId:e.headers["x-amz-id-2"],cfId:e.headers["x-amz-cf-id"]}),Ir=e=>{switch(e){case"standard":case"cross-region":return{retryMode:"standard",connectionTimeout:3100};case"in-region":return{retryMode:"standard",connectionTimeout:1100};case"mobile":return{retryMode:"standard",connectionTimeout:3e4};default:return{}}},Mr=e=>{const t=[];for(const r in L){const n=L[r];void 0!==e[n]&&t.push({algorithmId:()=>n,checksumConstructor:()=>e[n]})}return{_checksumAlgorithms:t,addChecksumAlgorithm(e){this._checksumAlgorithms.push(e)},checksumAlgorithms(){return this._checksumAlgorithms}}},Nr=e=>{const t={};return e.checksumAlgorithms().forEach((e=>{t[e.algorithmId()]=e.checksumConstructor()})),t},Fr=e=>{let t=e.retryStrategy;return{setRetryStrategy(e){t=e},retryStrategy:()=>t}},$r=e=>{const t={};return t.retryStrategy=e.retryStrategy(),t},Ur=e=>({...Mr(e),...Fr(e)}),Lr=e=>({...Nr(e),...$r(e)}),Br=e=>Array.isArray(e)?e:[e],Dr=e=>{const t="#text";for(const r in e)e.hasOwnProperty(r)&&void 0!==e[r][t]?e[r]=e[r][t]:"object"==typeof e[r]&&null!==e[r]&&(e[r]=Dr(e[r]));return e},jr=e=>null!=e,zr=function(){const e=Object.getPrototypeOf(this).constructor,t=new(Function.bind.apply(String,[null,...arguments]));return Object.setPrototypeOf(t,e.prototype),t};zr.prototype=Object.create(String.prototype,{constructor:{value:zr,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf(zr,String);class qr{trace(){}debug(){}info(){}warn(){}error(){}}function Hr(e,t,r){let n,i,o;if(void 0===t&&void 0===r)n={},o=e;else{if(n=e,"function"==typeof t)return i=t,o=r,Wr(n,i,o);o=t}for(const e of Object.keys(o))Array.isArray(o[e])?Kr(n,null,o,e):n[e]=o[e];return n}const Wr=(e,t,r)=>Hr(e,Object.entries(r).reduce(((e,[r,n])=>(Array.isArray(n)?e[r]=n:e[r]="function"==typeof n?[t,n()]:[t,n],e)),{})),Kr=(e,t,r,n)=>{if(null!==t){let i=r[n];"function"==typeof i&&(i=[,i]);const[o=Vr,s=Qr,a=n]=i;return void(("function"==typeof o&&o(t[a])||"function"!=typeof o&&o)&&(e[n]=s(t[a])))}let[i,o]=r[n];if("function"==typeof o){let t;const r=void 0===i&&null!=(t=o()),s="function"==typeof i&&!!i(void 0)||"function"!=typeof i&&!!i;r?e[n]=t:s&&(e[n]=o())}else{const t=void 0===i&&null!=o,r="function"==typeof i&&!!i(o)||"function"!=typeof i&&!!i;(t||r)&&(e[n]=o)}},Vr=e=>null!=e,Qr=e=>e;function Gr(e){return(e.includes(",")||e.includes('"'))&&(e=`"${e.replace(/"/g,'\\"')}"`),e}function Jr(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Xr={},Zr={};!function(e){const t=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",r="["+t+"]["+(t+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040")+"]*",n=new RegExp("^"+r+"$");e.isExist=function(e){return void 0!==e},e.isEmptyObject=function(e){return 0===Object.keys(e).length},e.merge=function(e,t,r){if(t){const n=Object.keys(t),i=n.length;for(let o=0;o<i;o++)e[n[o]]="strict"===r?[t[n[o]]]:t[n[o]]}},e.getValue=function(t){return e.isExist(t)?t:""},e.isName=function(e){const t=n.exec(e);return!(null==t)},e.getAllMatches=function(e,t){const r=[];let n=t.exec(e);for(;n;){const i=[];i.startIndex=t.lastIndex-n[0].length;const o=n.length;for(let e=0;e<o;e++)i.push(n[e]);r.push(i),n=t.exec(e)}return r},e.nameRegexp=r}(Zr);const Yr=Zr,en={allowBooleanAttributes:!1,unpairedTags:[]};function tn(e){return" "===e||"\t"===e||"\n"===e||"\r"===e}function rn(e,t){const r=t;for(;t<e.length;t++)if("?"!=e[t]&&" "!=e[t]);else{const n=e.substr(r,t-r);if(t>5&&"xml"===n)return ln("InvalidXml","XML declaration allowed only at the start of the document.",fn(e,t));if("?"==e[t]&&">"==e[t+1]){t++;break}}return t}function nn(e,t){if(e.length>t+5&&"-"===e[t+1]&&"-"===e[t+2]){for(t+=3;t<e.length;t++)if("-"===e[t]&&"-"===e[t+1]&&">"===e[t+2]){t+=2;break}}else if(e.length>t+8&&"D"===e[t+1]&&"O"===e[t+2]&&"C"===e[t+3]&&"T"===e[t+4]&&"Y"===e[t+5]&&"P"===e[t+6]&&"E"===e[t+7]){let r=1;for(t+=8;t<e.length;t++)if("<"===e[t])r++;else if(">"===e[t]&&(r--,0===r))break}else if(e.length>t+9&&"["===e[t+1]&&"C"===e[t+2]&&"D"===e[t+3]&&"A"===e[t+4]&&"T"===e[t+5]&&"A"===e[t+6]&&"["===e[t+7])for(t+=8;t<e.length;t++)if("]"===e[t]&&"]"===e[t+1]&&">"===e[t+2]){t+=2;break}return t}Xr.validate=function(e,t){t=Object.assign({},en,t);const r=[];let n=!1,i=!1;"\ufeff"===e[0]&&(e=e.substr(1));for(let s=0;s<e.length;s++)if("<"===e[s]&&"?"===e[s+1]){if(s+=2,s=rn(e,s),s.err)return s}else{if("<"!==e[s]){if(tn(e[s]))continue;return ln("InvalidChar","char '"+e[s]+"' is not expected.",fn(e,s))}{let a=s;if(s++,"!"===e[s]){s=nn(e,s);continue}{let c=!1;"/"===e[s]&&(c=!0,s++);let u="";for(;s<e.length&&">"!==e[s]&&" "!==e[s]&&"\t"!==e[s]&&"\n"!==e[s]&&"\r"!==e[s];s++)u+=e[s];if(u=u.trim(),"/"===u[u.length-1]&&(u=u.substring(0,u.length-1),s--),o=u,!Yr.isName(o)){let t;return t=0===u.trim().length?"Invalid space after '<'.":"Tag '"+u+"' is an invalid name.",ln("InvalidTag",t,fn(e,s))}const d=an(e,s);if(!1===d)return ln("InvalidAttr","Attributes for '"+u+"' have open quote.",fn(e,s));let l=d.value;if(s=d.index,"/"===l[l.length-1]){const r=s-l.length;l=l.substring(0,l.length-1);const i=un(l,t);if(!0!==i)return ln(i.err.code,i.err.msg,fn(e,r+i.err.line));n=!0}else if(c){if(!d.tagClosed)return ln("InvalidTag","Closing tag '"+u+"' doesn't have proper closing.",fn(e,s));if(l.trim().length>0)return ln("InvalidTag","Closing tag '"+u+"' can't have attributes or invalid starting.",fn(e,a));if(0===r.length)return ln("InvalidTag","Closing tag '"+u+"' has not been opened.",fn(e,a));{const t=r.pop();if(u!==t.tagName){let r=fn(e,t.tagStartPos);return ln("InvalidTag","Expected closing tag '"+t.tagName+"' (opened in line "+r.line+", col "+r.col+") instead of closing tag '"+u+"'.",fn(e,a))}0==r.length&&(i=!0)}}else{const o=un(l,t);if(!0!==o)return ln(o.err.code,o.err.msg,fn(e,s-l.length+o.err.line));if(!0===i)return ln("InvalidXml","Multiple possible root nodes found.",fn(e,s));-1!==t.unpairedTags.indexOf(u)||r.push({tagName:u,tagStartPos:a}),n=!0}for(s++;s<e.length;s++)if("<"===e[s]){if("!"===e[s+1]){s++,s=nn(e,s);continue}if("?"!==e[s+1])break;if(s=rn(e,++s),s.err)return s}else if("&"===e[s]){const t=dn(e,s);if(-1==t)return ln("InvalidChar","char '&' is not expected.",fn(e,s));s=t}else if(!0===i&&!tn(e[s]))return ln("InvalidXml","Extra text at the end",fn(e,s));"<"===e[s]&&s--}}}var o;return n?1==r.length?ln("InvalidTag","Unclosed tag '"+r[0].tagName+"'.",fn(e,r[0].tagStartPos)):!(r.length>0)||ln("InvalidXml","Invalid '"+JSON.stringify(r.map((e=>e.tagName)),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1}):ln("InvalidXml","Start tag expected.",1)};const on='"',sn="'";function an(e,t){let r="",n="",i=!1;for(;t<e.length;t++){if(e[t]===on||e[t]===sn)""===n?n=e[t]:n!==e[t]||(n="");else if(">"===e[t]&&""===n){i=!0;break}r+=e[t]}return""===n&&{value:r,index:t,tagClosed:i}}const cn=new RegExp("(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['\"])(([\\s\\S])*?)\\5)?","g");function un(e,t){const r=Yr.getAllMatches(e,cn),n={};for(let e=0;e<r.length;e++){if(0===r[e][1].length)return ln("InvalidAttr","Attribute '"+r[e][2]+"' has no space in starting.",pn(r[e]));if(void 0!==r[e][3]&&void 0===r[e][4])return ln("InvalidAttr","Attribute '"+r[e][2]+"' is without value.",pn(r[e]));if(void 0===r[e][3]&&!t.allowBooleanAttributes)return ln("InvalidAttr","boolean attribute '"+r[e][2]+"' is not allowed.",pn(r[e]));const i=r[e][2];if(!hn(i))return ln("InvalidAttr","Attribute '"+i+"' is an invalid name.",pn(r[e]));if(n.hasOwnProperty(i))return ln("InvalidAttr","Attribute '"+i+"' is repeated.",pn(r[e]));n[i]=1}return!0}function dn(e,t){if(";"===e[++t])return-1;if("#"===e[t])return function(e,t){let r=/\d/;for("x"===e[t]&&(t++,r=/[\da-fA-F]/);t<e.length;t++){if(";"===e[t])return t;if(!e[t].match(r))break}return-1}(e,++t);let r=0;for(;t<e.length;t++,r++)if(!(e[t].match(/\w/)&&r<20)){if(";"===e[t])break;return-1}return t}function ln(e,t,r){return{err:{code:e,msg:t,line:r.line||r,col:r.col}}}function hn(e){return Yr.isName(e)}function fn(e,t){const r=e.substring(0,t).split(/\r?\n/);return{line:r.length,col:r[r.length-1].length+1}}function pn(e){return e.startIndex+e[1].length}var gn={};const mn={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(e,t){return t},attributeValueProcessor:function(e,t){return t},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1,updateTag:function(e,t,r){return e}};gn.buildOptions=function(e){return Object.assign({},mn,e)},gn.defaultOptions=mn;var yn=class{constructor(e){this.tagname=e,this.child=[],this[":@"]={}}add(e,t){"__proto__"===e&&(e="#__proto__"),this.child.push({[e]:t})}addChild(e){"__proto__"===e.tagname&&(e.tagname="#__proto__"),e[":@"]&&Object.keys(e[":@"]).length>0?this.child.push({[e.tagname]:e.child,":@":e[":@"]}):this.child.push({[e.tagname]:e.child})}};const vn=Zr;function bn(e,t){let r="";for(;t<e.length&&"'"!==e[t]&&'"'!==e[t];t++)r+=e[t];if(r=r.trim(),-1!==r.indexOf(" "))throw new Error("External entites are not supported");const n=e[t++];let i="";for(;t<e.length&&e[t]!==n;t++)i+=e[t];return[r,i,t]}function wn(e,t){return"!"===e[t+1]&&"-"===e[t+2]&&"-"===e[t+3]}function kn(e,t){return"!"===e[t+1]&&"E"===e[t+2]&&"N"===e[t+3]&&"T"===e[t+4]&&"I"===e[t+5]&&"T"===e[t+6]&&"Y"===e[t+7]}function Sn(e,t){return"!"===e[t+1]&&"E"===e[t+2]&&"L"===e[t+3]&&"E"===e[t+4]&&"M"===e[t+5]&&"E"===e[t+6]&&"N"===e[t+7]&&"T"===e[t+8]}function En(e,t){return"!"===e[t+1]&&"A"===e[t+2]&&"T"===e[t+3]&&"T"===e[t+4]&&"L"===e[t+5]&&"I"===e[t+6]&&"S"===e[t+7]&&"T"===e[t+8]}function xn(e,t){return"!"===e[t+1]&&"N"===e[t+2]&&"O"===e[t+3]&&"T"===e[t+4]&&"A"===e[t+5]&&"T"===e[t+6]&&"I"===e[t+7]&&"O"===e[t+8]&&"N"===e[t+9]}function An(e){if(vn.isName(e))return e;throw new Error(`Invalid entity name ${e}`)}var Tn=function(e,t){const r={};if("O"!==e[t+3]||"C"!==e[t+4]||"T"!==e[t+5]||"Y"!==e[t+6]||"P"!==e[t+7]||"E"!==e[t+8])throw new Error("Invalid Tag instead of DOCTYPE");{t+=9;let n=1,i=!1,o=!1,s="";for(;t<e.length;t++)if("<"!==e[t]||o)if(">"===e[t]){if(o?"-"===e[t-1]&&"-"===e[t-2]&&(o=!1,n--):n--,0===n)break}else"["===e[t]?i=!0:s+=e[t];else{if(i&&kn(e,t))t+=7,[entityName,val,t]=bn(e,t+1),-1===val.indexOf("&")&&(r[An(entityName)]={regx:RegExp(`&${entityName};`,"g"),val:val});else if(i&&Sn(e,t))t+=8;else if(i&&En(e,t))t+=8;else if(i&&xn(e,t))t+=9;else{if(!wn)throw new Error("Invalid DOCTYPE");o=!0}n++,s=""}if(0!==n)throw new Error("Unclosed DOCTYPE")}return{entities:r,i:t}};const Cn=/^[-+]?0x[a-fA-F0-9]+$/,Rn=/^([\-\+])?(0*)(\.[0-9]+([eE]\-?[0-9]+)?|[0-9]+(\.[0-9]+([eE]\-?[0-9]+)?)?)$/;!Number.parseInt&&window.parseInt&&(Number.parseInt=window.parseInt),!Number.parseFloat&&window.parseFloat&&(Number.parseFloat=window.parseFloat);const On={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};const Pn=Zr,_n=yn,In=Tn,Mn=function(e,t={}){if(t=Object.assign({},On,t),!e||"string"!=typeof e)return e;let r=e.trim();if(void 0!==t.skipLike&&t.skipLike.test(r))return e;if(t.hex&&Cn.test(r))return Number.parseInt(r,16);{const n=Rn.exec(r);if(n){const i=n[1],o=n[2];let s=function(e){if(e&&-1!==e.indexOf("."))return"."===(e=e.replace(/0+$/,""))?e="0":"."===e[0]?e="0"+e:"."===e[e.length-1]&&(e=e.substr(0,e.length-1)),e;return e}(n[3]);const a=n[4]||n[6];if(!t.leadingZeros&&o.length>0&&i&&"."!==r[2])return e;if(!t.leadingZeros&&o.length>0&&!i&&"."!==r[1])return e;{const n=Number(r),c=""+n;return-1!==c.search(/[eE]/)||a?t.eNotation?n:e:-1!==r.indexOf(".")?"0"===c&&""===s||c===s||i&&c==="-"+s?n:e:o?s===c||i+s===c?n:e:r===c||r===i+c?n:e}}return e}};function Nn(e){const t=Object.keys(e);for(let r=0;r<t.length;r++){const n=t[r];this.lastEntities[n]={regex:new RegExp("&"+n+";","g"),val:e[n]}}}function Fn(e,t,r,n,i,o,s){if(void 0!==e&&(this.options.trimValues&&!n&&(e=e.trim()),e.length>0)){s||(e=this.replaceEntitiesValue(e));const n=this.options.tagValueProcessor(t,e,r,i,o);if(null==n)return e;if(typeof n!=typeof e||n!==e)return n;if(this.options.trimValues)return Vn(e,this.options.parseTagValue,this.options.numberParseOptions);return e.trim()===e?Vn(e,this.options.parseTagValue,this.options.numberParseOptions):e}}function $n(e){if(this.options.removeNSPrefix){const t=e.split(":"),r="/"===e.charAt(0)?"/":"";if("xmlns"===t[0])return"";2===t.length&&(e=r+t[1])}return e}const Un=new RegExp("([^\\s=]+)\\s*(=\\s*(['\"])([\\s\\S]*?)\\3)?","gm");function Ln(e,t,r){if(!this.options.ignoreAttributes&&"string"==typeof e){const r=Pn.getAllMatches(e,Un),n=r.length,i={};for(let e=0;e<n;e++){const n=this.resolveNameSpace(r[e][1]);let o=r[e][4],s=this.options.attributeNamePrefix+n;if(n.length)if(this.options.transformAttributeName&&(s=this.options.transformAttributeName(s)),"__proto__"===s&&(s="#__proto__"),void 0!==o){this.options.trimValues&&(o=o.trim()),o=this.replaceEntitiesValue(o);const e=this.options.attributeValueProcessor(n,o,t);i[s]=null==e?o:typeof e!=typeof o||e!==o?e:Vn(o,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(i[s]=!0)}if(!Object.keys(i).length)return;if(this.options.attributesGroupName){const e={};return e[this.options.attributesGroupName]=i,e}return i}}const Bn=function(e){e=e.replace(/\r\n?/g,"\n");const t=new _n("!xml");let r=t,n="",i="";for(let o=0;o<e.length;o++){if("<"===e[o])if("/"===e[o+1]){const t=Hn(e,">",o,"Closing Tag is not closed.");let s=e.substring(o+2,t).trim();if(this.options.removeNSPrefix){const e=s.indexOf(":");-1!==e&&(s=s.substr(e+1))}this.options.transformTagName&&(s=this.options.transformTagName(s)),r&&(n=this.saveTextToParentTag(n,r,i));const a=i.substring(i.lastIndexOf(".")+1);if(s&&-1!==this.options.unpairedTags.indexOf(s))throw new Error(`Unpaired tag can not be used as closing tag: </${s}>`);let c=0;a&&-1!==this.options.unpairedTags.indexOf(a)?(c=i.lastIndexOf(".",i.lastIndexOf(".")-1),this.tagsNodeStack.pop()):c=i.lastIndexOf("."),i=i.substring(0,c),r=this.tagsNodeStack.pop(),n="",o=t}else if("?"===e[o+1]){let t=Wn(e,o,!1,"?>");if(!t)throw new Error("Pi Tag is not closed.");if(n=this.saveTextToParentTag(n,r,i),this.options.ignoreDeclaration&&"?xml"===t.tagName||this.options.ignorePiTags);else{const e=new _n(t.tagName);e.add(this.options.textNodeName,""),t.tagName!==t.tagExp&&t.attrExpPresent&&(e[":@"]=this.buildAttributesMap(t.tagExp,i,t.tagName)),this.addChild(r,e,i)}o=t.closeIndex+1}else if("!--"===e.substr(o+1,3)){const t=Hn(e,"--\x3e",o+4,"Comment is not closed.");if(this.options.commentPropName){const s=e.substring(o+4,t-2);n=this.saveTextToParentTag(n,r,i),r.add(this.options.commentPropName,[{[this.options.textNodeName]:s}])}o=t}else if("!D"===e.substr(o+1,2)){const t=In(e,o);this.docTypeEntities=t.entities,o=t.i}else if("!["===e.substr(o+1,2)){const t=Hn(e,"]]>",o,"CDATA is not closed.")-2,s=e.substring(o+9,t);n=this.saveTextToParentTag(n,r,i);let a=this.parseTextData(s,r.tagname,i,!0,!1,!0,!0);null==a&&(a=""),this.options.cdataPropName?r.add(this.options.cdataPropName,[{[this.options.textNodeName]:s}]):r.add(this.options.textNodeName,a),o=t+2}else{let s=Wn(e,o,this.options.removeNSPrefix),a=s.tagName;const c=s.rawTagName;let u=s.tagExp,d=s.attrExpPresent,l=s.closeIndex;this.options.transformTagName&&(a=this.options.transformTagName(a)),r&&n&&"!xml"!==r.tagname&&(n=this.saveTextToParentTag(n,r,i,!1));const h=r;if(h&&-1!==this.options.unpairedTags.indexOf(h.tagname)&&(r=this.tagsNodeStack.pop(),i=i.substring(0,i.lastIndexOf("."))),a!==t.tagname&&(i+=i?"."+a:a),this.isItStopNode(this.options.stopNodes,i,a)){let t="";if(u.length>0&&u.lastIndexOf("/")===u.length-1)"/"===a[a.length-1]?(a=a.substr(0,a.length-1),i=i.substr(0,i.length-1),u=a):u=u.substr(0,u.length-1),o=s.closeIndex;else if(-1!==this.options.unpairedTags.indexOf(a))o=s.closeIndex;else{const r=this.readStopNodeData(e,c,l+1);if(!r)throw new Error(`Unexpected end of ${c}`);o=r.i,t=r.tagContent}const n=new _n(a);a!==u&&d&&(n[":@"]=this.buildAttributesMap(u,i,a)),t&&(t=this.parseTextData(t,a,i,!0,d,!0,!0)),i=i.substr(0,i.lastIndexOf(".")),n.add(this.options.textNodeName,t),this.addChild(r,n,i)}else{if(u.length>0&&u.lastIndexOf("/")===u.length-1){"/"===a[a.length-1]?(a=a.substr(0,a.length-1),i=i.substr(0,i.length-1),u=a):u=u.substr(0,u.length-1),this.options.transformTagName&&(a=this.options.transformTagName(a));const e=new _n(a);a!==u&&d&&(e[":@"]=this.buildAttributesMap(u,i,a)),this.addChild(r,e,i),i=i.substr(0,i.lastIndexOf("."))}else{const e=new _n(a);this.tagsNodeStack.push(r),a!==u&&d&&(e[":@"]=this.buildAttributesMap(u,i,a)),this.addChild(r,e,i),r=e}n="",o=l}}else n+=e[o]}return t.child};function Dn(e,t,r){const n=this.options.updateTag(t.tagname,r,t[":@"]);!1===n||("string"==typeof n?(t.tagname=n,e.addChild(t)):e.addChild(t))}const jn=function(e){if(this.options.processEntities){for(let t in this.docTypeEntities){const r=this.docTypeEntities[t];e=e.replace(r.regx,r.val)}for(let t in this.lastEntities){const r=this.lastEntities[t];e=e.replace(r.regex,r.val)}if(this.options.htmlEntities)for(let t in this.htmlEntities){const r=this.htmlEntities[t];e=e.replace(r.regex,r.val)}e=e.replace(this.ampEntity.regex,this.ampEntity.val)}return e};function zn(e,t,r,n){return e&&(void 0===n&&(n=0===Object.keys(t.child).length),void 0!==(e=this.parseTextData(e,t.tagname,r,!1,!!t[":@"]&&0!==Object.keys(t[":@"]).length,n))&&""!==e&&t.add(this.options.textNodeName,e),e=""),e}function qn(e,t,r){const n="*."+r;for(const r in e){const i=e[r];if(n===i||t===i)return!0}return!1}function Hn(e,t,r,n){const i=e.indexOf(t,r);if(-1===i)throw new Error(n);return i+t.length-1}function Wn(e,t,r,n=">"){const i=function(e,t,r=">"){let n,i="";for(let o=t;o<e.length;o++){let t=e[o];if(n)t===n&&(n="");else if('"'===t||"'"===t)n=t;else if(t===r[0]){if(!r[1])return{data:i,index:o};if(e[o+1]===r[1])return{data:i,index:o}}else"\t"===t&&(t=" ");i+=t}}(e,t+1,n);if(!i)return;let o=i.data;const s=i.index,a=o.search(/\s/);let c=o,u=!0;-1!==a&&(c=o.substring(0,a),o=o.substring(a+1).trimStart());const d=c;if(r){const e=c.indexOf(":");-1!==e&&(c=c.substr(e+1),u=c!==i.data.substr(e+1))}return{tagName:c,tagExp:o,closeIndex:s,attrExpPresent:u,rawTagName:d}}function Kn(e,t,r){const n=r;let i=1;for(;r<e.length;r++)if("<"===e[r])if("/"===e[r+1]){const o=Hn(e,">",r,`${t} is not closed`);if(e.substring(r+2,o).trim()===t&&(i--,0===i))return{tagContent:e.substring(n,r),i:o};r=o}else if("?"===e[r+1]){r=Hn(e,"?>",r+1,"StopNode is not closed.")}else if("!--"===e.substr(r+1,3)){r=Hn(e,"--\x3e",r+3,"StopNode is not closed.")}else if("!["===e.substr(r+1,2)){r=Hn(e,"]]>",r,"StopNode is not closed.")-2}else{const n=Wn(e,r,">");if(n){(n&&n.tagName)===t&&"/"!==n.tagExp[n.tagExp.length-1]&&i++,r=n.closeIndex}}}function Vn(e,t,r){if(t&&"string"==typeof e){const t=e.trim();return"true"===t||"false"!==t&&Mn(e,r)}return Pn.isExist(e)?e:""}var Qn=class{constructor(e){this.options=e,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:""},pound:{regex:/&(pound|#163);/g,val:""},yen:{regex:/&(yen|#165);/g,val:""},euro:{regex:/&(euro|#8364);/g,val:""},copyright:{regex:/&(copy|#169);/g,val:""},reg:{regex:/&(reg|#174);/g,val:""},inr:{regex:/&(inr|#8377);/g,val:""},num_dec:{regex:/&#([0-9]{1,7});/g,val:(e,t)=>String.fromCharCode(Number.parseInt(t,10))},num_hex:{regex:/&#x([0-9a-fA-F]{1,6});/g,val:(e,t)=>String.fromCharCode(Number.parseInt(t,16))}},this.addExternalEntities=Nn,this.parseXml=Bn,this.parseTextData=Fn,this.resolveNameSpace=$n,this.buildAttributesMap=Ln,this.isItStopNode=qn,this.replaceEntitiesValue=jn,this.readStopNodeData=Kn,this.saveTextToParentTag=zn,this.addChild=Dn}},Gn={};function Jn(e,t,r){let n;const i={};for(let o=0;o<e.length;o++){const s=e[o],a=Xn(s);let c="";if(c=void 0===r?a:r+"."+a,a===t.textNodeName)void 0===n?n=s[a]:n+=""+s[a];else{if(void 0===a)continue;if(s[a]){let e=Jn(s[a],t,c);const r=Yn(e,t);s[":@"]?Zn(e,s[":@"],c,t):1!==Object.keys(e).length||void 0===e[t.textNodeName]||t.alwaysCreateTextNode?0===Object.keys(e).length&&(t.alwaysCreateTextNode?e[t.textNodeName]="":e=""):e=e[t.textNodeName],void 0!==i[a]&&i.hasOwnProperty(a)?(Array.isArray(i[a])||(i[a]=[i[a]]),i[a].push(e)):t.isArray(a,c,r)?i[a]=[e]:i[a]=e}}}return"string"==typeof n?n.length>0&&(i[t.textNodeName]=n):void 0!==n&&(i[t.textNodeName]=n),i}function Xn(e){const t=Object.keys(e);for(let e=0;e<t.length;e++){const r=t[e];if(":@"!==r)return r}}function Zn(e,t,r,n){if(t){const i=Object.keys(t),o=i.length;for(let s=0;s<o;s++){const o=i[s];n.isArray(o,r+"."+o,!0,!0)?e[o]=[t[o]]:e[o]=t[o]}}}function Yn(e,t){const{textNodeName:r}=t,n=Object.keys(e).length;return 0===n||!(1!==n||!e[r]&&"boolean"!=typeof e[r]&&0!==e[r])}Gn.prettify=function(e,t){return Jn(e,t)};const{buildOptions:ei}=gn,ti=Qn,{prettify:ri}=Gn,ni=Xr;var ii=class{constructor(e){this.externalEntities={},this.options=ei(e)}parse(e,t){if("string"==typeof e);else{if(!e.toString)throw new Error("XML data is accepted in String or Bytes[] form.");e=e.toString()}if(t){!0===t&&(t={});const r=ni.validate(e,t);if(!0!==r)throw Error(`${r.err.msg}:${r.err.line}:${r.err.col}`)}const r=new ti(this.options);r.addExternalEntities(this.externalEntities);const n=r.parseXml(e);return this.options.preserveOrder||void 0===n?n:ri(n,this.options)}addEntity(e,t){if(-1!==t.indexOf("&"))throw new Error("Entity value can't have '&'");if(-1!==e.indexOf("&")||-1!==e.indexOf(";"))throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if("&"===t)throw new Error("An entity with value '&' is not permitted");this.externalEntities[e]=t}};function oi(e,t,r,n){let i="",o=!1;for(let s=0;s<e.length;s++){const a=e[s],c=si(a);if(void 0===c)continue;let u="";if(u=0===r.length?c:`${r}.${c}`,c===t.textNodeName){let e=a[c];ci(u,t)||(e=t.tagValueProcessor(c,e),e=ui(e,t)),o&&(i+=n),i+=e,o=!1;continue}if(c===t.cdataPropName){o&&(i+=n),i+=`<![CDATA[${a[c][0][t.textNodeName]}]]>`,o=!1;continue}if(c===t.commentPropName){i+=n+`\x3c!--${a[c][0][t.textNodeName]}--\x3e`,o=!0;continue}if("?"===c[0]){const e=ai(a[":@"],t),r="?xml"===c?"":n;let s=a[c][0][t.textNodeName];s=0!==s.length?" "+s:"",i+=r+`<${c}${s}${e}?>`,o=!0;continue}let d=n;""!==d&&(d+=t.indentBy);const l=n+`<${c}${ai(a[":@"],t)}`,h=oi(a[c],t,u,d);-1!==t.unpairedTags.indexOf(c)?t.suppressUnpairedNode?i+=l+">":i+=l+"/>":h&&0!==h.length||!t.suppressEmptyNode?h&&h.endsWith(">")?i+=l+`>${h}${n}</${c}>`:(i+=l+">",h&&""!==n&&(h.includes("/>")||h.includes("</"))?i+=n+t.indentBy+h+n:i+=h,i+=`</${c}>`):i+=l+"/>",o=!0}return i}function si(e){const t=Object.keys(e);for(let r=0;r<t.length;r++){const n=t[r];if(e.hasOwnProperty(n)&&":@"!==n)return n}}function ai(e,t){let r="";if(e&&!t.ignoreAttributes)for(let n in e){if(!e.hasOwnProperty(n))continue;let i=t.attributeValueProcessor(n,e[n]);i=ui(i,t),!0===i&&t.suppressBooleanAttributes?r+=` ${n.substr(t.attributeNamePrefix.length)}`:r+=` ${n.substr(t.attributeNamePrefix.length)}="${i}"`}return r}function ci(e,t){let r=(e=e.substr(0,e.length-t.textNodeName.length-1)).substr(e.lastIndexOf(".")+1);for(let n in t.stopNodes)if(t.stopNodes[n]===e||t.stopNodes[n]==="*."+r)return!0;return!1}function ui(e,t){if(e&&e.length>0&&t.processEntities)for(let r=0;r<t.entities.length;r++){const n=t.entities[r];e=e.replace(n.regex,n.val)}return e}const di=function(e,t){let r="";return t.format&&t.indentBy.length>0&&(r="\n"),oi(e,t,"",r)},li={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(e,t){return t},attributeValueProcessor:function(e,t){return t},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[],oneListGroup:!1};function hi(e){this.options=Object.assign({},li,e),this.options.ignoreAttributes||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=gi),this.processTextOrObjNode=fi,this.options.format?(this.indentate=pi,this.tagEndChar=">\n",this.newLine="\n"):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine="")}function fi(e,t,r){const n=this.j2x(e,r+1);return void 0!==e[this.options.textNodeName]&&1===Object.keys(e).length?this.buildTextValNode(e[this.options.textNodeName],t,n.attrStr,r):this.buildObjectNode(n.val,t,n.attrStr,r)}function pi(e){return this.options.indentBy.repeat(e)}function gi(e){return!(!e.startsWith(this.options.attributeNamePrefix)||e===this.options.textNodeName)&&e.substr(this.attrPrefixLen)}hi.prototype.build=function(e){return this.options.preserveOrder?di(e,this.options):(Array.isArray(e)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(e={[this.options.arrayNodeName]:e}),this.j2x(e,0).val)},hi.prototype.j2x=function(e,t){let r="",n="";for(let i in e)if(Object.prototype.hasOwnProperty.call(e,i))if(void 0===e[i])this.isAttribute(i)&&(n+="");else if(null===e[i])this.isAttribute(i)?n+="":"?"===i[0]?n+=this.indentate(t)+"<"+i+"?"+this.tagEndChar:n+=this.indentate(t)+"<"+i+"/"+this.tagEndChar;else if(e[i]instanceof Date)n+=this.buildTextValNode(e[i],i,"",t);else if("object"!=typeof e[i]){const o=this.isAttribute(i);if(o)r+=this.buildAttrPairStr(o,""+e[i]);else if(i===this.options.textNodeName){let t=this.options.tagValueProcessor(i,""+e[i]);n+=this.replaceEntitiesValue(t)}else n+=this.buildTextValNode(e[i],i,"",t)}else if(Array.isArray(e[i])){const r=e[i].length;let o="",s="";for(let a=0;a<r;a++){const r=e[i][a];if(void 0===r);else if(null===r)"?"===i[0]?n+=this.indentate(t)+"<"+i+"?"+this.tagEndChar:n+=this.indentate(t)+"<"+i+"/"+this.tagEndChar;else if("object"==typeof r)if(this.options.oneListGroup){const e=this.j2x(r,t+1);o+=e.val,this.options.attributesGroupName&&r.hasOwnProperty(this.options.attributesGroupName)&&(s+=e.attrStr)}else o+=this.processTextOrObjNode(r,i,t);else if(this.options.oneListGroup){let e=this.options.tagValueProcessor(i,r);e=this.replaceEntitiesValue(e),o+=e}else o+=this.buildTextValNode(r,i,"",t)}this.options.oneListGroup&&(o=this.buildObjectNode(o,i,s,t)),n+=o}else if(this.options.attributesGroupName&&i===this.options.attributesGroupName){const t=Object.keys(e[i]),n=t.length;for(let o=0;o<n;o++)r+=this.buildAttrPairStr(t[o],""+e[i][t[o]])}else n+=this.processTextOrObjNode(e[i],i,t);return{attrStr:r,val:n}},hi.prototype.buildAttrPairStr=function(e,t){return t=this.options.attributeValueProcessor(e,""+t),t=this.replaceEntitiesValue(t),this.options.suppressBooleanAttributes&&"true"===t?" "+e:" "+e+'="'+t+'"'},hi.prototype.buildObjectNode=function(e,t,r,n){if(""===e)return"?"===t[0]?this.indentate(n)+"<"+t+r+"?"+this.tagEndChar:this.indentate(n)+"<"+t+r+this.closeTag(t)+this.tagEndChar;{let i="</"+t+this.tagEndChar,o="";return"?"===t[0]&&(o="?",i=""),!r&&""!==r||-1!==e.indexOf("<")?!1!==this.options.commentPropName&&t===this.options.commentPropName&&0===o.length?this.indentate(n)+`\x3c!--${e}--\x3e`+this.newLine:this.indentate(n)+"<"+t+r+o+this.tagEndChar+e+this.indentate(n)+i:this.indentate(n)+"<"+t+r+o+">"+e+i}},hi.prototype.closeTag=function(e){let t="";return-1!==this.options.unpairedTags.indexOf(e)?this.options.suppressUnpairedNode||(t="/"):t=this.options.suppressEmptyNode?"/":`></${e}`,t},hi.prototype.buildTextValNode=function(e,t,r,n){if(!1!==this.options.cdataPropName&&t===this.options.cdataPropName)return this.indentate(n)+`<![CDATA[${e}]]>`+this.newLine;if(!1!==this.options.commentPropName&&t===this.options.commentPropName)return this.indentate(n)+`\x3c!--${e}--\x3e`+this.newLine;if("?"===t[0])return this.indentate(n)+"<"+t+r+"?"+this.tagEndChar;{let i=this.options.tagValueProcessor(t,e);return i=this.replaceEntitiesValue(i),""===i?this.indentate(n)+"<"+t+r+this.closeTag(t)+this.tagEndChar:this.indentate(n)+"<"+t+r+">"+i+"</"+t+this.tagEndChar}},hi.prototype.replaceEntitiesValue=function(e){if(e&&e.length>0&&this.options.processEntities)for(let t=0;t<this.options.entities.length;t++){const r=this.options.entities[t];e=e.replace(r.regex,r.val)}return e};var mi={XMLParser:ii,XMLValidator:Xr,XMLBuilder:hi};const yi=(e,t)=>((e,t)=>Qe(e,t).then((e=>t.utf8Encoder(e))))(e,t).then((e=>{if(e.length){const t=new mi.XMLParser({attributeNamePrefix:"",htmlEntities:!0,ignoreAttributes:!1,ignoreDeclaration:!0,parseTagValue:!1,trimValues:!1,tagValueProcessor:(e,t)=>""===t.trim()&&t.includes("\n")?"":void 0});let r;t.addEntity("#xD","\r"),t.addEntity("#10","\n");try{r=t.parse(e,!0)}catch(t){throw t&&"object"==typeof t&&Object.defineProperty(t,"$responseBodyText",{value:e}),t}const n="#text",i=Object.keys(r)[0],o=r[i];return o[n]&&(o[i]=o[n],delete o[n]),Dr(o)}return{}})),vi=async(e,t)=>{const r=await yi(e,t);return r.Error&&(r.Error.message=r.Error.message??r.Error.Message),r},bi=[J.CRC32,J.CRC32C,J.SHA1,J.SHA256],wi=[J.SHA256,J.SHA1,J.CRC32,J.CRC32C],ki=e=>e===J.MD5?"content-md5":`x-amz-checksum-${e.toLowerCase()}`,Si=e=>void 0!==e&&"string"!=typeof e&&!ArrayBuffer.isView(e)&&!St(e);function Ei(e,t,r,n){return new(r||(r=Promise))((function(i,o){function s(e){try{c(n.next(e))}catch(e){o(e)}}function a(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}c((n=n.apply(e,t||[])).next())}))}function xi(e,t){var r,n,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=a(0),s.throw=a(1),s.return=a(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(c){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(o=0)),o;)try{if(r=1,n&&(i=2&a[0]?n.return:a[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,a[1])).done)return i;switch(n=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,n=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],n=0}finally{r=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}"function"==typeof SuppressedError&&SuppressedError;var Ai="undefined"!=typeof Buffer&&Buffer.from?function(e){return Buffer.from(e,"utf8")}:e=>(new TextEncoder).encode(e);function Ti(e){return e instanceof Uint8Array?e:"string"==typeof e?Ai(e):ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength/Uint8Array.BYTES_PER_ELEMENT):new Uint8Array(e)}function Ci(e){return"string"==typeof e?0===e.length:0===e.byteLength}function Ri(e){return new Uint8Array([(4278190080&e)>>24,(16711680&e)>>16,(65280&e)>>8,255&e])}function Oi(e){if(!Uint32Array.from){for(var t=new Uint32Array(e.length),r=0;r<e.length;)t[r]=e[r],r+=1;return t}return Uint32Array.from(e)}var Pi=function(){function e(){this.crc32c=new _i}return e.prototype.update=function(e){Ci(e)||this.crc32c.update(Ti(e))},e.prototype.digest=function(){return Ei(this,void 0,void 0,(function(){return xi(this,(function(e){return[2,Ri(this.crc32c.digest())]}))}))},e.prototype.reset=function(){this.crc32c=new _i},e}(),_i=function(){function e(){this.checksum=4294967295}return e.prototype.update=function(e){var t,r;try{for(var n=function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),i=n.next();!i.done;i=n.next()){var o=i.value;this.checksum=this.checksum>>>8^Ii[255&(this.checksum^o)]}}catch(e){t={error:e}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}return this},e.prototype.digest=function(){return(4294967295^this.checksum)>>>0},e}(),Ii=Oi([0,4067132163,3778769143,324072436,3348797215,904991772,648144872,3570033899,2329499855,2024987596,1809983544,2575936315,1296289744,3207089363,2893594407,1578318884,274646895,3795141740,4049975192,51262619,3619967088,632279923,922689671,3298075524,2592579488,1760304291,2075979607,2312596564,1562183871,2943781820,3156637768,1313733451,549293790,3537243613,3246849577,871202090,3878099393,357341890,102525238,4101499445,2858735121,1477399826,1264559846,3107202533,1845379342,2677391885,2361733625,2125378298,820201905,3263744690,3520608582,598981189,4151959214,85089709,373468761,3827903834,3124367742,1213305469,1526817161,2842354314,2107672161,2412447074,2627466902,1861252501,1098587580,3004210879,2688576843,1378610760,2262928035,1955203488,1742404180,2511436119,3416409459,969524848,714683780,3639785095,205050476,4266873199,3976438427,526918040,1361435347,2739821008,2954799652,1114974503,2529119692,1691668175,2005155131,2247081528,3690758684,697762079,986182379,3366744552,476452099,3993867776,4250756596,255256311,1640403810,2477592673,2164122517,1922457750,2791048317,1412925310,1197962378,3037525897,3944729517,427051182,170179418,4165941337,746937522,3740196785,3451792453,1070968646,1905808397,2213795598,2426610938,1657317369,3053634322,1147748369,1463399397,2773627110,4215344322,153784257,444234805,3893493558,1021025245,3467647198,3722505002,797665321,2197175160,1889384571,1674398607,2443626636,1164749927,3070701412,2757221520,1446797203,137323447,4198817972,3910406976,461344835,3484808360,1037989803,781091935,3705997148,2460548119,1623424788,1939049696,2180517859,1429367560,2807687179,3020495871,1180866812,410100952,3927582683,4182430767,186734380,3756733383,763408580,1053836080,3434856499,2722870694,1344288421,1131464017,2971354706,1708204729,2545590714,2229949006,1988219213,680717673,3673779818,3383336350,1002577565,4010310262,493091189,238226049,4233660802,2987750089,1082061258,1395524158,2705686845,1972364758,2279892693,2494862625,1725896226,952904198,3399985413,3656866545,731699698,4283874585,222117402,510512622,3959836397,3280807620,837199303,582374963,3504198960,68661723,4135334616,3844915500,390545967,1230274059,3141532936,2825850620,1510247935,2395924756,2091215383,1878366691,2644384480,3553878443,565732008,854102364,3229815391,340358836,3861050807,4117890627,119113024,1493875044,2875275879,3090270611,1247431312,2660249211,1828433272,2141937292,2378227087,3811616794,291187481,34330861,4032846830,615137029,3603020806,3314634738,939183345,1776939221,2609017814,2295496738,2058945313,2926798794,1545135305,1330124605,3173225534,4084100981,17165430,307568514,3762199681,888469610,3332340585,3587147933,665062302,2042050490,2346497209,2559330125,1793573966,3190661285,1279665062,1595330642,2910671697]);function Mi(e,t,r,n){return new(r||(r=Promise))((function(i,o){function s(e){try{c(n.next(e))}catch(e){o(e)}}function a(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}c((n=n.apply(e,t||[])).next())}))}function Ni(e,t){var r,n,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=a(0),s.throw=a(1),s.return=a(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(c){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(o=0)),o;)try{if(r=1,n&&(i=2&a[0]?n.return:a[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,a[1])).done)return i;switch(n=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,n=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],n=0}finally{r=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}"function"==typeof SuppressedError&&SuppressedError;var Fi=function(){function e(){this.crc32=new $i}return e.prototype.update=function(e){Ci(e)||this.crc32.update(Ti(e))},e.prototype.digest=function(){return Mi(this,void 0,void 0,(function(){return Ni(this,(function(e){return[2,Ri(this.crc32.digest())]}))}))},e.prototype.reset=function(){this.crc32=new $i},e}(),$i=function(){function e(){this.checksum=4294967295}return e.prototype.update=function(e){var t,r;try{for(var n=function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),i=n.next();!i.done;i=n.next()){var o=i.value;this.checksum=this.checksum>>>8^Ui[255&(this.checksum^o)]}}catch(e){t={error:e}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}return this},e.prototype.digest=function(){return(4294967295^this.checksum)>>>0},e}(),Ui=Oi([0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117]);const Li=(e,t)=>({[J.MD5]:t.md5,[J.CRC32]:Fi,[J.CRC32C]:Pi,[J.SHA1]:t.sha1,[J.SHA256]:t.sha256}[e]),Bi=(e,t)=>{const r=new e;return r.update(Ae(t||"")),r.digest()},Di={name:"flexibleChecksumsMiddleware",step:"build",tags:["BODY_CHECKSUM"],override:!0},ji=(e,t)=>(r,n)=>async i=>{if(!q.isInstance(i.request))return r(i);const{request:o,input:s}=i,{body:a,headers:c}=o,{base64Encoder:u,streamHasher:d}=e,{requestChecksumRequired:l,requestAlgorithmMember:h}=t,f=((e,{requestChecksumRequired:t,requestAlgorithmMember:r},n)=>{const i=n?Y:Z;if(!r||!e[r])return t?i:void 0;const o=e[r];if(!bi.includes(o))throw new Error(`The checksum algorithm "${o}" is not supported by the client. Select one of ${bi}.`);return o})(s,{requestChecksumRequired:l,requestAlgorithmMember:h},!!n.isS3ExpressBucket);let p=a,g=c;if(f){switch(f){case J.CRC32:te(n,"FLEXIBLE_CHECKSUMS_REQ_CRC32","U");break;case J.CRC32C:te(n,"FLEXIBLE_CHECKSUMS_REQ_CRC32C","V");break;case J.SHA1:te(n,"FLEXIBLE_CHECKSUMS_REQ_SHA1","X");break;case J.SHA256:te(n,"FLEXIBLE_CHECKSUMS_REQ_SHA256","Y")}const t=ki(f),r=Li(f,e);if(Si(a)){const{getAwsChunkedEncodingStream:n,bodyLengthChecker:i}=e;p=n(a,{base64Encoder:u,bodyLengthChecker:i,checksumLocationName:t,checksumAlgorithmFn:r,streamHasher:d}),g={...c,"content-encoding":c["content-encoding"]?`${c["content-encoding"]},aws-chunked`:"aws-chunked","transfer-encoding":"chunked","x-amz-decoded-content-length":c["content-length"],"x-amz-content-sha256":"STREAMING-UNSIGNED-PAYLOAD-TRAILER","x-amz-trailer":t},delete g["content-length"]}else if(!((e,t)=>{const r=e.toLowerCase();for(const e of Object.keys(t))if(r===e.toLowerCase())return!0;return!1})(t,c)){const e=await Bi(r,a);g={...c,[t]:u(e)}}}return await r({...i,request:{...o,headers:g,body:p}})},zi=(e=[])=>{const t=[];for(const r of wi)e.includes(r)&&bi.includes(r)&&t.push(r);return t};function qi(e){return new Blob([e]).stream()}const Hi=async(e,{checksumAlgorithmFn:t,base64Encoder:r})=>r(await Bi(t,e)),Wi={name:"flexibleChecksumsResponseMiddleware",toMiddleware:"deserializerMiddleware",relation:"after",tags:["BODY_CHECKSUM"],override:!0},Ki=(e,t)=>(r,n)=>async i=>{if(!q.isInstance(i.request))return r(i);const o=i.input,s=await r(i),a=s.response;let c;const{requestValidationModeMember:u,responseAlgorithms:d}=t;if(u&&"ENABLED"===o[u]){const{clientName:t,commandName:r}=n;if("S3Client"===t&&"GetObjectCommand"===r&&zi(d).every((e=>{const t=ki(e),r=a.headers[t];return!r||(e=>{const t=e.lastIndexOf("-");if(-1!==t){const r=e.slice(t+1);if(!r.startsWith("0")){const e=parseInt(r,10);if(!isNaN(e)&&e>=1&&e<=1e4)return!0}}return!1})(r)})))return s;const i=Si(a.body);i&&(c=await e.streamCollector(a.body),a.body=qi(c)),await(async(e,{config:t,responseAlgorithms:r})=>{const n=zi(r),{body:i,headers:o}=e;for(const r of n){const n=ki(r),s=o[n];if(s){const o=Li(r,t),{base64Encoder:a}=t;if(Si(i))return void(e.body=Ve({expectedChecksum:s,checksumSourceLocation:n,checksum:new o,source:i,base64Encoder:a}));const c=await Hi(i,{checksumAlgorithmFn:o,base64Encoder:a});if(c===s)break;throw new Error(`Checksum mismatch: expected "${c}" but received "${s}" in response header "${n}".`)}}})(s.response,{config:e,responseAlgorithms:d}),i&&c&&(a.body=qi(c))}return s},Vi=(e,t)=>({applyToStack:r=>{r.add(ji(e,t),Di),r.addRelativeTo(Ki(e,t),Wi)}});const Qi={name:"hostHeaderMiddleware",step:"build",priority:"low",tags:["HOST"],override:!0},Gi=e=>({applyToStack:t=>{t.add((e=>t=>async r=>{if(!q.isInstance(r.request))return t(r);const{request:n}=r,{handlerProtocol:i=""}=e.requestHandler.metadata||{};if(i.indexOf("h2")>=0&&!n.headers[":authority"])delete n.headers.host,n.headers[":authority"]=n.hostname+(n.port?":"+n.port:"");else if(!n.headers.host){let e=n.hostname;null!=n.port&&(e+=`:${n.port}`),n.headers.host=e}return t(r)})(e),Qi)}}),Ji={name:"loggerMiddleware",tags:["LOGGER"],step:"initialize",override:!0},Xi="X-Amzn-Trace-Id",Zi={step:"build",tags:["RECURSION_DETECTION"],name:"recursionDetectionMiddleware",override:!0,priority:"low"},Yi=e=>({applyToStack:t=>{t.add((e=>t=>async r=>{const{request:n}=r;if(!q.isInstance(n)||"node"!==e.runtime||n.headers.hasOwnProperty(Xi))return t(r);const i=process.env.AWS_LAMBDA_FUNCTION_NAME,o=process.env._X_AMZN_TRACE_ID,s=e=>"string"==typeof e&&e.length>0;return s(i)&&s(o)&&(n.headers[Xi]=o),t({...r,request:n})})(e),Zi)}});const eo={step:"finalizeRequest",tags:["CHECK_CONTENT_LENGTH_HEADER"],name:"getCheckContentLengthHeaderPlugin",override:!0},to=e=>({applyToStack:e=>{e.add(((e,t)=>async r=>{const{request:n}=r;if(q.isInstance(n)&&!("content-length"in n.headers)){const e="Are you using a Stream of unknown length as the Body of a PutObject request? Consider using Upload instead from @aws-sdk/lib-storage.";"function"!=typeof t?.logger?.warn||t.logger instanceof qr?console.warn(e):t.logger.warn(e)}return e({...r})}),eo)}}),ro={tags:["REGION_REDIRECT","S3"],name:"regionRedirectEndpointMiddleware",override:!0,relation:"before",toMiddleware:"endpointV2Middleware"};const no={step:"initialize",tags:["REGION_REDIRECT","S3"],name:"regionRedirectMiddleware",override:!0},io=e=>({applyToStack:t=>{t.add(function(e){return(t,r)=>async n=>{try{return await t(n)}catch(i){if(e.followRegionRedirects&&(301===i?.$metadata?.httpStatusCode||400===i?.$metadata?.httpStatusCode&&"IllegalLocationConstraintException"===i?.name)){try{const t=i.$response.headers["x-amz-bucket-region"];r.logger?.debug(`Redirecting from ${await e.region()} to ${t}`),r.__s3RegionRedirect=t}catch(e){throw new Error("Region redirect failed: "+e)}return t(n)}throw i}}}(e),no),t.addRelativeTo((e=>(t,r)=>async n=>{const i=await e.region(),o=e.region;let s=()=>{};r.__s3RegionRedirect&&(Object.defineProperty(e,"region",{writable:!1,value:async()=>r.__s3RegionRedirect}),s=()=>Object.defineProperty(e,"region",{writable:!0,value:o}));try{const o=await t(n);if(r.__s3RegionRedirect&&(s(),i!==await e.region()))throw new Error("Region was not restored following S3 region redirect.");return o}catch(e){throw s(),e}})(e),ro)}}),oo={tags:["S3"],name:"s3ExpiresMiddleware",override:!0,relation:"after",toMiddleware:"deserializerMiddleware"},so=e=>({applyToStack:e=>{e.addRelativeTo(((e,t)=>async r=>{const n=await e(r),{response:i}=n;if(H.isInstance(i)&&i.headers.expires){i.headers.expiresstring=i.headers.expires;try{yr(i.headers.expires)}catch(e){t.logger?.warn(`AWS SDK Warning for ${t.clientName}::${t.commandName} response parsing (${i.headers.expires}): ${e}`),delete i.headers.expires}}return n}),oo)}});class ao{constructor(e={}){this.data=e,this.lastPurgeTime=Date.now()}get(e){const t=this.data[e];if(t)return t}set(e,t){return this.data[e]=t,t}delete(e){delete this.data[e]}async purgeExpired(){const e=Date.now();if(!(this.lastPurgeTime+ao.EXPIRED_CREDENTIAL_PURGE_INTERVAL_MS>e))for(const t in this.data){const r=this.data[t];if(!r.isRefreshing){const n=await r.identity;n.expiration&&n.expiration.getTime()<e&&delete this.data[t]}}}}ao.EXPIRED_CREDENTIAL_PURGE_INTERVAL_MS=3e4;class co{constructor(e,t=!1,r=Date.now()){this._identity=e,this.isRefreshing=t,this.accessed=r}get identity(){return this.accessed=Date.now(),this._identity}}class uo{constructor(e,t=new ao){this.createSessionFn=e,this.cache=t}async getS3ExpressIdentity(e,t){const r=t.Bucket,{cache:n}=this,i=n.get(r);return i?i.identity.then((e=>{if((e.expiration?.getTime()??0)<Date.now())return n.set(r,new co(this.getIdentity(r))).identity;return(e.expiration?.getTime()??0)<Date.now()+uo.REFRESH_WINDOW_MS&&!i.isRefreshing&&(i.isRefreshing=!0,this.getIdentity(r).then((e=>{n.set(r,new co(Promise.resolve(e)))}))),e})):n.set(r,new co(this.getIdentity(r))).identity}async getIdentity(e){await this.cache.purgeExpired().catch((e=>{console.warn("Error while clearing expired entries in S3ExpressIdentityCache: \n"+e)}));const t=await this.createSessionFn(e);if(!t.Credentials?.AccessKeyId||!t.Credentials?.SecretAccessKey)throw new Error("s3#createSession response credential missing AccessKeyId or SecretAccessKey.");return{accessKeyId:t.Credentials.AccessKeyId,secretAccessKey:t.Credentials.SecretAccessKey,sessionToken:t.Credentials.SessionToken,expiration:t.Credentials.Expiration?new Date(t.Credentials.Expiration):void 0}}}var lo;uo.REFRESH_WINDOW_MS=6e4,function(e){e.ENV="env",e.CONFIG="shared config entry"}(lo||(lo={}));const ho="X-Amz-S3session-Token",fo=ho.toLowerCase();class po extends _t{async signWithCredentials(e,t,r){const n=go(t);e.headers[fo]=t.sessionToken;return mo(this,n),this.signRequest(e,r??{})}async presignWithCredentials(e,t,r){const n=go(t);delete e.headers[fo],e.headers[ho]=t.sessionToken,e.query=e.query??{},e.query[ho]=t.sessionToken;return mo(this,n),this.presign(e,r)}}function go(e){return{accessKeyId:e.accessKeyId,secretAccessKey:e.secretAccessKey,expiration:e.expiration}}function mo(e,t){const r=setTimeout((()=>{throw new Error("SignatureV4S3Express credential override was created but not called.")}),10),n=e.credentialProvider;e.credentialProvider=()=>(clearTimeout(r),e.credentialProvider=n,Promise.resolve(t))}const yo={name:"s3ExpressMiddleware",step:"build",tags:["S3","S3_EXPRESS"],override:!0},vo=e=>({applyToStack:t=>{t.add((e=>(t,r)=>async n=>{if(r.endpointV2){const t=r.endpointV2,i="sigv4-s3express"===t.properties?.authSchemes?.[0]?.name;if(("S3Express"===t.properties?.backend||"Directory"===t.properties?.bucketType)&&(te(r,"S3_EXPRESS_BUCKET","J"),r.isS3ExpressBucket=!0),i){const t=n.input.Bucket;if(t){const i=await e.s3ExpressIdentityProvider.getS3ExpressIdentity(await e.credentials(),{Bucket:t});r.s3ExpressIdentity=i,q.isInstance(n.request)&&i.sessionToken&&(n.request.headers[fo]=i.sessionToken)}}}return t(n)})(e),yo)}}),bo=e=>e=>{throw e},wo=(e,t)=>{},ko=e=>(t,r)=>async n=>{if(!q.isInstance(n.request))return t(n);const i=ue(r).selectedHttpAuthScheme;if(!i)throw new Error("No HttpAuthScheme was selected: unable to sign request");const{httpAuthOption:{signingProperties:o={}},identity:s,signer:a}=i;let c;c=r.s3ExpressIdentity?await(async(e,t,r,n)=>{const i=await n.signWithCredentials(r,e,{});if(i.headers["X-Amz-Security-Token"]||i.headers["x-amz-security-token"])throw new Error("X-Amz-Security-Token must not be set for s3-express requests.");return i})(r.s3ExpressIdentity,0,n.request,await e.signer()):await a.sign(n.request,s,o);const u=await t({...n,request:c}).catch((a.errorHandler||bo)(o));return(a.successHandler||wo)(u.response,o),u},So={CopyObjectCommand:!0,UploadPartCopyCommand:!0,CompleteMultipartUploadCommand:!0},Eo=e=>(t,r)=>async n=>{const i=await t(n),{response:o}=i;if(!H.isInstance(o))return i;const{statusCode:s,body:a}=o;if(s<200||s>=300)return i;if(!("function"==typeof a?.stream||"function"==typeof a?.pipe||"function"==typeof a?.tee))return i;let c=a,u=a;!a||"object"!=typeof a||a instanceof Uint8Array||([c,u]=await async function(e){return"function"==typeof e.stream&&(e=e.stream()),e.tee()}(a)),o.body=u;const d=await xo(c,{streamCollector:async e=>async function(e,t){let r=0;const n=[],i=e.getReader();let o=!1;for(;!o;){const{done:e,value:s}=await i.read();if(s&&(n.push(s),r+=s?.byteLength??0),r>=t)break;o=e}i.releaseLock();const s=new Uint8Array(Math.min(t,r));let a=0;for(const e of n){if(e.byteLength>s.byteLength-a){s.set(e.subarray(0,s.byteLength-a),a);break}s.set(e,a),a+=e.length}return s}(e,3e3)});"function"==typeof c?.destroy&&c.destroy();const l=e.utf8Encoder(d.subarray(d.length-16));if(0===d.length&&So[r.commandName]){const e=new Error("S3 aborted request");throw e.name="InternalError",e}return l&&l.endsWith("</Error>")&&(o.statusCode=400),i},xo=(e=new Uint8Array,t)=>e instanceof Uint8Array?Promise.resolve(e):t.streamCollector(e)||Promise.resolve(new Uint8Array),Ao={relation:"after",toMiddleware:"deserializerMiddleware",tags:["THROW_200_EXCEPTIONS","S3"],name:"throw200ExceptionsMiddleware",override:!0},To=e=>({applyToStack:t=>{t.addRelativeTo(Eo(e),Ao)}});const Co={name:"bucketEndpointMiddleware",override:!0,relation:"after",toMiddleware:"endpointV2Middleware"};const Ro={step:"initialize",tags:["VALIDATE_BUCKET_NAME"],name:"validateBucketNameMiddleware",override:!0},Oo=e=>({applyToStack:t=>{t.add(function({bucketEndpoint:e}){return t=>async r=>{const{input:{Bucket:n}}=r;if(!e&&"string"==typeof n&&!("string"==typeof(i=n)&&0===i.indexOf("arn:")&&i.split(":").length>=6)&&n.indexOf("/")>=0){const e=new Error(`Bucket name shouldn't contain '/', received '${n}'`);throw e.name="InvalidBucketName",e}var i;return t({...r})}}(e),Ro),t.addRelativeTo(function(e){return(t,r)=>async n=>{if(e.bucketEndpoint){const e=r.endpointV2;if(e){const t=n.input.Bucket;if("string"==typeof t)try{const n=new URL(t);r.endpointV2={...e,url:n}}catch(e){const n=`@aws-sdk/middleware-sdk-s3: bucketEndpoint=true was set but Bucket=${t} could not be parsed as URL.`;throw"NoOpLogger"===r.logger?.constructor?.name?console.warn(n):r.logger?.warn?.(n),e}}}return t(n)}}(e),Co)}});const Po=new RegExp("^(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}$"),_o=e=>Po.test(e)||e.startsWith("[")&&e.endsWith("]"),Io=new RegExp("^(?!.*-$)(?!-)[a-zA-Z0-9-]{1,63}$"),Mo=(e,t=!1)=>{if(!t)return Io.test(e);const r=e.split(".");for(const e of r)if(!Mo(e))return!1;return!0},No={},Fo="endpoints";function $o(e){return"object"!=typeof e||null==e?e:"ref"in e?`$${$o(e.ref)}`:"fn"in e?`${e.fn}(${(e.argv||[]).map($o).join(", ")})`:JSON.stringify(e,null,2)}class Uo extends Error{constructor(e){super(e),this.name="EndpointError"}}const Lo=(e,t)=>(e=>{const t=e.split("."),r=[];for(const n of t){const t=n.indexOf("[");if(-1!==t){if(n.indexOf("]")!==n.length-1)throw new Uo(`Path: '${e}' does not end with ']'`);const i=n.slice(t+1,-1);if(Number.isNaN(parseInt(i)))throw new Uo(`Invalid array index: '${i}' in path: '${e}'`);0!==t&&r.push(n.slice(0,t)),r.push(i)}else r.push(n)}return r})(t).reduce(((r,n)=>{if("object"!=typeof r)throw new Uo(`Index '${n}' in '${t}' not found in '${JSON.stringify(e)}'`);return Array.isArray(r)?r[parseInt(n)]:r[n]}),e),Bo={[U.HTTP]:80,[U.HTTPS]:443},Do={booleanEquals:(e,t)=>e===t,getAttr:Lo,isSet:e=>null!=e,isValidHostLabel:Mo,not:e=>!e,parseURL:e=>{const t=(()=>{try{if(e instanceof URL)return e;if("object"==typeof e&&"hostname"in e){const{hostname:t,port:r,protocol:n="",path:i="",query:o={}}=e,s=new URL(`${n}//${t}${r?`:${r}`:""}${i}`);return s.search=Object.entries(o).map((([e,t])=>`${e}=${t}`)).join("&"),s}return new URL(e)}catch(e){return null}})();if(!t)return console.error(`Unable to parse ${JSON.stringify(e)} as a whatwg URL.`),null;const r=t.href,{host:n,hostname:i,pathname:o,protocol:s,search:a}=t;if(a)return null;const c=s.slice(0,-1);if(!Object.values(U).includes(c))return null;const u=_o(i);return{scheme:c,authority:`${n}${r.includes(`${n}:${Bo[c]}`)||"string"==typeof e&&e.includes(`${n}:${Bo[c]}`)?`:${Bo[c]}`:""}`,path:o,normalizedPath:o.endsWith("/")?o:`${o}/`,isIp:u}},stringEquals:(e,t)=>e===t,substring:(e,t,r,n)=>t>=r||e.length<r?null:n?e.substring(e.length-r,e.length-t):e.substring(t,r),uriEncode:e=>encodeURIComponent(e).replace(/[!*'()]/g,(e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`))},jo=(e,t)=>{const r=[],n={...t.endpointParams,...t.referenceRecord};let i=0;for(;i<e.length;){const t=e.indexOf("{",i);if(-1===t){r.push(e.slice(i));break}r.push(e.slice(i,t));const o=e.indexOf("}",t);if(-1===o){r.push(e.slice(t));break}"{"===e[t+1]&&"}"===e[o+1]&&(r.push(e.slice(t+1,o)),i=o+2);const s=e.substring(t+1,o);if(s.includes("#")){const[e,t]=s.split("#");r.push(Lo(n[e],t))}else r.push(n[s]);i=o+1}return r.join("")},zo=(e,t,r)=>{if("string"==typeof e)return jo(e,r);if(e.fn)return qo(e,r);if(e.ref)return(({ref:e},t)=>({...t.endpointParams,...t.referenceRecord}[e]))(e,r);throw new Uo(`'${t}': ${String(e)} is not a string, function or reference.`)},qo=({fn:e,argv:t},r)=>{const n=t.map((e=>["boolean","number"].includes(typeof e)?e:zo(e,"arg",r))),i=e.split(".");return i[0]in No&&null!=i[1]?No[i[0]][i[1]](...n):Do[e](...n)},Ho=({assign:e,...t},r)=>{if(e&&e in r.referenceRecord)throw new Uo(`'${e}' is already defined in Reference Record.`);const n=qo(t,r);return r.logger?.debug?.(`${Fo} evaluateCondition: ${$o(t)} = ${$o(n)}`),{result:""===n||!!n,...null!=e&&{toAssign:{name:e,value:n}}}},Wo=(e=[],t)=>{const r={};for(const n of e){const{result:e,toAssign:i}=Ho(n,{...t,referenceRecord:{...t.referenceRecord,...r}});if(!e)return{result:e};i&&(r[i.name]=i.value,t.logger?.debug?.(`${Fo} assign: ${i.name} := ${$o(i.value)}`))}return{result:!0,referenceRecord:r}},Ko=(e,t)=>Object.entries(e).reduce(((e,[r,n])=>({...e,[r]:n.map((e=>{const n=zo(e,"Header value entry",t);if("string"!=typeof n)throw new Uo(`Header '${r}' value '${n}' is not a string`);return n}))})),{}),Vo=(e,t)=>{if(Array.isArray(e))return e.map((e=>Vo(e,t)));switch(typeof e){case"string":return jo(e,t);case"object":if(null===e)throw new Uo(`Unexpected endpoint property: ${e}`);return Qo(e,t);case"boolean":return e;default:throw new Uo("Unexpected endpoint property type: "+typeof e)}},Qo=(e,t)=>Object.entries(e).reduce(((e,[r,n])=>({...e,[r]:Vo(n,t)})),{}),Go=(e,t)=>{const r=zo(e,"Endpoint URL",t);if("string"==typeof r)try{return new URL(r)}catch(e){throw console.error(`Failed to construct URL with ${r}`,e),e}throw new Uo("Endpoint URL must be a string, got "+typeof r)},Jo=(e,t)=>{const{conditions:r,endpoint:n}=e,{result:i,referenceRecord:o}=Wo(r,t);if(!i)return;const s={...t,referenceRecord:{...t.referenceRecord,...o}},{url:a,properties:c,headers:u}=n;return t.logger?.debug?.(`${Fo} Resolving endpoint from template: ${$o(n)}`),{...null!=u&&{headers:Ko(u,s)},...null!=c&&{properties:Qo(c,s)},url:Go(a,s)}},Xo=(e,t)=>{const{conditions:r,error:n}=e,{result:i,referenceRecord:o}=Wo(r,t);if(i)throw new Uo(zo(n,"Error",{...t,referenceRecord:{...t.referenceRecord,...o}}))},Zo=(e,t)=>{const{conditions:r,rules:n}=e,{result:i,referenceRecord:o}=Wo(r,t);if(i)return Yo(n,{...t,referenceRecord:{...t.referenceRecord,...o}})},Yo=(e,t)=>{for(const r of e)if("endpoint"===r.type){const e=Jo(r,t);if(e)return e}else if("error"===r.type)Xo(r,t);else{if("tree"!==r.type)throw new Uo(`Unknown endpoint rule: ${r}`);{const e=Zo(r,t);if(e)return e}}throw new Uo("Rules evaluation failed")},es=(e,t=!1)=>{if(t){for(const t of e.split("."))if(!es(t))return!1;return!0}return!!Mo(e)&&(!(e.length<3||e.length>63)&&(e===e.toLowerCase()&&!_o(e)))};let ts={partitions:[{id:"aws",outputs:{dnsSuffix:"amazonaws.com",dualStackDnsSuffix:"api.aws",implicitGlobalRegion:"us-east-1",name:"aws",supportsDualStack:!0,supportsFIPS:!0},regionRegex:"^(us|eu|ap|sa|ca|me|af|il|mx)\\-\\w+\\-\\d+$",regions:{"af-south-1":{description:"Africa (Cape Town)"},"ap-east-1":{description:"Asia Pacific (Hong Kong)"},"ap-northeast-1":{description:"Asia Pacific (Tokyo)"},"ap-northeast-2":{description:"Asia Pacific (Seoul)"},"ap-northeast-3":{description:"Asia Pacific (Osaka)"},"ap-south-1":{description:"Asia Pacific (Mumbai)"},"ap-south-2":{description:"Asia Pacific (Hyderabad)"},"ap-southeast-1":{description:"Asia Pacific (Singapore)"},"ap-southeast-2":{description:"Asia Pacific (Sydney)"},"ap-southeast-3":{description:"Asia Pacific (Jakarta)"},"ap-southeast-4":{description:"Asia Pacific (Melbourne)"},"ap-southeast-5":{description:"Asia Pacific (Malaysia)"},"aws-global":{description:"AWS Standard global region"},"ca-central-1":{description:"Canada (Central)"},"ca-west-1":{description:"Canada West (Calgary)"},"eu-central-1":{description:"Europe (Frankfurt)"},"eu-central-2":{description:"Europe (Zurich)"},"eu-north-1":{description:"Europe (Stockholm)"},"eu-south-1":{description:"Europe (Milan)"},"eu-south-2":{description:"Europe (Spain)"},"eu-west-1":{description:"Europe (Ireland)"},"eu-west-2":{description:"Europe (London)"},"eu-west-3":{description:"Europe (Paris)"},"il-central-1":{description:"Israel (Tel Aviv)"},"me-central-1":{description:"Middle East (UAE)"},"me-south-1":{description:"Middle East (Bahrain)"},"sa-east-1":{description:"South America (Sao Paulo)"},"us-east-1":{description:"US East (N. Virginia)"},"us-east-2":{description:"US East (Ohio)"},"us-west-1":{description:"US West (N. California)"},"us-west-2":{description:"US West (Oregon)"}}},{id:"aws-cn",outputs:{dnsSuffix:"amazonaws.com.cn",dualStackDnsSuffix:"api.amazonwebservices.com.cn",implicitGlobalRegion:"cn-northwest-1",name:"aws-cn",supportsDualStack:!0,supportsFIPS:!0},regionRegex:"^cn\\-\\w+\\-\\d+$",regions:{"aws-cn-global":{description:"AWS China global region"},"cn-north-1":{description:"China (Beijing)"},"cn-northwest-1":{description:"China (Ningxia)"}}},{id:"aws-us-gov",outputs:{dnsSuffix:"amazonaws.com",dualStackDnsSuffix:"api.aws",implicitGlobalRegion:"us-gov-west-1",name:"aws-us-gov",supportsDualStack:!0,supportsFIPS:!0},regionRegex:"^us\\-gov\\-\\w+\\-\\d+$",regions:{"aws-us-gov-global":{description:"AWS GovCloud (US) global region"},"us-gov-east-1":{description:"AWS GovCloud (US-East)"},"us-gov-west-1":{description:"AWS GovCloud (US-West)"}}},{id:"aws-iso",outputs:{dnsSuffix:"c2s.ic.gov",dualStackDnsSuffix:"c2s.ic.gov",implicitGlobalRegion:"us-iso-east-1",name:"aws-iso",supportsDualStack:!1,supportsFIPS:!0},regionRegex:"^us\\-iso\\-\\w+\\-\\d+$",regions:{"aws-iso-global":{description:"AWS ISO (US) global region"},"us-iso-east-1":{description:"US ISO East"},"us-iso-west-1":{description:"US ISO WEST"}}},{id:"aws-iso-b",outputs:{dnsSuffix:"sc2s.sgov.gov",dualStackDnsSuffix:"sc2s.sgov.gov",implicitGlobalRegion:"us-isob-east-1",name:"aws-iso-b",supportsDualStack:!1,supportsFIPS:!0},regionRegex:"^us\\-isob\\-\\w+\\-\\d+$",regions:{"aws-iso-b-global":{description:"AWS ISOB (US) global region"},"us-isob-east-1":{description:"US ISOB East (Ohio)"}}},{id:"aws-iso-e",outputs:{dnsSuffix:"cloud.adc-e.uk",dualStackDnsSuffix:"cloud.adc-e.uk",implicitGlobalRegion:"eu-isoe-west-1",name:"aws-iso-e",supportsDualStack:!1,supportsFIPS:!0},regionRegex:"^eu\\-isoe\\-\\w+\\-\\d+$",regions:{"eu-isoe-west-1":{description:"EU ISOE West"}}},{id:"aws-iso-f",outputs:{dnsSuffix:"csp.hci.ic.gov",dualStackDnsSuffix:"csp.hci.ic.gov",implicitGlobalRegion:"us-isof-south-1",name:"aws-iso-f",supportsDualStack:!1,supportsFIPS:!0},regionRegex:"^us\\-isof\\-\\w+\\-\\d+$",regions:{}}],version:"1.1"};const rs={isVirtualHostableS3Bucket:es,parseArn:e=>{const t=e.split(":");if(t.length<6)return null;const[r,n,i,o,s,...a]=t;if("arn"!==r||""===n||""===i||""===a.join(":"))return null;return{partition:n,service:i,region:o,accountId:s,resourceId:a.map((e=>e.split("/"))).flat()}},partition:e=>{const{partitions:t}=ts;for(const r of t){const{regions:t,outputs:n}=r;for(const[r,i]of Object.entries(t))if(r===e)return{...n,...i}}for(const r of t){const{regionRegex:t,outputs:n}=r;if(new RegExp(t).test(e))return{...n}}const r=t.find((e=>"aws"===e.id));if(!r)throw new Error("Provided region was not found in the partition array or regex, and default partition with id 'aws' doesn't exist.");return{...r.outputs}}};No.aws=rs;const ns=/\d{12}\.ddb/;const is="user-agent",os="x-amz-user-agent",ss=/[^\!\$\%\&\'\*\+\-\.\^\_\`\|\~\d\w]/g,as=/[^\!\$\%\&\'\*\+\-\.\^\_\`\|\~\d\w\#]/g;const cs=e=>(t,r)=>async n=>{const{request:i}=n;if(!q.isInstance(i))return t(n);const{headers:o}=i,s=r?.userAgent?.map(us)||[],a=(await e.defaultUserAgentProvider()).map(us);await async function(e,t,r){const n=r.request;if("rpc-v2-cbor"===n?.headers?.["smithy-protocol"]&&te(e,"PROTOCOL_RPC_V2_CBOR","M"),"function"==typeof t.retryStrategy){const r=await t.retryStrategy();"function"==typeof r.acquireInitialRetryToken?r.constructor?.name?.includes("Adaptive")?te(e,"RETRY_MODE_ADAPTIVE","F"):te(e,"RETRY_MODE_STANDARD","E"):te(e,"RETRY_MODE_LEGACY","D")}if("function"==typeof t.accountIdEndpointMode){const r=e.endpointV2;switch(String(r?.url?.hostname).match(ns)&&te(e,"ACCOUNT_ID_ENDPOINT","O"),await(t.accountIdEndpointMode?.())){case"disabled":te(e,"ACCOUNT_ID_MODE_DISABLED","Q");break;case"preferred":te(e,"ACCOUNT_ID_MODE_PREFERRED","P");break;case"required":te(e,"ACCOUNT_ID_MODE_REQUIRED","R")}}const i=e.__smithy_context?.selectedHttpAuthScheme?.identity;if(i?.$source){const t=i;t.accountId&&te(e,"RESOLVED_ACCOUNT_ID","T");for(const[r,n]of Object.entries(t.$source??{}))te(e,r,n)}}(r,e,n);const c=r;a.push(`m/${function(e){let t="";for(const r in e){const n=e[r];if(!(t.length+n.length+1<=1024))break;t.length?t+=","+n:t+=n}return t}(Object.assign({},r.__smithy_context?.features,c.__aws_sdk_context?.features))}`);const u=e?.customUserAgent?.map(us)||[],d=await e.userAgentAppId();d&&a.push(us([`app/${d}`]));const l=[].concat([...a,...s,...u]).join(" "),h=[...a.filter((e=>e.startsWith("aws-sdk-"))),...u].join(" ");return"browser"!==e.runtime?(h&&(o[os]=o[os]?`${o[is]} ${h}`:h),o[is]=l):o[os]=l,t({...n,request:i})},us=e=>{const t=e[0].split("/").map((e=>e.replace(ss,"-"))).join("/"),r=e[1]?.replace(as,"-"),n=t.indexOf("/"),i=t.substring(0,n);let o=t.substring(n+1);return"api"===i&&(o=o.toLowerCase()),[i,o,r].filter((e=>e&&e.length>0)).reduce(((e,t,r)=>{switch(r){case 0:return t;case 1:return`${e}/${t}`;default:return`${e}#${t}`}}),"")},ds={name:"getUserAgentMiddleware",step:"build",priority:"low",tags:["SET_USER_AGENT","USER_AGENT"],override:!0},ls=e=>"string"==typeof e&&(e.startsWith("fips-")||e.endsWith("-fips")),hs=e=>ls(e)?["fips-aws-global","aws-fips"].includes(e)?"us-east-1":e.replace(/fips-(dkr-|prod-)?|-fips/,""):e,fs="content-length";const ps={step:"build",tags:["SET_CONTENT_LENGTH","CONTENT_LENGTH"],name:"contentLengthMiddleware",override:!0},gs=e=>({applyToStack:t=>{var r;t.add((r=e.bodyLengthChecker,e=>async t=>{const n=t.request;if(q.isInstance(n)){const{body:e,headers:t}=n;if(e&&-1===Object.keys(t).map((e=>e.toLowerCase())).indexOf(fs))try{const t=r(e);n.headers={...n.headers,[fs]:String(t)}}catch(e){}}return e({...t,request:n})}),ps)}}),ms=/^[a-z0-9][a-z0-9\.\-]{1,61}[a-z0-9]$/,ys=/(\d+\.){3}\d+/,vs=/\.\./,bs=e=>ms.test(e)&&!ys.test(e)&&!vs.test(e),ws=e=>{const[t,r,n,,,i]=e.split(":"),o="arn"===t&&e.split(":").length>=6,s=Boolean(o&&r&&n&&i);if(o&&!s)throw new Error(`Invalid ARN: ${e} was an invalid ARN.`);return s},ks=(e,t,r)=>{const n=async()=>{const n=r[e]??r[t];return"function"==typeof n?n():n};return"credentialScope"===e||"CredentialScope"===t?async()=>{const e="function"==typeof r.credentials?await r.credentials():r.credentials;return e?.credentialScope??e?.CredentialScope}:"accountId"===e||"AccountId"===t?async()=>{const e="function"==typeof r.credentials?await r.credentials():r.credentials;return e?.accountId??e?.AccountId}:"endpoint"===e||"endpoint"===t?async()=>{const e=await n();if(e&&"object"==typeof e){if("url"in e)return e.url.href;if("hostname"in e){const{protocol:t,hostname:r,port:n,path:i}=e;return`${t}//${r}${n?":"+n:""}${i}`}}return e}:n},Ss=async e=>{};const Es=e=>{if("string"==typeof e)return Es(new URL(e));const{hostname:t,pathname:r,port:n,protocol:i,search:o}=e;let s;return o&&(s=function(e){const t={};if(e=e.replace(/^\?/,""))for(const r of e.split("&")){let[e,n=null]=r.split("=");e=decodeURIComponent(e),n&&(n=decodeURIComponent(n)),e in t?Array.isArray(t[e])?t[e].push(n):t[e]=[t[e],n]:t[e]=n}return t}(o)),{hostname:t,port:n?parseInt(n):void 0,protocol:i,path:r,query:s}},xs=e=>"object"==typeof e?"url"in e?Es(e.url):e:Es(e),As=async(e,t,r)=>{const n={},i=t?.getEndpointParameterInstructions?.()||{};for(const[t,o]of Object.entries(i))switch(o.type){case"staticContextParams":n[t]=o.value;break;case"contextParams":n[t]=e[o.name];break;case"clientContextParams":case"builtInParams":n[t]=await ks(o.name,t,r)();break;default:throw new Error("Unrecognized endpoint parameter instruction: "+JSON.stringify(o))}return 0===Object.keys(i).length&&Object.assign(n,r),"s3"===String(r.serviceId).toLowerCase()&&await(async e=>{const t=e?.Bucket||"";if("string"==typeof e.Bucket&&(e.Bucket=t.replace(/#/g,encodeURIComponent("#")).replace(/\?/g,encodeURIComponent("?"))),ws(t)){if(!0===e.ForcePathStyle)throw new Error("Path-style addressing cannot be used with ARN buckets")}else(!bs(t)||-1!==t.indexOf(".")&&!String(e.Endpoint).startsWith("http:")||t.toLowerCase()!==t||t.length<3)&&(e.ForcePathStyle=!0);return e.DisableMultiRegionAccessPoints&&(e.disableMultiRegionAccessPoints=!0,e.DisableMRAP=!0),e})(n),n},Ts=({config:e,instructions:t})=>(r,n)=>async i=>{e.endpoint&&function(e,t,r){e.__smithy_context?e.__smithy_context.features||(e.__smithy_context.features={}):e.__smithy_context={features:{}},e.__smithy_context.features[t]=r}(n,"ENDPOINT_OVERRIDE","N");const o=await(async(e,t,r,n)=>{if(!r.endpoint){let e;e=r.serviceConfiguredEndpoint?await r.serviceConfiguredEndpoint():await Ss(r.serviceId),e&&(r.endpoint=()=>Promise.resolve(xs(e)))}const i=await As(e,t,r);if("function"!=typeof r.endpointProvider)throw new Error("config.endpointProvider is not set.");return r.endpointProvider(i,n)})(i.input,{getEndpointParameterInstructions:()=>t},{...e},n);n.endpointV2=o,n.authSchemes=o.properties?.authSchemes;const s=n.authSchemes?.[0];if(s){n.signing_region=s.signingRegion,n.signing_service=s.signingName;const e=ue(n),t=e?.selectedHttpAuthScheme?.httpAuthOption;t&&(t.signingProperties=Object.assign(t.signingProperties||{},{signing_region:s.signingRegion,signingRegion:s.signingRegion,signing_service:s.signingName,signingName:s.signingName,signingRegionSet:s.signingRegionSet},s.properties))}return r({...i})},Cs={step:"serialize",tags:["ENDPOINT_PARAMETERS","ENDPOINT_V2","ENDPOINT"],name:"endpointV2Middleware",override:!0,relation:"before",toMiddleware:pe.name},Rs=(e,t)=>({applyToStack:r=>{r.addRelativeTo(Ts({config:e,instructions:t}),Cs)}});var Os;!function(e){e.STANDARD="standard",e.ADAPTIVE="adaptive"}(Os||(Os={}));const Ps=Os.STANDARD,_s=["BandwidthLimitExceeded","EC2ThrottledException","LimitExceededException","PriorRequestNotComplete","ProvisionedThroughputExceededException","RequestLimitExceeded","RequestThrottled","RequestThrottledException","SlowDown","ThrottledException","Throttling","ThrottlingException","TooManyRequestsException","TransactionInProgressException"],Is=["TimeoutError","RequestTimeout","RequestTimeoutException"],Ms=[500,502,503,504],Ns=["ECONNRESET","ECONNREFUSED","EPIPE","ETIMEDOUT"],Fs=e=>429===e.$metadata?.httpStatusCode||_s.includes(e.name)||1==e.$retryable?.throttling,$s=e=>(e=>e.$metadata?.clockSkewCorrected)(e)||Is.includes(e.name)||Ns.includes(e?.code||"")||Ms.includes(e.$metadata?.httpStatusCode||0);class Us{constructor(e){this.currentCapacity=0,this.enabled=!1,this.lastMaxRate=0,this.measuredTxRate=0,this.requestCount=0,this.lastTimestamp=0,this.timeWindow=0,this.beta=e?.beta??.7,this.minCapacity=e?.minCapacity??1,this.minFillRate=e?.minFillRate??.5,this.scaleConstant=e?.scaleConstant??.4,this.smooth=e?.smooth??.8;const t=this.getCurrentTimeInSeconds();this.lastThrottleTime=t,this.lastTxRateBucket=Math.floor(this.getCurrentTimeInSeconds()),this.fillRate=this.minFillRate,this.maxCapacity=this.minCapacity}getCurrentTimeInSeconds(){return Date.now()/1e3}async getSendToken(){return this.acquireTokenBucket(1)}async acquireTokenBucket(e){if(this.enabled){if(this.refillTokenBucket(),e>this.currentCapacity){const t=(e-this.currentCapacity)/this.fillRate*1e3;await new Promise((e=>Us.setTimeoutFn(e,t)))}this.currentCapacity=this.currentCapacity-e}}refillTokenBucket(){const e=this.getCurrentTimeInSeconds();if(!this.lastTimestamp)return void(this.lastTimestamp=e);const t=(e-this.lastTimestamp)*this.fillRate;this.currentCapacity=Math.min(this.maxCapacity,this.currentCapacity+t),this.lastTimestamp=e}updateClientSendingRate(e){let t;if(this.updateMeasuredRate(),Fs(e)){const e=this.enabled?Math.min(this.measuredTxRate,this.fillRate):this.measuredTxRate;this.lastMaxRate=e,this.calculateTimeWindow(),this.lastThrottleTime=this.getCurrentTimeInSeconds(),t=this.cubicThrottle(e),this.enableTokenBucket()}else this.calculateTimeWindow(),t=this.cubicSuccess(this.getCurrentTimeInSeconds());const r=Math.min(t,2*this.measuredTxRate);this.updateTokenBucketRate(r)}calculateTimeWindow(){this.timeWindow=this.getPrecise(Math.pow(this.lastMaxRate*(1-this.beta)/this.scaleConstant,1/3))}cubicThrottle(e){return this.getPrecise(e*this.beta)}cubicSuccess(e){return this.getPrecise(this.scaleConstant*Math.pow(e-this.lastThrottleTime-this.timeWindow,3)+this.lastMaxRate)}enableTokenBucket(){this.enabled=!0}updateTokenBucketRate(e){this.refillTokenBucket(),this.fillRate=Math.max(e,this.minFillRate),this.maxCapacity=Math.max(e,this.minCapacity),this.currentCapacity=Math.min(this.currentCapacity,this.maxCapacity)}updateMeasuredRate(){const e=this.getCurrentTimeInSeconds(),t=Math.floor(2*e)/2;if(this.requestCount++,t>this.lastTxRateBucket){const e=this.requestCount/(t-this.lastTxRateBucket);this.measuredTxRate=this.getPrecise(e*this.smooth+this.measuredTxRate*(1-this.smooth)),this.requestCount=0,this.lastTxRateBucket=t}}getPrecise(e){return parseFloat(e.toFixed(8))}}Us.setTimeoutFn=setTimeout;const Ls=({retryDelay:e,retryCount:t,retryCost:r})=>({getRetryCount:()=>t,getRetryDelay:()=>Math.min(2e4,e),getRetryCost:()=>r});class Bs{constructor(e){this.maxAttempts=e,this.mode=Os.STANDARD,this.capacity=500,this.retryBackoffStrategy=(()=>{let e=100;return{computeNextBackoffDelay:t=>Math.floor(Math.min(2e4,Math.random()*2**t*e)),setDelayBase:t=>{e=t}}})(),this.maxAttemptsProvider="function"==typeof e?e:async()=>e}async acquireInitialRetryToken(e){return Ls({retryDelay:100,retryCount:0})}async refreshRetryTokenForRetry(e,t){const r=await this.getMaxAttempts();if(this.shouldRetry(e,t,r)){const r=t.errorType;this.retryBackoffStrategy.setDelayBase("THROTTLING"===r?500:100);const n=this.retryBackoffStrategy.computeNextBackoffDelay(e.getRetryCount()),i=t.retryAfterHint?Math.max(t.retryAfterHint.getTime()-Date.now()||0,n):n,o=this.getCapacityCost(r);return this.capacity-=o,Ls({retryDelay:i,retryCount:e.getRetryCount()+1,retryCost:o})}throw new Error("No retry token available")}recordSuccess(e){this.capacity=Math.max(500,this.capacity+(e.getRetryCost()??1))}getCapacity(){return this.capacity}async getMaxAttempts(){try{return await this.maxAttemptsProvider()}catch(e){return console.warn("Max attempts provider could not resolve. Using default of 3"),3}}shouldRetry(e,t,r){return e.getRetryCount()+1<r&&this.capacity>=this.getCapacityCost(t.errorType)&&this.isRetryableError(t.errorType)}getCapacityCost(e){return"TRANSIENT"===e?10:5}isRetryableError(e){return"THROTTLING"===e||"TRANSIENT"===e}}class Ds{constructor(e,t){this.maxAttemptsProvider=e,this.mode=Os.ADAPTIVE;const{rateLimiter:r}=t??{};this.rateLimiter=r??new Us,this.standardRetryStrategy=new Bs(e)}async acquireInitialRetryToken(e){return await this.rateLimiter.getSendToken(),this.standardRetryStrategy.acquireInitialRetryToken(e)}async refreshRetryTokenForRetry(e,t){return this.rateLimiter.updateClientSendingRate(t),this.standardRetryStrategy.refreshRetryTokenForRetry(e,t)}recordSuccess(e){this.rateLimiter.updateClientSendingRate({}),this.standardRetryStrategy.recordSuccess(e)}}let js;const zs=new Uint8Array(16);function qs(){if(!js&&(js="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!js))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return js(zs)}const Hs=[];for(let e=0;e<256;++e)Hs.push((e+256).toString(16).slice(1));var Ws={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function Ks(e,t,r){if(Ws.randomUUID&&!t&&!e)return Ws.randomUUID();const n=(e=e||{}).random||(e.rng||qs)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,t){r=r||0;for(let e=0;e<16;++e)t[r+e]=n[e];return t}return function(e,t=0){return Hs[e[t+0]]+Hs[e[t+1]]+Hs[e[t+2]]+Hs[e[t+3]]+"-"+Hs[e[t+4]]+Hs[e[t+5]]+"-"+Hs[e[t+6]]+Hs[e[t+7]]+"-"+Hs[e[t+8]]+Hs[e[t+9]]+"-"+Hs[e[t+10]]+Hs[e[t+11]]+Hs[e[t+12]]+Hs[e[t+13]]+Hs[e[t+14]]+Hs[e[t+15]]}(n)}const Vs=e=>e?.body instanceof ReadableStream,Qs=e=>void 0!==e.acquireInitialRetryToken&&void 0!==e.refreshRetryTokenForRetry&&void 0!==e.recordSuccess,Gs=e=>{const t={error:e,errorType:Js(e)},r=Ys(e.$response);return r&&(t.retryAfterHint=r),t},Js=e=>Fs(e)?"THROTTLING":$s(e)?"TRANSIENT":(e=>{if(void 0!==e.$metadata?.httpStatusCode){const t=e.$metadata.httpStatusCode;return 500<=t&&t<=599&&!$s(e)}return!1})(e)?"SERVER_ERROR":"CLIENT_ERROR",Xs={name:"retryMiddleware",tags:["RETRY"],step:"finalizeRequest",priority:"high",override:!0},Zs=e=>({applyToStack:t=>{t.add((e=>(t,r)=>async n=>{let i=await e.retryStrategy();const o=await e.maxAttempts();if(!Qs(i))return i?.mode&&(r.userAgent=[...r.userAgent||[],["cfg/retry-mode",i.mode]]),i.retry(t,n);{let e=await i.acquireInitialRetryToken(r.partition_id),a=new Error,c=0,u=0;const{request:d}=n,l=q.isInstance(d);for(l&&(d.headers["amz-sdk-invocation-id"]=Ks());;)try{l&&(d.headers["amz-sdk-request"]=`attempt=${c+1}; max=${o}`);const{response:r,output:s}=await t(n);return i.recordSuccess(e),s.$metadata.attempts=c+1,s.$metadata.totalRetryDelay=u,{response:r,output:s}}catch(t){const n=Gs(t);if(a=(s=t)instanceof Error?s:s instanceof Object?Object.assign(new Error,s):"string"==typeof s?new Error(s):new Error(`AWS SDK error wrapper for ${s}`),l&&Vs(d))throw(r.logger instanceof qr?console:r.logger)?.warn("An error was encountered in a non-retryable streaming request."),a;try{e=await i.refreshRetryTokenForRetry(e,n)}catch(e){throw a.$metadata||(a.$metadata={}),a.$metadata.attempts=c+1,a.$metadata.totalRetryDelay=u,a}c=e.getRetryCount();const o=e.getRetryDelay();u+=o,await new Promise((e=>setTimeout(e,o)))}}var s})(e),Xs)}}),Ys=e=>{if(!H.isInstance(e))return;const t=Object.keys(e.headers).find((e=>"retry-after"===e.toLowerCase()));if(!t)return;const r=e.headers[t],n=Number(r);if(!Number.isNaN(n))return new Date(1e3*n);return new Date(r)},ea=null;class ta{constructor(e){this.sigv4Signer=new po(e),this.signerOptions=e}async sign(e,t={}){if("*"===t.signingRegion){if("node"!==this.signerOptions.runtime)throw new Error("This request requires signing with SigV4Asymmetric algorithm. It's only available in Node.js");return this.getSigv4aSigner().sign(e,t)}return this.sigv4Signer.sign(e,t)}async signWithCredentials(e,t,r={}){if("*"===r.signingRegion){if("node"!==this.signerOptions.runtime)throw new Error("This request requires signing with SigV4Asymmetric algorithm. It's only available in Node.js");return this.getSigv4aSigner().signWithCredentials(e,t,r)}return this.sigv4Signer.signWithCredentials(e,t,r)}async presign(e,t={}){if("*"===t.signingRegion){if("node"!==this.signerOptions.runtime)throw new Error("This request requires signing with SigV4Asymmetric algorithm. It's only available in Node.js");return this.getSigv4aSigner().presign(e,t)}return this.sigv4Signer.presign(e,t)}async presignWithCredentials(e,t,r={}){if("*"===r.signingRegion)throw new Error("Method presignWithCredentials is not supported for [signingRegion=*].");return this.sigv4Signer.presignWithCredentials(e,t,r)}getSigv4aSigner(){if(!this.sigv4aSigner){let e=null;try{if(e=ea,"function"!=typeof e)throw new Error}catch(e){throw e.message=`${e.message}\nPlease check whether you have installed the "@aws-sdk/signature-v4-crt" package explicitly. \nYou must also register the package by calling [require("@aws-sdk/signature-v4-crt");] or an ESM equivalent such as [import "@aws-sdk/signature-v4-crt";]. \nFor more information please go to https://github.com/aws/aws-sdk-js-v3#functionality-requiring-aws-common-runtime-crt`,e}this.sigv4aSigner=new e({...this.signerOptions,signingAlgorithm:1})}return this.sigv4aSigner}}const ra="required",na="type",ia="conditions",oa="fn",sa="argv",aa="ref",ca="assign",ua="url",da="properties",la="backend",ha="authSchemes",fa="disableDoubleEncoding",pa="signingName",ga="signingRegion",ma="headers",ya="signingRegionSet",va=!0,ba="isSet",wa="booleanEquals",ka="error",Sa="aws.partition",Ea="stringEquals",xa="getAttr",Aa="name",Ta="substring",Ca="bucketSuffix",Ra="parseURL",Oa="{url#scheme}://{url#authority}/{uri_encoded_bucket}{url#path}",Pa="endpoint",_a="tree",Ia="aws.isVirtualHostableS3Bucket",Ma="{url#scheme}://{Bucket}.{url#authority}{url#path}",Na="not",Fa="{url#scheme}://{url#authority}{url#path}",$a="hardwareType",Ua="regionPrefix",La="bucketAliasSuffix",Ba="outpostId",Da="isValidHostLabel",ja="sigv4a",za="s3-outposts",qa="s3",Ha="{url#scheme}://{url#authority}{url#normalizedPath}{Bucket}",Wa="https://{Bucket}.s3-accelerate.{partitionResult#dnsSuffix}",Ka="https://{Bucket}.s3.{partitionResult#dnsSuffix}",Va="aws.parseArn",Qa="bucketArn",Ga="arnType",Ja="s3-object-lambda",Xa="accesspoint",Za="accessPointName",Ya="{url#scheme}://{accessPointName}-{bucketArn#accountId}.{url#authority}{url#path}",ec="mrapPartition",tc="outpostType",rc="arnPrefix",nc="{url#scheme}://{url#authority}{url#normalizedPath}{uri_encoded_bucket}",ic="https://s3.{partitionResult#dnsSuffix}/{uri_encoded_bucket}",oc="https://s3.{partitionResult#dnsSuffix}",sc={[ra]:!1,[na]:"String"},ac={[ra]:!0,default:!1,[na]:"Boolean"},cc={[ra]:!1,[na]:"Boolean"},uc={[oa]:wa,[sa]:[{[aa]:"Accelerate"},!0]},dc={[oa]:wa,[sa]:[{[aa]:"UseFIPS"},!0]},lc={[oa]:wa,[sa]:[{[aa]:"UseDualStack"},!0]},hc={[oa]:ba,[sa]:[{[aa]:"Endpoint"}]},fc={[oa]:Sa,[sa]:[{[aa]:"Region"}],[ca]:"partitionResult"},pc={[oa]:Ea,[sa]:[{[oa]:xa,[sa]:[{[aa]:"partitionResult"},Aa]},"aws-cn"]},gc={[oa]:ba,[sa]:[{[aa]:"Bucket"}]},mc={[aa]:"Bucket"},yc={[oa]:Ra,[sa]:[{[aa]:"Endpoint"}],[ca]:"url"},vc={[oa]:wa,[sa]:[{[oa]:xa,[sa]:[{[aa]:"url"},"isIp"]},!0]},bc={[aa]:"url"},wc={[oa]:"uriEncode",[sa]:[mc],[ca]:"uri_encoded_bucket"},kc={[la]:"S3Express",[ha]:[{[fa]:!0,[Aa]:"sigv4",[pa]:"s3express",[ga]:"{Region}"}]},Sc={},Ec={[oa]:Ia,[sa]:[mc,!1]},xc={[ka]:"S3Express bucket name is not a valid virtual hostable name.",[na]:ka},Ac={[la]:"S3Express",[ha]:[{[fa]:!0,[Aa]:"sigv4-s3express",[pa]:"s3express",[ga]:"{Region}"}]},Tc={[oa]:ba,[sa]:[{[aa]:"UseS3ExpressControlEndpoint"}]},Cc={[oa]:wa,[sa]:[{[aa]:"UseS3ExpressControlEndpoint"},!0]},Rc={[oa]:Na,[sa]:[hc]},Oc={[ka]:"Unrecognized S3Express bucket name format.",[na]:ka},Pc={[oa]:Na,[sa]:[gc]},_c={[aa]:$a},Ic={[ia]:[Rc],[ka]:"Expected a endpoint to be specified but no endpoint was found",[na]:ka},Mc={[ha]:[{[fa]:!0,[Aa]:ja,[pa]:za,[ya]:["*"]},{[fa]:!0,[Aa]:"sigv4",[pa]:za,[ga]:"{Region}"}]},Nc={[oa]:wa,[sa]:[{[aa]:"ForcePathStyle"},!1]},Fc={[aa]:"ForcePathStyle"},$c={[oa]:wa,[sa]:[{[aa]:"Accelerate"},!1]},Uc={[oa]:Ea,[sa]:[{[aa]:"Region"},"aws-global"]},Lc={[ha]:[{[fa]:!0,[Aa]:"sigv4",[pa]:qa,[ga]:"us-east-1"}]},Bc={[oa]:Na,[sa]:[Uc]},Dc={[oa]:wa,[sa]:[{[aa]:"UseGlobalEndpoint"},!0]},jc={[ua]:"https://{Bucket}.s3-fips.dualstack.{Region}.{partitionResult#dnsSuffix}",[da]:{[ha]:[{[fa]:!0,[Aa]:"sigv4",[pa]:qa,[ga]:"{Region}"}]},[ma]:{}},zc={[ha]:[{[fa]:!0,[Aa]:"sigv4",[pa]:qa,[ga]:"{Region}"}]},qc={[oa]:wa,[sa]:[{[aa]:"UseGlobalEndpoint"},!1]},Hc={[oa]:wa,[sa]:[{[aa]:"UseDualStack"},!1]},Wc={[ua]:"https://{Bucket}.s3-fips.{Region}.{partitionResult#dnsSuffix}",[da]:zc,[ma]:{}},Kc={[oa]:wa,[sa]:[{[aa]:"UseFIPS"},!1]},Vc={[ua]:"https://{Bucket}.s3-accelerate.dualstack.{partitionResult#dnsSuffix}",[da]:zc,[ma]:{}},Qc={[ua]:"https://{Bucket}.s3.dualstack.{Region}.{partitionResult#dnsSuffix}",[da]:zc,[ma]:{}},Gc={[oa]:wa,[sa]:[{[oa]:xa,[sa]:[bc,"isIp"]},!1]},Jc={[ua]:Ha,[da]:zc,[ma]:{}},Xc={[ua]:Ma,[da]:zc,[ma]:{}},Zc={[Pa]:Xc,[na]:Pa},Yc={[ua]:Wa,[da]:zc,[ma]:{}},eu={[ua]:"https://{Bucket}.s3.{Region}.{partitionResult#dnsSuffix}",[da]:zc,[ma]:{}},tu={[ka]:"Invalid region: region was not a valid DNS name.",[na]:ka},ru={[aa]:Qa},nu={[aa]:Ga},iu={[oa]:xa,[sa]:[ru,"service"]},ou={[aa]:Za},su={[ia]:[lc],[ka]:"S3 Object Lambda does not support Dual-stack",[na]:ka},au={[ia]:[uc],[ka]:"S3 Object Lambda does not support S3 Accelerate",[na]:ka},cu={[ia]:[{[oa]:ba,[sa]:[{[aa]:"DisableAccessPoints"}]},{[oa]:wa,[sa]:[{[aa]:"DisableAccessPoints"},!0]}],[ka]:"Access points are not supported for this operation",[na]:ka},uu={[ia]:[{[oa]:ba,[sa]:[{[aa]:"UseArnRegion"}]},{[oa]:wa,[sa]:[{[aa]:"UseArnRegion"},!1]},{[oa]:Na,[sa]:[{[oa]:Ea,[sa]:[{[oa]:xa,[sa]:[ru,"region"]},"{Region}"]}]}],[ka]:"Invalid configuration: region from ARN `{bucketArn#region}` does not match client region `{Region}` and UseArnRegion is `false`",[na]:ka},du={[oa]:xa,[sa]:[{[aa]:"bucketPartition"},Aa]},lu={[oa]:xa,[sa]:[ru,"accountId"]},hu={[ha]:[{[fa]:!0,[Aa]:"sigv4",[pa]:Ja,[ga]:"{bucketArn#region}"}]},fu={[ka]:"Invalid ARN: The access point name may only contain a-z, A-Z, 0-9 and `-`. Found: `{accessPointName}`",[na]:ka},pu={[ka]:"Invalid ARN: The account id may only contain a-z, A-Z, 0-9 and `-`. Found: `{bucketArn#accountId}`",[na]:ka},gu={[ka]:"Invalid region in ARN: `{bucketArn#region}` (invalid DNS name)",[na]:ka},mu={[ka]:"Client was configured for partition `{partitionResult#name}` but ARN (`{Bucket}`) has `{bucketPartition#name}`",[na]:ka},yu={[ka]:"Invalid ARN: The ARN may only contain a single resource component after `accesspoint`.",[na]:ka},vu={[ka]:"Invalid ARN: Expected a resource of the format `accesspoint:<accesspoint name>` but no name was provided",[na]:ka},bu={[ha]:[{[fa]:!0,[Aa]:"sigv4",[pa]:qa,[ga]:"{bucketArn#region}"}]},wu={[ha]:[{[fa]:!0,[Aa]:ja,[pa]:za,[ya]:["*"]},{[fa]:!0,[Aa]:"sigv4",[pa]:za,[ga]:"{bucketArn#region}"}]},ku={[oa]:Va,[sa]:[mc]},Su={[ua]:"https://s3-fips.dualstack.{Region}.{partitionResult#dnsSuffix}/{uri_encoded_bucket}",[da]:zc,[ma]:{}},Eu={[ua]:"https://s3-fips.{Region}.{partitionResult#dnsSuffix}/{uri_encoded_bucket}",[da]:zc,[ma]:{}},xu={[ua]:"https://s3.dualstack.{Region}.{partitionResult#dnsSuffix}/{uri_encoded_bucket}",[da]:zc,[ma]:{}},Au={[ua]:nc,[da]:zc,[ma]:{}},Tu={[ua]:"https://s3.{Region}.{partitionResult#dnsSuffix}/{uri_encoded_bucket}",[da]:zc,[ma]:{}},Cu={[aa]:"UseObjectLambdaEndpoint"},Ru={[ha]:[{[fa]:!0,[Aa]:"sigv4",[pa]:Ja,[ga]:"{Region}"}]},Ou={[ua]:"https://s3-fips.dualstack.{Region}.{partitionResult#dnsSuffix}",[da]:zc,[ma]:{}},Pu={[ua]:"https://s3-fips.{Region}.{partitionResult#dnsSuffix}",[da]:zc,[ma]:{}},_u={[ua]:"https://s3.dualstack.{Region}.{partitionResult#dnsSuffix}",[da]:zc,[ma]:{}},Iu={[ua]:Fa,[da]:zc,[ma]:{}},Mu={[ua]:"https://s3.{Region}.{partitionResult#dnsSuffix}",[da]:zc,[ma]:{}},Nu=[{[aa]:"Region"}],Fu=[{[aa]:"Endpoint"}],$u=[mc],Uu=[lc],Lu=[uc],Bu=[hc,yc],Du=[{[oa]:ba,[sa]:[{[aa]:"DisableS3ExpressSessionAuth"}]},{[oa]:wa,[sa]:[{[aa]:"DisableS3ExpressSessionAuth"},!0]}],ju=[vc],zu=[wc],qu=[Ec],Hu=[dc],Wu=[{[oa]:Ta,[sa]:[mc,6,14,!0],[ca]:"s3expressAvailabilityZoneId"},{[oa]:Ta,[sa]:[mc,14,16,!0],[ca]:"s3expressAvailabilityZoneDelim"},{[oa]:Ea,[sa]:[{[aa]:"s3expressAvailabilityZoneDelim"},"--"]}],Ku=[{[ia]:[dc],[Pa]:{[ua]:"https://{Bucket}.s3express-fips-{s3expressAvailabilityZoneId}.{Region}.amazonaws.com",[da]:kc,[ma]:{}},[na]:Pa},{[Pa]:{[ua]:"https://{Bucket}.s3express-{s3expressAvailabilityZoneId}.{Region}.amazonaws.com",[da]:kc,[ma]:{}},[na]:Pa}],Vu=[{[oa]:Ta,[sa]:[mc,6,15,!0],[ca]:"s3expressAvailabilityZoneId"},{[oa]:Ta,[sa]:[mc,15,17,!0],[ca]:"s3expressAvailabilityZoneDelim"},{[oa]:Ea,[sa]:[{[aa]:"s3expressAvailabilityZoneDelim"},"--"]}],Qu=[{[ia]:[dc],[Pa]:{[ua]:"https://{Bucket}.s3express-fips-{s3expressAvailabilityZoneId}.{Region}.amazonaws.com",[da]:Ac,[ma]:{}},[na]:Pa},{[Pa]:{[ua]:"https://{Bucket}.s3express-{s3expressAvailabilityZoneId}.{Region}.amazonaws.com",[da]:Ac,[ma]:{}},[na]:Pa}],Gu=[gc],Ju=[{[oa]:Da,[sa]:[{[aa]:Ba},!1]}],Xu=[{[oa]:Ea,[sa]:[{[aa]:Ua},"beta"]}],Zu=[fc],Yu=[{[oa]:Da,[sa]:[{[aa]:"Region"},!1]}],ed=[{[oa]:Ea,[sa]:[{[aa]:"Region"},"us-east-1"]}],td=[{[oa]:Ea,[sa]:[nu,Xa]}],rd=[{[oa]:xa,[sa]:[ru,"resourceId[1]"],[ca]:Za},{[oa]:Na,[sa]:[{[oa]:Ea,[sa]:[ou,""]}]}],nd=[ru,"resourceId[1]"],id=[{[oa]:Na,[sa]:[{[oa]:Ea,[sa]:[{[oa]:xa,[sa]:[ru,"region"]},""]}]}],od=[{[oa]:Na,[sa]:[{[oa]:ba,[sa]:[{[oa]:xa,[sa]:[ru,"resourceId[2]"]}]}]}],sd=[ru,"resourceId[2]"],ad=[{[oa]:Sa,[sa]:[{[oa]:xa,[sa]:[ru,"region"]}],[ca]:"bucketPartition"}],cd=[{[oa]:Ea,[sa]:[du,{[oa]:xa,[sa]:[{[aa]:"partitionResult"},Aa]}]}],ud=[{[oa]:Da,[sa]:[{[oa]:xa,[sa]:[ru,"region"]},!0]}],dd=[{[oa]:Da,[sa]:[lu,!1]}],ld=[{[oa]:Da,[sa]:[ou,!1]}],hd=[{[oa]:Da,[sa]:[{[aa]:"Region"},!0]}],fd={version:"1.0",parameters:{Bucket:sc,Region:sc,UseFIPS:ac,UseDualStack:ac,Endpoint:sc,ForcePathStyle:ac,Accelerate:ac,UseGlobalEndpoint:ac,UseObjectLambdaEndpoint:cc,Key:sc,Prefix:sc,CopySource:sc,DisableAccessPoints:cc,DisableMultiRegionAccessPoints:ac,UseArnRegion:cc,UseS3ExpressControlEndpoint:cc,DisableS3ExpressSessionAuth:cc},rules:[{[ia]:[{[oa]:ba,[sa]:Nu}],rules:[{[ia]:[uc,dc],error:"Accelerate cannot be used with FIPS",[na]:ka},{[ia]:[lc,hc],error:"Cannot set dual-stack in combination with a custom endpoint.",[na]:ka},{[ia]:[hc,dc],error:"A custom endpoint cannot be combined with FIPS",[na]:ka},{[ia]:[hc,uc],error:"A custom endpoint cannot be combined with S3 Accelerate",[na]:ka},{[ia]:[dc,fc,pc],error:"Partition does not support FIPS",[na]:ka},{[ia]:[gc,{[oa]:Ta,[sa]:[mc,0,6,va],[ca]:Ca},{[oa]:Ea,[sa]:[{[aa]:Ca},"--x-s3"]}],rules:[{[ia]:Uu,error:"S3Express does not support Dual-stack.",[na]:ka},{[ia]:Lu,error:"S3Express does not support S3 Accelerate.",[na]:ka},{[ia]:Bu,rules:[{[ia]:Du,rules:[{[ia]:ju,rules:[{[ia]:zu,rules:[{endpoint:{[ua]:Oa,[da]:kc,[ma]:Sc},[na]:Pa}],[na]:_a}],[na]:_a},{[ia]:qu,rules:[{endpoint:{[ua]:Ma,[da]:kc,[ma]:Sc},[na]:Pa}],[na]:_a},xc],[na]:_a},{[ia]:ju,rules:[{[ia]:zu,rules:[{endpoint:{[ua]:Oa,[da]:Ac,[ma]:Sc},[na]:Pa}],[na]:_a}],[na]:_a},{[ia]:qu,rules:[{endpoint:{[ua]:Ma,[da]:Ac,[ma]:Sc},[na]:Pa}],[na]:_a},xc],[na]:_a},{[ia]:[Tc,Cc],rules:[{[ia]:[wc,Rc],rules:[{[ia]:Hu,endpoint:{[ua]:"https://s3express-control-fips.{Region}.amazonaws.com/{uri_encoded_bucket}",[da]:kc,[ma]:Sc},[na]:Pa},{endpoint:{[ua]:"https://s3express-control.{Region}.amazonaws.com/{uri_encoded_bucket}",[da]:kc,[ma]:Sc},[na]:Pa}],[na]:_a}],[na]:_a},{[ia]:qu,rules:[{[ia]:Du,rules:[{[ia]:Wu,rules:Ku,[na]:_a},{[ia]:Vu,rules:Ku,[na]:_a},Oc],[na]:_a},{[ia]:Wu,rules:Qu,[na]:_a},{[ia]:Vu,rules:Qu,[na]:_a},Oc],[na]:_a},xc],[na]:_a},{[ia]:[Pc,Tc,Cc],rules:[{[ia]:Bu,endpoint:{[ua]:Fa,[da]:kc,[ma]:Sc},[na]:Pa},{[ia]:Hu,endpoint:{[ua]:"https://s3express-control-fips.{Region}.amazonaws.com",[da]:kc,[ma]:Sc},[na]:Pa},{endpoint:{[ua]:"https://s3express-control.{Region}.amazonaws.com",[da]:kc,[ma]:Sc},[na]:Pa}],[na]:_a},{[ia]:[gc,{[oa]:Ta,[sa]:[mc,49,50,va],[ca]:$a},{[oa]:Ta,[sa]:[mc,8,12,va],[ca]:Ua},{[oa]:Ta,[sa]:[mc,0,7,va],[ca]:La},{[oa]:Ta,[sa]:[mc,32,49,va],[ca]:Ba},{[oa]:Sa,[sa]:Nu,[ca]:"regionPartition"},{[oa]:Ea,[sa]:[{[aa]:La},"--op-s3"]}],rules:[{[ia]:Ju,rules:[{[ia]:[{[oa]:Ea,[sa]:[_c,"e"]}],rules:[{[ia]:Xu,rules:[Ic,{[ia]:Bu,endpoint:{[ua]:"https://{Bucket}.ec2.{url#authority}",[da]:Mc,[ma]:Sc},[na]:Pa}],[na]:_a},{endpoint:{[ua]:"https://{Bucket}.ec2.s3-outposts.{Region}.{regionPartition#dnsSuffix}",[da]:Mc,[ma]:Sc},[na]:Pa}],[na]:_a},{[ia]:[{[oa]:Ea,[sa]:[_c,"o"]}],rules:[{[ia]:Xu,rules:[Ic,{[ia]:Bu,endpoint:{[ua]:"https://{Bucket}.op-{outpostId}.{url#authority}",[da]:Mc,[ma]:Sc},[na]:Pa}],[na]:_a},{endpoint:{[ua]:"https://{Bucket}.op-{outpostId}.s3-outposts.{Region}.{regionPartition#dnsSuffix}",[da]:Mc,[ma]:Sc},[na]:Pa}],[na]:_a},{error:'Unrecognized hardware type: "Expected hardware type o or e but got {hardwareType}"',[na]:ka}],[na]:_a},{error:"Invalid ARN: The outpost Id must only contain a-z, A-Z, 0-9 and `-`.",[na]:ka}],[na]:_a},{[ia]:Gu,rules:[{[ia]:[hc,{[oa]:Na,[sa]:[{[oa]:ba,[sa]:[{[oa]:Ra,[sa]:Fu}]}]}],error:"Custom endpoint `{Endpoint}` was not a valid URI",[na]:ka},{[ia]:[Nc,Ec],rules:[{[ia]:Zu,rules:[{[ia]:Yu,rules:[{[ia]:[uc,pc],error:"S3 Accelerate cannot be used in this region",[na]:ka},{[ia]:[lc,dc,$c,Rc,Uc],endpoint:{[ua]:"https://{Bucket}.s3-fips.dualstack.us-east-1.{partitionResult#dnsSuffix}",[da]:Lc,[ma]:Sc},[na]:Pa},{[ia]:[lc,dc,$c,Rc,Bc,Dc],rules:[{endpoint:jc,[na]:Pa}],[na]:_a},{[ia]:[lc,dc,$c,Rc,Bc,qc],endpoint:jc,[na]:Pa},{[ia]:[Hc,dc,$c,Rc,Uc],endpoint:{[ua]:"https://{Bucket}.s3-fips.us-east-1.{partitionResult#dnsSuffix}",[da]:Lc,[ma]:Sc},[na]:Pa},{[ia]:[Hc,dc,$c,Rc,Bc,Dc],rules:[{endpoint:Wc,[na]:Pa}],[na]:_a},{[ia]:[Hc,dc,$c,Rc,Bc,qc],endpoint:Wc,[na]:Pa},{[ia]:[lc,Kc,uc,Rc,Uc],endpoint:{[ua]:"https://{Bucket}.s3-accelerate.dualstack.us-east-1.{partitionResult#dnsSuffix}",[da]:Lc,[ma]:Sc},[na]:Pa},{[ia]:[lc,Kc,uc,Rc,Bc,Dc],rules:[{endpoint:Vc,[na]:Pa}],[na]:_a},{[ia]:[lc,Kc,uc,Rc,Bc,qc],endpoint:Vc,[na]:Pa},{[ia]:[lc,Kc,$c,Rc,Uc],endpoint:{[ua]:"https://{Bucket}.s3.dualstack.us-east-1.{partitionResult#dnsSuffix}",[da]:Lc,[ma]:Sc},[na]:Pa},{[ia]:[lc,Kc,$c,Rc,Bc,Dc],rules:[{endpoint:Qc,[na]:Pa}],[na]:_a},{[ia]:[lc,Kc,$c,Rc,Bc,qc],endpoint:Qc,[na]:Pa},{[ia]:[Hc,Kc,$c,hc,yc,vc,Uc],endpoint:{[ua]:Ha,[da]:Lc,[ma]:Sc},[na]:Pa},{[ia]:[Hc,Kc,$c,hc,yc,Gc,Uc],endpoint:{[ua]:Ma,[da]:Lc,[ma]:Sc},[na]:Pa},{[ia]:[Hc,Kc,$c,hc,yc,vc,Bc,Dc],rules:[{[ia]:ed,endpoint:Jc,[na]:Pa},{endpoint:Jc,[na]:Pa}],[na]:_a},{[ia]:[Hc,Kc,$c,hc,yc,Gc,Bc,Dc],rules:[{[ia]:ed,endpoint:Xc,[na]:Pa},Zc],[na]:_a},{[ia]:[Hc,Kc,$c,hc,yc,vc,Bc,qc],endpoint:Jc,[na]:Pa},{[ia]:[Hc,Kc,$c,hc,yc,Gc,Bc,qc],endpoint:Xc,[na]:Pa},{[ia]:[Hc,Kc,uc,Rc,Uc],endpoint:{[ua]:Wa,[da]:Lc,[ma]:Sc},[na]:Pa},{[ia]:[Hc,Kc,uc,Rc,Bc,Dc],rules:[{[ia]:ed,endpoint:Yc,[na]:Pa},{endpoint:Yc,[na]:Pa}],[na]:_a},{[ia]:[Hc,Kc,uc,Rc,Bc,qc],endpoint:Yc,[na]:Pa},{[ia]:[Hc,Kc,$c,Rc,Uc],endpoint:{[ua]:Ka,[da]:Lc,[ma]:Sc},[na]:Pa},{[ia]:[Hc,Kc,$c,Rc,Bc,Dc],rules:[{[ia]:ed,endpoint:{[ua]:Ka,[da]:zc,[ma]:Sc},[na]:Pa},{endpoint:eu,[na]:Pa}],[na]:_a},{[ia]:[Hc,Kc,$c,Rc,Bc,qc],endpoint:eu,[na]:Pa}],[na]:_a},tu],[na]:_a}],[na]:_a},{[ia]:[hc,yc,{[oa]:Ea,[sa]:[{[oa]:xa,[sa]:[bc,"scheme"]},"http"]},{[oa]:Ia,[sa]:[mc,va]},Nc,Kc,Hc,$c],rules:[{[ia]:Zu,rules:[{[ia]:Yu,rules:[Zc],[na]:_a},tu],[na]:_a}],[na]:_a},{[ia]:[Nc,{[oa]:Va,[sa]:$u,[ca]:Qa}],rules:[{[ia]:[{[oa]:xa,[sa]:[ru,"resourceId[0]"],[ca]:Ga},{[oa]:Na,[sa]:[{[oa]:Ea,[sa]:[nu,""]}]}],rules:[{[ia]:[{[oa]:Ea,[sa]:[iu,Ja]}],rules:[{[ia]:td,rules:[{[ia]:rd,rules:[su,au,{[ia]:id,rules:[cu,{[ia]:od,rules:[uu,{[ia]:ad,rules:[{[ia]:Zu,rules:[{[ia]:cd,rules:[{[ia]:ud,rules:[{[ia]:[{[oa]:Ea,[sa]:[lu,""]}],error:"Invalid ARN: Missing account id",[na]:ka},{[ia]:dd,rules:[{[ia]:ld,rules:[{[ia]:Bu,endpoint:{[ua]:Ya,[da]:hu,[ma]:Sc},[na]:Pa},{[ia]:Hu,endpoint:{[ua]:"https://{accessPointName}-{bucketArn#accountId}.s3-object-lambda-fips.{bucketArn#region}.{bucketPartition#dnsSuffix}",[da]:hu,[ma]:Sc},[na]:Pa},{endpoint:{[ua]:"https://{accessPointName}-{bucketArn#accountId}.s3-object-lambda.{bucketArn#region}.{bucketPartition#dnsSuffix}",[da]:hu,[ma]:Sc},[na]:Pa}],[na]:_a},fu],[na]:_a},pu],[na]:_a},gu],[na]:_a},mu],[na]:_a}],[na]:_a}],[na]:_a},yu],[na]:_a},{error:"Invalid ARN: bucket ARN is missing a region",[na]:ka}],[na]:_a},vu],[na]:_a},{error:"Invalid ARN: Object Lambda ARNs only support `accesspoint` arn types, but found: `{arnType}`",[na]:ka}],[na]:_a},{[ia]:td,rules:[{[ia]:rd,rules:[{[ia]:id,rules:[{[ia]:td,rules:[{[ia]:id,rules:[cu,{[ia]:od,rules:[uu,{[ia]:ad,rules:[{[ia]:Zu,rules:[{[ia]:[{[oa]:Ea,[sa]:[du,"{partitionResult#name}"]}],rules:[{[ia]:ud,rules:[{[ia]:[{[oa]:Ea,[sa]:[iu,qa]}],rules:[{[ia]:dd,rules:[{[ia]:ld,rules:[{[ia]:Lu,error:"Access Points do not support S3 Accelerate",[na]:ka},{[ia]:[dc,lc],endpoint:{[ua]:"https://{accessPointName}-{bucketArn#accountId}.s3-accesspoint-fips.dualstack.{bucketArn#region}.{bucketPartition#dnsSuffix}",[da]:bu,[ma]:Sc},[na]:Pa},{[ia]:[dc,Hc],endpoint:{[ua]:"https://{accessPointName}-{bucketArn#accountId}.s3-accesspoint-fips.{bucketArn#region}.{bucketPartition#dnsSuffix}",[da]:bu,[ma]:Sc},[na]:Pa},{[ia]:[Kc,lc],endpoint:{[ua]:"https://{accessPointName}-{bucketArn#accountId}.s3-accesspoint.dualstack.{bucketArn#region}.{bucketPartition#dnsSuffix}",[da]:bu,[ma]:Sc},[na]:Pa},{[ia]:[Kc,Hc,hc,yc],endpoint:{[ua]:Ya,[da]:bu,[ma]:Sc},[na]:Pa},{[ia]:[Kc,Hc],endpoint:{[ua]:"https://{accessPointName}-{bucketArn#accountId}.s3-accesspoint.{bucketArn#region}.{bucketPartition#dnsSuffix}",[da]:bu,[ma]:Sc},[na]:Pa}],[na]:_a},fu],[na]:_a},pu],[na]:_a},{error:"Invalid ARN: The ARN was not for the S3 service, found: {bucketArn#service}",[na]:ka}],[na]:_a},gu],[na]:_a},mu],[na]:_a}],[na]:_a}],[na]:_a},yu],[na]:_a}],[na]:_a}],[na]:_a},{[ia]:[{[oa]:Da,[sa]:[ou,va]}],rules:[{[ia]:Uu,error:"S3 MRAP does not support dual-stack",[na]:ka},{[ia]:Hu,error:"S3 MRAP does not support FIPS",[na]:ka},{[ia]:Lu,error:"S3 MRAP does not support S3 Accelerate",[na]:ka},{[ia]:[{[oa]:wa,[sa]:[{[aa]:"DisableMultiRegionAccessPoints"},va]}],error:"Invalid configuration: Multi-Region Access Point ARNs are disabled.",[na]:ka},{[ia]:[{[oa]:Sa,[sa]:Nu,[ca]:ec}],rules:[{[ia]:[{[oa]:Ea,[sa]:[{[oa]:xa,[sa]:[{[aa]:ec},Aa]},{[oa]:xa,[sa]:[ru,"partition"]}]}],rules:[{endpoint:{[ua]:"https://{accessPointName}.accesspoint.s3-global.{mrapPartition#dnsSuffix}",[da]:{[ha]:[{[fa]:va,name:ja,[pa]:qa,[ya]:["*"]}]},[ma]:Sc},[na]:Pa}],[na]:_a},{error:"Client was configured for partition `{mrapPartition#name}` but bucket referred to partition `{bucketArn#partition}`",[na]:ka}],[na]:_a}],[na]:_a},{error:"Invalid Access Point Name",[na]:ka}],[na]:_a},vu],[na]:_a},{[ia]:[{[oa]:Ea,[sa]:[iu,za]}],rules:[{[ia]:Uu,error:"S3 Outposts does not support Dual-stack",[na]:ka},{[ia]:Hu,error:"S3 Outposts does not support FIPS",[na]:ka},{[ia]:Lu,error:"S3 Outposts does not support S3 Accelerate",[na]:ka},{[ia]:[{[oa]:ba,[sa]:[{[oa]:xa,[sa]:[ru,"resourceId[4]"]}]}],error:"Invalid Arn: Outpost Access Point ARN contains sub resources",[na]:ka},{[ia]:[{[oa]:xa,[sa]:nd,[ca]:Ba}],rules:[{[ia]:Ju,rules:[uu,{[ia]:ad,rules:[{[ia]:Zu,rules:[{[ia]:cd,rules:[{[ia]:ud,rules:[{[ia]:dd,rules:[{[ia]:[{[oa]:xa,[sa]:sd,[ca]:tc}],rules:[{[ia]:[{[oa]:xa,[sa]:[ru,"resourceId[3]"],[ca]:Za}],rules:[{[ia]:[{[oa]:Ea,[sa]:[{[aa]:tc},Xa]}],rules:[{[ia]:Bu,endpoint:{[ua]:"https://{accessPointName}-{bucketArn#accountId}.{outpostId}.{url#authority}",[da]:wu,[ma]:Sc},[na]:Pa},{endpoint:{[ua]:"https://{accessPointName}-{bucketArn#accountId}.{outpostId}.s3-outposts.{bucketArn#region}.{bucketPartition#dnsSuffix}",[da]:wu,[ma]:Sc},[na]:Pa}],[na]:_a},{error:"Expected an outpost type `accesspoint`, found {outpostType}",[na]:ka}],[na]:_a},{error:"Invalid ARN: expected an access point name",[na]:ka}],[na]:_a},{error:"Invalid ARN: Expected a 4-component resource",[na]:ka}],[na]:_a},pu],[na]:_a},gu],[na]:_a},mu],[na]:_a}],[na]:_a}],[na]:_a},{error:"Invalid ARN: The outpost Id may only contain a-z, A-Z, 0-9 and `-`. Found: `{outpostId}`",[na]:ka}],[na]:_a},{error:"Invalid ARN: The Outpost Id was not set",[na]:ka}],[na]:_a},{error:"Invalid ARN: Unrecognized format: {Bucket} (type: {arnType})",[na]:ka}],[na]:_a},{error:"Invalid ARN: No ARN type specified",[na]:ka}],[na]:_a},{[ia]:[{[oa]:Ta,[sa]:[mc,0,4,!1],[ca]:rc},{[oa]:Ea,[sa]:[{[aa]:rc},"arn:"]},{[oa]:Na,[sa]:[{[oa]:ba,[sa]:[ku]}]}],error:"Invalid ARN: `{Bucket}` was not a valid ARN",[na]:ka},{[ia]:[{[oa]:wa,[sa]:[Fc,va]},ku],error:"Path-style addressing cannot be used with ARN buckets",[na]:ka},{[ia]:zu,rules:[{[ia]:Zu,rules:[{[ia]:[$c],rules:[{[ia]:[lc,Rc,dc,Uc],endpoint:{[ua]:"https://s3-fips.dualstack.us-east-1.{partitionResult#dnsSuffix}/{uri_encoded_bucket}",[da]:Lc,[ma]:Sc},[na]:Pa},{[ia]:[lc,Rc,dc,Bc,Dc],rules:[{endpoint:Su,[na]:Pa}],[na]:_a},{[ia]:[lc,Rc,dc,Bc,qc],endpoint:Su,[na]:Pa},{[ia]:[Hc,Rc,dc,Uc],endpoint:{[ua]:"https://s3-fips.us-east-1.{partitionResult#dnsSuffix}/{uri_encoded_bucket}",[da]:Lc,[ma]:Sc},[na]:Pa},{[ia]:[Hc,Rc,dc,Bc,Dc],rules:[{endpoint:Eu,[na]:Pa}],[na]:_a},{[ia]:[Hc,Rc,dc,Bc,qc],endpoint:Eu,[na]:Pa},{[ia]:[lc,Rc,Kc,Uc],endpoint:{[ua]:"https://s3.dualstack.us-east-1.{partitionResult#dnsSuffix}/{uri_encoded_bucket}",[da]:Lc,[ma]:Sc},[na]:Pa},{[ia]:[lc,Rc,Kc,Bc,Dc],rules:[{endpoint:xu,[na]:Pa}],[na]:_a},{[ia]:[lc,Rc,Kc,Bc,qc],endpoint:xu,[na]:Pa},{[ia]:[Hc,hc,yc,Kc,Uc],endpoint:{[ua]:nc,[da]:Lc,[ma]:Sc},[na]:Pa},{[ia]:[Hc,hc,yc,Kc,Bc,Dc],rules:[{[ia]:ed,endpoint:Au,[na]:Pa},{endpoint:Au,[na]:Pa}],[na]:_a},{[ia]:[Hc,hc,yc,Kc,Bc,qc],endpoint:Au,[na]:Pa},{[ia]:[Hc,Rc,Kc,Uc],endpoint:{[ua]:ic,[da]:Lc,[ma]:Sc},[na]:Pa},{[ia]:[Hc,Rc,Kc,Bc,Dc],rules:[{[ia]:ed,endpoint:{[ua]:ic,[da]:zc,[ma]:Sc},[na]:Pa},{endpoint:Tu,[na]:Pa}],[na]:_a},{[ia]:[Hc,Rc,Kc,Bc,qc],endpoint:Tu,[na]:Pa}],[na]:_a},{error:"Path-style addressing cannot be used with S3 Accelerate",[na]:ka}],[na]:_a}],[na]:_a}],[na]:_a},{[ia]:[{[oa]:ba,[sa]:[Cu]},{[oa]:wa,[sa]:[Cu,va]}],rules:[{[ia]:Zu,rules:[{[ia]:hd,rules:[su,au,{[ia]:Bu,endpoint:{[ua]:Fa,[da]:Ru,[ma]:Sc},[na]:Pa},{[ia]:Hu,endpoint:{[ua]:"https://s3-object-lambda-fips.{Region}.{partitionResult#dnsSuffix}",[da]:Ru,[ma]:Sc},[na]:Pa},{endpoint:{[ua]:"https://s3-object-lambda.{Region}.{partitionResult#dnsSuffix}",[da]:Ru,[ma]:Sc},[na]:Pa}],[na]:_a},tu],[na]:_a}],[na]:_a},{[ia]:[Pc],rules:[{[ia]:Zu,rules:[{[ia]:hd,rules:[{[ia]:[dc,lc,Rc,Uc],endpoint:{[ua]:"https://s3-fips.dualstack.us-east-1.{partitionResult#dnsSuffix}",[da]:Lc,[ma]:Sc},[na]:Pa},{[ia]:[dc,lc,Rc,Bc,Dc],rules:[{endpoint:Ou,[na]:Pa}],[na]:_a},{[ia]:[dc,lc,Rc,Bc,qc],endpoint:Ou,[na]:Pa},{[ia]:[dc,Hc,Rc,Uc],endpoint:{[ua]:"https://s3-fips.us-east-1.{partitionResult#dnsSuffix}",[da]:Lc,[ma]:Sc},[na]:Pa},{[ia]:[dc,Hc,Rc,Bc,Dc],rules:[{endpoint:Pu,[na]:Pa}],[na]:_a},{[ia]:[dc,Hc,Rc,Bc,qc],endpoint:Pu,[na]:Pa},{[ia]:[Kc,lc,Rc,Uc],endpoint:{[ua]:"https://s3.dualstack.us-east-1.{partitionResult#dnsSuffix}",[da]:Lc,[ma]:Sc},[na]:Pa},{[ia]:[Kc,lc,Rc,Bc,Dc],rules:[{endpoint:_u,[na]:Pa}],[na]:_a},{[ia]:[Kc,lc,Rc,Bc,qc],endpoint:_u,[na]:Pa},{[ia]:[Kc,Hc,hc,yc,Uc],endpoint:{[ua]:Fa,[da]:Lc,[ma]:Sc},[na]:Pa},{[ia]:[Kc,Hc,hc,yc,Bc,Dc],rules:[{[ia]:ed,endpoint:Iu,[na]:Pa},{endpoint:Iu,[na]:Pa}],[na]:_a},{[ia]:[Kc,Hc,hc,yc,Bc,qc],endpoint:Iu,[na]:Pa},{[ia]:[Kc,Hc,Rc,Uc],endpoint:{[ua]:oc,[da]:Lc,[ma]:Sc},[na]:Pa},{[ia]:[Kc,Hc,Rc,Bc,Dc],rules:[{[ia]:ed,endpoint:{[ua]:oc,[da]:zc,[ma]:Sc},[na]:Pa},{endpoint:Mu,[na]:Pa}],[na]:_a},{[ia]:[Kc,Hc,Rc,Bc,qc],endpoint:Mu,[na]:Pa}],[na]:_a},tu],[na]:_a}],[na]:_a}],[na]:_a},{error:"A region must be set when sending requests to S3.",[na]:ka}]},pd=new class{constructor({size:e,params:t}){this.data=new Map,this.parameters=[],this.capacity=e??50,t&&(this.parameters=t)}get(e,t){const r=this.hash(e);if(!1===r)return t();if(!this.data.has(r)){if(this.data.size>this.capacity+10){const e=this.data.keys();let t=0;for(;;){const{value:r,done:n}=e.next();if(this.data.delete(r),n||++t>10)break}}this.data.set(r,t())}return this.data.get(r)}size(){return this.data.size}hash(e){let t="";const{parameters:r}=this;if(0===r.length)return!1;for(const n of r){const r=String(e[n]??"");if(r.includes("|;"))return!1;t+=r+"|;"}return t}}({size:50,params:["Accelerate","Bucket","DisableAccessPoints","DisableMultiRegionAccessPoints","DisableS3ExpressSessionAuth","Endpoint","ForcePathStyle","Region","UseArnRegion","UseDualStack","UseFIPS","UseGlobalEndpoint","UseObjectLambdaEndpoint","UseS3ExpressControlEndpoint"]}),gd=(e,t={})=>pd.get(e,(()=>((e,t)=>{const{endpointParams:r,logger:n}=t,{parameters:i,rules:o}=e;t.logger?.debug?.(`${Fo} Initial EndpointParams: ${$o(r)}`);const s=Object.entries(i).filter((([,e])=>null!=e.default)).map((([e,t])=>[e,t.default]));if(s.length>0)for(const[e,t]of s)r[e]=r[e]??t;const a=Object.entries(i).filter((([,e])=>e.required)).map((([e])=>e));for(const e of a)if(null==r[e])throw new Uo(`Missing required parameter: '${e}'`);const c=Yo(o,{endpointParams:r,logger:n,referenceRecord:{}});return t.logger?.debug?.(`${Fo} Resolved endpoint: ${$o(c)}`),c})(fd,{endpointParams:e,logger:t.logger})));No.aws=rs;const md=(yd=async(e,t,r)=>({operation:ue(t).operation,region:await de(e.region)()||(()=>{throw new Error("expected `region` to be configured for `aws.auth#sigv4`")})()}),async(e,t,r)=>{if(!r)throw new Error("Could not find `input` for `defaultEndpointRuleSetHttpAuthSchemeParametersProvider`");const n=await yd(e,t,r),i=ue(t)?.commandInstance?.constructor?.getEndpointParameterInstructions;if(!i)throw new Error(`getEndpointParameterInstructions() is not defined on \`${t.commandName}\``);const o=await As(r,{getEndpointParameterInstructions:i},e);return Object.assign(n,o)});var yd;function vd(e){return{schemeId:"aws.auth#sigv4",signingProperties:{name:"s3",region:e.region},propertiesExtractor:(e,t)=>({signingProperties:{config:e,context:t}})}}function bd(e){return{schemeId:"aws.auth#sigv4a",signingProperties:{name:"s3",region:e.region},propertiesExtractor:(e,t)=>({signingProperties:{config:e,context:t}})}}const wd=((e,t,r)=>n=>{const i=e(n),o=i.properties?.authSchemes;if(!o)return t(n);const s=[];for(const e of o){const{name:t,properties:i={},...a}=e,c=t.toLowerCase();let u;if(t!==c&&console.warn(`HttpAuthScheme has been normalized with lowercasing: \`${t}\` to \`${c}\``),"sigv4a"===c){u="aws.auth#sigv4a";const e=o.find((e=>{const t=e.name.toLowerCase();return"sigv4a"!==t&&t.startsWith("sigv4")}));if(e)continue}else{if(!c.startsWith("sigv4"))throw new Error(`Unknown HttpAuthScheme found in \`@smithy.rules#endpointRuleSet\`: \`${c}\``);u="aws.auth#sigv4"}const d=r[u];if(!d)throw new Error(`Could not find HttpAuthOption create function for \`${u}\``);const l=d(n);l.schemeId=u,l.signingProperties={...l.signingProperties||{},...a,...i},s.push(l)}return s})(gd,(e=>{const t=[];return e.operation,t.push(vd(e)),t.push(bd(e)),t}),{"aws.auth#sigv4":vd,"aws.auth#sigv4a":bd}),kd=e=>{const t=(e=>(e.sigv4aSigningRegionSet=we(e.sigv4aSigningRegionSet),e))(Nt(e));return{...t}},Sd={ForcePathStyle:{type:"clientContextParams",name:"forcePathStyle"},UseArnRegion:{type:"clientContextParams",name:"useArnRegion"},DisableMultiRegionAccessPoints:{type:"clientContextParams",name:"disableMultiregionAccessPoints"},Accelerate:{type:"clientContextParams",name:"useAccelerateEndpoint"},DisableS3ExpressSessionAuth:{type:"clientContextParams",name:"disableS3ExpressSessionAuth"},UseGlobalEndpoint:{type:"builtInParams",name:"useGlobalEndpoint"},UseFIPS:{type:"builtInParams",name:"useFipsEndpoint"},Endpoint:{type:"builtInParams",name:"endpoint"},Region:{type:"builtInParams",name:"region"},UseDualStack:{type:"builtInParams",name:"useDualstackEndpoint"}};class Ed extends Or{constructor(e){super(e),Object.setPrototypeOf(this,Ed.prototype)}}class xd extends Ed{constructor(e){super({name:"NoSuchUpload",$fault:"client",...e}),this.name="NoSuchUpload",this.$fault="client",Object.setPrototypeOf(this,xd.prototype)}}class Ad extends Ed{constructor(e){super({name:"ObjectNotInActiveTierError",$fault:"client",...e}),this.name="ObjectNotInActiveTierError",this.$fault="client",Object.setPrototypeOf(this,Ad.prototype)}}class Td extends Ed{constructor(e){super({name:"BucketAlreadyExists",$fault:"client",...e}),this.name="BucketAlreadyExists",this.$fault="client",Object.setPrototypeOf(this,Td.prototype)}}class Cd extends Ed{constructor(e){super({name:"BucketAlreadyOwnedByYou",$fault:"client",...e}),this.name="BucketAlreadyOwnedByYou",this.$fault="client",Object.setPrototypeOf(this,Cd.prototype)}}class Rd extends Ed{constructor(e){super({name:"NoSuchBucket",$fault:"client",...e}),this.name="NoSuchBucket",this.$fault="client",Object.setPrototypeOf(this,Rd.prototype)}}var Od,Pd;!function(e){e.visit=(e,t)=>void 0!==e.Prefix?t.Prefix(e.Prefix):void 0!==e.Tag?t.Tag(e.Tag):void 0!==e.And?t.And(e.And):t._(e.$unknown[0],e.$unknown[1])}(Od||(Od={})),function(e){e.visit=(e,t)=>void 0!==e.Prefix?t.Prefix(e.Prefix):void 0!==e.Tag?t.Tag(e.Tag):void 0!==e.AccessPointArn?t.AccessPointArn(e.AccessPointArn):void 0!==e.And?t.And(e.And):t._(e.$unknown[0],e.$unknown[1])}(Pd||(Pd={}));class _d extends Ed{constructor(e){super({name:"InvalidObjectState",$fault:"client",...e}),this.name="InvalidObjectState",this.$fault="client",Object.setPrototypeOf(this,_d.prototype),this.StorageClass=e.StorageClass,this.AccessTier=e.AccessTier}}class Id extends Ed{constructor(e){super({name:"NoSuchKey",$fault:"client",...e}),this.name="NoSuchKey",this.$fault="client",Object.setPrototypeOf(this,Id.prototype)}}class Md extends Ed{constructor(e){super({name:"NotFound",$fault:"client",...e}),this.name="NotFound",this.$fault="client",Object.setPrototypeOf(this,Md.prototype)}}const Nd=e=>({...e,...e.SecretAccessKey&&{SecretAccessKey:qt},...e.SessionToken&&{SessionToken:qt}}),Fd=e=>({...e,...e.SSEKMSKeyId&&{SSEKMSKeyId:qt},...e.SSEKMSEncryptionContext&&{SSEKMSEncryptionContext:qt},...e.Credentials&&{Credentials:Nd(e.Credentials)}}),$d=e=>({...e,...e.SSEKMSKeyId&&{SSEKMSKeyId:qt},...e.SSEKMSEncryptionContext&&{SSEKMSEncryptionContext:qt}}),Ud=e=>({...e,...e.SSEKMSKeyId&&{SSEKMSKeyId:qt}}),Ld=e=>({...e,...e.SSECustomerKey&&{SSECustomerKey:qt}});class Bd extends Ed{constructor(e){super({name:"EncryptionTypeMismatch",$fault:"client",...e}),this.name="EncryptionTypeMismatch",this.$fault="client",Object.setPrototypeOf(this,Bd.prototype)}}class Dd extends Ed{constructor(e){super({name:"InvalidRequest",$fault:"client",...e}),this.name="InvalidRequest",this.$fault="client",Object.setPrototypeOf(this,Dd.prototype)}}class jd extends Ed{constructor(e){super({name:"InvalidWriteOffset",$fault:"client",...e}),this.name="InvalidWriteOffset",this.$fault="client",Object.setPrototypeOf(this,jd.prototype)}}class zd extends Ed{constructor(e){super({name:"TooManyParts",$fault:"client",...e}),this.name="TooManyParts",this.$fault="client",Object.setPrototypeOf(this,zd.prototype)}}class qd extends Ed{constructor(e){super({name:"ObjectAlreadyInActiveTierError",$fault:"client",...e}),this.name="ObjectAlreadyInActiveTierError",this.$fault="client",Object.setPrototypeOf(this,qd.prototype)}}var Hd;!function(e){e.visit=(e,t)=>void 0!==e.Records?t.Records(e.Records):void 0!==e.Stats?t.Stats(e.Stats):void 0!==e.Progress?t.Progress(e.Progress):void 0!==e.Cont?t.Cont(e.Cont):void 0!==e.End?t.End(e.End):t._(e.$unknown[0],e.$unknown[1])}(Hd||(Hd={}));const Wd=e=>({...e,...e.SSEKMSKeyId&&{SSEKMSKeyId:qt},...e.SSEKMSEncryptionContext&&{SSEKMSEncryptionContext:qt}}),Kd=e=>({...e,...e.SSECustomerKey&&{SSECustomerKey:qt},...e.SSEKMSKeyId&&{SSEKMSKeyId:qt},...e.SSEKMSEncryptionContext&&{SSEKMSEncryptionContext:qt}}),Vd=async(e,t)=>{const r=Je(e,t),n=Hr({},jr,{[ep]:e[Xh],[xp]:e[Zh],[Ap]:e[nf],[Cp]:e[rf],[Tp]:[()=>jr(e[_l]),()=>e[_l].toString()]});r.bp("/"),r.p("Bucket",(()=>e.Bucket),"{Bucket}",!1);const i=Hr({[Hf]:[,""]});return r.m("GET").h(n).q(i).b(undefined),r.build()},Qd=async(e,t)=>{const r=Je(e,t),n=Hr({},jr,{[dp]:e[Sh],[wp]:e[Hh],[Qf]:[()=>jr(e[Pl]),()=>e[Pl].toString()],[np]:e[eh],[Rf]:e[lh],[cp]:[()=>jr(e[hh]),()=>lr(e[hh]).toString()],[up]:[()=>jr(e[fh]),()=>e[fh].toString()]});r.bp("/{Key+}"),r.p("Bucket",(()=>e.Bucket),"{Bucket}",!1),r.p("Key",(()=>e.Key),"{Key+}",!0);const i=Hr({[$p]:[,"DeleteObject"],[Kf]:[,e[uf]]});return r.m("DELETE").h(n).q(i).b(undefined),r.build()},Gd=async(e,t)=>{const r=Je(e,t),n=Hr({},jr,{[Rf]:e[lh],[Of]:[()=>jr(e[ph]),()=>lr(e[ph]).toString()],[Pf]:e[gh],[_f]:[()=>jr(e[vh]),()=>lr(e[vh]).toString()],[Uf]:e[Fh],[Rp]:e[Yh],[Op]:e[ef],[Pp]:e[tf],[wp]:e[Hh],[np]:e[eh],[Xf]:e[jl]});r.bp("/{Key+}"),r.p("Bucket",(()=>e.Bucket),"{Bucket}",!1),r.p("Key",(()=>e.Key),"{Key+}",!0);const i=Hr({[$p]:[,"GetObject"],[Lf]:[,e[Uh]],[Bf]:[,e[Lh]],[Df]:[,e[Bh]],[jf]:[,e[Dh]],[zf]:[,e[jh]],[qf]:[()=>void 0!==e.ResponseExpires,()=>lr(e[zh]).toString()],[Kf]:[,e[uf]],[Ff]:[()=>void 0!==e.PartNumber,()=>e[Nh].toString()]});return r.m("GET").h(n).q(i).b(undefined),r.build()},Jd=async(e,t)=>{const r=Je(e,t),n=Hr({},jr,{[wp]:e[Hh],[np]:e[eh],[mp]:[()=>jr(e[_h]),()=>(e[_h]||[]).map(Gr).join(", ")]});r.bp("/"),r.p("Bucket",(()=>e.Bucket),"{Bucket}",!1);const i=Hr({[Mf]:[,"2"],[Sf]:[,e[Jl]],[xf]:[,e[rh]],[Nf]:[()=>void 0!==e.MaxKeys,()=>e[Eh].toString()],[$f]:[,e[Ih]],[kf]:[,e[Ql]],[Cf]:[()=>void 0!==e.FetchOwner,()=>e[oh].toString()],[Wf]:[,e[Qh]]});return r.m("GET").h(n).q(i).b(undefined),r.build()},Xd=async(e,t)=>{const r=Je(e,t),n=Hr({},jr,{[wf]:e[Vl]||"application/octet-stream",[Vf]:e[Tl],[ff]:e[Nl],[pf]:e[Ul],[gf]:e[Ll],[mf]:e[Bl],[yf]:[()=>jr(e[Dl]),()=>e[Dl].toString()],[vf]:e[zl],[Ep]:e[Ml],[Gf]:e[Fl],[Jf]:e[$l],[Zf]:e[Wl],[Yf]:e[Kl],[Ef]:[()=>jr(e[Yl]),()=>lr(e[Yl]).toString()],[Rf]:e[lh],[Pf]:e[gh],[ip]:e[sh],[op]:e[ah],[sp]:e[ch],[ap]:e[uh],[Np]:[()=>jr(e[df]),()=>e[df].toString()],[xp]:e[Zh],[Sp]:e[Jh],[Fp]:e[lf],[Rp]:e[Yh],[Op]:e[ef],[Pp]:e[tf],[Ap]:e[nf],[Cp]:e[rf],[Tp]:[()=>jr(e[_l]),()=>e[_l].toString()],[wp]:e[Hh],[_p]:e[af],[pp]:e[Oh],[gp]:[()=>jr(e[Ph]),()=>{return(t=e[Ph],t.toISOString().replace(".000Z","Z")).toString();var t}],[fp]:e[Rh],[np]:e[eh],...void 0!==e.Metadata&&Object.keys(e.Metadata).reduce(((t,r)=>(t[`x-amz-meta-${r.toLowerCase()}`]=e.Metadata[r],t)),{})});r.bp("/{Key+}"),r.p("Bucket",(()=>e.Bucket),"{Bucket}",!1),r.p("Key",(()=>e.Key),"{Key+}",!0);const i=Hr({[$p]:[,"PutObject"]});let o,s;return void 0!==e.Body&&(s=e.Body,o=s),r.m("PUT").h(n).q(i).b(o),r.build()},Zd=async(e,t)=>{if(200!==e.statusCode&&e.statusCode>=300)return nl(e,t);const r=Hr({$metadata:Al(e),[Zh]:[,e.headers[xp]],[nf]:[,e.headers[Ap]],[rf]:[,e.headers[Cp]],[_l]:[()=>void 0!==e.headers[Tp],()=>Ht(e.headers[Tp])]}),n=Yt(er(await yi(e.body,t)),"body");return null!=n[Il]&&(r[Il]=xl(n[Il])),r},Yd=async(e,t)=>{if(204!==e.statusCode&&e.statusCode>=300)return nl(e,t);const r=Hr({$metadata:Al(e),[Xl]:[()=>void 0!==e.headers[tp],()=>Ht(e.headers[tp])],[uf]:[,e.headers[Mp]],[$h]:[,e.headers[bp]]});return await Qe(e.body,t),r},el=async(e,t)=>{if(200!==e.statusCode&&e.statusCode>=300)return nl(e,t);const r=Hr({$metadata:Al(e),[Xl]:[()=>void 0!==e.headers[tp],()=>Ht(e.headers[tp])],[Rl]:[,e.headers[hf]],[ih]:[,e.headers[rp]],[Vh]:[,e.headers[vp]],[kh]:[()=>void 0!==e.headers[If],()=>Yt(yr(e.headers[If]))],[Dl]:[()=>void 0!==e.headers[yf],()=>ir(e.headers[yf])],[nh]:[,e.headers[Af]],[Fl]:[,e.headers[Gf]],[$l]:[,e.headers[Jf]],[Wl]:[,e.headers[Zf]],[Kl]:[,e.headers[Yf]],[xh]:[()=>void 0!==e.headers[lp],()=>or(e.headers[lp])],[uf]:[,e.headers[Mp]],[Nl]:[,e.headers[ff]],[Ul]:[,e.headers[pf]],[Ll]:[,e.headers[gf]],[Bl]:[,e.headers[mf]],[Hl]:[,e.headers[bf]],[Vl]:[,e.headers[wf]],[Yl]:[()=>void 0!==e.headers[Ef],()=>Yt(yr(e.headers[Ef]))],[th]:[,e.headers[Tf]],[lf]:[,e.headers[Fp]],[Zh]:[,e.headers[xp]],[Yh]:[,e.headers[Rp]],[tf]:[,e.headers[Pp]],[nf]:[,e.headers[Ap]],[_l]:[()=>void 0!==e.headers[Tp],()=>Ht(e.headers[Tp])],[Jh]:[,e.headers[Sp]],[$h]:[,e.headers[bp]],[Wh]:[,e.headers[kp]],[Mh]:[()=>void 0!==e.headers[hp],()=>or(e.headers[hp])],[cf]:[()=>void 0!==e.headers[Ip],()=>or(e.headers[Ip])],[Oh]:[,e.headers[pp]],[Ph]:[()=>void 0!==e.headers[gp],()=>Yt(fr(e.headers[gp]))],[Rh]:[,e.headers[fp]],Metadata:[,Object.keys(e.headers).filter((e=>e.startsWith("x-amz-meta-"))).reduce(((t,r)=>(t[r.substring(11)]=e.headers[r],t)),{})]}),n=e.body;return t.sdkStreamMixin(n),r.Body=n,r},tl=async(e,t)=>{if(200!==e.statusCode&&e.statusCode>=300)return nl(e,t);const r=Hr({$metadata:Al(e),[$h]:[,e.headers[bp]]}),n=Yt(er(await yi(e.body,t)),"body");return""===n.CommonPrefixes?r[ql]=[]:null!=n[ql]&&(r[ql]=bl(Br(n[ql]))),""===n.Contents?r[Gl]=[]:null!=n[Gl]&&(r[Gl]=kl(Br(n[Gl]))),null!=n[Ql]&&(r[Ql]=tr(n[Ql])),null!=n[Jl]&&(r[Jl]=tr(n[Jl])),null!=n[rh]&&(r[rh]=tr(n[rh])),null!=n[yh]&&(r[yh]=Ht(n[yh])),null!=n[wh]&&(r[wh]=or(n[wh])),null!=n[Eh]&&(r[Eh]=or(n[Eh])),null!=n[Ah]&&(r[Ah]=tr(n[Ah])),null!=n[Th]&&(r[Th]=tr(n[Th])),null!=n[Ih]&&(r[Ih]=tr(n[Ih])),null!=n[Qh]&&(r[Qh]=tr(n[Qh])),r},rl=async(e,t)=>{if(200!==e.statusCode&&e.statusCode>=300)return nl(e,t);const r=Hr({$metadata:Al(e),[ih]:[,e.headers[rp]],[nh]:[,e.headers[Af]],[Fl]:[,e.headers[Gf]],[$l]:[,e.headers[Jf]],[Wl]:[,e.headers[Zf]],[Kl]:[,e.headers[Yf]],[Zh]:[,e.headers[xp]],[uf]:[,e.headers[Mp]],[Yh]:[,e.headers[Rp]],[tf]:[,e.headers[Pp]],[nf]:[,e.headers[Ap]],[rf]:[,e.headers[Cp]],[_l]:[()=>void 0!==e.headers[Tp],()=>Ht(e.headers[Tp])],[sf]:[()=>void 0!==e.headers[yp],()=>ir(e.headers[yp])],[$h]:[,e.headers[bp]]});return await Qe(e.body,t),r},nl=async(e,t)=>{const r={...e,body:await vi(e.body,t)},n=((e,t)=>void 0!==t?.Error?.Code?t.Error.Code:void 0!==t?.Code?t.Code:404==e.statusCode?"NotFound":void 0)(e,r.body);switch(n){case"NoSuchUpload":case"com.amazonaws.s3#NoSuchUpload":throw await pl(r,t);case"ObjectNotInActiveTierError":case"com.amazonaws.s3#ObjectNotInActiveTierError":throw await yl(r,t);case"BucketAlreadyExists":case"com.amazonaws.s3#BucketAlreadyExists":throw await sl(r,t);case"BucketAlreadyOwnedByYou":case"com.amazonaws.s3#BucketAlreadyOwnedByYou":throw await al(r,t);case"NoSuchBucket":case"com.amazonaws.s3#NoSuchBucket":throw await hl(r,t);case"InvalidObjectState":case"com.amazonaws.s3#InvalidObjectState":throw await ul(r,t);case"NoSuchKey":case"com.amazonaws.s3#NoSuchKey":throw await fl(r,t);case"NotFound":case"com.amazonaws.s3#NotFound":throw await gl(r,t);case"EncryptionTypeMismatch":case"com.amazonaws.s3#EncryptionTypeMismatch":throw await cl(r,t);case"InvalidRequest":case"com.amazonaws.s3#InvalidRequest":throw await dl(r,t);case"InvalidWriteOffset":case"com.amazonaws.s3#InvalidWriteOffset":throw await ll(r,t);case"TooManyParts":case"com.amazonaws.s3#TooManyParts":throw await vl(r,t);case"ObjectAlreadyInActiveTierError":case"com.amazonaws.s3#ObjectAlreadyInActiveTierError":throw await ml(r,t);default:const i=r.body;return il({output:e,parsedBody:i,errorCode:n})}},il=(ol=Ed,({output:e,parsedBody:t,errorCode:r})=>{(({output:e,parsedBody:t,exceptionCtor:r,errorCode:n})=>{const i=_r(e),o=i.httpStatusCode?i.httpStatusCode+"":void 0,s=new r({name:t?.code||t?.Code||n||o||"UnknownError",$fault:"client",$metadata:i});throw Pr(s,t)})({output:e,parsedBody:t,exceptionCtor:ol,errorCode:r})});var ol;const sl=async(e,t)=>{const r=Hr({});e.body;const n=new Td({$metadata:Al(e),...r});return Pr(n,e.body)},al=async(e,t)=>{const r=Hr({});e.body;const n=new Cd({$metadata:Al(e),...r});return Pr(n,e.body)},cl=async(e,t)=>{const r=Hr({});e.body;const n=new Bd({$metadata:Al(e),...r});return Pr(n,e.body)},ul=async(e,t)=>{const r=Hr({}),n=e.body;null!=n[Ol]&&(r[Ol]=tr(n[Ol])),null!=n[Jh]&&(r[Jh]=tr(n[Jh]));const i=new _d({$metadata:Al(e),...r});return Pr(i,e.body)},dl=async(e,t)=>{const r=Hr({});e.body;const n=new Dd({$metadata:Al(e),...r});return Pr(n,e.body)},ll=async(e,t)=>{const r=Hr({});e.body;const n=new jd({$metadata:Al(e),...r});return Pr(n,e.body)},hl=async(e,t)=>{const r=Hr({});e.body;const n=new Rd({$metadata:Al(e),...r});return Pr(n,e.body)},fl=async(e,t)=>{const r=Hr({});e.body;const n=new Id({$metadata:Al(e),...r});return Pr(n,e.body)},pl=async(e,t)=>{const r=Hr({});e.body;const n=new xd({$metadata:Al(e),...r});return Pr(n,e.body)},gl=async(e,t)=>{const r=Hr({});e.body;const n=new Md({$metadata:Al(e),...r});return Pr(n,e.body)},ml=async(e,t)=>{const r=Hr({});e.body;const n=new qd({$metadata:Al(e),...r});return Pr(n,e.body)},yl=async(e,t)=>{const r=Hr({});e.body;const n=new Ad({$metadata:Al(e),...r});return Pr(n,e.body)},vl=async(e,t)=>{const r=Hr({});e.body;const n=new zd({$metadata:Al(e),...r});return Pr(n,e.body)},bl=(e,t)=>(e||[]).filter((e=>null!=e)).map((e=>(e=>{const t={};return null!=e[Ih]&&(t[Ih]=tr(e[Ih])),t})(e))),wl=(e,t)=>{const r={};return null!=e[bh]&&(r[bh]=tr(e[bh])),null!=e[kh]&&(r[kh]=Yt(fr(e[kh]))),null!=e[nh]&&(r[nh]=tr(e[nh])),""===e.ChecksumAlgorithm?r[Ml]=[]:null!=e[Ml]&&(r[Ml]=(e=>(e||[]).filter((e=>null!=e)).map((e=>tr(e))))(Br(e[Ml]))),null!=e[sf]&&(r[sf]=ir(e[sf])),null!=e[Jh]&&(r[Jh]=tr(e[Jh])),null!=e[Ch]&&(r[Ch]=Sl(e[Ch])),null!=e[Kh]&&(r[Kh]=El(e[Kh])),r},kl=(e,t)=>(e||[]).filter((e=>null!=e)).map((e=>wl(e))),Sl=(e,t)=>{const r={};return null!=e[Zl]&&(r[Zl]=tr(e[Zl])),null!=e[dh]&&(r[dh]=tr(e[dh])),r},El=(e,t)=>{const r={};return null!=e[mh]&&(r[mh]=Ht(e[mh])),null!=e[qh]&&(r[qh]=Yt(fr(e[qh]))),r},xl=(e,t)=>{const r={};return null!=e[Cl]&&(r[Cl]=tr(e[Cl])),null!=e[Gh]&&(r[Gh]=tr(e[Gh])),null!=e[of]&&(r[of]=tr(e[of])),null!=e[ih]&&(r[ih]=Yt(fr(e[ih]))),r},Al=e=>({httpStatusCode:e.statusCode,requestId:e.headers["x-amzn-requestid"]??e.headers["x-amzn-request-id"]??e.headers["x-amz-request-id"],extendedRequestId:e.headers["x-amz-id-2"],cfId:e.headers["x-amz-cf-id"]}),Tl="ACL",Cl="AccessKeyId",Rl="AcceptRanges",Ol="AccessTier",Pl="BypassGovernanceRetention",_l="BucketKeyEnabled",Il="Credentials",Ml="ChecksumAlgorithm",Nl="CacheControl",Fl="ChecksumCRC32",$l="ChecksumCRC32C",Ul="ContentDisposition",Ll="ContentEncoding",Bl="ContentLanguage",Dl="ContentLength",jl="ChecksumMode",zl="ContentMD5",ql="CommonPrefixes",Hl="ContentRange",Wl="ChecksumSHA1",Kl="ChecksumSHA256",Vl="ContentType",Ql="ContinuationToken",Gl="Contents",Jl="Delimiter",Xl="DeleteMarker",Zl="DisplayName",Yl="Expires",eh="ExpectedBucketOwner",th="ExpiresString",rh="EncodingType",nh="ETag",ih="Expiration",oh="FetchOwner",sh="GrantFullControl",ah="GrantRead",ch="GrantReadACP",uh="GrantWriteACP",dh="ID",lh="IfMatch",hh="IfMatchLastModifiedTime",fh="IfMatchSize",ph="IfModifiedSince",gh="IfNoneMatch",mh="IsRestoreInProgress",yh="IsTruncated",vh="IfUnmodifiedSince",bh="Key",wh="KeyCount",kh="LastModified",Sh="MFA",Eh="MaxKeys",xh="MissingMeta",Ah="Name",Th="NextContinuationToken",Ch="Owner",Rh="ObjectLockLegalHoldStatus",Oh="ObjectLockMode",Ph="ObjectLockRetainUntilDate",_h="OptionalObjectAttributes",Ih="Prefix",Mh="PartsCount",Nh="PartNumber",Fh="Range",$h="RequestCharged",Uh="ResponseCacheControl",Lh="ResponseContentDisposition",Bh="ResponseContentEncoding",Dh="ResponseContentLanguage",jh="ResponseContentType",zh="ResponseExpires",qh="RestoreExpiryDate",Hh="RequestPayer",Wh="ReplicationStatus",Kh="RestoreStatus",Vh="Restore",Qh="StartAfter",Gh="SecretAccessKey",Jh="StorageClass",Xh="SessionMode",Zh="ServerSideEncryption",Yh="SSECustomerAlgorithm",ef="SSECustomerKey",tf="SSECustomerKeyMD5",rf="SSEKMSEncryptionContext",nf="SSEKMSKeyId",of="SessionToken",sf="Size",af="Tagging",cf="TagCount",uf="VersionId",df="WriteOffsetBytes",lf="WebsiteRedirectLocation",hf="accept-ranges",ff="cache-control",pf="content-disposition",gf="content-encoding",mf="content-language",yf="content-length",vf="content-md5",bf="content-range",wf="content-type",kf="continuation-token",Sf="delimiter",Ef="expires",xf="encoding-type",Af="etag",Tf="expiresstring",Cf="fetch-owner",Rf="if-match",Of="if-modified-since",Pf="if-none-match",_f="if-unmodified-since",If="last-modified",Mf="list-type",Nf="max-keys",Ff="partNumber",$f="prefix",Uf="range",Lf="response-cache-control",Bf="response-content-disposition",Df="response-content-encoding",jf="response-content-language",zf="response-content-type",qf="response-expires",Hf="session",Wf="start-after",Kf="versionId",Vf="x-amz-acl",Qf="x-amz-bypass-governance-retention",Gf="x-amz-checksum-crc32",Jf="x-amz-checksum-crc32c",Xf="x-amz-checksum-mode",Zf="x-amz-checksum-sha1",Yf="x-amz-checksum-sha256",ep="x-amz-create-session-mode",tp="x-amz-delete-marker",rp="x-amz-expiration",np="x-amz-expected-bucket-owner",ip="x-amz-grant-full-control",op="x-amz-grant-read",sp="x-amz-grant-read-acp",ap="x-amz-grant-write-acp",cp="x-amz-if-match-last-modified-time",up="x-amz-if-match-size",dp="x-amz-mfa",lp="x-amz-missing-meta",hp="x-amz-mp-parts-count",fp="x-amz-object-lock-legal-hold",pp="x-amz-object-lock-mode",gp="x-amz-object-lock-retain-until-date",mp="x-amz-optional-object-attributes",yp="x-amz-object-size",vp="x-amz-restore",bp="x-amz-request-charged",wp="x-amz-request-payer",kp="x-amz-replication-status",Sp="x-amz-storage-class",Ep="x-amz-sdk-checksum-algorithm",xp="x-amz-server-side-encryption",Ap="x-amz-server-side-encryption-aws-kms-key-id",Tp="x-amz-server-side-encryption-bucket-key-enabled",Cp="x-amz-server-side-encryption-context",Rp="x-amz-server-side-encryption-customer-algorithm",Op="x-amz-server-side-encryption-customer-key",Pp="x-amz-server-side-encryption-customer-key-md5",_p="x-amz-tagging",Ip="x-amz-tagging-count",Mp="x-amz-version-id",Np="x-amz-write-offset-bytes",Fp="x-amz-website-redirect-location",$p="x-id";class Up extends(jt.classBuilder().ep({...Sd,DisableS3ExpressSessionAuth:{type:"staticContextParams",value:!0},Bucket:{type:"contextParams",name:"Bucket"}}).m((function(e,t,r,n){return[ge(r,this.serialize,this.deserialize),Rs(r,e.getEndpointParameterInstructions()),To(r)]})).s("AmazonS3","CreateSession",{}).n("S3Client","CreateSessionCommand").f($d,Fd).ser(Vd).de(Zd).build()){}var Lp="3.701.0";function Bp(e){return"string"==typeof e?0===e.length:0===e.byteLength}var Dp={name:"SHA-1"},jp={name:"HMAC",hash:Dp},zp=new Uint8Array([218,57,163,238,94,107,75,13,50,85,191,239,149,96,24,144,175,216,7,9]);const qp={};function Hp(){return"undefined"!=typeof window?window:"undefined"!=typeof self?self:qp}var Wp=function(){function e(e){this.toHash=new Uint8Array(0),void 0!==e&&(this.key=new Promise((function(t,r){Hp().crypto.subtle.importKey("raw",Kp(e),jp,!1,["sign"]).then(t,r)})),this.key.catch((function(){})))}return e.prototype.update=function(e){if(!Bp(e)){var t=Kp(e),r=new Uint8Array(this.toHash.byteLength+t.byteLength);r.set(this.toHash,0),r.set(t,this.toHash.byteLength),this.toHash=r}},e.prototype.digest=function(){var e=this;return this.key?this.key.then((function(t){return Hp().crypto.subtle.sign(jp,t,e.toHash).then((function(e){return new Uint8Array(e)}))})):Bp(this.toHash)?Promise.resolve(zp):Promise.resolve().then((function(){return Hp().crypto.subtle.digest(Dp,e.toHash)})).then((function(e){return Promise.resolve(new Uint8Array(e))}))},e.prototype.reset=function(){this.toHash=new Uint8Array(0)},e}();function Kp(e){return"string"==typeof e?(t=e,(new TextEncoder).encode(t)):ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength/Uint8Array.BYTES_PER_ELEMENT):new Uint8Array(e);var t}var Vp=["decrypt","digest","encrypt","exportKey","generateKey","importKey","sign","verify"];function Qp(e){return!(!function(e){if("object"==typeof e&&"object"==typeof e.crypto){return"function"==typeof e.crypto.getRandomValues}return!1}(e)||"object"!=typeof e.crypto.subtle)&&function(e){return e&&Vp.every((function(t){return"function"==typeof e[t]}))}(e.crypto.subtle)}var Gp=function(){function e(e){if(!Qp(Hp()))throw new Error("SHA1 not supported");this.hash=new Wp(e)}return e.prototype.update=function(e,t){this.hash.update(Ti(e))},e.prototype.digest=function(){return this.hash.digest()},e.prototype.reset=function(){this.hash.reset()},e}(),Jp={name:"SHA-256"},Xp={name:"HMAC",hash:Jp},Zp=new Uint8Array([227,176,196,66,152,252,28,20,154,251,244,200,153,111,185,36,39,174,65,228,100,155,147,76,164,149,153,27,120,82,184,85]),Yp=function(){function e(e){this.toHash=new Uint8Array(0),this.secret=e,this.reset()}return e.prototype.update=function(e){if(!Ci(e)){var t=Ti(e),r=new Uint8Array(this.toHash.byteLength+t.byteLength);r.set(this.toHash,0),r.set(t,this.toHash.byteLength),this.toHash=r}},e.prototype.digest=function(){var e=this;return this.key?this.key.then((function(t){return Hp().crypto.subtle.sign(Xp,t,e.toHash).then((function(e){return new Uint8Array(e)}))})):Ci(this.toHash)?Promise.resolve(Zp):Promise.resolve().then((function(){return Hp().crypto.subtle.digest(Jp,e.toHash)})).then((function(e){return Promise.resolve(new Uint8Array(e))}))},e.prototype.reset=function(){var e=this;this.toHash=new Uint8Array(0),this.secret&&void 0!==this.secret&&(this.key=new Promise((function(t,r){Hp().crypto.subtle.importKey("raw",Ti(e.secret),Xp,!1,["sign"]).then(t,r)})),this.key.catch((function(){})))},e}();function eg(e,t,r,n){return new(r||(r=Promise))((function(i,o){function s(e){try{c(n.next(e))}catch(e){o(e)}}function a(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}c((n=n.apply(e,t||[])).next())}))}function tg(e,t){var r,n,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=a(0),s.throw=a(1),s.return=a(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(c){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(o=0)),o;)try{if(r=1,n&&(i=2&a[0]?n.return:a[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,a[1])).done)return i;switch(n=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,n=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],n=0}finally{r=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}"function"==typeof SuppressedError&&SuppressedError;var rg=64,ng=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),ig=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],og=Math.pow(2,53)-1,sg=function(){function e(){this.state=Int32Array.from(ig),this.temp=new Int32Array(64),this.buffer=new Uint8Array(64),this.bufferLength=0,this.bytesHashed=0,this.finished=!1}return e.prototype.update=function(e){if(this.finished)throw new Error("Attempted to update an already finished hash.");var t=0,r=e.byteLength;if(this.bytesHashed+=r,8*this.bytesHashed>og)throw new Error("Cannot hash more than 2^53 - 1 bits");for(;r>0;)this.buffer[this.bufferLength++]=e[t++],r--,this.bufferLength===rg&&(this.hashBuffer(),this.bufferLength=0)},e.prototype.digest=function(){if(!this.finished){var e=8*this.bytesHashed,t=new DataView(this.buffer.buffer,this.buffer.byteOffset,this.buffer.byteLength),r=this.bufferLength;if(t.setUint8(this.bufferLength++,128),r%rg>=56){for(var n=this.bufferLength;n<rg;n++)t.setUint8(n,0);this.hashBuffer(),this.bufferLength=0}for(n=this.bufferLength;n<56;n++)t.setUint8(n,0);t.setUint32(56,Math.floor(e/4294967296),!0),t.setUint32(60,e),this.hashBuffer(),this.finished=!0}var i=new Uint8Array(32);for(n=0;n<8;n++)i[4*n]=this.state[n]>>>24&255,i[4*n+1]=this.state[n]>>>16&255,i[4*n+2]=this.state[n]>>>8&255,i[4*n+3]=this.state[n]>>>0&255;return i},e.prototype.hashBuffer=function(){for(var e=this.buffer,t=this.state,r=t[0],n=t[1],i=t[2],o=t[3],s=t[4],a=t[5],c=t[6],u=t[7],d=0;d<rg;d++){if(d<16)this.temp[d]=(255&e[4*d])<<24|(255&e[4*d+1])<<16|(255&e[4*d+2])<<8|255&e[4*d+3];else{var l=this.temp[d-2],h=(l>>>17|l<<15)^(l>>>19|l<<13)^l>>>10,f=((l=this.temp[d-15])>>>7|l<<25)^(l>>>18|l<<14)^l>>>3;this.temp[d]=(h+this.temp[d-7]|0)+(f+this.temp[d-16]|0)}var p=(((s>>>6|s<<26)^(s>>>11|s<<21)^(s>>>25|s<<7))+(s&a^~s&c)|0)+(u+(ng[d]+this.temp[d]|0)|0)|0,g=((r>>>2|r<<30)^(r>>>13|r<<19)^(r>>>22|r<<10))+(r&n^r&i^n&i)|0;u=c,c=a,a=s,s=o+p|0,o=i,i=n,n=r,r=p+g|0}t[0]+=r,t[1]+=n,t[2]+=i,t[3]+=o,t[4]+=s,t[5]+=a,t[6]+=c,t[7]+=u},e}(),ag=function(){function e(e){this.secret=e,this.hash=new sg,this.reset()}return e.prototype.update=function(e){if(!Ci(e)&&!this.error)try{this.hash.update(Ti(e))}catch(e){this.error=e}},e.prototype.digestSync=function(){if(this.error)throw this.error;return this.outer?(this.outer.finished||this.outer.update(this.hash.digest()),this.outer.digest()):this.hash.digest()},e.prototype.digest=function(){return eg(this,void 0,void 0,(function(){return tg(this,(function(e){return[2,this.digestSync()]}))}))},e.prototype.reset=function(){if(this.hash=new sg,this.secret){this.outer=new sg;var e=function(e){var t=Ti(e);if(t.byteLength>rg){var r=new sg;r.update(t),t=r.digest()}var n=new Uint8Array(rg);return n.set(t),n}(this.secret),t=new Uint8Array(rg);t.set(e);for(var r=0;r<rg;r++)e[r]^=54,t[r]^=92;this.hash.update(e),this.outer.update(t);for(r=0;r<e.byteLength;r++)e[r]=0}},e}();var cg=function(){function e(e){Qp(Hp())?this.hash=new Yp(e):this.hash=new ag(e)}return e.prototype.update=function(e,t){this.hash.update(Ti(e))},e.prototype.digest=function(){return this.hash.digest()},e.prototype.reset=function(){this.hash.reset()},e}(),ug={exports:{}};ug.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=90)}({17:function(e,t,r){t.__esModule=!0,t.default=void 0;var n=r(18),i=function(){function e(){}return e.getFirstMatch=function(e,t){var r=t.match(e);return r&&r.length>0&&r[1]||""},e.getSecondMatch=function(e,t){var r=t.match(e);return r&&r.length>1&&r[2]||""},e.matchAndReturnConst=function(e,t,r){if(e.test(t))return r},e.getWindowsVersionName=function(e){switch(e){case"NT":return"NT";case"XP":case"NT 5.1":return"XP";case"NT 5.0":return"2000";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}},e.getMacOSVersionName=function(e){var t=e.split(".").splice(0,2).map((function(e){return parseInt(e,10)||0}));if(t.push(0),10===t[0])switch(t[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}},e.getAndroidVersionName=function(e){var t=e.split(".").splice(0,2).map((function(e){return parseInt(e,10)||0}));if(t.push(0),!(1===t[0]&&t[1]<5))return 1===t[0]&&t[1]<6?"Cupcake":1===t[0]&&t[1]>=6?"Donut":2===t[0]&&t[1]<2?"Eclair":2===t[0]&&2===t[1]?"Froyo":2===t[0]&&t[1]>2?"Gingerbread":3===t[0]?"Honeycomb":4===t[0]&&t[1]<1?"Ice Cream Sandwich":4===t[0]&&t[1]<4?"Jelly Bean":4===t[0]&&t[1]>=4?"KitKat":5===t[0]?"Lollipop":6===t[0]?"Marshmallow":7===t[0]?"Nougat":8===t[0]?"Oreo":9===t[0]?"Pie":void 0},e.getVersionPrecision=function(e){return e.split(".").length},e.compareVersions=function(t,r,n){void 0===n&&(n=!1);var i=e.getVersionPrecision(t),o=e.getVersionPrecision(r),s=Math.max(i,o),a=0,c=e.map([t,r],(function(t){var r=s-e.getVersionPrecision(t),n=t+new Array(r+1).join(".0");return e.map(n.split("."),(function(e){return new Array(20-e.length).join("0")+e})).reverse()}));for(n&&(a=s-Math.min(i,o)),s-=1;s>=a;){if(c[0][s]>c[1][s])return 1;if(c[0][s]===c[1][s]){if(s===a)return 0;s-=1}else if(c[0][s]<c[1][s])return-1}},e.map=function(e,t){var r,n=[];if(Array.prototype.map)return Array.prototype.map.call(e,t);for(r=0;r<e.length;r+=1)n.push(t(e[r]));return n},e.find=function(e,t){var r,n;if(Array.prototype.find)return Array.prototype.find.call(e,t);for(r=0,n=e.length;r<n;r+=1){var i=e[r];if(t(i,r))return i}},e.assign=function(e){for(var t,r,n=e,i=arguments.length,o=new Array(i>1?i-1:0),s=1;s<i;s++)o[s-1]=arguments[s];if(Object.assign)return Object.assign.apply(Object,[e].concat(o));var a=function(){var e=o[t];"object"==typeof e&&null!==e&&Object.keys(e).forEach((function(t){n[t]=e[t]}))};for(t=0,r=o.length;t<r;t+=1)a();return e},e.getBrowserAlias=function(e){return n.BROWSER_ALIASES_MAP[e]},e.getBrowserTypeByAlias=function(e){return n.BROWSER_MAP[e]||""},e}();t.default=i,e.exports=t.default},18:function(e,t,r){t.__esModule=!0,t.ENGINE_MAP=t.OS_MAP=t.PLATFORMS_MAP=t.BROWSER_MAP=t.BROWSER_ALIASES_MAP=void 0,t.BROWSER_ALIASES_MAP={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},t.BROWSER_MAP={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},t.PLATFORMS_MAP={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},t.OS_MAP={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},t.ENGINE_MAP={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"}},90:function(e,t,r){t.__esModule=!0,t.default=void 0;var n,i=(n=r(91))&&n.__esModule?n:{default:n},o=r(18);function s(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var a=function(){function e(){}var t,r,n;return e.getParser=function(e,t){if(void 0===t&&(t=!1),"string"!=typeof e)throw new Error("UserAgent should be a string");return new i.default(e,t)},e.parse=function(e){return new i.default(e).getResult()},t=e,n=[{key:"BROWSER_MAP",get:function(){return o.BROWSER_MAP}},{key:"ENGINE_MAP",get:function(){return o.ENGINE_MAP}},{key:"OS_MAP",get:function(){return o.OS_MAP}},{key:"PLATFORMS_MAP",get:function(){return o.PLATFORMS_MAP}}],(r=null)&&s(t.prototype,r),n&&s(t,n),e}();t.default=a,e.exports=t.default},91:function(e,t,r){t.__esModule=!0,t.default=void 0;var n=c(r(92)),i=c(r(93)),o=c(r(94)),s=c(r(95)),a=c(r(17));function c(e){return e&&e.__esModule?e:{default:e}}var u=function(){function e(e,t){if(void 0===t&&(t=!1),null==e||""===e)throw new Error("UserAgent parameter can't be empty");this._ua=e,this.parsedResult={},!0!==t&&this.parse()}var t=e.prototype;return t.getUA=function(){return this._ua},t.test=function(e){return e.test(this._ua)},t.parseBrowser=function(){var e=this;this.parsedResult.browser={};var t=a.default.find(n.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.browser=t.describe(this.getUA())),this.parsedResult.browser},t.getBrowser=function(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()},t.getBrowserName=function(e){return e?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""},t.getBrowserVersion=function(){return this.getBrowser().version},t.getOS=function(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()},t.parseOS=function(){var e=this;this.parsedResult.os={};var t=a.default.find(i.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.os=t.describe(this.getUA())),this.parsedResult.os},t.getOSName=function(e){var t=this.getOS().name;return e?String(t).toLowerCase()||"":t||""},t.getOSVersion=function(){return this.getOS().version},t.getPlatform=function(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()},t.getPlatformType=function(e){void 0===e&&(e=!1);var t=this.getPlatform().type;return e?String(t).toLowerCase()||"":t||""},t.parsePlatform=function(){var e=this;this.parsedResult.platform={};var t=a.default.find(o.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.platform=t.describe(this.getUA())),this.parsedResult.platform},t.getEngine=function(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()},t.getEngineName=function(e){return e?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""},t.parseEngine=function(){var e=this;this.parsedResult.engine={};var t=a.default.find(s.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.engine=t.describe(this.getUA())),this.parsedResult.engine},t.parse=function(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this},t.getResult=function(){return a.default.assign({},this.parsedResult)},t.satisfies=function(e){var t=this,r={},n=0,i={},o=0;if(Object.keys(e).forEach((function(t){var s=e[t];"string"==typeof s?(i[t]=s,o+=1):"object"==typeof s&&(r[t]=s,n+=1)})),n>0){var s=Object.keys(r),c=a.default.find(s,(function(e){return t.isOS(e)}));if(c){var u=this.satisfies(r[c]);if(void 0!==u)return u}var d=a.default.find(s,(function(e){return t.isPlatform(e)}));if(d){var l=this.satisfies(r[d]);if(void 0!==l)return l}}if(o>0){var h=Object.keys(i),f=a.default.find(h,(function(e){return t.isBrowser(e,!0)}));if(void 0!==f)return this.compareVersion(i[f])}},t.isBrowser=function(e,t){void 0===t&&(t=!1);var r=this.getBrowserName().toLowerCase(),n=e.toLowerCase(),i=a.default.getBrowserTypeByAlias(n);return t&&i&&(n=i.toLowerCase()),n===r},t.compareVersion=function(e){var t=[0],r=e,n=!1,i=this.getBrowserVersion();if("string"==typeof i)return">"===e[0]||"<"===e[0]?(r=e.substr(1),"="===e[1]?(n=!0,r=e.substr(2)):t=[],">"===e[0]?t.push(1):t.push(-1)):"="===e[0]?r=e.substr(1):"~"===e[0]&&(n=!0,r=e.substr(1)),t.indexOf(a.default.compareVersions(i,r,n))>-1},t.isOS=function(e){return this.getOSName(!0)===String(e).toLowerCase()},t.isPlatform=function(e){return this.getPlatformType(!0)===String(e).toLowerCase()},t.isEngine=function(e){return this.getEngineName(!0)===String(e).toLowerCase()},t.is=function(e,t){return void 0===t&&(t=!1),this.isBrowser(e,t)||this.isOS(e)||this.isPlatform(e)},t.some=function(e){var t=this;return void 0===e&&(e=[]),e.some((function(e){return t.is(e)}))},e}();t.default=u,e.exports=t.default},92:function(e,t,r){t.__esModule=!0,t.default=void 0;var n,i=(n=r(17))&&n.__esModule?n:{default:n},o=/version\/(\d+(\.?_?\d+)+)/i,s=[{test:[/googlebot/i],describe:function(e){var t={name:"Googlebot"},r=i.default.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,e)||i.default.getFirstMatch(o,e);return r&&(t.version=r),t}},{test:[/opera/i],describe:function(e){var t={name:"Opera"},r=i.default.getFirstMatch(o,e)||i.default.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/opr\/|opios/i],describe:function(e){var t={name:"Opera"},r=i.default.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,e)||i.default.getFirstMatch(o,e);return r&&(t.version=r),t}},{test:[/SamsungBrowser/i],describe:function(e){var t={name:"Samsung Internet for Android"},r=i.default.getFirstMatch(o,e)||i.default.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/Whale/i],describe:function(e){var t={name:"NAVER Whale Browser"},r=i.default.getFirstMatch(o,e)||i.default.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/MZBrowser/i],describe:function(e){var t={name:"MZ Browser"},r=i.default.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,e)||i.default.getFirstMatch(o,e);return r&&(t.version=r),t}},{test:[/focus/i],describe:function(e){var t={name:"Focus"},r=i.default.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,e)||i.default.getFirstMatch(o,e);return r&&(t.version=r),t}},{test:[/swing/i],describe:function(e){var t={name:"Swing"},r=i.default.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,e)||i.default.getFirstMatch(o,e);return r&&(t.version=r),t}},{test:[/coast/i],describe:function(e){var t={name:"Opera Coast"},r=i.default.getFirstMatch(o,e)||i.default.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe:function(e){var t={name:"Opera Touch"},r=i.default.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,e)||i.default.getFirstMatch(o,e);return r&&(t.version=r),t}},{test:[/yabrowser/i],describe:function(e){var t={name:"Yandex Browser"},r=i.default.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,e)||i.default.getFirstMatch(o,e);return r&&(t.version=r),t}},{test:[/ucbrowser/i],describe:function(e){var t={name:"UC Browser"},r=i.default.getFirstMatch(o,e)||i.default.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/Maxthon|mxios/i],describe:function(e){var t={name:"Maxthon"},r=i.default.getFirstMatch(o,e)||i.default.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/epiphany/i],describe:function(e){var t={name:"Epiphany"},r=i.default.getFirstMatch(o,e)||i.default.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/puffin/i],describe:function(e){var t={name:"Puffin"},r=i.default.getFirstMatch(o,e)||i.default.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/sleipnir/i],describe:function(e){var t={name:"Sleipnir"},r=i.default.getFirstMatch(o,e)||i.default.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/k-meleon/i],describe:function(e){var t={name:"K-Meleon"},r=i.default.getFirstMatch(o,e)||i.default.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/micromessenger/i],describe:function(e){var t={name:"WeChat"},r=i.default.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,e)||i.default.getFirstMatch(o,e);return r&&(t.version=r),t}},{test:[/qqbrowser/i],describe:function(e){var t={name:/qqbrowserlite/i.test(e)?"QQ Browser Lite":"QQ Browser"},r=i.default.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,e)||i.default.getFirstMatch(o,e);return r&&(t.version=r),t}},{test:[/msie|trident/i],describe:function(e){var t={name:"Internet Explorer"},r=i.default.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/\sedg\//i],describe:function(e){var t={name:"Microsoft Edge"},r=i.default.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/edg([ea]|ios)/i],describe:function(e){var t={name:"Microsoft Edge"},r=i.default.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/vivaldi/i],describe:function(e){var t={name:"Vivaldi"},r=i.default.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/seamonkey/i],describe:function(e){var t={name:"SeaMonkey"},r=i.default.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/sailfish/i],describe:function(e){var t={name:"Sailfish"},r=i.default.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,e);return r&&(t.version=r),t}},{test:[/silk/i],describe:function(e){var t={name:"Amazon Silk"},r=i.default.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/phantom/i],describe:function(e){var t={name:"PhantomJS"},r=i.default.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/slimerjs/i],describe:function(e){var t={name:"SlimerJS"},r=i.default.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(e){var t={name:"BlackBerry"},r=i.default.getFirstMatch(o,e)||i.default.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/(web|hpw)[o0]s/i],describe:function(e){var t={name:"WebOS Browser"},r=i.default.getFirstMatch(o,e)||i.default.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/bada/i],describe:function(e){var t={name:"Bada"},r=i.default.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/tizen/i],describe:function(e){var t={name:"Tizen"},r=i.default.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,e)||i.default.getFirstMatch(o,e);return r&&(t.version=r),t}},{test:[/qupzilla/i],describe:function(e){var t={name:"QupZilla"},r=i.default.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,e)||i.default.getFirstMatch(o,e);return r&&(t.version=r),t}},{test:[/firefox|iceweasel|fxios/i],describe:function(e){var t={name:"Firefox"},r=i.default.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/electron/i],describe:function(e){var t={name:"Electron"},r=i.default.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/MiuiBrowser/i],describe:function(e){var t={name:"Miui"},r=i.default.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/chromium/i],describe:function(e){var t={name:"Chromium"},r=i.default.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,e)||i.default.getFirstMatch(o,e);return r&&(t.version=r),t}},{test:[/chrome|crios|crmo/i],describe:function(e){var t={name:"Chrome"},r=i.default.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/GSA/i],describe:function(e){var t={name:"Google Search"},r=i.default.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:function(e){var t=!e.test(/like android/i),r=e.test(/android/i);return t&&r},describe:function(e){var t={name:"Android Browser"},r=i.default.getFirstMatch(o,e);return r&&(t.version=r),t}},{test:[/playstation 4/i],describe:function(e){var t={name:"PlayStation 4"},r=i.default.getFirstMatch(o,e);return r&&(t.version=r),t}},{test:[/safari|applewebkit/i],describe:function(e){var t={name:"Safari"},r=i.default.getFirstMatch(o,e);return r&&(t.version=r),t}},{test:[/.*/i],describe:function(e){var t=-1!==e.search("\\(")?/^(.*)\/(.*)[ \t]\((.*)/:/^(.*)\/(.*) /;return{name:i.default.getFirstMatch(t,e),version:i.default.getSecondMatch(t,e)}}}];t.default=s,e.exports=t.default},93:function(e,t,r){t.__esModule=!0,t.default=void 0;var n,i=(n=r(17))&&n.__esModule?n:{default:n},o=r(18),s=[{test:[/Roku\/DVP/],describe:function(e){var t=i.default.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,e);return{name:o.OS_MAP.Roku,version:t}}},{test:[/windows phone/i],describe:function(e){var t=i.default.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,e);return{name:o.OS_MAP.WindowsPhone,version:t}}},{test:[/windows /i],describe:function(e){var t=i.default.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,e),r=i.default.getWindowsVersionName(t);return{name:o.OS_MAP.Windows,version:t,versionName:r}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(e){var t={name:o.OS_MAP.iOS},r=i.default.getSecondMatch(/(Version\/)(\d[\d.]+)/,e);return r&&(t.version=r),t}},{test:[/macintosh/i],describe:function(e){var t=i.default.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,e).replace(/[_\s]/g,"."),r=i.default.getMacOSVersionName(t),n={name:o.OS_MAP.MacOS,version:t};return r&&(n.versionName=r),n}},{test:[/(ipod|iphone|ipad)/i],describe:function(e){var t=i.default.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,e).replace(/[_\s]/g,".");return{name:o.OS_MAP.iOS,version:t}}},{test:function(e){var t=!e.test(/like android/i),r=e.test(/android/i);return t&&r},describe:function(e){var t=i.default.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,e),r=i.default.getAndroidVersionName(t),n={name:o.OS_MAP.Android,version:t};return r&&(n.versionName=r),n}},{test:[/(web|hpw)[o0]s/i],describe:function(e){var t=i.default.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,e),r={name:o.OS_MAP.WebOS};return t&&t.length&&(r.version=t),r}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(e){var t=i.default.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,e)||i.default.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,e)||i.default.getFirstMatch(/\bbb(\d+)/i,e);return{name:o.OS_MAP.BlackBerry,version:t}}},{test:[/bada/i],describe:function(e){var t=i.default.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,e);return{name:o.OS_MAP.Bada,version:t}}},{test:[/tizen/i],describe:function(e){var t=i.default.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,e);return{name:o.OS_MAP.Tizen,version:t}}},{test:[/linux/i],describe:function(){return{name:o.OS_MAP.Linux}}},{test:[/CrOS/],describe:function(){return{name:o.OS_MAP.ChromeOS}}},{test:[/PlayStation 4/],describe:function(e){var t=i.default.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,e);return{name:o.OS_MAP.PlayStation4,version:t}}}];t.default=s,e.exports=t.default},94:function(e,t,r){t.__esModule=!0,t.default=void 0;var n,i=(n=r(17))&&n.__esModule?n:{default:n},o=r(18),s=[{test:[/googlebot/i],describe:function(){return{type:"bot",vendor:"Google"}}},{test:[/huawei/i],describe:function(e){var t=i.default.getFirstMatch(/(can-l01)/i,e)&&"Nova",r={type:o.PLATFORMS_MAP.mobile,vendor:"Huawei"};return t&&(r.model=t),r}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:function(){return{type:o.PLATFORMS_MAP.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe:function(){return{type:o.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(){return{type:o.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe:function(){return{type:o.PLATFORMS_MAP.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe:function(){return{type:o.PLATFORMS_MAP.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe:function(){return{type:o.PLATFORMS_MAP.tablet}}},{test:function(e){var t=e.test(/ipod|iphone/i),r=e.test(/like (ipod|iphone)/i);return t&&!r},describe:function(e){var t=i.default.getFirstMatch(/(ipod|iphone)/i,e);return{type:o.PLATFORMS_MAP.mobile,vendor:"Apple",model:t}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:function(){return{type:o.PLATFORMS_MAP.mobile,vendor:"Nexus"}}},{test:[/[^-]mobi/i],describe:function(){return{type:o.PLATFORMS_MAP.mobile}}},{test:function(e){return"blackberry"===e.getBrowserName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.mobile,vendor:"BlackBerry"}}},{test:function(e){return"bada"===e.getBrowserName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.mobile}}},{test:function(e){return"windows phone"===e.getBrowserName()},describe:function(){return{type:o.PLATFORMS_MAP.mobile,vendor:"Microsoft"}}},{test:function(e){var t=Number(String(e.getOSVersion()).split(".")[0]);return"android"===e.getOSName(!0)&&t>=3},describe:function(){return{type:o.PLATFORMS_MAP.tablet}}},{test:function(e){return"android"===e.getOSName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.mobile}}},{test:function(e){return"macos"===e.getOSName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.desktop,vendor:"Apple"}}},{test:function(e){return"windows"===e.getOSName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.desktop}}},{test:function(e){return"linux"===e.getOSName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.desktop}}},{test:function(e){return"playstation 4"===e.getOSName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.tv}}},{test:function(e){return"roku"===e.getOSName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.tv}}}];t.default=s,e.exports=t.default},95:function(e,t,r){t.__esModule=!0,t.default=void 0;var n,i=(n=r(17))&&n.__esModule?n:{default:n},o=r(18),s=[{test:function(e){return"microsoft edge"===e.getBrowserName(!0)},describe:function(e){if(/\sedg\//i.test(e))return{name:o.ENGINE_MAP.Blink};var t=i.default.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,e);return{name:o.ENGINE_MAP.EdgeHTML,version:t}}},{test:[/trident/i],describe:function(e){var t={name:o.ENGINE_MAP.Trident},r=i.default.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:function(e){return e.test(/presto/i)},describe:function(e){var t={name:o.ENGINE_MAP.Presto},r=i.default.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:function(e){var t=e.test(/gecko/i),r=e.test(/like gecko/i);return t&&!r},describe:function(e){var t={name:o.ENGINE_MAP.Gecko},r=i.default.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/(apple)?webkit\/537\.36/i],describe:function(){return{name:o.ENGINE_MAP.Blink}}},{test:[/(apple)?webkit/i],describe:function(e){var t={name:o.ENGINE_MAP.WebKit},r=i.default.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}}];t.default=s,e.exports=t.default}});var dg=Jr(ug.exports);const lg=({serviceId:e,clientVersion:t})=>async r=>{const n="undefined"!=typeof window&&window?.navigator?.userAgent?dg.parse(window.navigator.userAgent):void 0,i=[["aws-sdk-js",t],["ua","2.1"],[`os/${n?.os?.name||"other"}`,n?.os?.version],["lang/js"],["md/browser",`${n?.browser?.name??"unknown"}_${n?.browser?.version??"unknown"}`]];e&&i.push([`api/${e}`,t]);const o=await(r?.userAgentAppId?.());return o&&i.push([`app/${o}`]),i};class hg{constructor(e){if(this.bytes=e,8!==e.byteLength)throw new Error("Int64 buffers must be exactly 8 bytes")}static fromNumber(e){if(e>0x8000000000000000||e<-0x8000000000000000)throw new Error(`${e} is too large (or, if negative, too small) to represent as an Int64`);const t=new Uint8Array(8);for(let r=7,n=Math.abs(Math.round(e));r>-1&&n>0;r--,n/=256)t[r]=n;return e<0&&fg(t),new hg(t)}valueOf(){const e=this.bytes.slice(0),t=128&e[0];return t&&fg(e),parseInt(De(e),16)*(t?-1:1)}toString(){return String(this.valueOf())}}function fg(e){for(let t=0;t<8;t++)e[t]^=255;for(let t=7;t>-1&&(e[t]++,0===e[t]);t--);}class pg{constructor(e,t){this.toUtf8=e,this.fromUtf8=t}format(e){const t=[];for(const r of Object.keys(e)){const n=this.fromUtf8(r);t.push(Uint8Array.from([n.byteLength]),n,this.formatHeaderValue(e[r]))}const r=new Uint8Array(t.reduce(((e,t)=>e+t.byteLength),0));let n=0;for(const e of t)r.set(e,n),n+=e.byteLength;return r}formatHeaderValue(e){switch(e.type){case"boolean":return Uint8Array.from([e.value?0:1]);case"byte":return Uint8Array.from([2,e.value]);case"short":const t=new DataView(new ArrayBuffer(3));return t.setUint8(0,3),t.setInt16(1,e.value,!1),new Uint8Array(t.buffer);case"integer":const r=new DataView(new ArrayBuffer(5));return r.setUint8(0,4),r.setInt32(1,e.value,!1),new Uint8Array(r.buffer);case"long":const n=new Uint8Array(9);return n[0]=5,n.set(e.value.bytes,1),n;case"binary":const i=new DataView(new ArrayBuffer(3+e.value.byteLength));i.setUint8(0,6),i.setUint16(1,e.value.byteLength,!1);const o=new Uint8Array(i.buffer);return o.set(e.value,3),o;case"string":const s=this.fromUtf8(e.value),a=new DataView(new ArrayBuffer(3+s.byteLength));a.setUint8(0,7),a.setUint16(1,s.byteLength,!1);const c=new Uint8Array(a.buffer);return c.set(s,3),c;case"timestamp":const u=new Uint8Array(9);return u[0]=8,u.set(hg.fromNumber(e.value.valueOf()).bytes,1),u;case"uuid":if(!Ag.test(e.value))throw new Error(`Invalid UUID received: ${e.value}`);const d=new Uint8Array(17);return d[0]=9,d.set(Be(e.value.replace(/\-/g,"")),1),d}}parse(e){const t={};let r=0;for(;r<e.byteLength;){const n=e.getUint8(r++),i=this.toUtf8(new Uint8Array(e.buffer,e.byteOffset+r,n));switch(r+=n,e.getUint8(r++)){case 0:t[i]={type:mg,value:!0};break;case 1:t[i]={type:mg,value:!1};break;case 2:t[i]={type:yg,value:e.getInt8(r++)};break;case 3:t[i]={type:vg,value:e.getInt16(r,!1)},r+=2;break;case 4:t[i]={type:bg,value:e.getInt32(r,!1)},r+=4;break;case 5:t[i]={type:wg,value:new hg(new Uint8Array(e.buffer,e.byteOffset+r,8))},r+=8;break;case 6:const n=e.getUint16(r,!1);r+=2,t[i]={type:kg,value:new Uint8Array(e.buffer,e.byteOffset+r,n)},r+=n;break;case 7:const o=e.getUint16(r,!1);r+=2,t[i]={type:Sg,value:this.toUtf8(new Uint8Array(e.buffer,e.byteOffset+r,o))},r+=o;break;case 8:t[i]={type:Eg,value:new Date(new hg(new Uint8Array(e.buffer,e.byteOffset+r,8)).valueOf())},r+=8;break;case 9:const s=new Uint8Array(e.buffer,e.byteOffset+r,16);r+=16,t[i]={type:xg,value:`${De(s.subarray(0,4))}-${De(s.subarray(4,6))}-${De(s.subarray(6,8))}-${De(s.subarray(8,10))}-${De(s.subarray(10))}`};break;default:throw new Error("Unrecognized header type tag")}}return t}}var gg;!function(e){e[e.boolTrue=0]="boolTrue",e[e.boolFalse=1]="boolFalse",e[e.byte=2]="byte",e[e.short=3]="short",e[e.integer=4]="integer",e[e.long=5]="long",e[e.byteArray=6]="byteArray",e[e.string=7]="string",e[e.timestamp=8]="timestamp",e[e.uuid=9]="uuid"}(gg||(gg={}));const mg="boolean",yg="byte",vg="short",bg="integer",wg="long",kg="binary",Sg="string",Eg="timestamp",xg="uuid",Ag=/^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$/;class Tg{constructor(e,t){this.headerMarshaller=new pg(e,t),this.messageBuffer=[],this.isEndOfStream=!1}feed(e){this.messageBuffer.push(this.decode(e))}endOfStream(){this.isEndOfStream=!0}getMessage(){const e=this.messageBuffer.pop(),t=this.isEndOfStream;return{getMessage:()=>e,isEndOfStream:()=>t}}getAvailableMessages(){const e=this.messageBuffer;this.messageBuffer=[];const t=this.isEndOfStream;return{getMessages:()=>e,isEndOfStream:()=>t}}encode({headers:e,body:t}){const r=this.headerMarshaller.format(e),n=r.byteLength+t.byteLength+16,i=new Uint8Array(n),o=new DataView(i.buffer,i.byteOffset,i.byteLength),s=new $i;return o.setUint32(0,n,!1),o.setUint32(4,r.byteLength,!1),o.setUint32(8,s.update(i.subarray(0,8)).digest(),!1),i.set(r,12),i.set(t,r.byteLength+12),o.setUint32(n-4,s.update(i.subarray(8,n-4)).digest(),!1),i}decode(e){const{headers:t,body:r}=function({byteLength:e,byteOffset:t,buffer:r}){if(e<16)throw new Error("Provided message too short to accommodate event stream message overhead");const n=new DataView(r,t,e),i=n.getUint32(0,!1);if(e!==i)throw new Error("Reported message length does not match received message length");const o=n.getUint32(4,!1),s=n.getUint32(8,!1),a=n.getUint32(e-4,!1),c=(new $i).update(new Uint8Array(r,t,8));if(s!==c.digest())throw new Error(`The prelude checksum specified in the message (${s}) does not match the calculated CRC32 checksum (${c.digest()})`);if(c.update(new Uint8Array(r,t+8,e-12)),a!==c.digest())throw new Error(`The message checksum (${c.digest()}) did not match the expected value of ${a}`);return{headers:new DataView(r,t+8+4,o),body:new Uint8Array(r,t+8+4+o,i-o-16)}}(e);return{headers:this.headerMarshaller.parse(t),body:r}}formatHeaders(e){return this.headerMarshaller.format(e)}}class Cg{constructor(e){this.options=e}[Symbol.asyncIterator](){return this.asyncIterator()}async*asyncIterator(){for await(const e of this.options.inputStream){const t=this.options.decoder.decode(e);yield t}}}class Rg{constructor(e){this.options=e}[Symbol.asyncIterator](){return this.asyncIterator()}async*asyncIterator(){for await(const e of this.options.messageStream){const t=this.options.encoder.encode(e);yield t}this.options.includeEndFrame&&(yield new Uint8Array(0))}}class Og{constructor(e){this.options=e}[Symbol.asyncIterator](){return this.asyncIterator()}async*asyncIterator(){for await(const e of this.options.messageStream){const t=await this.options.deserializer(e);void 0!==t&&(yield t)}}}class Pg{constructor(e){this.options=e}[Symbol.asyncIterator](){return this.asyncIterator()}async*asyncIterator(){for await(const e of this.options.inputStream){const t=this.options.serializer(e);yield t}}}function _g(e,t){return async function(r){const{value:n}=r.headers[":message-type"];if("error"===n){const e=new Error(r.headers[":error-message"].value||"UnknownError");throw e.name=r.headers[":error-code"].value,e}if("exception"===n){const n=r.headers[":exception-type"].value,i={[n]:r},o=await e(i);if(o.$unknown){const e=new Error(t(r.body));throw e.name=n,e}throw o[n]}if("event"===n){const t={[r.headers[":event-type"].value]:r},n=await e(t);if(n.$unknown)return;return n}throw Error(`Unrecognizable event type: ${r.headers[":event-type"].value}`)}}class Ig{constructor({utf8Encoder:e,utf8Decoder:t}){this.eventStreamCodec=new Tg(e,t),this.utfEncoder=e}deserialize(e,t){const r=function(e){let t=0,r=0,n=null,i=null;const o=e=>{if("number"!=typeof e)throw new Error("Attempted to allocate an event message where size was not a number: "+e);t=e,r=4,n=new Uint8Array(e),new DataView(n.buffer).setUint32(0,e,!1)};return{[Symbol.asyncIterator]:async function*(){const s=e[Symbol.asyncIterator]();for(;;){const{value:e,done:a}=await s.next();if(a){if(!t)return;if(t!==r)throw new Error("Truncated event message received.");return void(yield n)}const c=e.length;let u=0;for(;u<c;){if(!n){const t=c-u;i||(i=new Uint8Array(4));const n=Math.min(4-r,t);if(i.set(e.slice(u,u+n),r),r+=n,u+=n,r<4)break;o(new DataView(i.buffer).getUint32(0,!1)),i=null}const s=Math.min(t-r,c-u);n.set(e.slice(u,u+s),r),r+=s,u+=s,t&&t===r&&(yield n,n=null,t=0,r=0)}}}}}(e);return new Og({messageStream:new Cg({inputStream:r,decoder:this.eventStreamCodec}),deserializer:_g(t,this.utfEncoder)})}serialize(e,t){return new Rg({messageStream:new Pg({inputStream:e,serializer:t}),encoder:this.eventStreamCodec,includeEndFrame:!0})}}class Mg{constructor({utf8Encoder:e,utf8Decoder:t}){this.universalMarshaller=new Ig({utf8Decoder:t,utf8Encoder:e})}deserialize(e,t){const r=Ng(e)?(n=e,{[Symbol.asyncIterator]:async function*(){const e=n.getReader();try{for(;;){const{done:t,value:r}=await e.read();if(t)return;yield r}}finally{e.releaseLock()}}}):e;var n;return this.universalMarshaller.deserialize(r,t)}serialize(e,t){const r=this.universalMarshaller.serialize(e,t);return"function"==typeof ReadableStream?(e=>{const t=e[Symbol.asyncIterator]();return new ReadableStream({async pull(e){const{done:r,value:n}=await t.next();if(r)return e.close();e.enqueue(n)}})})(r):r}}const Ng=e=>"function"==typeof ReadableStream&&e instanceof ReadableStream,Fg=e=>new Mg(e);const $g=async function(e,t){const r=new e;return await async function(e,t,r=1048576){const n=e.size;let i=0;for(;i<n;){const o=e.slice(i,Math.min(n,i+r));t(new Uint8Array(await o.arrayBuffer())),i+=o.size}}(t,(e=>{r.update(e)})),r.digest()},Ug=64,Lg=[1732584193,4023233417,2562383102,271733878];class Bg{constructor(){this.reset()}update(e){if(function(e){if("string"==typeof e)return 0===e.length;return 0===e.byteLength}(e))return;if(this.finished)throw new Error("Attempted to update an already finished hash.");const t=function(e){if("string"==typeof e)return xe(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength/Uint8Array.BYTES_PER_ELEMENT);return new Uint8Array(e)}(e);let r=0,{byteLength:n}=t;for(this.bytesHashed+=n;n>0;)this.buffer.setUint8(this.bufferLength++,t[r++]),n--,this.bufferLength===Ug&&(this.hashBuffer(),this.bufferLength=0)}async digest(){if(!this.finished){const{buffer:e,bufferLength:t,bytesHashed:r}=this,n=8*r;if(e.setUint8(this.bufferLength++,128),t%Ug>=56){for(let t=this.bufferLength;t<Ug;t++)e.setUint8(t,0);this.hashBuffer(),this.bufferLength=0}for(let t=this.bufferLength;t<56;t++)e.setUint8(t,0);e.setUint32(56,n>>>0,!0),e.setUint32(60,Math.floor(n/4294967296),!0),this.hashBuffer(),this.finished=!0}const e=new DataView(new ArrayBuffer(16));for(let t=0;t<4;t++)e.setUint32(4*t,this.state[t],!0);return new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}hashBuffer(){const{buffer:e,state:t}=this;let r=t[0],n=t[1],i=t[2],o=t[3];r=jg(r,n,i,o,e.getUint32(0,!0),7,3614090360),o=jg(o,r,n,i,e.getUint32(4,!0),12,3905402710),i=jg(i,o,r,n,e.getUint32(8,!0),17,606105819),n=jg(n,i,o,r,e.getUint32(12,!0),22,3250441966),r=jg(r,n,i,o,e.getUint32(16,!0),7,4118548399),o=jg(o,r,n,i,e.getUint32(20,!0),12,1200080426),i=jg(i,o,r,n,e.getUint32(24,!0),17,2821735955),n=jg(n,i,o,r,e.getUint32(28,!0),22,4249261313),r=jg(r,n,i,o,e.getUint32(32,!0),7,1770035416),o=jg(o,r,n,i,e.getUint32(36,!0),12,2336552879),i=jg(i,o,r,n,e.getUint32(40,!0),17,4294925233),n=jg(n,i,o,r,e.getUint32(44,!0),22,2304563134),r=jg(r,n,i,o,e.getUint32(48,!0),7,1804603682),o=jg(o,r,n,i,e.getUint32(52,!0),12,4254626195),i=jg(i,o,r,n,e.getUint32(56,!0),17,2792965006),n=jg(n,i,o,r,e.getUint32(60,!0),22,1236535329),r=zg(r,n,i,o,e.getUint32(4,!0),5,4129170786),o=zg(o,r,n,i,e.getUint32(24,!0),9,3225465664),i=zg(i,o,r,n,e.getUint32(44,!0),14,643717713),n=zg(n,i,o,r,e.getUint32(0,!0),20,3921069994),r=zg(r,n,i,o,e.getUint32(20,!0),5,3593408605),o=zg(o,r,n,i,e.getUint32(40,!0),9,38016083),i=zg(i,o,r,n,e.getUint32(60,!0),14,3634488961),n=zg(n,i,o,r,e.getUint32(16,!0),20,3889429448),r=zg(r,n,i,o,e.getUint32(36,!0),5,568446438),o=zg(o,r,n,i,e.getUint32(56,!0),9,3275163606),i=zg(i,o,r,n,e.getUint32(12,!0),14,4107603335),n=zg(n,i,o,r,e.getUint32(32,!0),20,1163531501),r=zg(r,n,i,o,e.getUint32(52,!0),5,2850285829),o=zg(o,r,n,i,e.getUint32(8,!0),9,4243563512),i=zg(i,o,r,n,e.getUint32(28,!0),14,1735328473),n=zg(n,i,o,r,e.getUint32(48,!0),20,2368359562),r=qg(r,n,i,o,e.getUint32(20,!0),4,4294588738),o=qg(o,r,n,i,e.getUint32(32,!0),11,2272392833),i=qg(i,o,r,n,e.getUint32(44,!0),16,1839030562),n=qg(n,i,o,r,e.getUint32(56,!0),23,4259657740),r=qg(r,n,i,o,e.getUint32(4,!0),4,2763975236),o=qg(o,r,n,i,e.getUint32(16,!0),11,1272893353),i=qg(i,o,r,n,e.getUint32(28,!0),16,4139469664),n=qg(n,i,o,r,e.getUint32(40,!0),23,3200236656),r=qg(r,n,i,o,e.getUint32(52,!0),4,681279174),o=qg(o,r,n,i,e.getUint32(0,!0),11,3936430074),i=qg(i,o,r,n,e.getUint32(12,!0),16,3572445317),n=qg(n,i,o,r,e.getUint32(24,!0),23,76029189),r=qg(r,n,i,o,e.getUint32(36,!0),4,3654602809),o=qg(o,r,n,i,e.getUint32(48,!0),11,3873151461),i=qg(i,o,r,n,e.getUint32(60,!0),16,530742520),n=qg(n,i,o,r,e.getUint32(8,!0),23,3299628645),r=Hg(r,n,i,o,e.getUint32(0,!0),6,4096336452),o=Hg(o,r,n,i,e.getUint32(28,!0),10,1126891415),i=Hg(i,o,r,n,e.getUint32(56,!0),15,2878612391),n=Hg(n,i,o,r,e.getUint32(20,!0),21,4237533241),r=Hg(r,n,i,o,e.getUint32(48,!0),6,1700485571),o=Hg(o,r,n,i,e.getUint32(12,!0),10,2399980690),i=Hg(i,o,r,n,e.getUint32(40,!0),15,4293915773),n=Hg(n,i,o,r,e.getUint32(4,!0),21,2240044497),r=Hg(r,n,i,o,e.getUint32(32,!0),6,1873313359),o=Hg(o,r,n,i,e.getUint32(60,!0),10,4264355552),i=Hg(i,o,r,n,e.getUint32(24,!0),15,2734768916),n=Hg(n,i,o,r,e.getUint32(52,!0),21,1309151649),r=Hg(r,n,i,o,e.getUint32(16,!0),6,4149444226),o=Hg(o,r,n,i,e.getUint32(44,!0),10,3174756917),i=Hg(i,o,r,n,e.getUint32(8,!0),15,718787259),n=Hg(n,i,o,r,e.getUint32(36,!0),21,3951481745),t[0]=r+t[0]&4294967295,t[1]=n+t[1]&4294967295,t[2]=i+t[2]&4294967295,t[3]=o+t[3]&4294967295}reset(){this.state=Uint32Array.from(Lg),this.buffer=new DataView(new ArrayBuffer(Ug)),this.bufferLength=0,this.bytesHashed=0,this.finished=!1}}function Dg(e,t,r,n,i,o){return((t=(t+e&4294967295)+(n+o&4294967295)&4294967295)<<i|t>>>32-i)+r&4294967295}function jg(e,t,r,n,i,o,s){return Dg(t&r|~t&n,e,t,i,o,s)}function zg(e,t,r,n,i,o,s){return Dg(t&n|r&~n,e,t,i,o,s)}function qg(e,t,r,n,i,o,s){return Dg(t^r^n,e,t,i,o,s)}function Hg(e,t,r,n,i,o,s){return Dg(r^(t|~n),e,t,i,o,s)}const Wg="function"==typeof TextEncoder?new TextEncoder:null,Kg=e=>{if("string"==typeof e){if(Wg)return Wg.encode(e).byteLength;let t=e.length;for(let r=t-1;r>=0;r--){const n=e.charCodeAt(r);n>127&&n<=2047?t++:n>2047&&n<=65535&&(t+=2),n>=56320&&n<=57343&&r--}return t}if("number"==typeof e.byteLength)return e.byteLength;if("number"==typeof e.size)return e.size;throw new Error(`Body Length computation failed for ${e}`)},Vg=["in-region","cross-region","mobile","standard","legacy"],Qg=()=>{const e="undefined"!=typeof window&&window?.navigator?.userAgent?dg.parse(window.navigator.userAgent):void 0,t=e?.platform?.type;return"tablet"===t||"mobile"===t},Gg=e=>{const t=(({defaultsMode:e}={})=>((e,t,r)=>{let n,i,o,s=!1;const a=async()=>{i||(i=e());try{n=await i,o=!0,s=!1}finally{i=void 0}return n};return void 0===t?async e=>(o&&!e?.forceRefresh||(n=await a()),n):async e=>(o&&!e?.forceRefresh||(n=await a()),s?n:r&&!r(n)?(s=!0,n):t(n)?(await a(),n):n)})((async()=>{const t="function"==typeof e?await e():e;switch(t?.toLowerCase()){case"auto":return Promise.resolve(Qg()?"mobile":"standard");case"mobile":case"in-region":case"cross-region":case"standard":case"legacy":return Promise.resolve(t?.toLocaleLowerCase());case void 0:return Promise.resolve("legacy");default:throw new Error(`Invalid parameter for "defaultsMode", expect ${Vg.join(", ")}, got ${t}`)}})))(e),r=()=>t().then(Ir),n=(e=>({apiVersion:"2006-03-01",base64Decoder:e?.base64Decoder??Ee,base64Encoder:e?.base64Encoder??Ce,disableHostPrefix:e?.disableHostPrefix??!1,endpointProvider:e?.endpointProvider??gd,extensions:e?.extensions??[],getAwsChunkedEncodingStream:e?.getAwsChunkedEncodingStream??Oe,httpAuthSchemeProvider:e?.httpAuthSchemeProvider??wd,httpAuthSchemes:e?.httpAuthSchemes??[{schemeId:"aws.auth#sigv4",identityProvider:e=>e.getIdentityProvider("aws.auth#sigv4"),signer:new ae},{schemeId:"aws.auth#sigv4a",identityProvider:e=>e.getIdentityProvider("aws.auth#sigv4a"),signer:new ce}],logger:e?.logger??new qr,sdkStreamMixin:e?.sdkStreamMixin??qe,serviceId:e?.serviceId??"S3",signerConstructor:e?.signerConstructor??ta,signingEscapePath:e?.signingEscapePath??!1,urlParser:e?.urlParser??Es,useArnRegion:e?.useArnRegion??!1,utf8Decoder:e?.utf8Decoder??xe,utf8Encoder:e?.utf8Encoder??Te}))(e);return{...n,...e,runtime:"browser",defaultsMode:t,bodyLengthChecker:e?.bodyLengthChecker??Kg,credentialDefaultProvider:e?.credentialDefaultProvider??(e=>()=>Promise.reject(new Error("Credential is missing"))),defaultUserAgentProvider:e?.defaultUserAgentProvider??lg({serviceId:n.serviceId,clientVersion:Lp}),eventStreamSerdeProvider:e?.eventStreamSerdeProvider??Fg,maxAttempts:e?.maxAttempts??3,md5:e?.md5??Bg,region:e?.region??(i="Region is missing",()=>Promise.reject(i)),requestHandler:Fe.create(e?.requestHandler??r),retryMode:e?.retryMode??(async()=>(await r()).retryMode||Ps),sha1:e?.sha1??Gp,sha256:e?.sha256??cg,streamCollector:e?.streamCollector??$e,streamHasher:e?.streamHasher??$g,useDualstackEndpoint:e?.useDualstackEndpoint??(()=>Promise.resolve(false)),useFipsEndpoint:e?.useFipsEndpoint??(()=>Promise.resolve(false))};var i},Jg=e=>{let t=async()=>{if(void 0===e.region)throw new Error("Region is missing from runtimeConfig");const t=e.region;return"string"==typeof t?t:t()};return{setRegion(e){t=e},region:()=>t}},Xg=e=>{const t=e.httpAuthSchemes;let r=e.httpAuthSchemeProvider,n=e.credentials;return{setHttpAuthScheme(e){const r=t.findIndex((t=>t.schemeId===e.schemeId));-1===r?t.push(e):t.splice(r,1,e)},httpAuthSchemes:()=>t,setHttpAuthSchemeProvider(e){r=e},httpAuthSchemeProvider:()=>r,setCredentials(e){n=e},credentials:()=>n}},Zg=e=>({httpAuthSchemes:e.httpAuthSchemes(),httpAuthSchemeProvider:e.httpAuthSchemeProvider(),credentials:e.credentials()});class Yg extends Dt{constructor(...[e]){const t=Gg(e||{});var r;const n=function(e){const t=we(e.userAgentAppId??void 0);return{...e,customUserAgent:"string"==typeof e.customUserAgent?[[e.customUserAgent]]:e.customUserAgent,userAgentAppId:async()=>{const r=await t();if(!function(e){return void 0===e||"string"==typeof e&&e.length<=50}(r)){const t="NoOpLogger"!==e.logger?.constructor?.name&&e.logger?e.logger:console;"string"!=typeof r?t?.warn("userAgentAppId must be a string or undefined."):r.length>50&&t?.warn("The provided userAgentAppId exceeds the maximum length of 50 characters.")}return r}}}((r=t,{...r,useFipsEndpoint:r.useFipsEndpoint??!1,useDualstackEndpoint:r.useDualstackEndpoint??!1,forcePathStyle:r.forcePathStyle??!1,useAccelerateEndpoint:r.useAccelerateEndpoint??!1,useGlobalEndpoint:r.useGlobalEndpoint??!1,disableMultiregionAccessPoints:r.disableMultiregionAccessPoints??!1,defaultSigningName:"s3"}));var i;const o=(e=>({...e,eventStreamMarshaller:e.eventStreamSerdeProvider(e)}))((e=>{const t=e.tls??!0,{endpoint:r}=e,n=null!=r?async()=>xs(await de(r)()):void 0,i=!!r,o={...e,endpoint:n,tls:t,isCustomEndpoint:i,useDualstackEndpoint:de(e.useDualstackEndpoint??!1),useFipsEndpoint:de(e.useFipsEndpoint??!1)};let s;return o.serviceConfiguredEndpoint=async()=>(e.serviceId&&!s&&(s=Ss(e.serviceId)),s),o})((e=>{const{region:t,useFipsEndpoint:r}=e;if(!t)throw new Error("Region is missing");return{...e,region:async()=>{if("string"==typeof t)return hs(t);const e=await t();return hs(e)},useFipsEndpoint:async()=>{const e="string"==typeof t?t:await t();return!!ls(e)||("function"!=typeof r?Promise.resolve(!!r):r())}}})((e=>{const{retryStrategy:t}=e,r=de(e.maxAttempts??3);return{...e,maxAttempts:r,retryStrategy:async()=>t||(await de(e.retryMode)()===Os.ADAPTIVE?new Ds(r):new Bs(r))}})((i=n,{...i,requestChecksumCalculation:de(i.requestChecksumCalculation??Q),responseChecksumValidation:de(i.responseChecksumValidation??G)}))))),s=((e,{session:t})=>{const[r,n]=t;return{...e,forcePathStyle:e.forcePathStyle??!1,useAccelerateEndpoint:e.useAccelerateEndpoint??!1,disableMultiregionAccessPoints:e.disableMultiregionAccessPoints??!1,followRegionRedirects:e.followRegionRedirects??!1,s3ExpressIdentityProvider:e.s3ExpressIdentityProvider??new uo((async e=>r().send(new n({Bucket:e,SessionMode:"ReadWrite"})))),bucketEndpoint:e.bucketEndpoint??!1}})(kd(o),{session:[()=>this,Up]}),a=((e,t)=>{const r={...Jg(e),...Ur(e),...N(e),...Xg(e)};return t.forEach((e=>e.configure(r))),{...e,...(i=r,{region:i.region()}),...Lr(r),...(n=r,{httpHandler:n.httpHandler()}),...Zg(r)};var n,i})(s,e?.extensions||[]);super(a),this.config=a,this.middlewareStack.use((e=>({applyToStack:t=>{t.add(cs(e),ds)}}))(this.config)),this.middlewareStack.use(Zs(this.config)),this.middlewareStack.use(gs(this.config)),this.middlewareStack.use(Gi(this.config)),this.middlewareStack.use((this.config,{applyToStack:e=>{e.add(((e,t)=>async r=>{try{const n=await e(r),{clientName:i,commandName:o,logger:s,dynamoDbDocumentClientOptions:a={}}=t,{overrideInputFilterSensitiveLog:c,overrideOutputFilterSensitiveLog:u}=a,d=c??t.inputFilterSensitiveLog,l=u??t.outputFilterSensitiveLog,{$metadata:h,...f}=n.output;return s?.info?.({clientName:i,commandName:o,input:d(r.input),output:l(f),metadata:h}),n}catch(e){const{clientName:n,commandName:i,logger:o,dynamoDbDocumentClientOptions:s={}}=t,{overrideInputFilterSensitiveLog:a}=s,c=a??t.inputFilterSensitiveLog;throw o?.error?.({clientName:n,commandName:i,input:c(r.input),error:e,metadata:e.$metadata}),e}}),Ji)}})),this.middlewareStack.use(Yi(this.config)),this.middlewareStack.use(((e,{httpAuthSchemeParametersProvider:t,identityProviderConfigProvider:r})=>({applyToStack:n=>{n.addRelativeTo(le(e,{httpAuthSchemeParametersProvider:t,identityProviderConfigProvider:r}),he)}}))(this.config,{httpAuthSchemeParametersProvider:md,identityProviderConfigProvider:async e=>new Ze({"aws.auth#sigv4":e.credentials,"aws.auth#sigv4a":e.credentials})})),this.middlewareStack.use(be(this.config)),this.middlewareStack.use(Oo(this.config)),this.middlewareStack.use(K(this.config)),this.middlewareStack.use(io(this.config)),this.middlewareStack.use(vo(this.config)),this.middlewareStack.use((e=>({applyToStack:t=>{t.addRelativeTo(ko(e),ve)}}))(this.config))}destroy(){super.destroy()}}const em={name:"ssecMiddleware",step:"initialize",tags:["SSE"],override:!0},tm=e=>({applyToStack:t=>{var r;t.add((r=e,e=>async t=>{const n={...t.input},i=[{target:"SSECustomerKey",hash:"SSECustomerKeyMD5"},{target:"CopySourceSSECustomerKey",hash:"CopySourceSSECustomerKeyMD5"}];for(const e of i){const t=n[e.target];if(t){let i;"string"==typeof t?rm(t,r)?i=r.base64Decoder(t):(i=r.utf8Decoder(t),n[e.target]=r.base64Encoder(i)):(i=ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):new Uint8Array(t),n[e.target]=r.base64Encoder(i));const o=new r.md5;o.update(i),n[e.hash]=r.base64Encoder(await o.digest())}}return e({...t,input:n})}),em)}});function rm(e,t){if(!/^(?:[A-Za-z0-9+/]{4})*([A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e))return!1;try{return 32===t.base64Decoder(e).length}catch{return!1}}class nm extends(jt.classBuilder().ep({...Sd,Bucket:{type:"contextParams",name:"Bucket"},Key:{type:"contextParams",name:"Key"}}).m((function(e,t,r,n){return[ge(r,this.serialize,this.deserialize),Rs(r,e.getEndpointParameterInstructions()),To(r)]})).s("AmazonS3","DeleteObject",{}).n("S3Client","DeleteObjectCommand").f(void 0,void 0).ser(Qd).de(Yd).build()){}class im extends(jt.classBuilder().ep({...Sd,Bucket:{type:"contextParams",name:"Bucket"},Key:{type:"contextParams",name:"Key"}}).m((function(e,t,r,n){return[ge(r,this.serialize,this.deserialize),Rs(r,e.getEndpointParameterInstructions()),Vi(r,{requestChecksumRequired:!1,requestValidationModeMember:"ChecksumMode",responseAlgorithms:["CRC32","CRC32C","SHA256","SHA1"]}),tm(r),so()]})).s("AmazonS3","GetObject",{}).n("S3Client","GetObjectCommand").f(Ld,Ud).ser(Gd).de(el).build()){}class om extends(jt.classBuilder().ep({...Sd,Bucket:{type:"contextParams",name:"Bucket"},Prefix:{type:"contextParams",name:"Prefix"}}).m((function(e,t,r,n){return[ge(r,this.serialize,this.deserialize),Rs(r,e.getEndpointParameterInstructions()),To(r)]})).s("AmazonS3","ListObjectsV2",{}).n("S3Client","ListObjectsV2Command").f(void 0,void 0).ser(Jd).de(tl).build()){}class sm extends(jt.classBuilder().ep({...Sd,Bucket:{type:"contextParams",name:"Bucket"},Key:{type:"contextParams",name:"Key"}}).m((function(e,t,r,n){return[ge(r,this.serialize,this.deserialize),Rs(r,e.getEndpointParameterInstructions()),Vi(r,{requestAlgorithmMember:"ChecksumAlgorithm",requestAlgorithmMemberHttpHeader:"x-amz-sdk-checksum-algorithm",requestChecksumRequired:!1}),to(),To(r),tm(r)]})).s("AmazonS3","PutObject",{}).n("S3Client","PutObjectCommand").f(Kd,Wd).ser(Xd).de(rl).build()){}class am{constructor(e){this.config=e,this.taskQueue=new f(5),void 0===this.config.baseFolder?this.baseFolder="KoodoReader":this.baseFolder=this.config.baseFolder}retryOperation(e,t=0){return a(this,void 0,void 0,(function*(){let r=0;for(;;){const n=yield e();if(n)return n;if(r>=t)return this.taskQueue.hasFailedTasks=!0,this.taskQueue.clearQueue(),n;r++;const i=1e3*Math.pow(2,r);console.info(`Retry attempt ${r} after ${i}ms`),yield new Promise((e=>setTimeout(e,i)))}}))}listFiles(e){return a(this,void 0,void 0,(function*(){let{endpoint:t,region:r,bucketName:n,accessKeyId:i,secretAccessKey:o,dir:s}=this.config;s=s&&"KoodoReader"===this.baseFolder?s:this.baseFolder;let a=s+"/"+e;for(;a.startsWith("/");)a=a.substring(1);const c=new Yg({endpoint:t,region:r,credentials:{accessKeyId:i,secretAccessKey:o}});try{let e,t=[],r=!0;for(;r;){const i=yield c.send(new om({Bucket:n,Prefix:a,ContinuationToken:e}));i.Contents&&(t=t.concat(i.Contents)),e=i.NextContinuationToken,r=!!e}if(0===t.length)return[];const i=new Set;""===a||a.endsWith("/")||(a+="/");let o=t.map((e=>e.Key));for(const e of o){const t=e.substring(a.length).split("/")[0];i.add(t)}return Array.from(i)}catch(e){return console.error(e),[]}}))}deleteFile(e){return a(this,void 0,void 0,(function*(){let{endpoint:t,region:r,bucketName:n,accessKeyId:i,secretAccessKey:o,dir:s}=this.config;s=s&&"KoodoReader"===this.baseFolder?s:this.baseFolder;const a=new Yg({endpoint:t,region:r,credentials:{accessKeyId:i,secretAccessKey:o}});let c=s+"/"+e;for(;c.startsWith("/");)c=c.substring(1);try{return yield a.send(new nm({Bucket:n,Key:c})),!0}catch(e){return console.error(e),!1}}))}}class cm extends am{constructor(e){super(e)}uploadFile(e,t){return a(this,void 0,void 0,(function*(){return this.taskQueue.addTask((()=>this.retryOperation((()=>a(this,void 0,void 0,(function*(){let{endpoint:r,region:n,bucketName:i,accessKeyId:o,secretAccessKey:s,dir:a}=this.config;const c=new Yg({endpoint:r,region:n,credentials:{accessKeyId:o,secretAccessKey:s}});a=a&&"KoodoReader"===this.baseFolder?a:this.baseFolder;let u=a+"/"+t;for(;u.startsWith("/");)u=u.substring(1);try{let t=yield c.send(new sm({Bucket:i,Key:u,Body:e}));return 200===t.$metadata.httpStatusCode||(console.error("Error uploading file:",t),!1)}catch(e){return console.error("Error: ",e),!1}}))))))}))}downloadFile(e){return a(this,void 0,void 0,(function*(){return this.taskQueue.addTask((()=>this.retryOperation((()=>a(this,void 0,void 0,(function*(){let{endpoint:t,region:r,bucketName:n,accessKeyId:i,secretAccessKey:o,dir:s}=this.config;s=s&&"KoodoReader"===this.baseFolder?s:this.baseFolder;const a=new Yg({endpoint:t,region:r,credentials:{accessKeyId:i,secretAccessKey:o}});let c=s+"/"+e;for(;c.startsWith("/");)c=c.substring(1);try{const e=yield a.send(new im({Bucket:n,Key:c}));if(!e.Body)return console.error("No response body"),!1;return(yield e.Body.transformToByteArray()).buffer}catch(t){return console.error("Error downloading file:",t,e),!1}}))))))}))}}class um{constructor(e){let{username:t,password:r,url:o,dir:s}=e;void 0===e.baseFolder?this.baseFolder="KoodoReader":this.baseFolder=e.baseFolder,s=s&&"KoodoReader"===this.baseFolder?s:this.baseFolder,this.client=n(o,{authType:i.Password,username:t,password:r}),this.username=t,this.password=r,this.url=o,this.dir=s,this.taskQueue=new f(5)}retryOperation(e,t=0){return a(this,void 0,void 0,(function*(){let r=0;for(;;){const n=yield e();if(n)return n;if(r>=t)return this.taskQueue.hasFailedTasks=!0,this.taskQueue.clearQueue(),n;r++;const i=1e3*Math.pow(2,r);console.info(`Retry attempt ${r} after ${i}ms`),yield new Promise((e=>setTimeout(e,i)))}}))}uploadFile(t,r){return a(this,void 0,void 0,(function*(){return this.taskQueue.addTask((()=>this.retryOperation((()=>a(this,void 0,void 0,(function*(){try{yield this.listFiles(r.substring(0,r.lastIndexOf("/")));let n=r.split("/").pop()||"",i=new File([t],n,{lastModified:(new Date).getTime(),type:t.type}),o=this.client.getFileUploadLink(this.dir+"/"+r);const s=new URL(o);s.search="",o=s.toString();const a=btoa(this.username+":"+this.password),c=yield e.put(o,i,{headers:{Authorization:"Basic "+a},maxContentLength:1/0,maxBodyLength:1/0});return!(c.status>=300)||(console.error("Error occurred during file upload:",c),!1)}catch(e){return console.error("Error uploading file:",e),!1}}))))))}))}downloadFile(t){return a(this,void 0,void 0,(function*(){return this.taskQueue.addTask((()=>this.retryOperation((()=>a(this,void 0,void 0,(function*(){try{const r=btoa(this.username+":"+this.password);let n=this.url.endsWith("/")?this.url:this.url+"/",i=this.dir.startsWith("/")?this.dir.substring(1):this.dir;const o=yield e({url:n+i+"/"+t,method:"get",headers:{Authorization:"Basic "+r},responseType:"arraybuffer",maxContentLength:1/0,maxBodyLength:1/0});return o.status>=300?(console.error("Error occurred during file download:",o),!1):o.data}catch(e){return console.error("Error occurred during file download:",e),!1}}))))))}))}listFiles(e){return a(this,void 0,void 0,(function*(){try{return(yield this.client.getDirectoryContents(this.dir+"/"+e)).filter((t=>"."!==t.filename&&".."!==t.filename&&t.filename!==e)).map((e=>e.basename))}catch(t){return t.response&&404===t.response.status&&(yield this.client.createDirectory(this.dir+"/"+e)),console.error("Error listing files:",t),[]}}))}deleteFile(e){return a(this,void 0,void 0,(function*(){try{return yield this.client.deleteFile(this.dir+"/"+e),!0}catch(e){return console.error("Error deleting file:",e),!1}}))}}class dm{constructor(e){this.username=e.username,this.password=e.password,this.url=e.url,this.refreshTokenPromise=null,this.taskQueue=new f(3)}retryOperation(e,t=3){return a(this,void 0,void 0,(function*(){let r=0;for(;;){const n=yield e();if(n)return n;if(r>=t)return this.taskQueue.hasFailedTasks=!0,this.taskQueue.clearQueue(),n;r++;const i=1e3*Math.pow(2,r);console.info(`Retry attempt ${r} after ${i}ms`),yield new Promise((e=>setTimeout(e,i)))}}))}listFiles(t){return a(this,void 0,void 0,(function*(){try{return(yield e.get(`${this.url}/list`,{params:{dir:t},auth:{username:this.username,password:this.password}})).data.files.map((e=>e.name))||[]}catch(e){return console.error("Error listing files:",e),[]}}))}deleteFile(e){return a(this,void 0,void 0,(function*(){return this.taskQueue.addTask((()=>this.retryOperation((()=>a(this,void 0,void 0,(function*(){return yield this.deleteFileWithoutQueue(e)}))))))}))}deleteFileWithoutQueue(t){return a(this,void 0,void 0,(function*(){try{return(yield e.delete(`${this.url}/delete`,{params:{dir:t.split("/").slice(0,-1).join("/")||"",filename:t.split("/").pop()},auth:{username:this.username,password:this.password}})).data.success}catch(e){return console.error("Error deleting file:",e),!1}}))}}class lm extends dm{constructor(e){super(e)}getAuthHeader(){return`Basic ${btoa(`${this.username}:${this.password}`)}`}uploadFile(t,r){return a(this,void 0,void 0,(function*(){return this.taskQueue.addTask((()=>this.retryOperation((()=>a(this,void 0,void 0,(function*(){try{const n=r.split("/").pop()||"",i=r.substring(0,r.lastIndexOf("/"))||"";let o=new File([t],n,{lastModified:(new Date).getTime(),type:t.type});const s=new FormData;s.append("file",o);const a=yield e.post(`${this.url}/upload?dir=${encodeURIComponent(i)}`,s,{headers:{Authorization:this.getAuthHeader(),"Content-Type":"multipart/form-data"},maxContentLength:1/0,maxBodyLength:1/0});return!(a.status>=300)||(console.error("Error occurred during file upload:",a),!1)}catch(e){return console.error("Error uploading file:",e),!1}}))))))}))}downloadFile(t){return a(this,void 0,void 0,(function*(){return this.taskQueue.addTask((()=>this.retryOperation((()=>a(this,void 0,void 0,(function*(){try{const r=t.split("/").pop()||"",n=t.substring(0,t.lastIndexOf("/"))||"",i=yield e({url:`${this.url}/download`,method:"GET",params:{dir:n,filename:r},headers:{Authorization:this.getAuthHeader()},maxContentLength:1/0,maxBodyLength:1/0,responseType:"arraybuffer"});return i.status>=300?(console.error("Error occurred during file download:",i),!1):i.data}catch(e){return console.error("Error occurred during file download:",e),!1}}))))))}))}}const hm=["book","config","cover","font"];class fm{constructor(e,t,r){this.type=e,this.remote="dropbox"===e?new x(t,r):"microsoft"===e?new P(t,r):"google"===e?new T(t,r):"microsoft_exp"===e?new P(Object.assign(Object.assign({},t),{isExp:!0}),r):"google_exp"===e?new T(Object.assign(Object.assign({},t),{isExp:!0}),r):"s3compatible"===e?new cm(t):"webdav"===e?new um(t):"docker"===e?new lm(t):"boxnet"===e?new S(t,r):"mega"===e?new R(t):"adrive"===e?new w(t,r):"pcloud"===e?new M(t,r):new _}downloadFile(e,t){return a(this,void 0,void 0,(function*(){if("cover"!==t){if(!(yield this.listFiles(t)).find((t=>e.indexOf(t)>-1)))return!1}return yield this.remote.downloadFile(t+"/"+e)}))}uploadFile(e,t,r){return a(this,void 0,void 0,(function*(){return yield this.remote.uploadFile(r,t+"/"+e)}))}deleteFile(e,t){return a(this,void 0,void 0,(function*(){return!(yield this.listFiles(t)).find((t=>e.indexOf(t)>-1))||(yield this.remote.deleteFile(t+"/"+e))}))}listFiles(e){return a(this,void 0,void 0,(function*(){return yield this.remote.listFiles(e)}))}isExist(e,t){return a(this,void 0,void 0,(function*(){return(yield this.listFiles(t)).find((t=>-1!==t.indexOf(e)))}))}downloadAllFiles(){return a(this,void 0,void 0,(function*(){for(let e of hm){let t=yield this.listFiles(e);for(let r of t)yield this.downloadFile(r,e)}}))}authToken(e){return a(this,void 0,void 0,(function*(){return yield this.remote.authToken(e)}))}getAuthUrl(){return this.remote.getAuthUrl?this.remote.getAuthUrl():""}getStats(){return this.remote.taskQueue.getStats()}resetCounters(){this.remote.taskQueue.resetCounters()}}const pm={notes:"SELECT * FROM notes WHERE key = ?",bookmarks:"SELECT * FROM bookmarks WHERE key = ?",books:"SELECT * FROM books WHERE key = ?",plugins:"SELECT * FROM plugins WHERE key = ?",words:"SELECT * FROM words WHERE key = ?"},gm={notes:"SELECT * FROM notes WHERE bookKey = ?",bookmarks:"SELECT * FROM bookmarks WHERE bookKey = ?",words:"SELECT * FROM words WHERE bookKey = ?",books:"SELECT * FROM books WHERE key = ?"},mm={notes:"DELETE FROM notes WHERE bookKey = ?",bookmarks:"DELETE FROM bookmarks WHERE bookKey = ?",words:"DELETE FROM words WHERE bookKey = ?"};function ym(e){for(const t in e)e.hasOwnProperty(t)&&(e[`temp-${t}`]=e[t]);return e}const vm={notes:e=>{let t=Object.assign({},e);return t.date=JSON.parse(e.date),t.tag=JSON.parse(e.tag),t},bookmarks:e=>e,books:e=>e,plugins:e=>{let t=Object.assign({},e);return e.autoValue||delete t.autoValue,e.langList?t.langList=JSON.parse(e.langList):delete t.langList,e.voiceList?t.voiceList=JSON.parse(e.voiceList):delete t.voiceList,t.config=JSON.parse(e.config),t},words:e=>{let t=Object.assign({},e);return t.date=JSON.parse(e.date),t}};var bm,wm={sqlStatement:{createTableStatement:ym({notes:'\n      CREATE TABLE IF NOT EXISTS "notes" (\n        "key" text PRIMARY KEY,\n        "bookKey" text,\n        "date" object,\n        "chapter" text,\n        "chapterIndex" integer,\n        "text" text,\n        "cfi" text,\n        "range" text,\n        "notes" text,\n        "percentage" text,\n        "color" integer,\n        "tag" array\n      )\n    ',bookmarks:'\n      CREATE TABLE IF NOT EXISTS "bookmarks" (\n        "key" text PRIMARY KEY,\n        "bookKey" text,\n        "cfi" text,\n        "label" text,\n        "percentage" text,\n        "chapter" text\n      );\n    ',books:'\n      CREATE TABLE IF NOT EXISTS "books" (\n        "key" text PRIMARY KEY,\n        "name" text,\n        "author" text,\n        "description" text,\n        "md5" text,\n        "cover" text,\n        "format" text,\n        "publisher" text,\n        "size" integer,\n        "page" integer,\n        "path" text,\n        "charset" text\n      );\n    ',plugins:'\n      CREATE TABLE IF NOT EXISTS "plugins" (\n        "key" text PRIMARY KEY,\n        "type" text,\n        "displayName" text,\n        "icon" text,\n        "version" text,\n        "config" object,\n        "autoValue" string,\n        "langList" text,\n        "voiceList" text,\n        "scriptSHA256" text,\n        "script" text\n      );\n    ',words:'\n      CREATE TABLE IF NOT EXISTS "words" (\n        "key" text PRIMARY KEY,\n        "bookKey" text,\n        "date" object,\n        "word" text,\n        "chapter" text\n      );\n    '}),getAllStatement:ym({notes:"SELECT * FROM notes",bookmarks:"SELECT * FROM bookmarks",books:"SELECT * FROM books",plugins:"SELECT * FROM plugins",words:"SELECT * FROM words"}),saveStatement:ym({notes:"INSERT OR REPLACE INTO notes (key, bookKey, chapter, chapterIndex, text, cfi, range, notes, date, percentage, color, tag) VALUES (@key, @bookKey, @chapter, @chapterIndex, @text, @cfi, @range, @notes, @date, @percentage, @color, @tag)",bookmarks:"INSERT OR REPLACE INTO bookmarks (key, bookKey, cfi, label, percentage, chapter) VALUES (@key, @bookKey, @cfi, @label, @percentage, @chapter)",books:"INSERT OR REPLACE INTO books (key, name, author, description, md5, cover, format, publisher, size, page, path, charset) VALUES (@key, @name, @author, @description, @md5, @cover, @format, @publisher, @size, @page, @path, @charset)",plugins:"INSERT OR REPLACE INTO plugins (key, type, displayName, icon, version, config, autoValue, langList, voiceList, scriptSHA256, script) VALUES (@key, @type, @displayName, @icon, @version, @config, @autoValue, @langList, @voiceList, @scriptSHA256, @script)",words:"INSERT OR REPLACE INTO words (key, bookKey, date, word, chapter) VALUES (@key, @bookKey, @date, @word, @chapter)"}),deleteAllStatement:ym({notes:"DELETE FROM notes",bookmarks:"DELETE FROM bookmarks",books:"DELETE FROM books",plugins:"DELETE FROM plugins",words:"DELETE FROM words"}),updateStatement:ym({notes:"UPDATE notes SET bookKey = @bookKey, chapter = @chapter, chapterIndex = @chapterIndex, text = @text, cfi = @cfi, range = @range, notes = @notes, date = @date, percentage = @percentage, color = @color, tag = @tag WHERE key = @key",bookmarks:"UPDATE bookmarks SET bookKey = @bookKey, cfi = @cfi, label = @label, percentage = @percentage, chapter = @chapter WHERE key = @key",books:"UPDATE books SET name = @name, author = @author, description = @description, md5 = @md5, cover = @cover, format = @format, publisher = @publisher, size = @size, page = @page, path = @path, charset = @charset WHERE key = @key",plugins:"UPDATE plugins SET type = @type, displayName = @displayName, icon = @icon, version = @version, config = @config, autoValue = @autoValue, langList = @langList, voiceList = @voiceList, scriptSHA256 = @scriptSHA256, script = @script WHERE key = @key",words:"UPDATE words SET bookKey = @bookKey, date = @date, word = @word, chapter = @chapter WHERE key = @key"}),deleteStatement:ym({notes:"DELETE FROM notes WHERE key = ?",bookmarks:"DELETE FROM bookmarks WHERE key = ?",books:"DELETE FROM books WHERE key = ?",plugins:"DELETE FROM plugins WHERE key = ?",words:"DELETE FROM words WHERE key = ?"}),dropStatement:ym({notes:"DROP TABLE IF EXISTS notes",bookmarks:"DROP TABLE IF EXISTS bookmarks",books:"DROP TABLE IF EXISTS books",plugins:"DROP TABLE IF EXISTS plugins",words:"DROP TABLE IF EXISTS words"}),getStatement:ym(pm),getByBookKeyStatement:ym(gm),getByBookKeysStatement:ym({notes:e=>`SELECT * FROM notes WHERE bookKey IN (${e.map((()=>"?")).join(",")})`,bookmarks:e=>`SELECT * FROM bookmarks WHERE bookKey IN (${e.map((()=>"?")).join(",")})`,words:e=>`SELECT * FROM words WHERE bookKey IN (${e.map((()=>"?")).join(",")})`,books:e=>`SELECT * FROM books WHERE key IN (${e.map((()=>"?")).join(",")})`}),deleteByBookKeyStatement:ym(mm)},jsonToSqlite:ym({notes:e=>{let t=Object.assign({},e);return t.date=JSON.stringify(e.date),t.tag=JSON.stringify(e.tag),t},bookmarks:e=>e,books:e=>{let t=Object.assign({},e);return t.page=e.page||0,t},plugins:e=>{let t=Object.assign({},e);return e.autoValue||(t.autoValue=null),e.langList?t.langList=JSON.stringify(e.langList):t.langList=null,e.voiceList?t.voiceList=JSON.stringify(e.voiceList):t.voiceList=null,t.config=JSON.stringify(e.config),t},words:e=>{let t=Object.assign({},e);return t.date=JSON.stringify(e.date),t}}),sqliteToJson:ym(vm)};class km{constructor(e,t,r,n,i,o,s,a,c,u,d,l){this.key=e,this.name=t,this.author=r,this.description=n,this.md5=i,this.cover=o,this.format=s,this.publisher=a,this.size=c,this.page=u,this.path=d,this.charset=l}}class Sm{static generateBook(e,t,r,n,i,o,s){return new Promise(((c,u)=>a(this,void 0,void 0,(function*(){try{let a,u,d,l,h,f,p,g,m="";switch([u,d,h,l,f,p]=[e,"","","","",0],t){case"pdf":case"epub":case"mobi":case"azw":case"azw3":case"fb2":g=yield s.getMetadata(),[u,d,h,l,m]=[g.name||e,g.author||"",g.description||"",g.publisher||"",g.cover||""];break;case"cbr":case"cbt":case"cbz":case"cb7":g=yield s.getMetadata(),m=g.cover;break;case"txt":g=yield s.getMetadata(o),f=g.charset}let y=t.toUpperCase();a=(new Date).getTime()+"",c(new km(a,u,d,h,r,m,y,l,n,p,i,f))}catch(e){console.error(e),u(e)}}))))}}bm=Sm,Sm.getRendition=(e,t,r)=>{let n,i=t.format.toUpperCase();var o,s;return"CACHE"===i?n=new r.CacheRender(e,t):"MOBI"===i||"AZW3"===i||"AZW"===i?n=new r.MobiRender(e,t):"EPUB"===i?n=new r.EpubRender(e,t):"TXT"===i?n=new r.TxtRender(e,t):"MD"===i?n=new r.MdRender(e,t):"PDF"===i?n=new r.PdfRender(e,t):"FB2"===i?n=new r.Fb2Render(e,t):"DOCX"===i?n=new r.DocxRender(e,t):"HTML"===i||"XHTML"===i||"MHTML"===i||"HTM"===i||"XML"===i?n=new r.HtmlRender(e,t):"CBR"!==i&&"CBT"!==i&&"CBZ"!==i&&"CB7"!==i||(n=new r.ComicRender((o=e,s=new ArrayBuffer(o.byteLength),new Uint8Array(s).set(new Uint8Array(o)),s),t)),n},Sm.initMobileBook=(e,t,r,n,i,o,s,c,u)=>a(void 0,void 0,void 0,(function*(){try{window.ReactNativeWebView.postMessage(JSON.stringify({event:"user-agent",userAgent:navigator.userAgent}));const a=yield fetch(e);if(!a.ok)throw new Error(`Failed to download book: ${a.status} ${a.statusText}`);const d=yield a.arrayBuffer();window.ReactNativeWebView.postMessage(JSON.stringify({event:"finish-download"})),window.file_content=d;let l=bm.getRendition(d,{format:t,readerMode:r,charset:n,animation:i,convertChinese:o,parserRegex:s,isDarkMode:u,isMobile:"yes"},window.Kookit);window.rendition=l;let h=document.getElementById("page-area");t&&"TXT"===t.toUpperCase()?yield window.rendition.renderTo(h,c):yield window.rendition.renderTo(h),window.rendition.on("rendered",(()=>{let e=window.rendition.getPosition();window.ReactNativeWebView.postMessage(JSON.stringify({event:"content-loaded",bookLocation:e})),window.rendition.tsTransform()})),window.rendition.on("page-changed",(()=>{let e=window.rendition.getPosition();window.ReactNativeWebView.postMessage(JSON.stringify({event:"page-changed",bookLocation:e}))})),window.ReactNativeWebView.postMessage(JSON.stringify({event:"book-inited",chapterList:window.rendition.getChapter()}))}catch(e){window.ReactNativeWebView.postMessage(JSON.stringify({event:"error",message:"Parse book failed"}))}})),Sm.addMobileBook=(e,t,r,n,i,o,s="")=>a(void 0,void 0,void 0,(function*(){var a;try{if(window.ReactNativeWebView.postMessage(JSON.stringify({event:"user-agent",userAgent:navigator.userAgent})),"PDF"===r.toUpperCase()&&i>314572800){t=t.replace(/\.[^/.]+$/,"");let e=r.toUpperCase(),s=(new Date).getTime()+"",a=new km(s,t,"","",n,"",e,"",i,0,o,"");return void window.ReactNativeWebView.postMessage(JSON.stringify({event:"metadata",bookInfo:a}))}const c=yield fetch(e);if(!c.ok)throw new Error(`Failed to download book: ${c.status} ${c.statusText}`);const u=yield c.arrayBuffer();null===(a=window.ReactNativeWebView)||void 0===a||a.postMessage(JSON.stringify({event:"finish-download"})),window.file_content=u;let d=bm.getRendition(u,{format:r.toUpperCase(),readerMode:"",charset:"",animation:"",convertChinese:"no",parserRegex:s||"",isDarkMode:"no",isMobile:"yes"},window.Kookit);window.rendition=d,t=t.replace(/\.[^/.]+$/,"");let l=yield Sm.generateBook(t,r,n,i,o,u,d);if(!l||!l.key)return;window.ReactNativeWebView.postMessage(JSON.stringify({event:"metadata",bookInfo:l}))}catch(e){window.ReactNativeWebView.postMessage(JSON.stringify({event:"error",message:"Parse book failed"}))}})),Sm.precacheMobileBook=(e,t)=>a(void 0,void 0,void 0,(function*(){let r=yield window.rendition.preCache(window.file_content);if(""===r)window.ReactNativeWebView.postMessage(JSON.stringify({event:"cache",cacheBase64:"",key:t}));else if("err"!==r){try{const n=`${e}/dav/${"cache-"+t+".zip"}`,i=yield fetch(n,{method:"PUT",headers:{"Content-Type":"application/octet-stream",Overwrite:"T"},body:r});if(!i.ok)throw new Error(`: ${i.status}`);console.info("")}catch(e){console.error(":"+e)}window.ReactNativeWebView.postMessage(JSON.stringify({event:"cache",key:t}))}else window.ReactNativeWebView.postMessage(JSON.stringify({event:"error",message:"Parse book failed"}));window.file_content=null,window.rendition=null}));const Em=g.cloudUrl,xm=g.cloudCNUrl;class Am{constructor(e,t){this.TokenService=e,this.ConfigService=t,this.baseUrl="china"===t.getItem("serverRegion")?xm:Em,this.refreshToken="",this.accessToken="",this.streamPromise=null}refreshUserToken(){return a(this,void 0,void 0,(function*(){if(this.refreshToken=yield this.TokenService.getToken("refresh_token"),!this.refreshToken)return{code:401,message:"refresh token not found"};let t=(yield e.post(this.baseUrl+"/api/v1/public/user/refresh_token",{refresh_token:this.refreshToken})).data;return 200===t.code&&(yield this.TokenService.setToken("access_token",t.data.access_token),yield this.TokenService.setToken("refresh_token",t.data.refresh_token),this.accessToken=t.data.access_token,this.refreshToken=t.data.refresh_token),t}))}requestWithRetry(e){return a(this,void 0,void 0,(function*(){return Am.requestQueue||(Am.requestQueue=[]),new Promise(((t,r)=>{Am.requestQueue.push({config:e,resolve:t,reject:r}),Am.processingQueue||this.processQueue()}))}))}processQueue(){return a(this,void 0,void 0,(function*(){if(!Am.processingQueue){Am.processingQueue=!0;try{for(;Am.requestQueue.length>0;){const e=Am.requestQueue.shift();try{let t=yield this.executeRequest(e.config);e.resolve(t)}catch(t){e.reject(t)}}}finally{Am.processingQueue=!1}}}))}executeRequest(t){return a(this,void 0,void 0,(function*(){try{try{this.accessToken=(yield this.TokenService.getToken("access_token"))||""}catch(e){console.error("Error get Token:",e)}let r="req-"+Date.now().toString(36)+"-"+Math.random().toString(36).substring(2,11);if(t.baseURL=this.baseUrl,t.headers)t.headers.Authorization="Bearer "+this.accessToken,t.headers["X-Request-ID"]=r;else{let e=this.ConfigService.getItem("appVersion"),n=this.ConfigService.getItem("appPlatform");t.headers={Authorization:"Bearer "+this.accessToken,"X-Request-ID":r,"X-App-Version":e||"1.0.0","X-App-Platform":n||"web"}}let n=(yield e(t)).data;if(402===n.code){let r=yield this.refreshUserToken();if(200===r.code){return t.headers=t.headers||{},t.headers.Authorization="Bearer "+this.accessToken,(yield e(t)).data}return r}return 200!==n.code&&this.ConfigService.setItem("errorLog",JSON.stringify({request:t.data,url:t.url,result:n,requestID:r})),n}catch(e){return console.error("Request execution error:",e),{code:503,message:"network error",data:null}}}))}requestWithStream(e,t,r){return a(this,void 0,void 0,(function*(){return this.streamPromise||(this.streamPromise=(()=>a(this,void 0,void 0,(function*(){try{let n="";try{n=(yield this.TokenService.getToken("access_token"))||""}catch(e){console.error("Error get Token:",e)}let i="req-"+Date.now().toString(36)+"-"+Math.random().toString(36).substring(2,11);return new Promise(((o,s)=>{let c=this.ConfigService.getItem("appVersion"),u=this.ConfigService.getItem("appPlatform");const d=new r(this.baseUrl+e.url,{headers:{"Content-Type":"application/json",Authorization:"Bearer "+n,"X-Request-ID":i,"X-App-Version":c||"1.0.0","X-App-Platform":u||"web"},method:e.method,body:JSON.stringify(e.data),pollingInterval:0});d.addEventListener("open",(()=>{console.info("Connection to OpenAI established.")})),d.addEventListener("message",(e=>a(this,void 0,void 0,(function*(){if(!e.data)return;const r=JSON.parse(e.data);r.done?(d.close(),o(r)):(402===r.code&&(yield this.refreshUserToken()),t(r.data))})))),d.addEventListener("error",(e=>{if(console.info("Error:",e),!e.data)return;const t=JSON.parse(e.data);o(t),d.close()}))}))}finally{this.streamPromise=null}})))()),this.streamPromise}))}requestWithFetch(e,t){return a(this,void 0,void 0,(function*(){return this.streamPromise||(this.streamPromise=(()=>a(this,void 0,void 0,(function*(){try{let r="";try{r=(yield this.TokenService.getToken("access_token"))||""}catch(e){console.error("Error get Token:",e)}let n="req-"+Date.now().toString(36)+"-"+Math.random().toString(36).substring(2,11);return new Promise(((i,s)=>a(this,void 0,void 0,(function*(){let s=this.ConfigService.getItem("appVersion"),c=this.ConfigService.getItem("appPlatform");var u=new o(this.baseUrl+e.url,{headers:{"Content-Type":"text/plain",Authorization:"Bearer "+r,"X-Request-ID":n,"X-App-Version":s||"1.0.0","X-App-Platform":c||"web"},payload:JSON.stringify(e.data),method:"POST"});u.addEventListener("message",(e=>a(this,void 0,void 0,(function*(){if(!e.data)return;const r=JSON.parse(e.data);r.done?(u.close(),i(r)):(402===r.code&&(yield this.refreshUserToken()),t(r.data))})))),u.addEventListener("open",(e=>{console.info(e,"Connection to OpenAI established.")})),u.addEventListener("error",(e=>{if(console.error(e,"Error occurred while connecting to OpenAI"),!e.data)return;const t=JSON.parse(e.data);i(t),u.close()}))}))))}finally{this.streamPromise=null}})))()),this.streamPromise}))}}Am.processingQueue=!1,Am.requestQueue=[];class Tm extends Am{constructor(e,t){super(e,t)}getTransStream(e,t,r){return a(this,void 0,void 0,(function*(){const n={method:"post",url:"/api/v1/pro/reader/get_llm_trans_stream",data:e};return yield this.requestWithStream(n,t,r)}))}getTransFetch(e,t){return a(this,void 0,void 0,(function*(){const r={method:"post",url:"/api/v1/pro/reader/get_llm_trans_stream",data:e};return yield this.requestWithFetch(r,t)}))}getDictionary(e){return a(this,void 0,void 0,(function*(){const t={method:"post",url:"/api/v1/pro/reader/get_llm_dict",data:e};return yield this.requestWithRetry(t)}))}getSummaryStream(e,t,r){return a(this,void 0,void 0,(function*(){const n={method:"post",url:"/api/v1/pro/reader/get_llm_sum_stream",data:e};return yield this.requestWithStream(n,t,r)}))}getAnswerStream(e,t,r){return a(this,void 0,void 0,(function*(){const n={method:"post",url:"/api/v1/pro/reader/get_llm_answer_stream",data:e};return yield this.requestWithStream(n,t,r)}))}getAnswerFetch(e,t){return a(this,void 0,void 0,(function*(){const r={method:"post",url:"/api/v1/pro/reader/get_llm_answer_stream",data:e};return yield this.requestWithFetch(r,t)}))}getSummaryFetch(e,t){return a(this,void 0,void 0,(function*(){const r={method:"post",url:"/api/v1/pro/reader/get_llm_sum_stream",data:e};return yield this.requestWithFetch(r,t)}))}getGoogleFont(e){return a(this,void 0,void 0,(function*(){const t={method:"post",url:"/api/v1/pro/reader/get_google_font",data:e};return yield this.requestWithRetry(t)}))}sendToKindle(e){return a(this,void 0,void 0,(function*(){let t=new FormData;t.append("file",e.file),t.append("email",e.email),t.append("file_name",e.fileName);const r={method:"post",url:"/api/v1/pro/reader/send_to_kindle",headers:{"Content-Type":"multipart/form-data"},data:t};return yield this.requestWithRetry(r)}))}}class Cm extends Am{constructor(e,t){super(e,t)}encryptToken(e){return a(this,void 0,void 0,(function*(){const t={method:"post",url:"/api/v1/pro/thirdparty/encrypt_token",data:e};return yield this.requestWithRetry(t)}))}decryptToken(e){return a(this,void 0,void 0,(function*(){const t={method:"post",url:"/api/v1/pro/thirdparty/decrypt_token",data:e};return yield this.requestWithRetry(t)}))}authThirdToken(e){return a(this,void 0,void 0,(function*(){const t={method:"post",url:"/api/v1/pro/thirdparty/auth_token",data:e};return yield this.requestWithRetry(t)}))}refreshThirdToken(e){return a(this,void 0,void 0,(function*(){const t={method:"post",url:"/api/v1/pro/thirdparty/refresh_token",data:e};return yield this.requestWithRetry(t)}))}getSyncData(){return a(this,void 0,void 0,(function*(){return yield this.requestWithRetry({method:"get",url:"/api/v1/pro/thirdparty/get_sync_data"})}))}updateSyncData(e){return a(this,void 0,void 0,(function*(){const t={method:"post",url:"/api/v1/pro/thirdparty/update_sync_data",data:e};return yield this.requestWithRetry(t)}))}}class Rm extends Am{constructor(e,t){super(e,t)}loginRegister(e){return a(this,void 0,void 0,(function*(){const t={method:"post",url:"/api/v1/public/user/login_register",data:e};return yield this.requestWithRetry(t)}))}logout(){return a(this,void 0,void 0,(function*(){return yield this.requestWithRetry({method:"post",url:"/api/v1/member/user/logout"})}))}getLogins(){return a(this,void 0,void 0,(function*(){return yield this.requestWithRetry({method:"post",url:"/api/v1/member/user/get_logins"})}))}getLoginsV2(){return a(this,void 0,void 0,(function*(){return yield this.requestWithRetry({method:"post",url:"/api/v1/member/user/get_logins_v2"})}))}addLogin(e){return a(this,void 0,void 0,(function*(){const t={method:"post",url:"/api/v1/member/user/add_login",data:e};return yield this.requestWithRetry(t)}))}removeLogin(e){return a(this,void 0,void 0,(function*(){const t={method:"post",url:"/api/v1/member/user/remove_login",data:e};return yield this.requestWithRetry(t)}))}getUserInfo(){return a(this,void 0,void 0,(function*(){return yield this.requestWithRetry({method:"post",url:"/api/v1/member/user/get_info"})}))}updateUserConfig(e){return a(this,void 0,void 0,(function*(){const t={method:"post",url:"/api/v1/member/user/update_config",data:e};return yield this.requestWithRetry(t)}))}getTempToken(){return a(this,void 0,void 0,(function*(){return yield this.requestWithRetry({method:"get",url:"/api/v1/member/user/get_temp_token"})}))}getTempUuid(){return a(this,void 0,void 0,(function*(){return yield this.requestWithRetry({method:"get",url:"/api/v1/member/user/get_temp_uuid"})}))}sendEmailCode(e){return a(this,void 0,void 0,(function*(){const t={method:"post",url:"/api/v1/public/user/send_email_code",data:e};return yield this.requestWithRetry(t)}))}checkEmailRegistration(e){return a(this,void 0,void 0,(function*(){const t={method:"post",url:"/api/v1/public/user/check_email_registration",data:e};return yield this.requestWithRetry(t)}))}redeemCode(e){return a(this,void 0,void 0,(function*(){const t={method:"post",url:"/api/v1/member/user/redeem_code",data:e};return yield this.requestWithRetry(t)}))}deleteAccount(e){return a(this,void 0,void 0,(function*(){const t={method:"post",url:"/api/v1/member/user/delete_account",data:e};return yield this.requestWithRetry(t)}))}}var Om={getAuthUrl:(e,t)=>{let r="";if("github"===e?r=`https://github.com/login/oauth/authorize?client_id=${m.githubClientId}&redirect_uri=${m.callbackUrl}&scope=${y.github.scopes.join(" ")}&response_type=code`:"google"===e?r=`https://accounts.google.com/o/oauth2/v2/auth?redirect_uri=${m.callbackUrl}&prompt=consent&response_type=code&client_id=${m.googleClientId}&scope=${y.google.scopes.join(" ")}&access_type=offline`:"facebook"===e?r=`https://www.facebook.com/v12.0/dialog/oauth?client_id=${m.facebookClientId}&redirect_uri=${m.callbackUrl}&scope=&response_type=code`:"microsoft"===e&&(r=`https://login.microsoftonline.com/common/oauth2/v2.0/authorize?client_id=${m.microsoftClientId}&scope=${y.microsoft.scopes.join(" ")}&response_type=code&redirect_uri=${m.callbackUrl}`),"manual"===t)return r;let n=JSON.stringify({deeplink:"desktop"===t?"koodo-reader://callback":"browser"===t?"https://web.koodoreader.com/#/login":"",service:e});return`${r}&state=${"state|"+encodeURIComponent(n)}`}};class Pm{static CompareDatabase(e,t,r){return a(this,void 0,void 0,(function*(){let n=Object.keys(e).filter((e=>e.startsWith("database.sqlite.books"))),i=Object.keys(e).filter((e=>e.startsWith("database.sqlite.notes"))),o=Object.keys(e).filter((e=>e.startsWith("database.sqlite.bookmarks"))),s=Object.keys(e).filter((e=>e.startsWith("database.sqlite.plugins"))),a=Object.keys(e).filter((e=>e.startsWith("database.sqlite.words"))),c=Object.keys(t).filter((e=>e.startsWith("database.sqlite.books"))),u=Object.keys(t).filter((e=>e.startsWith("database.sqlite.notes"))),d=Object.keys(t).filter((e=>e.startsWith("database.sqlite.bookmarks"))),l=Object.keys(t).filter((e=>e.startsWith("database.sqlite.plugins"))),h=Object.keys(t).filter((e=>e.startsWith("database.sqlite.words"))),f={books:Array.from(new Set(n.concat(c))),notes:Array.from(new Set(i.concat(u))),bookmarks:Array.from(new Set(o.concat(d))),plugins:Array.from(new Set(s.concat(l))),words:Array.from(new Set(a.concat(h)))},p={books:{save:[],update:[],delete:[],conflict:[],upload:[]},notes:{save:[],update:[],delete:[],conflict:[],upload:[]},bookmarks:{save:[],update:[],delete:[],conflict:[],upload:[]},plugins:{save:[],update:[],delete:[],conflict:[],upload:[]},words:{save:[],update:[],delete:[],conflict:[],upload:[]}},g=["books","notes","bookmarks","plugins","words"];for(let n of g)for(let i of f[n]){let o=i.split(".")[3],s=e[i],a=t[i];s?a?("save"===a.operation&&("update"===s.operation||"delete"===s.operation?p[n].upload.push(o):console.info("ignore",a)),"delete"===a.operation&&("save"===s.operation&&(p[n].delete.push(o),e[i]=a),"update"===s.operation&&(s.time<a.time?(p[n].delete.push(o),e[i]=a):s.time>a.time?(p[n].conflict.push(o),"cloud"===r?(p[n].delete.push(o),e[i]=a):p[n].upload.push(o)):console.info("ignore",a)),"delete"===s.operation&&console.info("ignore",a)),"update"===a.operation&&("save"===s.operation&&(p[n].update.push(o),e[i]=a),"update"===s.operation&&(s.time<a.time?(p[n].update.push(o),e[i]=a):s.time>a.time?p[n].upload.push(o):console.info("ignore",a)),"delete"===s.operation&&(s.time<a.time?(p[n].conflict.push(o),"cloud"===r?(p[n].save.push(o),e[i]=a):p[n].upload.push(o)):s.time>a.time?p[n].upload.push(o):console.info("ignore",a)))):p[n].upload.push(o):(p[n].save.push(o),e[i]=a)}return{compareResult:p,syncRecords:e}}))}static CompareConfig(e,t,r){return a(this,void 0,void 0,(function*(){let n=Object.keys(e).filter((e=>e.startsWith("config.readerConfig"))),i=Object.keys(e).filter((e=>e.startsWith("config.listConfig"))),o=Object.keys(e).filter((e=>e.startsWith("config.objectConfig"))),s=Object.keys(e).filter((e=>e.startsWith("config.mapConfig"))),a=Object.keys(t).filter((e=>e.startsWith("config.readerConfig"))),c=Object.keys(t).filter((e=>e.startsWith("config.listConfig"))),u=Object.keys(t).filter((e=>e.startsWith("config.objectConfig"))),d=Object.keys(t).filter((e=>e.startsWith("config.mapConfig"))),l={readerConfig:Array.from(new Set(n.concat(a))),listConfig:Array.from(new Set(i.concat(c))),objectConfig:Array.from(new Set(o.concat(u))),mapConfig:Array.from(new Set(s.concat(d)))},h={readerConfig:{update:[],upload:[]},listConfig:{update:[],upload:[]},objectConfig:{update:[],delete:[],conflict:[],save:[],upload:[]},mapConfig:{update:[],delete:[],conflict:[],save:[],upload:[]}},f=["readerConfig","listConfig"];for(let r of f)for(let n of l[r]){let i=n,o=e[n],s=t[n];o?s?o.time<s.time?(h[r].update.push(i),e[n]=s):o.time>s.time?h[r].upload.push(i):console.info("ignore",s):h[r].upload.push(i):(h[r].update.push(i),e[n]=s)}let p=["objectConfig","mapConfig"];for(let n of p)for(let i of l[n]){let o=i,s=e[i],a=t[i];s?a?("delete"===a.operation&&("update"===s.operation&&(s.time<a.time?(h[n].delete.push(o),e[i]=a):s.time>a.time?(h[n].conflict.push(o),"cloud"===r?(h[n].delete.push(o),e[i]=a):h[n].upload.push(o)):console.info("ignore",a)),"delete"===s.operation&&console.info("ignore",a)),"update"===a.operation&&("update"===s.operation&&(s.time<a.time?(h[n].update.push(o),e[i]=a):s.time>a.time?h[n].upload.push(o):console.info("ignore",a)),"delete"===s.operation&&(s.time<a.time?(h[n].conflict.push(o),"cloud"===r?(h[n].save.push(o),e[i]=a):h[n].upload.push(o)):s.time>a.time?h[n].upload.push(o):console.info("ignore",a)))):h[n].upload.push(o):(h[n].update.push(o),e[i]=a)}return{compareResult:h,syncRecords:e}}))}static compareAll(e,t,r,n,i){return a(this,void 0,void 0,(function*(){let o="cloud";if("yes"===r.getReaderConfig("isKeepLocal")){o="local";let e=r.getObjectConfig(yield n.getFingerprint(),"cloudSyncTime",{time:0,conflictMode:"cloud"}),t=yield i.getCloudConfig("config"),s=JSON.parse(t.cloudSyncTime||"{}");delete s[yield n.getFingerprint()],Object.values(s).filter((t=>"local"===t.conflictMode&&t.time>e.time)).length>0&&(o="cloud")}let{compareResult:s,syncRecords:a}=yield this.CompareDatabase(e,t,o),{compareResult:c,syncRecords:u}=yield this.CompareConfig(a,t,o),d=Object.assign(Object.assign({},s),c);return r.setAllSyncRecord(u),"local"===o&&(d.books.conflict.length>0||d.notes.conflict.length>0||d.bookmarks.conflict.length>0||d.plugins.conflict.length>0||d.words.conflict.length>0||d.objectConfig.conflict.length>0||d.mapConfig.conflict.length>0)?r.setObjectConfig(yield n.getFingerprint(),{time:(new Date).getTime(),conflictMode:"local"},"cloudSyncTime"):r.setObjectConfig(yield n.getFingerprint(),{time:(new Date).getTime(),conflictMode:"cloud"},"cloudSyncTime"),d}))}static startSync(e,t,r,n,i,o){return a(this,void 0,void 0,(function*(){let s=yield this.syncConfig(e,t,r,i,n);if(e.books.save.length>0||e.books.upload.length>0){let e=yield this.syncCover(t,o,i),r=yield this.syncBook(t,i);return[...s,...e,...r]}return s}))}static syncConfig(e,t,r,n,i){return a(this,void 0,void 0,(function*(){let o=[];for(let t of u){if(e[t].save.length+e[t].update.length>0){let n=yield i.getCloudDatabase(t);for(let i of e[t].save){let e=n.find((e=>e.key===i));e&&(yield r.saveRecord(e,t))}for(let i of e[t].update){let e=n.find((e=>e.key===i));e&&(yield r.updateRecord(e,t,!1))}}if(e[t].delete.length>0)for(let i of e[t].delete)yield r.deleteRecord(i,t),"books"===t&&(yield n.deleteOfflineBook(i))}if(e.readerConfig.update.length>0||e.listConfig.update.length>0||e.objectConfig.update.length>0||e.mapConfig.update.length>0){let r=yield i.getCloudConfig("config");for(let n of e.readerConfig.update){let e=n.split(".")[3];r.readerConfig&&t.setReaderConfig(e,JSON.parse(r.readerConfig)[e],!1)}for(let n of e.listConfig.update){let e=n.split(".")[3];r[e]&&t.setAllListConfig(JSON.parse(r[e]),e,!1)}for(let n of e.objectConfig.update){let e=n.split(".")[3],i=n.split(".")[2];r[i]&&JSON.parse(r[i])&&JSON.parse(r[i])[e]&&t.setObjectConfig(e,JSON.parse(r[i])[e],i,!1)}for(let n of e.mapConfig.update){let e=n.split(".")[3],i=n.split(".")[2];if(r[i]&&JSON.parse(r[i])&&JSON.parse(r[i])[e]){let n=JSON.parse(r[i])[e];t.setOneMapConfig(e,n,i,!1)}}}if(e.objectConfig.delete.length>0||e.mapConfig.delete.length>0){for(let r of e.objectConfig.delete){let e=r.split(".")[3],n=r.split(".")[2];t.deleteObjectConfig(e,n)}for(let r of e.mapConfig.delete){let e=r.split(".")[3],n=r.split(".")[2];t.deleteMapConfig(e,n)}}for(let t of u)e[t].upload.length>0&&o.push((()=>i.uploadDatabase(t)));return o.push((()=>i.uploadConfig("config"))),o.push((()=>i.uploadConfig("sync"))),o}))}static syncCover(e,t,r){return a(this,void 0,void 0,(function*(){let r=yield t.getLocalCoverList(),n=yield t.getCloudCoverList(),i=Array.from(new Set([...r,...n])),o=[];for(let s of i)r.includes(s)&&!n.includes(s)&&o.push((()=>t.uploadCover(s))),!r.includes(s)&&n.includes(s)&&"adrive"!==e.getItem("defaultSyncOption")&&o.push((()=>t.downloadCover(s)));return o}))}static syncBook(e,t){return a(this,void 0,void 0,(function*(){let r=yield t.getLocalBookList(),n=yield t.getCloudBookList(),i=[],o=Array.from(new Set([...r,...n]));for(let s of o){if(r.includes(s)&&!n.includes(s)){let e=s.split(".")[0],r=s.split(".")[1];i.push((()=>t.uploadBook(e,r)))}let o="yes"===e.getReaderConfig("autoOffline");if(!r.includes(s)&&n.includes(s)&&o&&"adrive"!==e.getItem("defaultSyncOption")){let e=s.split(".")[0],r=s.split(".")[1];i.push((()=>t.offlineBook(e,r.toUpperCase())))}}return i}))}static runTasksWithLimit(e,t,r){return a(this,void 0,void 0,(function*(){if("ftp"!==r&&"adrive"!==r){const r=[],n=[];for(const i of e){const e=i().then((t=>(n.splice(n.indexOf(e),1),t)));r.push(e),n.push(e),n.length>=t&&(yield Promise.race(n))}return Promise.all(r)}for(let t of e)yield t()}))}}const _m=(Im=class{static getItem(e){return localStorage.getItem(e)}static setItem(e,t){localStorage.setItem(e,t)}static removeItem(e){localStorage.removeItem(e)}},Mm="browser",class extends Im{static getReaderConfig(e){return JSON.parse(this.getItem("readerConfig")||"{}")[e]}static setReaderConfig(e,t,r=!0){let n=JSON.parse(this.getItem("readerConfig")||"{}");n[e]=t,this.setItem("readerConfig",JSON.stringify(n)),r&&this.setSyncRecord({type:"config",catergory:"readerConfig",name:Mm,key:e},{operation:"update",time:Date.now()})}static getAllListConfig(e){return("{}"!==this.getItem(e)&&this.getItem(e)?JSON.parse(this.getItem(e)||""):[])||[]}static deleteListConfig(e,t){let r=this.getAllListConfig(t);const n=r.indexOf(e);n>-1&&r.splice(n,1),this.setAllListConfig(r,t)}static setListConfig(e,t){let r=this.getAllListConfig(t);const n=r.indexOf(e);n>-1?(r.splice(n,1),r.unshift(e)):r.unshift(e),this.setAllListConfig(r,t)}static setAllListConfig(e,t,r=!0){this.setItem(t,JSON.stringify(e)),r&&this.setSyncRecord({type:"config",catergory:"listConfig",name:"general",key:t},{operation:"update",time:Date.now()})}static setObjectConfig(e,t,r,n=!0){let i=this.getAllObjectConfig(r);i[e]=t,n&&this.setSyncRecord({type:"config",catergory:"objectConfig",name:r,key:e},{operation:"update",time:Date.now()}),this.setAllObjectConfig(i,r)}static getObjectConfig(e,t,r){return this.getAllObjectConfig(t)[e]||r}static getAllObjectConfig(e){let t=this.getItem(e);return JSON.parse(t)||{}}static setAllObjectConfig(e,t){this.setItem(t,JSON.stringify(e))}static deleteObjectConfig(e,t){let r=this.getAllObjectConfig(t);delete r[e],this.setSyncRecord({type:"config",catergory:"objectConfig",name:t,key:e},{operation:"delete",time:Date.now()}),this.setAllObjectConfig(r,t)}static getAllMapConfig(e){let t=this.getItem(e);return JSON.parse(t)||{}}static getMapConfig(e,t){return this.getAllMapConfig(t)[e]||[]}static setAllMapConfig(e,t){this.setItem(t,JSON.stringify(e))}static setMapConfig(e,t,r){let n=this.getAllMapConfig(r);void 0===n[e]&&(n[e]=[]),t&&-1===n[e].indexOf(t)&&n[e].unshift(t),this.setSyncRecord({type:"config",catergory:"mapConfig",name:r,key:e},{operation:"update",time:Date.now()}),this.setAllMapConfig(n,r)}static setOneMapConfig(e,t,r,n=!0){let i=this.getAllMapConfig(r);i[e]=t,n&&this.setSyncRecord({type:"config",catergory:"mapConfig",name:r,key:e},{operation:"update",time:Date.now()}),this.setAllMapConfig(i,r)}static deleteFromMapConfig(e,t,r){let n=this.getAllMapConfig(r),i=n[e].indexOf(t);n[e].splice(i,1),this.setSyncRecord({type:"config",catergory:"mapConfig",name:r,key:e},{operation:"update",time:Date.now()}),this.setAllMapConfig(n,r)}static deleteFromAllMapConfig(e,t){let r=this.getAllMapConfig(t);Object.keys(r).forEach((n=>{let i=r[n].indexOf(e);i>-1&&(r[n].splice(i,1),this.setSyncRecord({type:"config",catergory:"mapConfig",name:t,key:n},{operation:"update",time:Date.now()}))})),this.setAllMapConfig(r,t)}static deleteMapConfig(e,t){let r=this.getAllMapConfig(t);delete r[e],this.setSyncRecord({type:"config",catergory:"mapConfig",name:t,key:e},{operation:"delete",time:Date.now()}),this.setAllMapConfig(r,t)}static getFromAllMapConfig(e,t){let r=this.getAllMapConfig(t),n=[];for(let t in r)r[t]&&r[t].indexOf(e)>-1&&n.push(t);return n}static getSyncRecord(e){return JSON.parse(this.getItem("syncRecord")||"{}")[e.type+"."+e.catergory+"."+e.name+"."+e.key]||{operation:"",time:0}}static getAllSyncRecord(){return JSON.parse(this.getItem("syncRecord")||"{}")}static setSyncRecord(e,t){let r=JSON.parse(this.getItem("syncRecord")||"{}");r[e.type+"."+e.catergory+"."+e.name+"."+e.key]=t,this.setItem("syncRecord",JSON.stringify(r))}static setAllSyncRecord(e){this.setItem("syncRecord",JSON.stringify(e))}});var Im,Mm;class Nm{static saveAllToken(e){return a(this,void 0,void 0,(function*(){if(e)if(s){const{ipcRenderer:t}=window.require("electron");t.invoke("encrypt-data",{token:e})}else{const t=yield this.encryptString(e);localStorage.setItem("encryptedToken",t)}}))}static getAllToken(){return a(this,void 0,void 0,(function*(){if(s){const{ipcRenderer:e}=window.require("electron");return yield e.invoke("decrypt-data")}{let e=localStorage.getItem("encryptedToken")||"";return e?yield this.decryptString(e):null}}))}static setToken(e,t){return a(this,void 0,void 0,(function*(){const r=JSON.parse((yield this.getAllToken())||"{}");r[e]=t,yield this.saveAllToken(JSON.stringify(r))}))}static getToken(e){return a(this,void 0,void 0,(function*(){return JSON.parse((yield this.getAllToken())||"{}")[e]||null}))}static deleteToken(e){return a(this,void 0,void 0,(function*(){const t=JSON.parse((yield this.getAllToken())||"{}");delete t[e],yield this.saveAllToken(JSON.stringify(t))}))}static encryptString(e){return a(this,void 0,void 0,(function*(){try{let t=yield this.getFingerprint();const r=yield Um(t),n="undefined"!=typeof crypto&&crypto.subtle?yield function(e,t,r={alg:"HS256",typ:"JWT"}){return a(this,void 0,void 0,(function*(){const n=Fm((new TextEncoder).encode(JSON.stringify(r))),i=Fm((new TextEncoder).encode(JSON.stringify(e))),o=(new TextEncoder).encode(`${n}.${i}`),s=yield crypto.subtle.importKey("raw",(new TextEncoder).encode(t),{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]);return`${n}.${i}.${Fm(yield crypto.subtle.sign("HMAC",s,o))}`}))}(e,r):function(e,t){if(!e||!t)return"";const r=h((new TextEncoder).encode(t)),n=Array.from(new Uint8Array(r)),i=(new TextEncoder).encode(e),o=new Uint8Array(i.length);for(let e=0;e<i.length;e++)o[e]=i[e]^n[e%n.length];return l(o.buffer)}(e,r);return n}catch(e){return console.error("Error generating secret:",e),""}}))}static decryptString(e){return a(this,void 0,void 0,(function*(){try{let t=yield this.getFingerprint();const r=yield Um(t),n="undefined"!=typeof crypto&&crypto.subtle?yield function(e,t){return a(this,void 0,void 0,(function*(){const[r,n,i]=e.split("."),o=(new TextEncoder).encode(`${r}.${n}`),s=yield $m(i),a=yield crypto.subtle.importKey("raw",(new TextEncoder).encode(t),{name:"HMAC",hash:{name:"SHA-256"}},!1,["verify"]);if(!(yield crypto.subtle.verify("HMAC",a,s,o)))throw new Error("Invalid signature");return JSON.parse((new TextDecoder).decode($m(n)))}))}(e,r):function(e,t){if(!e||!t)return"";try{const r=h((new TextEncoder).encode(t)),n=Array.from(new Uint8Array(r)),i=d(e),o=new Uint8Array(i),s=new Uint8Array(o.length);for(let e=0;e<o.length;e++)s[e]=o[e]^n[e%n.length];return(new TextDecoder).decode(s)}catch(e){return console.error("Decryption failed:",e),""}}(e,r);return n}catch(e){return console.error("Error generating secret:",e),""}}))}static getFingerprint(){return a(this,void 0,void 0,(function*(){if(s){const{ipcRenderer:e}=window.require("electron");return yield e.invoke("get-mac")}{let e=_m.getItem("fingerPrint");if(e)return e;let t=Ks().replace(/-/g,"");return _m.setItem("fingerPrint",t),t}}))}}function Fm(e){return btoa(String.fromCharCode.apply(null,Array.from(new Uint8Array(e)))).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}function $m(e){const t=e.replace(/-/g,"+").replace(/_/g,"/"),r=atob(t),n=new Uint8Array(r.length);for(let e=0;e<r.length;e++)n[e]=r.charCodeAt(e);return n}function Um(e){return a(this,void 0,void 0,(function*(){const t=(new TextEncoder).encode(e),r=function(e){let t="";const r=new Uint8Array(e);for(let e=0;e<r.byteLength;e++)t+=String.fromCharCode(r[e]);return btoa(t)}("undefined"!=typeof crypto&&crypto.subtle?yield crypto.subtle.digest("SHA-256",t):h(t));return r}))}var Lm="1.13.7",Bm="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global||Function("return this")()||{},Dm=Array.prototype,jm=Object.prototype,zm="undefined"!=typeof Symbol?Symbol.prototype:null,qm=Dm.push,Hm=Dm.slice,Wm=jm.toString,Km=jm.hasOwnProperty,Vm="undefined"!=typeof ArrayBuffer,Qm="undefined"!=typeof DataView,Gm=Array.isArray,Jm=Object.keys,Xm=Object.create,Zm=Vm&&ArrayBuffer.isView,Ym=isNaN,ey=isFinite,ty=!{toString:null}.propertyIsEnumerable("toString"),ry=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],ny=Math.pow(2,53)-1;function iy(e,t){return t=null==t?e.length-1:+t,function(){for(var r=Math.max(arguments.length-t,0),n=Array(r),i=0;i<r;i++)n[i]=arguments[i+t];switch(t){case 0:return e.call(this,n);case 1:return e.call(this,arguments[0],n);case 2:return e.call(this,arguments[0],arguments[1],n)}var o=Array(t+1);for(i=0;i<t;i++)o[i]=arguments[i];return o[t]=n,e.apply(this,o)}}function oy(e){var t=typeof e;return"function"===t||"object"===t&&!!e}function sy(e){return void 0===e}function ay(e){return!0===e||!1===e||"[object Boolean]"===Wm.call(e)}function cy(e){var t="[object "+e+"]";return function(e){return Wm.call(e)===t}}var uy=cy("String"),dy=cy("Number"),ly=cy("Date"),hy=cy("RegExp"),fy=cy("Error"),py=cy("Symbol"),gy=cy("ArrayBuffer"),my=cy("Function"),yy=Bm.document&&Bm.document.childNodes;"function"!=typeof/./&&"object"!=typeof Int8Array&&"function"!=typeof yy&&(my=function(e){return"function"==typeof e||!1});var vy=my,by=cy("Object"),wy=Qm&&(!/\[native code\]/.test(String(DataView))||by(new DataView(new ArrayBuffer(8)))),ky="undefined"!=typeof Map&&by(new Map),Sy=cy("DataView");var Ey=wy?function(e){return null!=e&&vy(e.getInt8)&&gy(e.buffer)}:Sy,xy=Gm||cy("Array");function Ay(e,t){return null!=e&&Km.call(e,t)}var Ty=cy("Arguments");!function(){Ty(arguments)||(Ty=function(e){return Ay(e,"callee")})}();var Cy=Ty;function Ry(e){return dy(e)&&Ym(e)}function Oy(e){return function(){return e}}function Py(e){return function(t){var r=e(t);return"number"==typeof r&&r>=0&&r<=ny}}function _y(e){return function(t){return null==t?void 0:t[e]}}var Iy=_y("byteLength"),My=Py(Iy),Ny=/\[object ((I|Ui)nt(8|16|32)|Float(32|64)|Uint8Clamped|Big(I|Ui)nt64)Array\]/;var Fy=Vm?function(e){return Zm?Zm(e)&&!Ey(e):My(e)&&Ny.test(Wm.call(e))}:Oy(!1),$y=_y("length");function Uy(e,t){t=function(e){for(var t={},r=e.length,n=0;n<r;++n)t[e[n]]=!0;return{contains:function(e){return!0===t[e]},push:function(r){return t[r]=!0,e.push(r)}}}(t);var r=ry.length,n=e.constructor,i=vy(n)&&n.prototype||jm,o="constructor";for(Ay(e,o)&&!t.contains(o)&&t.push(o);r--;)(o=ry[r])in e&&e[o]!==i[o]&&!t.contains(o)&&t.push(o)}function Ly(e){if(!oy(e))return[];if(Jm)return Jm(e);var t=[];for(var r in e)Ay(e,r)&&t.push(r);return ty&&Uy(e,t),t}function By(e,t){var r=Ly(t),n=r.length;if(null==e)return!n;for(var i=Object(e),o=0;o<n;o++){var s=r[o];if(t[s]!==i[s]||!(s in i))return!1}return!0}function Dy(e){return e instanceof Dy?e:this instanceof Dy?void(this._wrapped=e):new Dy(e)}function jy(e){return new Uint8Array(e.buffer||e,e.byteOffset||0,Iy(e))}Dy.VERSION=Lm,Dy.prototype.value=function(){return this._wrapped},Dy.prototype.valueOf=Dy.prototype.toJSON=Dy.prototype.value,Dy.prototype.toString=function(){return String(this._wrapped)};var zy="[object DataView]";function qy(e,t,r,n){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return!1;if(e!=e)return t!=t;var i=typeof e;return("function"===i||"object"===i||"object"==typeof t)&&Hy(e,t,r,n)}function Hy(e,t,r,n){e instanceof Dy&&(e=e._wrapped),t instanceof Dy&&(t=t._wrapped);var i=Wm.call(e);if(i!==Wm.call(t))return!1;if(wy&&"[object Object]"==i&&Ey(e)){if(!Ey(t))return!1;i=zy}switch(i){case"[object RegExp]":case"[object String]":return""+e==""+t;case"[object Number]":return+e!=+e?+t!=+t:0==+e?1/+e==1/t:+e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object Symbol]":return zm.valueOf.call(e)===zm.valueOf.call(t);case"[object ArrayBuffer]":case zy:return Hy(jy(e),jy(t),r,n)}var o="[object Array]"===i;if(!o&&Fy(e)){if(Iy(e)!==Iy(t))return!1;if(e.buffer===t.buffer&&e.byteOffset===t.byteOffset)return!0;o=!0}if(!o){if("object"!=typeof e||"object"!=typeof t)return!1;var s=e.constructor,a=t.constructor;if(s!==a&&!(vy(s)&&s instanceof s&&vy(a)&&a instanceof a)&&"constructor"in e&&"constructor"in t)return!1}n=n||[];for(var c=(r=r||[]).length;c--;)if(r[c]===e)return n[c]===t;if(r.push(e),n.push(t),o){if((c=e.length)!==t.length)return!1;for(;c--;)if(!qy(e[c],t[c],r,n))return!1}else{var u,d=Ly(e);if(c=d.length,Ly(t).length!==c)return!1;for(;c--;)if(!Ay(t,u=d[c])||!qy(e[u],t[u],r,n))return!1}return r.pop(),n.pop(),!0}function Wy(e){if(!oy(e))return[];var t=[];for(var r in e)t.push(r);return ty&&Uy(e,t),t}function Ky(e){var t=$y(e);return function(r){if(null==r)return!1;var n=Wy(r);if($y(n))return!1;for(var i=0;i<t;i++)if(!vy(r[e[i]]))return!1;return e!==Xy||!vy(r[Vy])}}var Vy="forEach",Qy=["clear","delete"],Gy=["get","has","set"],Jy=Qy.concat(Vy,Gy),Xy=Qy.concat(Gy),Zy=["add"].concat(Qy,Vy,"has"),Yy=ky?Ky(Jy):cy("Map"),ev=ky?Ky(Xy):cy("WeakMap"),tv=ky?Ky(Zy):cy("Set"),rv=cy("WeakSet");function nv(e){for(var t=Ly(e),r=t.length,n=Array(r),i=0;i<r;i++)n[i]=e[t[i]];return n}function iv(e){for(var t={},r=Ly(e),n=0,i=r.length;n<i;n++)t[e[r[n]]]=r[n];return t}function ov(e){var t=[];for(var r in e)vy(e[r])&&t.push(r);return t.sort()}function sv(e,t){return function(r){var n=arguments.length;if(t&&(r=Object(r)),n<2||null==r)return r;for(var i=1;i<n;i++)for(var o=arguments[i],s=e(o),a=s.length,c=0;c<a;c++){var u=s[c];t&&void 0!==r[u]||(r[u]=o[u])}return r}}var av=sv(Wy),cv=sv(Ly),uv=sv(Wy,!0);function dv(e){if(!oy(e))return{};if(Xm)return Xm(e);var t=function(){};t.prototype=e;var r=new t;return t.prototype=null,r}function lv(e){return xy(e)?e:[e]}function hv(e){return Dy.toPath(e)}function fv(e,t){for(var r=t.length,n=0;n<r;n++){if(null==e)return;e=e[t[n]]}return r?e:void 0}function pv(e,t,r){var n=fv(e,hv(t));return sy(n)?r:n}function gv(e){return e}function mv(e){return e=cv({},e),function(t){return By(t,e)}}function yv(e){return e=hv(e),function(t){return fv(t,e)}}function vv(e,t,r){if(void 0===t)return e;switch(null==r?3:r){case 1:return function(r){return e.call(t,r)};case 3:return function(r,n,i){return e.call(t,r,n,i)};case 4:return function(r,n,i,o){return e.call(t,r,n,i,o)}}return function(){return e.apply(t,arguments)}}function bv(e,t,r){return null==e?gv:vy(e)?vv(e,t,r):oy(e)&&!xy(e)?mv(e):yv(e)}function wv(e,t){return bv(e,t,1/0)}function kv(e,t,r){return Dy.iteratee!==wv?Dy.iteratee(e,t):bv(e,t,r)}function Sv(){}function Ev(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))}Dy.toPath=lv,Dy.iteratee=wv;var xv=Date.now||function(){return(new Date).getTime()};function Av(e){var t=function(t){return e[t]},r="(?:"+Ly(e).join("|")+")",n=RegExp(r),i=RegExp(r,"g");return function(e){return e=null==e?"":""+e,n.test(e)?e.replace(i,t):e}}var Tv={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},Cv=Av(Tv),Rv=Av(iv(Tv)),Ov=Dy.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g},Pv=/(.)^/,_v={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},Iv=/\\|'|\r|\n|\u2028|\u2029/g;function Mv(e){return"\\"+_v[e]}var Nv=/^\s*(\w|\$)+\s*$/;var Fv=0;function $v(e,t,r,n,i){if(!(n instanceof t))return e.apply(r,i);var o=dv(e.prototype),s=e.apply(o,i);return oy(s)?s:o}var Uv=iy((function(e,t){var r=Uv.placeholder,n=function(){for(var i=0,o=t.length,s=Array(o),a=0;a<o;a++)s[a]=t[a]===r?arguments[i++]:t[a];for(;i<arguments.length;)s.push(arguments[i++]);return $v(e,n,this,this,s)};return n}));Uv.placeholder=Dy;var Lv=iy((function(e,t,r){if(!vy(e))throw new TypeError("Bind must be called on a function");var n=iy((function(i){return $v(e,n,t,this,r.concat(i))}));return n})),Bv=Py($y);function Dv(e,t,r,n){if(n=n||[],t||0===t){if(t<=0)return n.concat(e)}else t=1/0;for(var i=n.length,o=0,s=$y(e);o<s;o++){var a=e[o];if(Bv(a)&&(xy(a)||Cy(a)))if(t>1)Dv(a,t-1,r,n),i=n.length;else for(var c=0,u=a.length;c<u;)n[i++]=a[c++];else r||(n[i++]=a)}return n}var jv=iy((function(e,t){var r=(t=Dv(t,!1,!1)).length;if(r<1)throw new Error("bindAll must be passed function names");for(;r--;){var n=t[r];e[n]=Lv(e[n],e)}return e}));var zv=iy((function(e,t,r){return setTimeout((function(){return e.apply(null,r)}),t)})),qv=Uv(zv,Dy,1);function Hv(e){return function(){return!e.apply(this,arguments)}}function Wv(e,t){var r;return function(){return--e>0&&(r=t.apply(this,arguments)),e<=1&&(t=null),r}}var Kv=Uv(Wv,2);function Vv(e,t,r){t=kv(t,r);for(var n,i=Ly(e),o=0,s=i.length;o<s;o++)if(t(e[n=i[o]],n,e))return n}function Qv(e){return function(t,r,n){r=kv(r,n);for(var i=$y(t),o=e>0?0:i-1;o>=0&&o<i;o+=e)if(r(t[o],o,t))return o;return-1}}var Gv=Qv(1),Jv=Qv(-1);function Xv(e,t,r,n){for(var i=(r=kv(r,n,1))(t),o=0,s=$y(e);o<s;){var a=Math.floor((o+s)/2);r(e[a])<i?o=a+1:s=a}return o}function Zv(e,t,r){return function(n,i,o){var s=0,a=$y(n);if("number"==typeof o)e>0?s=o>=0?o:Math.max(o+a,s):a=o>=0?Math.min(o+1,a):o+a+1;else if(r&&o&&a)return n[o=r(n,i)]===i?o:-1;if(i!=i)return(o=t(Hm.call(n,s,a),Ry))>=0?o+s:-1;for(o=e>0?s:a-1;o>=0&&o<a;o+=e)if(n[o]===i)return o;return-1}}var Yv=Zv(1,Gv,Xv),eb=Zv(-1,Jv);function tb(e,t,r){var n=(Bv(e)?Gv:Vv)(e,t,r);if(void 0!==n&&-1!==n)return e[n]}function rb(e,t,r){var n,i;if(t=vv(t,r),Bv(e))for(n=0,i=e.length;n<i;n++)t(e[n],n,e);else{var o=Ly(e);for(n=0,i=o.length;n<i;n++)t(e[o[n]],o[n],e)}return e}function nb(e,t,r){t=kv(t,r);for(var n=!Bv(e)&&Ly(e),i=(n||e).length,o=Array(i),s=0;s<i;s++){var a=n?n[s]:s;o[s]=t(e[a],a,e)}return o}function ib(e){return function(t,r,n,i){var o=arguments.length>=3;return function(t,r,n,i){var o=!Bv(t)&&Ly(t),s=(o||t).length,a=e>0?0:s-1;for(i||(n=t[o?o[a]:a],a+=e);a>=0&&a<s;a+=e){var c=o?o[a]:a;n=r(n,t[c],c,t)}return n}(t,vv(r,i,4),n,o)}}var ob=ib(1),sb=ib(-1);function ab(e,t,r){var n=[];return t=kv(t,r),rb(e,(function(e,r,i){t(e,r,i)&&n.push(e)})),n}function cb(e,t,r){t=kv(t,r);for(var n=!Bv(e)&&Ly(e),i=(n||e).length,o=0;o<i;o++){var s=n?n[o]:o;if(!t(e[s],s,e))return!1}return!0}function ub(e,t,r){t=kv(t,r);for(var n=!Bv(e)&&Ly(e),i=(n||e).length,o=0;o<i;o++){var s=n?n[o]:o;if(t(e[s],s,e))return!0}return!1}function db(e,t,r,n){return Bv(e)||(e=nv(e)),("number"!=typeof r||n)&&(r=0),Yv(e,t,r)>=0}var lb=iy((function(e,t,r){var n,i;return vy(t)?i=t:(t=hv(t),n=t.slice(0,-1),t=t[t.length-1]),nb(e,(function(e){var o=i;if(!o){if(n&&n.length&&(e=fv(e,n)),null==e)return;o=e[t]}return null==o?o:o.apply(e,r)}))}));function hb(e,t){return nb(e,yv(t))}function fb(e,t,r){var n,i,o=-1/0,s=-1/0;if(null==t||"number"==typeof t&&"object"!=typeof e[0]&&null!=e)for(var a=0,c=(e=Bv(e)?e:nv(e)).length;a<c;a++)null!=(n=e[a])&&n>o&&(o=n);else t=kv(t,r),rb(e,(function(e,r,n){((i=t(e,r,n))>s||i===-1/0&&o===-1/0)&&(o=e,s=i)}));return o}var pb=/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g;function gb(e){return e?xy(e)?Hm.call(e):uy(e)?e.match(pb):Bv(e)?nb(e,gv):nv(e):[]}function mb(e,t,r){if(null==t||r)return Bv(e)||(e=nv(e)),e[Ev(e.length-1)];var n=gb(e),i=$y(n);t=Math.max(Math.min(t,i),0);for(var o=i-1,s=0;s<t;s++){var a=Ev(s,o),c=n[s];n[s]=n[a],n[a]=c}return n.slice(0,t)}function yb(e,t){return function(r,n,i){var o=t?[[],[]]:{};return n=kv(n,i),rb(r,(function(t,i){var s=n(t,i,r);e(o,t,s)})),o}}var vb=yb((function(e,t,r){Ay(e,r)?e[r].push(t):e[r]=[t]})),bb=yb((function(e,t,r){e[r]=t})),wb=yb((function(e,t,r){Ay(e,r)?e[r]++:e[r]=1})),kb=yb((function(e,t,r){e[r?0:1].push(t)}),!0);function Sb(e,t,r){return t in r}var Eb=iy((function(e,t){var r={},n=t[0];if(null==e)return r;vy(n)?(t.length>1&&(n=vv(n,t[1])),t=Wy(e)):(n=Sb,t=Dv(t,!1,!1),e=Object(e));for(var i=0,o=t.length;i<o;i++){var s=t[i],a=e[s];n(a,s,e)&&(r[s]=a)}return r})),xb=iy((function(e,t){var r,n=t[0];return vy(n)?(n=Hv(n),t.length>1&&(r=t[1])):(t=nb(Dv(t,!1,!1),String),n=function(e,r){return!db(t,r)}),Eb(e,n,r)}));function Ab(e,t,r){return Hm.call(e,0,Math.max(0,e.length-(null==t||r?1:t)))}function Tb(e,t,r){return null==e||e.length<1?null==t||r?void 0:[]:null==t||r?e[0]:Ab(e,e.length-t)}function Cb(e,t,r){return Hm.call(e,null==t||r?1:t)}var Rb=iy((function(e,t){return t=Dv(t,!0,!0),ab(e,(function(e){return!db(t,e)}))})),Ob=iy((function(e,t){return Rb(e,t)}));function Pb(e,t,r,n){ay(t)||(n=r,r=t,t=!1),null!=r&&(r=kv(r,n));for(var i=[],o=[],s=0,a=$y(e);s<a;s++){var c=e[s],u=r?r(c,s,e):c;t&&!r?(s&&o===u||i.push(c),o=u):r?db(o,u)||(o.push(u),i.push(c)):db(i,c)||i.push(c)}return i}var _b=iy((function(e){return Pb(Dv(e,!0,!0))}));function Ib(e){for(var t=e&&fb(e,$y).length||0,r=Array(t),n=0;n<t;n++)r[n]=hb(e,n);return r}var Mb=iy(Ib);function Nb(e,t){return e._chain?Dy(t).chain():t}function Fb(e){return rb(ov(e),(function(t){var r=Dy[t]=e[t];Dy.prototype[t]=function(){var e=[this._wrapped];return qm.apply(e,arguments),Nb(this,r.apply(Dy,e))}})),Dy}rb(["pop","push","reverse","shift","sort","splice","unshift"],(function(e){var t=Dm[e];Dy.prototype[e]=function(){var r=this._wrapped;return null!=r&&(t.apply(r,arguments),"shift"!==e&&"splice"!==e||0!==r.length||delete r[0]),Nb(this,r)}})),rb(["concat","join","slice"],(function(e){var t=Dm[e];Dy.prototype[e]=function(){var e=this._wrapped;return null!=e&&(e=t.apply(e,arguments)),Nb(this,e)}}));var $b=Object.freeze({__proto__:null,VERSION:Lm,restArguments:iy,isObject:oy,isNull:function(e){return null===e},isUndefined:sy,isBoolean:ay,isElement:function(e){return!(!e||1!==e.nodeType)},isString:uy,isNumber:dy,isDate:ly,isRegExp:hy,isError:fy,isSymbol:py,isArrayBuffer:gy,isDataView:Ey,isArray:xy,isFunction:vy,isArguments:Cy,isFinite:function(e){return!py(e)&&ey(e)&&!isNaN(parseFloat(e))},isNaN:Ry,isTypedArray:Fy,isEmpty:function(e){if(null==e)return!0;var t=$y(e);return"number"==typeof t&&(xy(e)||uy(e)||Cy(e))?0===t:0===$y(Ly(e))},isMatch:By,isEqual:function(e,t){return qy(e,t)},isMap:Yy,isWeakMap:ev,isSet:tv,isWeakSet:rv,keys:Ly,allKeys:Wy,values:nv,pairs:function(e){for(var t=Ly(e),r=t.length,n=Array(r),i=0;i<r;i++)n[i]=[t[i],e[t[i]]];return n},invert:iv,functions:ov,methods:ov,extend:av,extendOwn:cv,assign:cv,defaults:uv,create:function(e,t){var r=dv(e);return t&&cv(r,t),r},clone:function(e){return oy(e)?xy(e)?e.slice():av({},e):e},tap:function(e,t){return t(e),e},get:pv,has:function(e,t){for(var r=(t=hv(t)).length,n=0;n<r;n++){var i=t[n];if(!Ay(e,i))return!1;e=e[i]}return!!r},mapObject:function(e,t,r){t=kv(t,r);for(var n=Ly(e),i=n.length,o={},s=0;s<i;s++){var a=n[s];o[a]=t(e[a],a,e)}return o},identity:gv,constant:Oy,noop:Sv,toPath:lv,property:yv,propertyOf:function(e){return null==e?Sv:function(t){return pv(e,t)}},matcher:mv,matches:mv,times:function(e,t,r){var n=Array(Math.max(0,e));t=vv(t,r,1);for(var i=0;i<e;i++)n[i]=t(i);return n},random:Ev,now:xv,escape:Cv,unescape:Rv,templateSettings:Ov,template:function(e,t,r){!t&&r&&(t=r),t=uv({},t,Dy.templateSettings);var n=RegExp([(t.escape||Pv).source,(t.interpolate||Pv).source,(t.evaluate||Pv).source].join("|")+"|$","g"),i=0,o="__p+='";e.replace(n,(function(t,r,n,s,a){return o+=e.slice(i,a).replace(Iv,Mv),i=a+t.length,r?o+="'+\n((__t=("+r+"))==null?'':_.escape(__t))+\n'":n?o+="'+\n((__t=("+n+"))==null?'':__t)+\n'":s&&(o+="';\n"+s+"\n__p+='"),t})),o+="';\n";var s,a=t.variable;if(a){if(!Nv.test(a))throw new Error("variable is not a bare identifier: "+a)}else o="with(obj||{}){\n"+o+"}\n",a="obj";o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{s=new Function(a,"_",o)}catch(e){throw e.source=o,e}var c=function(e){return s.call(this,e,Dy)};return c.source="function("+a+"){\n"+o+"}",c},result:function(e,t,r){var n=(t=hv(t)).length;if(!n)return vy(r)?r.call(e):r;for(var i=0;i<n;i++){var o=null==e?void 0:e[t[i]];void 0===o&&(o=r,i=n),e=vy(o)?o.call(e):o}return e},uniqueId:function(e){var t=++Fv+"";return e?e+t:t},chain:function(e){var t=Dy(e);return t._chain=!0,t},iteratee:wv,partial:Uv,bind:Lv,bindAll:jv,memoize:function(e,t){var r=function(n){var i=r.cache,o=""+(t?t.apply(this,arguments):n);return Ay(i,o)||(i[o]=e.apply(this,arguments)),i[o]};return r.cache={},r},delay:zv,defer:qv,throttle:function(e,t,r){var n,i,o,s,a=0;r||(r={});var c=function(){a=!1===r.leading?0:xv(),n=null,s=e.apply(i,o),n||(i=o=null)},u=function(){var u=xv();a||!1!==r.leading||(a=u);var d=t-(u-a);return i=this,o=arguments,d<=0||d>t?(n&&(clearTimeout(n),n=null),a=u,s=e.apply(i,o),n||(i=o=null)):n||!1===r.trailing||(n=setTimeout(c,d)),s};return u.cancel=function(){clearTimeout(n),a=0,n=i=o=null},u},debounce:function(e,t,r){var n,i,o,s,a,c=function(){var u=xv()-i;t>u?n=setTimeout(c,t-u):(n=null,r||(s=e.apply(a,o)),n||(o=a=null))},u=iy((function(u){return a=this,o=u,i=xv(),n||(n=setTimeout(c,t),r&&(s=e.apply(a,o))),s}));return u.cancel=function(){clearTimeout(n),n=o=a=null},u},wrap:function(e,t){return Uv(t,e)},negate:Hv,compose:function(){var e=arguments,t=e.length-1;return function(){for(var r=t,n=e[t].apply(this,arguments);r--;)n=e[r].call(this,n);return n}},after:function(e,t){return function(){if(--e<1)return t.apply(this,arguments)}},before:Wv,once:Kv,findKey:Vv,findIndex:Gv,findLastIndex:Jv,sortedIndex:Xv,indexOf:Yv,lastIndexOf:eb,find:tb,detect:tb,findWhere:function(e,t){return tb(e,mv(t))},each:rb,forEach:rb,map:nb,collect:nb,reduce:ob,foldl:ob,inject:ob,reduceRight:sb,foldr:sb,filter:ab,select:ab,reject:function(e,t,r){return ab(e,Hv(kv(t)),r)},every:cb,all:cb,some:ub,any:ub,contains:db,includes:db,include:db,invoke:lb,pluck:hb,where:function(e,t){return ab(e,mv(t))},max:fb,min:function(e,t,r){var n,i,o=1/0,s=1/0;if(null==t||"number"==typeof t&&"object"!=typeof e[0]&&null!=e)for(var a=0,c=(e=Bv(e)?e:nv(e)).length;a<c;a++)null!=(n=e[a])&&n<o&&(o=n);else t=kv(t,r),rb(e,(function(e,r,n){((i=t(e,r,n))<s||i===1/0&&o===1/0)&&(o=e,s=i)}));return o},shuffle:function(e){return mb(e,1/0)},sample:mb,sortBy:function(e,t,r){var n=0;return t=kv(t,r),hb(nb(e,(function(e,r,i){return{value:e,index:n++,criteria:t(e,r,i)}})).sort((function(e,t){var r=e.criteria,n=t.criteria;if(r!==n){if(r>n||void 0===r)return 1;if(r<n||void 0===n)return-1}return e.index-t.index})),"value")},groupBy:vb,indexBy:bb,countBy:wb,partition:kb,toArray:gb,size:function(e){return null==e?0:Bv(e)?e.length:Ly(e).length},pick:Eb,omit:xb,first:Tb,head:Tb,take:Tb,initial:Ab,last:function(e,t,r){return null==e||e.length<1?null==t||r?void 0:[]:null==t||r?e[e.length-1]:Cb(e,Math.max(0,e.length-t))},rest:Cb,tail:Cb,drop:Cb,compact:function(e){return ab(e,Boolean)},flatten:function(e,t){return Dv(e,t,!1)},without:Ob,uniq:Pb,unique:Pb,union:_b,intersection:function(e){for(var t=[],r=arguments.length,n=0,i=$y(e);n<i;n++){var o=e[n];if(!db(t,o)){var s;for(s=1;s<r&&db(arguments[s],o);s++);s===r&&t.push(o)}}return t},difference:Rb,unzip:Ib,transpose:Ib,zip:Mb,object:function(e,t){for(var r={},n=0,i=$y(e);n<i;n++)t?r[e[n]]=t[n]:r[e[n][0]]=e[n][1];return r},range:function(e,t,r){null==t&&(t=e||0,e=0),r||(r=t<e?-1:1);for(var n=Math.max(Math.ceil((t-e)/r),0),i=Array(n),o=0;o<n;o++,e+=r)i[o]=e;return i},chunk:function(e,t){if(null==t||t<1)return[];for(var r=[],n=0,i=e.length;n<i;)r.push(Hm.call(e,n,n+=t));return r},mixin:Fb,default:Dy}),Ub=Fb($b);Ub._=Ub;const Lb=e=>e.map((e=>e.name)),Bb=e=>e.map((e=>e.key)),Db=(e,t)=>{let r=[];for(let n=0;n<e.length;n++)t.indexOf(e[n])>-1&&r.push(t.indexOf(e[n]));return r.length<t.length&&t.forEach((n=>{if(-1===e.indexOf(n))for(let e=0;e<t.length;e++)if(-1===r.indexOf(e)){r.push(e);break}})),[...new Set(r.map((e=>e-Math.min(...r))))]};class jb{static sortBooks(e,t,r){let n=e.map((e=>e.key)),i=(e=>e.getAllListConfig("recentBooks"))(r);if(1===t.sort||0===t.sort)return 1===t.order?Db(i,n).reverse():Db(i,n);if(2===t.sort){let r=Lb(e),n=Lb(e).sort();return 1===t.order?Db(n,r).reverse():Db(n,r)}if(3===t.sort){let r=[];for(let t=0;t<e.length;t++)r.push(t);return 1===t.order?r.reverse():r}if(4===t.sort){let n=(e=>{let t=e.getAllObjectConfig("readingTime");var r=[];for(let e in t)r.push([e,t[e]]);return r.sort((function(e,t){return e[1]-t[1]})),Object.keys(t)})(r),i=Bb(e);return 1===t.order?Db(Ub.union(n,i),i).reverse():Db(Ub.union(n,i),i)}if(5===t.sort){let r=Bb(e),n=(e=>Ub.sortBy(e.map((e=>({key:e.key,author:e.author}))),"author").map((e=>e.key)))(e);return 1===t.order?Db(n,r).reverse():Db(n,r)}if(6===t.sort){let n=(e=>{let t=e.getAllObjectConfig("recordLocation");var r=[];for(let e in t)r.push([e,t[e].percentage||0]);return r.sort((function(e,t){return e[1]-t[1]})),r.map((e=>e[0]))})(r),i=Bb(e);return 1===t.order?Db(n,i).reverse():Db(n,i)}}static sortNotes(e,t,r=[]){if(3===t.sort){let r=Ub.clone(e).reverse(),n=Ub.uniq(e.map((e=>({chapter:e.chapter,chapterIndex:e.chapterIndex}))));n=1===t.order?Ub.sortBy(n,"chapterIndex"):Ub.sortBy(n,"chapterIndex").reverse();let i=Ub.uniq(n.map((e=>e.chapter))),o={};return i.forEach((e=>{o[e]=[]})),r.forEach((e=>{o[e.chapter].push(e)})),i.map((e=>({group:e,notes:o[e]})))||[]}if(2===t.sort){let r=Ub.clone(e).reverse(),n=Ub.uniq(e.map((e=>e.date.year+"-"+e.date.month+"-"+e.date.day)));1===t.order?n.sort():n.sort().reverse();let i={};return n.forEach((e=>{i[e]=[]})),r.forEach((e=>{n.forEach((t=>{t===e.date.year+"-"+e.date.month+"-"+e.date.day&&i[t].push(e)}))})),i||{}}if(1===t.sort){let n=Ub.clone(e).reverse(),i=Ub.uniq(e.map((e=>{let t=Ub.findLastIndex(r,{key:e.bookKey});return t>-1?r[t].name:""})));1===t.order?i.sort():i.sort().reverse();let o={};return i.forEach((e=>{o[e]=[]})),n.forEach((e=>{i.forEach((t=>{let n=Ub.findLastIndex(r,{key:e.bookKey});n>-1&&t===r[n].name&&o[t].push(e)}))})),o||{}}}static sortBookmarks(e,t){if(3===t.sort){let r=Ub.clone(e).reverse(),n=Ub.uniq(e.map((e=>({chapter:e.chapter,chapterIndex:parseInt(JSON.parse(e.cfi).chapterDocIndex)}))));n=1===t.order?Ub.sortBy(n,"chapterIndex"):Ub.sortBy(n,"chapterIndex").reverse();let i=Ub.uniq(n.map((e=>e.chapter))),o={};return i.forEach((e=>{o[e]=[]})),r.forEach((e=>{o[e.chapter].push(e)})),i.map((e=>({group:e,bookmarks:o[e]})))||[]}}}class zb{static getDefaultCss(e){return`::selection{background:#f3a6a68c}::-moz-selection{background:#f3a6a68c}.kookit-note:hover{cursor:pointer;}body,html{margin: 0px !important; padding: 0px !important; font-size: 18px;}.kookit-text{${this.getCustomCss(e)}}.kookit-title{${this.getCustomCss(e,!0)}}code,pre{white-space: pre-wrap;}p{margin-block: 0;margin-inline: 0;}${"yes"===e.getReaderConfig("isOverwriteLink")?"a{color: #0066cc !important; text-decoration: underline !important; cursor: pointer !important;}a:hover{color: #004080 !important;}a:visited{color: #6600cc !important;}":""}${"yes"===e.getReaderConfig("isMergeWord")?`h1{font-size: ${e.getReaderConfig("fontSize")||18}px !important;}`:""}`}static getCustomCss(e,t=!1){return`font-size: ${t?"":e.getReaderConfig("fontSize")?e.getReaderConfig("fontSize"):""}px !important;line-height: ${e.getReaderConfig("lineHeight")||""} !important;font-family: ${e.getReaderConfig("fontFamily")||""} !important;background-color: transparent;color: ${e.getReaderConfig("textColor")?e.getReaderConfig("textColor"):"rgba(44,47,49,1)"===e.getReaderConfig("backgroundColor")||"night"===e.getReaderConfig("appSkin")||"system"===e.getReaderConfig("appSkin")&&"yes"===e.getReaderConfig("isOSNight")?"white":""};letter-spacing: ${e.getReaderConfig("letterSpacing")||""}px !important;text-align: ${e.getReaderConfig("textAlign")?e.getReaderConfig("textAlign"):""} !important;font-weight: ${"yes"===e.getReaderConfig("isBold")?"bold !important":""};font-style: ${"yes"===e.getReaderConfig("isItalic")?"italic !important":""};text-shadow: ${"yes"===e.getReaderConfig("isShadow")?"2px 2px 2px #cccccc !important":""};text-indent: ${"yes"===e.getReaderConfig("isIndent")?"2rem":""};text-decoration: ${"yes"===e.getReaderConfig("isUnderline")?"underline !important":""};margin-bottom: ${e.getReaderConfig("paraSpacing")||0}px !important;${t?"":"padding:0px !important;"}word-wrap: break-word !important; writing-mode: horizontal-tb !important; `}}class qb{static mergeArray(e,t){var r=[];for(let t of e)r.push(t);for(let i of t){var n=!0;for(let t of e)if(i===t){n=!1;break}n&&r.push(i)}return r}static fuzzyQuery(e,t){for(var r=[],n=0;n<e.length;n++)e[n].indexOf(t.trim())>-1&&r.push(n);return r}static mouseSearch(e){let t=document.querySelector(".header-search-box").value.toLowerCase(),r=[],n=[];if(!e)return[];e.forEach((e=>{r.push(e.name.toLowerCase()),n.push(e.author.toLowerCase())}));let i=this.fuzzyQuery(r,t),o=this.fuzzyQuery(n,t);return this.mergeArray(i,o)}static keywordSearch(e,t){let r=[],n=[];if(!t)return[];t.forEach((e=>{r.push(e.name.toLowerCase()),n.push(e.author.toLowerCase())}));let i=this.fuzzyQuery(r,e),o=this.fuzzyQuery(n,e);return this.mergeArray(i,o)}static keySearch(e,t){if(e&&13===e.keyCode){let r=[],n=[];if(!t)return[];t.forEach((e=>{r.push(e.name.toLowerCase()),n.push(e.author.toLowerCase())}));let i=this.fuzzyQuery(r,e.target.value.toLowerCase()),o=this.fuzzyQuery(n,e.target.value.toLowerCase());return this.mergeArray(i,o)}}static mouseNoteSearch(e){let t=document.querySelector(".header-search-box").value.toLowerCase(),r=[],n=[];e.forEach((e=>{r.push(e.notes.toLowerCase()),n.push(e.text.toLowerCase())}));let i=this.fuzzyQuery(r,t),o=this.fuzzyQuery(n,t);return this.mergeArray(i,o)}static keyNoteSearch(e,t){if(e&&13===e.keyCode){let r=[],n=[];t.forEach((e=>{r.push(e.notes.toLowerCase()),n.push(e.text.toLowerCase())}));let i=this.fuzzyQuery(r,e.target.value.toLowerCase()),o=this.fuzzyQuery(n,e.target.value.toLowerCase());return this.mergeArray(i,o)}}}export{Sm as BookHelper,p as CommonTool,_m as ConfigService,v as KookitConfig,Om as LoginHelper,Tm as ReaderRequest,qb as SearchUtil,jb as SortUtil,wm as SqlStatement,zb as StyleHelper,Pm as SyncHelper,fm as SyncUtil,Cm as ThirdpartyRequest,Nm as TokenService,Rm as UserRequest};
